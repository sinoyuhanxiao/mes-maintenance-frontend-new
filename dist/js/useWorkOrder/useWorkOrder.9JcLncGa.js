const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../element-plus/element-plus.CU5xiOkY.js","../vue/vue.Dfo81L2Q.js","../@vue/@vue.CVGyaoMH.js","../lodash-es/lodash-es.BLHqGvLj.js","../@element-plus/@element-plus.BNeHluFm.js","../@popperjs/@popperjs.D_chPuIy.js","../@ctrl/@ctrl.r5W6hzzQ.js","../dayjs/dayjs.C0sY0_St.js","../async-validator/async-validator.D3FX-SGt.js","../memoize-one/memoize-one.BdPwpGay.js","../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js","../@floating-ui/@floating-ui.85_40PfK.js","../../assets/element-plus-HhdsBjgU.css"])))=>i.map(i=>d[i]);
import"../vue/vue.Dfo81L2Q.js";import{m as pe,a6 as _e}from"../@element-plus/@element-plus.BNeHluFm.js";import{l as ue,d as ve,a as ce,g as me,m as we,s as De}from"../work-order/work-order.DahU_I_M.js";import{_ as he}from"../../assets/index-CE-d1vf_.js";import{am as B,c as E,o as V,a as q,O,S as i,L as y,R as T,Q as C,F as z,a8 as le,r as v,q as fe,w as oe,j as N,t as ye,_ as de}from"../@vue/@vue.CVGyaoMH.js";import{_ as ke}from"../geotiff/geotiff.Dp1pzeXC.js";import{u as ge}from"../vue-i18n/vue-i18n.DjO1PVT4.js";import{u as Oe}from"../commonData/commonData.B4nBUyAw.js";import{f as ie,E as se}from"../element-plus/element-plus.CU5xiOkY.js";const be={__name:"RecurrenceEditor",props:{workOrderStartDate:{type:String,default:null},workOrderDueDate:{type:String,default:null},recurrenceSetting:{type:Object,default:()=>({})}},emits:["update:recurrenceSetting"],setup(a,{expose:u,emit:I}){u();const r=v(null),w=v(null),D=v("none"),h=v(1),b=v([]),l=v(1),Y=v(1),H=v(1),F=v(1),W=v(1),k=v(null),M=v(null),g=a,s=I,x=v([]),U=v({}),Z=async()=>{try{const e=await ue();if(e.data){x.value=e.data;const n={};e.data.forEach(o=>{var d,m;switch(((d=o.name)==null?void 0:d.toLowerCase())||((m=o.type)==null?void 0:m.toLowerCase())){case"none":case"does not repeat":case"不重复":n.none=o.id;break;case"daily":case"每日":n.daily=o.id;break;case"weekly":case"每周":n.weekly=o.id;break;case"monthly":case"monthly (by date)":case"每月 (按日期)":n.monthlyByDate=o.id;break;case"yearly":case"每年":n.yearly=o.id;break;default:n[o.id]=o.id}}),U.value=n}}catch(e){console.error("Failed to load recurrence types:",e),U.value={none:1,daily:2,weekly:3,monthlyByDate:4,yearly:5}}},P=()=>{if(!g.recurrenceSetting||Object.keys(g.recurrenceSetting).length===0)return;const e=g.recurrenceSetting;let n="none";if(e.recurrence_type){for(const[o,d]of Object.entries(U.value))if(d===e.recurrence_type){n=o;break}}D.value=n,n==="none"?(e.start_date_time&&(r.value=e.start_date_time),e.end_date_time&&(w.value=e.end_date_time)):(e.start_time&&(k.value=e.start_time),e.end_time&&(M.value=e.end_time),n==="weekly"?(e.interval&&(h.value=e.interval),e.days_of_week&&(b.value=e.days_of_week)):n==="monthlyByDate"?(e.interval&&(l.value=e.interval),e.day_of_month&&(Y.value=e.day_of_month)):n==="yearly"&&(e.interval&&(H.value=e.interval),e.month&&(F.value=e.month),e.day_of_month&&(W.value=e.day_of_month)))};fe(async()=>{await Z(),P()}),oe(()=>g.recurrenceSetting,()=>{Object.keys(U.value).length>0&&P()},{deep:!0});const Q=e=>{const n=new Date;n.setDate(n.getDate()-30);const o=new Date;if(o.setFullYear(o.getFullYear()+2),e<n||e>o)return!0;if(g.workOrderStartDate){const d=new Date(g.workOrderStartDate);d.setHours(0,0,0,0);const m=new Date(e);return m.setHours(0,0,0,0),m<d}return!1},X=e=>{if(!r.value)return!1;const n=new Date(r.value);n.setHours(0,0,0,0);const o=new Date;if(o.setFullYear(o.getFullYear()+2),e<n||e>o)return!0;if(g.workOrderDueDate){const d=new Date(g.workOrderDueDate);d.setHours(23,59,59,999);const m=new Date(e);return m.setHours(0,0,0,0),m>d}return!1},ee=()=>{if(!g.workOrderStartDate||!r.value)return[];const e=new Date(g.workOrderStartDate),n=new Date(r.value);if(e.toDateString()===n.toDateString()){const o=[];for(let d=0;d<e.getHours();d++)o.push(d);return o}return[]},G=e=>{if(!g.workOrderStartDate||!r.value)return[];const n=new Date(g.workOrderStartDate),o=new Date(r.value);if(n.toDateString()===o.toDateString()&&e===n.getHours()){const d=[];for(let m=0;m<n.getMinutes();m++)d.push(m);return d}return[]},re=()=>{if(!r.value||!w.value)return[];const e=new Date(r.value),n=new Date(w.value),o=[];if(e.toDateString()===n.toDateString())for(let d=0;d<e.getHours();d++)o.push(d);if(g.workOrderDueDate){const d=new Date(g.workOrderDueDate);if(d.toDateString()===n.toDateString())for(let m=d.getHours()+1;m<=23;m++)o.push(m)}return o},te=e=>{if(!r.value||!w.value)return[];const n=new Date(r.value),o=new Date(w.value),d=[];if(n.toDateString()===o.toDateString()&&e===n.getHours())for(let m=0;m<=n.getMinutes();m++)d.push(m);if(g.workOrderDueDate){const m=new Date(g.workOrderDueDate);if(m.toDateString()===o.toDateString()&&e===m.getHours())for(let A=m.getMinutes()+1;A<=59;A++)d.push(A)}return d},L=()=>g.workOrderStartDate?new Date(g.workOrderStartDate).toISOString().split("T")[0]:null,t=()=>g.workOrderDueDate?new Date(g.workOrderDueDate).toISOString().split("T")[0]:null,c=()=>{if(!k.value)return[];const[e]=k.value.split(":").map(Number),n=[];for(let o=0;o<e;o++)n.push(o);return n},f=e=>{if(!k.value)return[];const[n,o]=k.value.split(":").map(Number),d=[];if(e===n)for(let m=0;m<=o;m++)d.push(m);return d},p=()=>{if(!r.value||!w.value)return 0;const e=new Date(r.value),o=new Date(w.value)-e;return o>0?Math.ceil(o/(1e3*60)):0},S=e=>{if(e<60)return`${e} minutes`;const n=Math.floor(e/60),o=e%60;return o===0?`${n} hour${n!==1?"s":""}`:`${n}h ${o}m`},_=()=>{if(!k.value||!M.value)return 0;const[e,n]=k.value.split(":").map(Number),[o,d]=M.value.split(":").map(Number),m=e*60+n,A=o*60+d;return A>m?A-m:0},R=N(()=>{const e=p();return e>0&&e<=1440}),$=N(()=>{if(D.value==="none"){if(!g.workOrderStartDate||!r.value)return!1;const e=new Date(g.workOrderStartDate);return new Date(r.value)<e}return!1}),ae=N(()=>_()>0),ne=N(()=>!k.value||!M.value?!1:_()===0),J=N(()=>{const e={};if(D.value==="none")if(r.value&&(e.start_date_time=new Date(r.value).toISOString()),w.value&&(e.end_date_time=new Date(w.value).toISOString()),r.value&&w.value){const n=new Date(r.value),d=new Date(w.value)-n,m=Math.ceil(d/(1e3*60));e.duration_minutes=m>0?m:0}else e.duration_minutes=0;else if(["daily","weekly","monthlyByDate","yearly"].includes(D.value)){const n=L(),o=t();if(n&&k.value){const d=new Date(`${n}T${k.value}`);e.start_date_time=d.toISOString()}if(o&&M.value){const d=new Date(`${o}T${M.value}`);e.end_date_time=d.toISOString()}e.start_time=k.value,e.end_time=M.value,e.duration_minutes=_()}return e.recurrence_type=U.value[D.value]||1,D.value==="daily"?e.interval=1:D.value==="weekly"?(e.interval=h.value,e.days_of_week=b.value.filter(n=>typeof n=="number")):D.value==="monthlyByDate"?(e.interval=l.value,e.day_of_month=Y.value):D.value==="yearly"&&(e.interval=H.value,e.month_of_year=F.value,e.day_of_month=W.value),e});let j=!1;oe(J,e=>{j||(j=!0,s("update:recurrenceSetting",e),ye(()=>{j=!1}))},{deep:!0});const K={startDate:r,endDate:w,recurrence:D,repeatInterval:h,selectedDays:b,monthlyRepeatInterval:l,monthlyDate:Y,yearlyRepeatInterval:H,yearlyMonth:F,yearlyDay:W,startTime:k,endTime:M,props:g,emit:s,recurrenceTypes:x,recurrenceTypeMap:U,loadRecurrenceTypes:Z,initializeFromRecurrenceSetting:P,disabledStartDate:Q,disabledEndDate:X,disabledStartHours:ee,disabledStartMinutes:G,disabledEndHours:re,disabledEndMinutes:te,getWorkOrderStartDate:L,getWorkOrderDueDate:t,disabledEndTimeHours:c,disabledEndTimeMinutes:f,calculateDuration:p,formatDuration:S,calculateTimeDuration:_,showDurationWarning:R,showRecurrenceStartWarning:$,showTimeDurationInfo:ae,showTimeValidationError:ne,recurrenceSetting:J,get isUpdating(){return j},set isUpdating(e){j=e},ref:v,watch:oe,computed:N,onMounted:fe,nextTick:ye,get Warning(){return _e},get Clock(){return pe},get getAllRecurrenceTypes(){return ue}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}},Se={class:"recurrence-editor"},Te={key:0,class:"weekly-interval-selection"},Me={class:"repeat-interval"},Re={key:1,class:"weekly-selection"},Ee={key:0,class:"monthly-by-date-selection"},Ve={class:"repeat-interval"},He={key:1,class:"yearly-selection"},Fe={class:"repeat-interval"},qe={key:0,class:"recurrence-warning"},Ie={key:0,class:"duration-warning"},Ce={key:0,class:"duration-info"},Ye={key:1,class:"time-validation-error"};function We(a,u,I,r,w,D){const h=B("el-option"),b=B("el-select"),l=B("el-form-item"),Y=B("el-input-number"),H=B("el-checkbox-button"),F=B("el-checkbox-group"),W=B("el-date-picker"),k=B("el-icon"),M=B("el-text"),g=B("el-time-picker");return V(),E(z,null,[q("div",Se,[i(l,{label:a.$t("workOrder.create.recurrenceSettings"),prop:"recurrence_type","show-message":!1,required:""},{default:y(()=>[i(b,{modelValue:r.recurrence,"onUpdate:modelValue":u[0]||(u[0]=s=>r.recurrence=s),placeholder:a.$t("workOrder.placeholder.selectRecurrence"),style:{width:"500px"},clearable:""},{default:y(()=>[i(h,{label:a.$t("workOrder.recurrence.none"),value:"none"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.daily"),value:"daily"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.weekly"),value:"weekly"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.monthlyByDate"),value:"monthlyByDate"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.yearly"),value:"yearly"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),O(" Weekly Interval Selection "),r.recurrence==="weekly"?(V(),E("div",Te,[i(l,{label:""},{default:y(()=>[q("div",Me,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.repeatInterval,"onUpdate:modelValue":u[1]||(u[1]=s=>r.repeatInterval=s),min:1,max:52,style:{width:"120px",margin:"0 10px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.weeksRepeat")),1)])]),_:1})])):O("v-if",!0),O(" Days of the Week Selection "),r.recurrence==="weekly"?(V(),E("div",Re,[i(l,{label:""},{default:y(()=>[i(F,{modelValue:r.selectedDays,"onUpdate:modelValue":u[2]||(u[2]=s=>r.selectedDays=s),onChange:a.handleDaySelectionChange},{default:y(()=>[i(H,{label:1},{default:y(()=>[C(T(a.$t("workOrder.days.monday")),1)]),_:1}),i(H,{label:2},{default:y(()=>[C(T(a.$t("workOrder.days.tuesday")),1)]),_:1}),i(H,{label:3},{default:y(()=>[C(T(a.$t("workOrder.days.wednesday")),1)]),_:1}),i(H,{label:4},{default:y(()=>[C(T(a.$t("workOrder.days.thursday")),1)]),_:1}),i(H,{label:5},{default:y(()=>[C(T(a.$t("workOrder.days.friday")),1)]),_:1}),i(H,{label:6},{default:y(()=>[C(T(a.$t("workOrder.days.saturday")),1)]),_:1}),i(H,{label:0},{default:y(()=>[C(T(a.$t("workOrder.days.sunday")),1)]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})])):O("v-if",!0)]),O(" Monthly By Date Selection "),r.recurrence==="monthlyByDate"?(V(),E("div",Ee,[i(l,{label:""},{default:y(()=>[q("div",Ve,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.monthlyRepeatInterval,"onUpdate:modelValue":u[3]||(u[3]=s=>r.monthlyRepeatInterval=s),min:1,max:12,style:{width:"120px",margin:"0 10px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.monthsOn")),1),i(b,{modelValue:r.monthlyDate,"onUpdate:modelValue":u[4]||(u[4]=s=>r.monthlyDate=s),placeholder:a.$t("workOrder.recurrence.selectDate"),style:{width:"100px",margin:"0 10px"}},{default:y(()=>[(V(),E(z,null,le(31,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.dayOfMonth")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),q("span",null,T(a.$t("workOrder.recurrence.repeat")),1)])]),_:1})])):O("v-if",!0),O(" Yearly Selection "),r.recurrence==="yearly"?(V(),E("div",He,[i(l,{label:""},{default:y(()=>[q("div",Fe,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.yearlyRepeatInterval,"onUpdate:modelValue":u[5]||(u[5]=s=>r.yearlyRepeatInterval=s),min:1,max:10,style:{width:"120px",margin:"0 6px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.yearsOn")),1),i(b,{modelValue:r.yearlyMonth,"onUpdate:modelValue":u[6]||(u[6]=s=>r.yearlyMonth=s),placeholder:a.$t("workOrder.recurrence.selectMonth"),style:{width:"100px",margin:"0 6px"}},{default:y(()=>[(V(),E(z,null,le(12,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.month")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),i(b,{modelValue:r.yearlyDay,"onUpdate:modelValue":u[7]||(u[7]=s=>r.yearlyDay=s),placeholder:a.$t("workOrder.recurrence.selectDate"),style:{width:"100px",margin:"0 6px"}},{default:y(()=>[(V(),E(z,null,le(31,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.dayOfMonth")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),q("span",null,T(a.$t("workOrder.recurrence.repeat")),1)])]),_:1})])):O("v-if",!0),O(" For 'none' recurrence, use date-time fields "),r.recurrence==="none"?(V(),E(z,{key:2},[O(" Start Date Time Selection "),i(l,{label:a.$t("workOrder.recurrence.startDateTime"),prop:"recurrence_setting.start_date_time",required:"","show-message":!1},{default:y(()=>[i(W,{modelValue:r.startDate,"onUpdate:modelValue":u[8]||(u[8]=s=>r.startDate=s),type:"datetime",placeholder:a.$t("workOrder.recurrence.selectStartTime"),format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"500px"},"disabled-date":r.disabledStartDate,"disabled-hours":r.disabledStartHours,"disabled-minutes":r.disabledStartMinutes},null,8,["modelValue","placeholder"]),r.showRecurrenceStartWarning?(V(),E("div",qe,[i(M,{type:"warning",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),u[12]||(u[12]=C(" Recurrence start time should not be before work order start time "))]),_:1,__:[12]})])):O("v-if",!0)]),_:1},8,["label"]),O(" End Date Time Selection "),i(l,{label:a.$t("workOrder.recurrence.endDateTime"),prop:"recurrence_setting.end_date_time",required:"","show-message":!1},{default:y(()=>[i(W,{modelValue:r.endDate,"onUpdate:modelValue":u[9]||(u[9]=s=>r.endDate=s),type:"datetime",placeholder:a.$t("workOrder.recurrence.selectEndTime"),format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"500px"},"disabled-date":r.disabledEndDate,"disabled-hours":r.disabledEndHours,"disabled-minutes":r.disabledEndMinutes},null,8,["modelValue","placeholder"]),r.showDurationWarning?(V(),E("div",Ie,[i(M,{type:"warning",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),C(" Duration: "+T(r.formatDuration(r.calculateDuration())),1)]),_:1})])):O("v-if",!0)]),_:1},8,["label"])],64)):["daily","weekly","monthlyByDate","yearly"].includes(r.recurrence)?(V(),E(z,{key:3},[O(" For recurring types, use only time fields "),O(" Start Time Selection "),i(l,{label:a.$t("workOrder.recurrence.startTime"),prop:"recurrence_setting.start_time",required:"","show-message":!1},{default:y(()=>[i(g,{modelValue:r.startTime,"onUpdate:modelValue":u[10]||(u[10]=s=>r.startTime=s),placeholder:a.$t("workOrder.recurrence.selectStartTime"),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"500px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),O(" End Time Selection "),i(l,{label:a.$t("workOrder.recurrence.endTime"),prop:"recurrence_setting.end_time",required:"","show-message":!1},{default:y(()=>[i(g,{modelValue:r.endTime,"onUpdate:modelValue":u[11]||(u[11]=s=>r.endTime=s),placeholder:a.$t("workOrder.recurrence.selectEndTime"),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"500px"},"disabled-hours":r.disabledEndTimeHours,"disabled-minutes":r.disabledEndTimeMinutes},null,8,["modelValue","placeholder"]),r.showTimeDurationInfo?(V(),E("div",Ce,[i(M,{type:"info",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Clock)]),_:1}),C(" Duration: "+T(r.formatDuration(r.calculateTimeDuration())),1)]),_:1})])):O("v-if",!0),r.showTimeValidationError?(V(),E("div",Ye,[i(M,{type:"danger",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),u[13]||(u[13]=C(" End time must be after start time "))]),_:1,__:[13]})])):O("v-if",!0)]),_:1},8,["label"])],64)):O("v-if",!0)],64)}const xe=he(be,[["render",We],["__scopeId","data-v-4ef2c0cb"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/components/RecurrenceEditor.vue"]]);function Ze(){const{t:a}=ge(),u=Oe(),I=v(!1),r=v([]),w=v(0),D=v(new Set),h=v(!1),b=v(null),l=de({page:1,limit:20,importance:void 0,title:void 0,type:void 0,latest_per_recurrence:!0,assignedTo:void 0,priority:void 0,workType:void 0,status:void 0,search:void 0,dueDate:void 0,customDateRange:void 0,recurrence:void 0,sort:"created_at_desc"}),Y=N(()=>r.value&&r.value.length>0),H=N(()=>!I.value&&!Y.value),F=async(t={})=>{I.value=!0;try{const c={...t};l.assignedTo&&(c.assignedTo=l.assignedTo),l.priority&&(c.priority=l.priority),l.workType&&(c.workType=l.workType),l.status&&(c.status=l.status),l.search&&(c.search=l.search),l.dueDate&&(c.dueDate=l.dueDate),l.customDateRange&&(c.customDateRange=l.customDateRange),l.recurrence&&(c.recurrence=l.recurrence);let f,p;l.page===-1&&l.limit===-1?(f=await we(L()),p=f.data):(f=await De(l.page,l.limit,"createdAt","DESC",L()),p=f.data.content),w.value=f.data.totalElements||f.data.length,r.value=p.map(S=>{var _;return((_=S.recurrence_type)==null?void 0:_.id)!==1?{...S,children:null,hasChildren:!0}:S})}catch(c){console.error("Failed to fetch work orders:",c),se.error(a("workOrder.messages.loadingFailed"))}finally{I.value=!1}},W=async(t,c={})=>{I.value=!0;try{h.value=!0,b.value=t;const f=await me(t,l.page,l.limit,"createdAt","DESC");r.value=f.data.content||[],w.value=f.data.totalElements||0,r.value=r.value.map(p=>({...p,hasChildren:!1}))}catch(f){console.error("Failed to fetch recurring work orders:",f),se.error(a("workOrder.messages.loadingFailed"))}finally{I.value=!1}},k=()=>{h.value=!1,b.value=null,l.page=1,F()},M=async(t,c,f)=>{try{const p=t.recurrence_uuid;if(!p)return f([]);let _=(await me(p)).data.content;_=_.filter(R=>R.id!==t.id),t.children=_,f(_.map(R=>({...R,hasChildren:!1})))}catch(p){console.error("Error loading children:",p),f([])}},g=()=>{l.page=1,F()},s=t=>{Object.keys(t).forEach(c=>{Object.prototype.hasOwnProperty.call(l,c)&&(l[c]=t[c])}),l.page=1,F()},x=t=>{l.limit=t,l.page=1,h.value&&b.value?W(b.value):F()},U=t=>{l.page=t,h.value&&b.value?W(b.value):F()},Z=(t,c)=>{c?(D.value.add(t.id),t.children&&t.children.forEach(f=>D.value.add(f.id))):(D.value.delete(t.id),t.children&&t.children.forEach(f=>D.value.delete(f.id)))},P=({row:t})=>D.value.has(t.id)?"expanded-highlight":"",Q=async(t,c)=>{try{if(t.recurrence_type&&t.recurrence_type.id!==1&&t.recurrence_uuid){const{ElMessageBox:p}=await ke(async()=>{const{ElMessageBox:_}=await import("../element-plus/element-plus.CU5xiOkY.js").then(R=>R.h);return{ElMessageBox:_}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url);if(await p.confirm("This is a recurring work order. Choose which work orders you want to delete:","Delete Work Order",{confirmButtonText:"Delete Recurrence",cancelButtonText:"Delete Individual",distinguishCancelAndClose:!0,type:"warning",customClass:"delete-recurrence-dialog"}).catch(_=>{if(_==="cancel")return"individual";throw new Error("User cancelled")})==="confirm"){await ve(t.recurrence_uuid),ie({title:a("common.success"),message:"All recurring work orders deleted successfully",type:"success",duration:3e3});const _=[];r.value.forEach((R,$)=>{R.recurrence_uuid===t.recurrence_uuid&&_.push($)}),_.reverse().forEach(R=>{r.value.splice(R,1)})}else await ce(t.id),ie({title:a("common.success"),message:a("workOrder.messages.deleteSuccess"),type:"success",duration:2e3}),r.value.splice(c,1)}else await ce(t.id),ie({title:a("common.success"),message:a("workOrder.messages.deleteSuccess"),type:"success",duration:2e3}),r.value.splice(c,1);w.value=Math.max(0,w.value-1)}catch(f){console.error("Delete failed:",f),f.message!=="User cancelled"&&se.error(a("workOrder.messages.deleteFailed"))}},X=async()=>{try{await Promise.all([u.fetchPriorities(),u.fetchWorkTypes(),u.fetchCategories(),u.fetchStates()])}catch(t){console.error("Failed to initialize common data:",t)}},ee=24*60*60*1e3,G=t=>{const c=t instanceof Date?t:new Date(t);return new Date(c.getFullYear(),c.getMonth(),c.getDate())},re=t=>{const c=G(t);return new Date(c.getTime()+ee-1)},te=(t=new Date)=>{const c=l==null?void 0:l.dueDate;if(!c)return{};const f=G(t),p=t.getFullYear(),S=t.getMonth(),_=t.getDate(),R=t.getDay(),$=new Date(p,S,_-R),ae=new Date(p,S,_-R+7),ne=new Date(ae.getTime()-1),J=new Date(p,S,1),j=new Date(p,S+1,1),K=new Date(j.getTime()-1);switch(c){case"overdue":return{due_date_to:f};case"today":return{due_date_from:f,due_date_to:re(f)};case"thisWeek":return{due_date_from:$,due_date_to:ne};case"thisMonth":return{due_date_from:J,due_date_to:K};case"custom":return{};default:return{}}},L=()=>{const t=l,c={keyword:t.search||null,work_type_ids:t.workType?[t.workType]:[],priority_ids:t.priority?[t.priority]:[],state_ids:t.state?[t.state]:[],category_ids:t.category?[t.category]:[],recurrence_type_id:t.recurrence||null,latest_per_recurrence:t.latest_per_recurrence,start_date_from:t.start_date_from,end_date_to:t.end_date_to},f=te();return Object.assign(c,f),Object.keys(c).forEach(p=>{const S=c[p];(S==null||Array.isArray(S)&&S.length===0)&&delete c[p]}),c};return{loading:I,list:r,total:w,listQuery:l,expandedRows:D,recurrenceViewMode:h,currentRecurrenceId:b,hasData:Y,isEmpty:H,fetchWorkOrders:F,fetchRecurringWorkOrders:W,exitRecurrenceView:k,loadChildren:M,handleFilter:g,updateFilters:s,handleSizeChange:x,handleCurrentChange:U,toggleRowHighlight:Z,getRowClass:P,handleDelete:Q,initializeCommonData:X}}function Ge(){const{t:a}=ge(),u=de({name:"",description:"",estimated_minutes:30,production_line_id:null,equipment_group_id:null,equipment_id:null,component_id:null,priority_id:null,category_id:null,work_type_id:null,state_id:1,halt_type:0,time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,created_by:37,recurrence_type:null,image_list:[],files_list:[],recurrence_setting:{}}),I=de({name:[{required:!0,message:a("workOrder.validation.nameRequired"),trigger:"blur"}],halt_type:[{required:!0,message:a("workOrder.validation.haltTypeRequired"),trigger:"change"}],production_line_id:[{required:!0,message:a("workOrder.validation.productionLineRequired"),trigger:"change"}],priority_id:[{required:!0,message:a("workOrder.validation.priorityRequired"),trigger:"change"}],category_id:[{required:!0,message:a("workOrder.validation.categoryRequired"),trigger:"change"}],work_type_id:[{required:!0,message:a("workOrder.validation.workTypeRequired"),trigger:"change"}],recurrence_type:[{required:!0,message:a("workOrder.validation.recurrenceRequired"),trigger:"change"}],"recurrence_setting.start_date_time":[{required:!0,message:a("workOrder.validation.startDateRequired"),trigger:"change"}],"recurrence_setting.end_date_time":[{required:!0,message:a("workOrder.validation.endDateRequired"),trigger:"change"}]});return{form:u,rules:I,resetForm:()=>{Object.assign(u,{name:"",description:"",estimated_minutes:30,production_line_id:null,equipment_group_id:null,equipment_id:null,component_id:null,priority_id:null,category_id:null,work_type_id:null,state_id:1,halt_type:0,time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,created_by:37,recurrence_type:null,image_list:[],files_list:[],recurrence_setting:{}})},validateForm:D=>new Promise(h=>{D.validate(b=>{h(b)})})}}export{xe as R,Ge as a,Ze as u};
