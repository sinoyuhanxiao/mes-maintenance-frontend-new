const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../element-plus/element-plus.CU5xiOkY.js","../vue/vue.Dfo81L2Q.js","../@vue/@vue.CVGyaoMH.js","../lodash-es/lodash-es.BLHqGvLj.js","../@element-plus/@element-plus.BNeHluFm.js","../@popperjs/@popperjs.D_chPuIy.js","../@ctrl/@ctrl.r5W6hzzQ.js","../dayjs/dayjs.C0sY0_St.js","../async-validator/async-validator.D3FX-SGt.js","../memoize-one/memoize-one.BdPwpGay.js","../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js","../@floating-ui/@floating-ui.85_40PfK.js","../../assets/element-plus-HhdsBjgU.css"])))=>i.map(i=>d[i]);
import"../vue/vue.Dfo81L2Q.js";import{m as fe,a6 as ye}from"../@element-plus/@element-plus.BNeHluFm.js";import{l as se,d as _e,a as de,g as ue,m as pe,s as ge}from"../work-order/work-order.CtSeOWtO.js";import{_ as ve}from"../../assets/index-fCswSekQ.js";import{am as B,c as E,o as V,a as q,O as b,S as i,L as y,R as T,Q as C,F as A,a8 as ae,r as g,q as ce,w as ne,j as N,_ as ie}from"../@vue/@vue.CVGyaoMH.js";import{_ as we}from"../geotiff/geotiff.Dp1pzeXC.js";import{u as me}from"../vue-i18n/vue-i18n.DjO1PVT4.js";import{u as he}from"../commonData/commonData.BC1BHJWB.js";import{f as le,E as oe}from"../element-plus/element-plus.CU5xiOkY.js";const De={__name:"RecurrenceEditor",props:{workOrderStartDate:{type:String,default:null},workOrderDueDate:{type:String,default:null},recurrenceSetting:{type:Object,default:()=>({})}},emits:["update:recurrenceSetting"],setup(a,{expose:d,emit:I}){d();const r=g(null),v=g(null),w=g("none"),h=g(1),S=g([]),o=g(1),Y=g(1),H=g(1),F=g(1),W=g(1),k=g(null),M=g(null),_=a,s=I,$=g([]),U=g({}),x=async()=>{try{const e=await se();if(e.data){$.value=e.data;const n={};e.data.forEach(l=>{var c,m;switch(((c=l.name)==null?void 0:c.toLowerCase())||((m=l.type)==null?void 0:m.toLowerCase())){case"none":case"does not repeat":case"不重复":n.none=l.id;break;case"daily":case"每日":n.daily=l.id;break;case"weekly":case"每周":n.weekly=l.id;break;case"monthly":case"monthly (by date)":case"每月 (按日期)":n.monthlyByDate=l.id;break;case"yearly":case"每年":n.yearly=l.id;break;default:n[l.id]=l.id}}),U.value=n}}catch(e){console.error("Failed to load recurrence types:",e),U.value={none:1,daily:2,weekly:3,monthlyByDate:4,yearly:5}}},z=()=>{if(!_.recurrenceSetting||Object.keys(_.recurrenceSetting).length===0)return;const e=_.recurrenceSetting;let n="none";if(e.recurrence_type){for(const[l,c]of Object.entries(U.value))if(c===e.recurrence_type){n=l;break}}w.value=n,n==="none"?(e.start_date_time&&(r.value=e.start_date_time),e.end_date_time&&(v.value=e.end_date_time)):(e.start_time&&(k.value=e.start_time),e.end_time&&(M.value=e.end_time),n==="weekly"?(e.interval&&(h.value=e.interval),e.days_of_week&&(S.value=e.days_of_week)):n==="monthlyByDate"?(e.interval&&(o.value=e.interval),e.day_of_month&&(Y.value=e.day_of_month)):n==="yearly"&&(e.interval&&(H.value=e.interval),e.month&&(F.value=e.month),e.day_of_month&&(W.value=e.day_of_month)))};ce(async()=>{await x(),z()}),ne(()=>_.recurrenceSetting,()=>{Object.keys(U.value).length>0&&z()},{deep:!0});const K=e=>{const n=new Date;n.setDate(n.getDate()-30);const l=new Date;if(l.setFullYear(l.getFullYear()+2),e<n||e>l)return!0;if(_.workOrderStartDate){const c=new Date(_.workOrderStartDate);c.setHours(0,0,0,0);const m=new Date(e);return m.setHours(0,0,0,0),m<c}return!1},Q=e=>{if(!r.value)return!1;const n=new Date(r.value);n.setHours(0,0,0,0);const l=new Date;if(l.setFullYear(l.getFullYear()+2),e<n||e>l)return!0;if(_.workOrderDueDate){const c=new Date(_.workOrderDueDate);c.setHours(23,59,59,999);const m=new Date(e);return m.setHours(0,0,0,0),m>c}return!1},X=()=>{if(!_.workOrderStartDate||!r.value)return[];const e=new Date(_.workOrderStartDate),n=new Date(r.value);if(e.toDateString()===n.toDateString()){const l=[];for(let c=0;c<e.getHours();c++)l.push(c);return l}return[]},Z=e=>{if(!_.workOrderStartDate||!r.value)return[];const n=new Date(_.workOrderStartDate),l=new Date(r.value);if(n.toDateString()===l.toDateString()&&e===n.getHours()){const c=[];for(let m=0;m<n.getMinutes();m++)c.push(m);return c}return[]},ee=()=>{if(!r.value||!v.value)return[];const e=new Date(r.value),n=new Date(v.value),l=[];if(e.toDateString()===n.toDateString())for(let c=0;c<e.getHours();c++)l.push(c);if(_.workOrderDueDate){const c=new Date(_.workOrderDueDate);if(c.toDateString()===n.toDateString())for(let m=c.getHours()+1;m<=23;m++)l.push(m)}return l},re=e=>{if(!r.value||!v.value)return[];const n=new Date(r.value),l=new Date(v.value),c=[];if(n.toDateString()===l.toDateString()&&e===n.getHours())for(let m=0;m<=n.getMinutes();m++)c.push(m);if(_.workOrderDueDate){const m=new Date(_.workOrderDueDate);if(m.toDateString()===l.toDateString()&&e===m.getHours())for(let j=m.getMinutes()+1;j<=59;j++)c.push(j)}return c},P=()=>_.workOrderStartDate?new Date(_.workOrderStartDate).toISOString().split("T")[0]:null,t=()=>{if(!k.value)return[];const[e]=k.value.split(":").map(Number),n=[];for(let l=0;l<e;l++)n.push(l);return n},u=e=>{if(!k.value)return[];const[n,l]=k.value.split(":").map(Number),c=[];if(e===n)for(let m=0;m<=l;m++)c.push(m);return c},f=()=>{if(!r.value||!v.value)return 0;const e=new Date(r.value),l=new Date(v.value)-e;return l>0?Math.ceil(l/(1e3*60)):0},p=e=>{if(e<60)return`${e} minutes`;const n=Math.floor(e/60),l=e%60;return l===0?`${n} hour${n!==1?"s":""}`:`${n}h ${l}m`},D=()=>{if(!k.value||!M.value)return 0;const[e,n]=k.value.split(":").map(Number),[l,c]=M.value.split(":").map(Number),m=e*60+n,j=l*60+c;return j>m?j-m:0},O=N(()=>{const e=f();return e>0&&e<=1440}),R=N(()=>{if(w.value==="none"){if(!_.workOrderStartDate||!r.value)return!1;const e=new Date(_.workOrderStartDate);return new Date(r.value)<e}return!1}),L=N(()=>D()>0),te=N(()=>!k.value||!M.value?!1:D()===0),G=N(()=>{const e={};if(w.value==="none")if(r.value&&(e.start_date_time=new Date(r.value).toISOString()),v.value&&(e.end_date_time=new Date(v.value).toISOString()),r.value&&v.value){const n=new Date(r.value),c=new Date(v.value)-n,m=Math.ceil(c/(1e3*60));e.duration_minutes=m>0?m:0}else e.duration_minutes=0;else if(["daily","weekly","monthlyByDate","yearly"].includes(w.value)){const n=P();if(n&&k.value){const l=new Date(`${n}T${k.value}`);e.start_date_time=l.toISOString()}if(n&&M.value){const l=new Date(`${n}T${M.value}`);e.end_date_time=l.toISOString()}e.start_time=k.value,e.end_time=M.value,e.duration_minutes=D()}return e.recurrence_type=U.value[w.value]||1,w.value==="daily"?e.interval=1:w.value==="weekly"?(e.interval=h.value,e.days_of_week=S.value.filter(n=>typeof n=="number")):w.value==="monthlyByDate"?(e.interval=o.value,e.day_of_month=Y.value):w.value==="yearly"&&(e.interval=H.value,e.month_of_year=F.value,e.day_of_month=W.value),e});ne(G,e=>{s("update:recurrenceSetting",e)},{deep:!0});const J={startDate:r,endDate:v,recurrence:w,repeatInterval:h,selectedDays:S,monthlyRepeatInterval:o,monthlyDate:Y,yearlyRepeatInterval:H,yearlyMonth:F,yearlyDay:W,startTime:k,endTime:M,props:_,emit:s,recurrenceTypes:$,recurrenceTypeMap:U,loadRecurrenceTypes:x,initializeFromRecurrenceSetting:z,disabledStartDate:K,disabledEndDate:Q,disabledStartHours:X,disabledStartMinutes:Z,disabledEndHours:ee,disabledEndMinutes:re,getWorkOrderDate:P,disabledEndTimeHours:t,disabledEndTimeMinutes:u,calculateDuration:f,formatDuration:p,calculateTimeDuration:D,showDurationWarning:O,showRecurrenceStartWarning:R,showTimeDurationInfo:L,showTimeValidationError:te,recurrenceSetting:G,ref:g,watch:ne,computed:N,onMounted:ce,get Warning(){return ye},get Clock(){return fe},get getAllRecurrenceTypes(){return se}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}},ke={class:"recurrence-editor"},Oe={key:0,class:"weekly-interval-selection"},be={class:"repeat-interval"},Se={key:1,class:"weekly-selection"},Te={key:0,class:"monthly-by-date-selection"},Me={class:"repeat-interval"},Re={key:1,class:"yearly-selection"},Ee={class:"repeat-interval"},Ve={key:0,class:"recurrence-warning"},He={key:0,class:"duration-warning"},Fe={key:0,class:"duration-info"},qe={key:1,class:"time-validation-error"};function Ie(a,d,I,r,v,w){const h=B("el-option"),S=B("el-select"),o=B("el-form-item"),Y=B("el-input-number"),H=B("el-checkbox-button"),F=B("el-checkbox-group"),W=B("el-date-picker"),k=B("el-icon"),M=B("el-text"),_=B("el-time-picker");return V(),E(A,null,[q("div",ke,[i(o,{label:a.$t("workOrder.create.recurrenceSettings"),prop:"recurrence_type","show-message":!1,required:""},{default:y(()=>[i(S,{modelValue:r.recurrence,"onUpdate:modelValue":d[0]||(d[0]=s=>r.recurrence=s),placeholder:a.$t("workOrder.placeholder.selectRecurrence"),style:{width:"500px"},clearable:""},{default:y(()=>[i(h,{label:a.$t("workOrder.recurrence.none"),value:"none"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.daily"),value:"daily"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.weekly"),value:"weekly"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.monthlyByDate"),value:"monthlyByDate"},null,8,["label"]),i(h,{label:a.$t("workOrder.recurrence.yearly"),value:"yearly"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),b(" Weekly Interval Selection "),r.recurrence==="weekly"?(V(),E("div",Oe,[i(o,{label:""},{default:y(()=>[q("div",be,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.repeatInterval,"onUpdate:modelValue":d[1]||(d[1]=s=>r.repeatInterval=s),min:1,max:52,style:{width:"120px",margin:"0 10px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.weeksRepeat")),1)])]),_:1})])):b("v-if",!0),b(" Days of the Week Selection "),r.recurrence==="weekly"?(V(),E("div",Se,[i(o,{label:""},{default:y(()=>[i(F,{modelValue:r.selectedDays,"onUpdate:modelValue":d[2]||(d[2]=s=>r.selectedDays=s),onChange:a.handleDaySelectionChange},{default:y(()=>[i(H,{label:1},{default:y(()=>[C(T(a.$t("workOrder.days.monday")),1)]),_:1}),i(H,{label:2},{default:y(()=>[C(T(a.$t("workOrder.days.tuesday")),1)]),_:1}),i(H,{label:3},{default:y(()=>[C(T(a.$t("workOrder.days.wednesday")),1)]),_:1}),i(H,{label:4},{default:y(()=>[C(T(a.$t("workOrder.days.thursday")),1)]),_:1}),i(H,{label:5},{default:y(()=>[C(T(a.$t("workOrder.days.friday")),1)]),_:1}),i(H,{label:6},{default:y(()=>[C(T(a.$t("workOrder.days.saturday")),1)]),_:1}),i(H,{label:0},{default:y(()=>[C(T(a.$t("workOrder.days.sunday")),1)]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})])):b("v-if",!0)]),b(" Monthly By Date Selection "),r.recurrence==="monthlyByDate"?(V(),E("div",Te,[i(o,{label:""},{default:y(()=>[q("div",Me,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.monthlyRepeatInterval,"onUpdate:modelValue":d[3]||(d[3]=s=>r.monthlyRepeatInterval=s),min:1,max:12,style:{width:"120px",margin:"0 10px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.monthsOn")),1),i(S,{modelValue:r.monthlyDate,"onUpdate:modelValue":d[4]||(d[4]=s=>r.monthlyDate=s),placeholder:a.$t("workOrder.recurrence.selectDate"),style:{width:"100px",margin:"0 10px"}},{default:y(()=>[(V(),E(A,null,ae(31,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.dayOfMonth")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),q("span",null,T(a.$t("workOrder.recurrence.repeat")),1)])]),_:1})])):b("v-if",!0),b(" Yearly Selection "),r.recurrence==="yearly"?(V(),E("div",Re,[i(o,{label:""},{default:y(()=>[q("div",Ee,[q("span",null,T(a.$t("workOrder.recurrence.every")),1),i(Y,{modelValue:r.yearlyRepeatInterval,"onUpdate:modelValue":d[5]||(d[5]=s=>r.yearlyRepeatInterval=s),min:1,max:10,style:{width:"120px",margin:"0 6px"}},null,8,["modelValue"]),q("span",null,T(a.$t("workOrder.recurrence.yearsOn")),1),i(S,{modelValue:r.yearlyMonth,"onUpdate:modelValue":d[6]||(d[6]=s=>r.yearlyMonth=s),placeholder:a.$t("workOrder.recurrence.selectMonth"),style:{width:"100px",margin:"0 6px"}},{default:y(()=>[(V(),E(A,null,ae(12,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.month")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),i(S,{modelValue:r.yearlyDay,"onUpdate:modelValue":d[7]||(d[7]=s=>r.yearlyDay=s),placeholder:a.$t("workOrder.recurrence.selectDate"),style:{width:"100px",margin:"0 6px"}},{default:y(()=>[(V(),E(A,null,ae(31,s=>i(h,{key:s,label:`${s}${a.$t("workOrder.recurrence.dayOfMonth")}`,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),q("span",null,T(a.$t("workOrder.recurrence.repeat")),1)])]),_:1})])):b("v-if",!0),b(" For 'none' recurrence, use date-time fields "),r.recurrence==="none"?(V(),E(A,{key:2},[b(" Start Date Time Selection "),i(o,{label:a.$t("workOrder.recurrence.startDateTime"),prop:"recurrence_setting.start_date_time",required:"","show-message":!1},{default:y(()=>[i(W,{modelValue:r.startDate,"onUpdate:modelValue":d[8]||(d[8]=s=>r.startDate=s),type:"datetime",placeholder:a.$t("workOrder.recurrence.selectStartTime"),format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"500px"},"disabled-date":r.disabledStartDate,"disabled-hours":r.disabledStartHours,"disabled-minutes":r.disabledStartMinutes},null,8,["modelValue","placeholder"]),r.showRecurrenceStartWarning?(V(),E("div",Ve,[i(M,{type:"warning",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),d[12]||(d[12]=C(" Recurrence start time should not be before work order start time "))]),_:1,__:[12]})])):b("v-if",!0)]),_:1},8,["label"]),b(" End Date Time Selection "),i(o,{label:a.$t("workOrder.recurrence.endDateTime"),prop:"recurrence_setting.end_date_time",required:"","show-message":!1},{default:y(()=>[i(W,{modelValue:r.endDate,"onUpdate:modelValue":d[9]||(d[9]=s=>r.endDate=s),type:"datetime",placeholder:a.$t("workOrder.recurrence.selectEndTime"),format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"500px"},"disabled-date":r.disabledEndDate,"disabled-hours":r.disabledEndHours,"disabled-minutes":r.disabledEndMinutes},null,8,["modelValue","placeholder"]),r.showDurationWarning?(V(),E("div",He,[i(M,{type:"warning",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),C(" Duration: "+T(r.formatDuration(r.calculateDuration())),1)]),_:1})])):b("v-if",!0)]),_:1},8,["label"])],64)):["daily","weekly","monthlyByDate","yearly"].includes(r.recurrence)?(V(),E(A,{key:3},[b(" For recurring types, use only time fields "),b(" Start Time Selection "),i(o,{label:a.$t("workOrder.recurrence.startTime"),prop:"recurrence_setting.start_time",required:"","show-message":!1},{default:y(()=>[i(_,{modelValue:r.startTime,"onUpdate:modelValue":d[10]||(d[10]=s=>r.startTime=s),placeholder:a.$t("workOrder.recurrence.selectStartTime"),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"500px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),b(" End Time Selection "),i(o,{label:a.$t("workOrder.recurrence.endTime"),prop:"recurrence_setting.end_time",required:"","show-message":!1},{default:y(()=>[i(_,{modelValue:r.endTime,"onUpdate:modelValue":d[11]||(d[11]=s=>r.endTime=s),placeholder:a.$t("workOrder.recurrence.selectEndTime"),format:"HH:mm","value-format":"HH:mm:ss",style:{width:"500px"},"disabled-hours":r.disabledEndTimeHours,"disabled-minutes":r.disabledEndTimeMinutes},null,8,["modelValue","placeholder"]),r.showTimeDurationInfo?(V(),E("div",Fe,[i(M,{type:"info",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Clock)]),_:1}),C(" Duration: "+T(r.formatDuration(r.calculateTimeDuration())),1)]),_:1})])):b("v-if",!0),r.showTimeValidationError?(V(),E("div",qe,[i(M,{type:"danger",size:"small"},{default:y(()=>[i(k,null,{default:y(()=>[i(r.Warning)]),_:1}),d[13]||(d[13]=C(" End time must be after start time "))]),_:1,__:[13]})])):b("v-if",!0)]),_:1},8,["label"])],64)):b("v-if",!0)],64)}const Pe=ve(De,[["render",Ie],["__scopeId","data-v-4ef2c0cb"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/components/RecurrenceEditor.vue"]]);function Le(){const{t:a}=me(),d=he(),I=g(!1),r=g([]),v=g(0),w=g(new Set),h=g(!1),S=g(null),o=ie({page:1,limit:20,importance:void 0,title:void 0,type:void 0,latest_per_recurrence:!0,assignedTo:void 0,priority:void 0,workType:void 0,status:void 0,search:void 0,dueDate:void 0,customDateRange:void 0,recurrence:void 0,sort:"created_at_desc"}),Y=N(()=>r.value&&r.value.length>0),H=N(()=>!I.value&&!Y.value),F=async(t={})=>{I.value=!0;try{const u={...t};o.assignedTo&&(u.assignedTo=o.assignedTo),o.priority&&(u.priority=o.priority),o.workType&&(u.workType=o.workType),o.status&&(u.status=o.status),o.search&&(u.search=o.search),o.dueDate&&(u.dueDate=o.dueDate),o.customDateRange&&(u.customDateRange=o.customDateRange),o.recurrence&&(u.recurrence=o.recurrence);let f,p;o.page===-1&&o.limit===-1?(f=await pe(P()),p=f.data):(f=await ge(o.page,o.limit,"createdAt","DESC",P()),p=f.data.content),v.value=f.data.totalElements||f.data.length,r.value=p.map(D=>{var O;return((O=D.recurrence_type)==null?void 0:O.id)!==1?{...D,children:null,hasChildren:!0}:D})}catch(u){console.error("Failed to fetch work orders:",u),oe.error(a("workOrder.messages.loadingFailed"))}finally{I.value=!1}},W=async(t,u={})=>{I.value=!0;try{h.value=!0,S.value=t;const f=await ue(t,o.page,o.limit,"createdAt","DESC");r.value=f.data.content||[],v.value=f.data.totalElements||0,r.value=r.value.map(p=>({...p,hasChildren:!1}))}catch(f){console.error("Failed to fetch recurring work orders:",f),oe.error(a("workOrder.messages.loadingFailed"))}finally{I.value=!1}},k=()=>{h.value=!1,S.value=null,o.page=1,F()},M=async(t,u,f)=>{try{const p=t.recurrence_uuid;if(!p)return f([]);let O=(await ue(p)).data.content;O=O.filter(R=>R.id!==t.id),t.children=O,f(O.map(R=>({...R,hasChildren:!1})))}catch(p){console.error("Error loading children:",p),f([])}},_=()=>{o.page=1,F()},s=t=>{Object.keys(t).forEach(u=>{Object.prototype.hasOwnProperty.call(o,u)&&(o[u]=t[u])}),o.page=1,F()},$=t=>{o.limit=t,o.page=1,h.value&&S.value?W(S.value):F()},U=t=>{o.page=t,h.value&&S.value?W(S.value):F()},x=(t,u)=>{u?(w.value.add(t.id),t.children&&t.children.forEach(f=>w.value.add(f.id))):(w.value.delete(t.id),t.children&&t.children.forEach(f=>w.value.delete(f.id)))},z=({row:t})=>w.value.has(t.id)?"expanded-highlight":"",K=async(t,u)=>{try{if(t.recurrence_type&&t.recurrence_type.id!==1&&t.recurrence_uuid){const{ElMessageBox:p}=await we(async()=>{const{ElMessageBox:O}=await import("../element-plus/element-plus.CU5xiOkY.js").then(R=>R.h);return{ElMessageBox:O}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url);if(await p.confirm("This is a recurring work order. Choose which work orders you want to delete:","Delete Work Order",{confirmButtonText:"Delete Recurrence",cancelButtonText:"Delete Individual",distinguishCancelAndClose:!0,type:"warning",customClass:"delete-recurrence-dialog"}).catch(O=>{if(O==="cancel")return"individual";throw new Error("User cancelled")})==="confirm"){await _e(t.recurrence_uuid),le({title:a("common.success"),message:"All recurring work orders deleted successfully",type:"success",duration:3e3});const O=[];r.value.forEach((R,L)=>{R.recurrence_uuid===t.recurrence_uuid&&O.push(L)}),O.reverse().forEach(R=>{r.value.splice(R,1)})}else await de(t.id),le({title:a("common.success"),message:a("workOrder.messages.deleteSuccess"),type:"success",duration:2e3}),r.value.splice(u,1)}else await de(t.id),le({title:a("common.success"),message:a("workOrder.messages.deleteSuccess"),type:"success",duration:2e3}),r.value.splice(u,1);v.value=Math.max(0,v.value-1)}catch(f){console.error("Delete failed:",f),f.message!=="User cancelled"&&oe.error(a("workOrder.messages.deleteFailed"))}},Q=async()=>{try{await Promise.all([d.fetchPriorities(),d.fetchWorkTypes(),d.fetchCategories(),d.fetchStates()])}catch(t){console.error("Failed to initialize common data:",t)}},X=24*60*60*1e3,Z=t=>{const u=t instanceof Date?t:new Date(t);return new Date(u.getFullYear(),u.getMonth(),u.getDate())},ee=t=>{const u=Z(t);return new Date(u.getTime()+X-1)},re=(t=new Date)=>{const u=o==null?void 0:o.dueDate;if(!u)return{};const f=Z(t),p=t.getFullYear(),D=t.getMonth(),O=t.getDate(),R=t.getDay(),L=new Date(p,D,O-R),te=new Date(p,D,O-R+7),G=new Date(te.getTime()-1),J=new Date(p,D,1),e=new Date(p,D+1,1),n=new Date(e.getTime()-1);switch(u){case"overdue":return{due_date_to:f};case"today":return{due_date_from:f,due_date_to:ee(f)};case"thisWeek":return{due_date_from:L,due_date_to:G};case"thisMonth":return{due_date_from:J,due_date_to:n};case"custom":return{};default:return{}}},P=()=>{const t=o,u={keyword:t.search||null,work_type_ids:t.workType?[t.workType]:[],priority_ids:t.priority?[t.priority]:[],state_ids:t.state?[t.state]:[],category_ids:t.category?[t.category]:[],recurrence_type_id:t.recurrence||null,latest_per_recurrence:t.latest_per_recurrence,start_date_from:t.start_date_from,end_date_to:t.end_date_to},f=re();return Object.assign(u,f),Object.keys(u).forEach(p=>{const D=u[p];(D==null||Array.isArray(D)&&D.length===0)&&delete u[p]}),u};return{loading:I,list:r,total:v,listQuery:o,expandedRows:w,recurrenceViewMode:h,currentRecurrenceId:S,hasData:Y,isEmpty:H,fetchWorkOrders:F,fetchRecurringWorkOrders:W,exitRecurrenceView:k,loadChildren:M,handleFilter:_,updateFilters:s,handleSizeChange:$,handleCurrentChange:U,toggleRowHighlight:x,getRowClass:z,handleDelete:K,initializeCommonData:Q}}function $e(){const{t:a}=me(),d=ie({name:"",description:"",estimated_minutes:30,production_line_id:null,equipment_group_id:null,equipment_id:null,component_id:null,priority_id:null,category_id:null,work_type_id:null,state_id:1,halt_type:0,time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,created_by:37,recurrence_type:null,image_list:[],files_list:[],recurrence_setting:{}}),I=ie({name:[{required:!0,message:a("workOrder.validation.nameRequired"),trigger:"blur"}],halt_type:[{required:!0,message:a("workOrder.validation.haltTypeRequired"),trigger:"change"}],production_line_id:[{required:!0,message:a("workOrder.validation.productionLineRequired"),trigger:"change"}],priority_id:[{required:!0,message:a("workOrder.validation.priorityRequired"),trigger:"change"}],category_id:[{required:!0,message:a("workOrder.validation.categoryRequired"),trigger:"change"}],work_type_id:[{required:!0,message:a("workOrder.validation.workTypeRequired"),trigger:"change"}],recurrence_type:[{required:!0,message:a("workOrder.validation.recurrenceRequired"),trigger:"change"}],"recurrence_setting.start_date_time":[{required:!0,message:a("workOrder.validation.startDateRequired"),trigger:"change"}],"recurrence_setting.end_date_time":[{required:!0,message:a("workOrder.validation.endDateRequired"),trigger:"change"}]});return{form:d,rules:I,resetForm:()=>{Object.assign(d,{name:"",description:"",estimated_minutes:30,production_line_id:null,equipment_group_id:null,equipment_id:null,component_id:null,priority_id:null,category_id:null,work_type_id:null,state_id:1,halt_type:0,time_zone:Intl.DateTimeFormat().resolvedOptions().timeZone,created_by:37,recurrence_type:null,image_list:[],files_list:[],recurrence_setting:{}})},validateForm:w=>new Promise(h=>{w.validate(S=>{h(S)})})}}export{Pe as R,$e as a,Le as u};
