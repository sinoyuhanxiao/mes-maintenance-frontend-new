import"../vue/vue.Dfo81L2Q.js";import{u as Jt,a as Gt,o as Qt}from"../vue-router/vue-router.30cuaQZO.js";import{as as Ca,a1 as yo,v as bo,$ as dt,at as wo,P as Dt,a2 as So,ad as Ta,a0 as ct,W as ko,E as xa,d as xt,O as Ye,aq as Kt,au as Yt,G as Da,H as Va,M as Co,B as Vt,ar as Xt,Y as Zt,a as To,af as xo,ab as Pa,av as Fa,aw as Ia,i as Oa,j as Do,ax as Aa,ay as Ra,F as Na,x as Ea,az as qa,aa as La,a6 as Ua,f as Ba}from"../@element-plus/@element-plus.BNeHluFm.js";import{S as ut,A as Xe,T as pt,N as mt,C as ft,I as gt,a as $t,u as eo,f as rt,e as to}from"../ServiceStepPreview/ServiceStepPreview.9cWJ2Utk.js";import{l as Ze,j as kt,m as Ct,h as oo}from"../task-library/task-library.mnROmZvc.js";import{_ as Te,b as ao,d as lo,c as so,e as no}from"../../assets/index-fCswSekQ.js";import{r as O,am as k,c as f,o as i,O as u,a as l,R as T,S as o,L as s,K as U,Q as A,Y as ke,F as X,a8 as te,E as fe,P as Oe,G as Ce,_ as Ae,j as z,w as Z,q as Be,W as io,d as _t,t as me,Z as ro,$ as co,a5 as uo}from"../@vue/@vue.CVGyaoMH.js";import{d as po}from"../equipment/equipment.DNKw76bx.js";import{a as mo}from"../common/common.CHi731XS.js";import{V as Vo}from"../vuedraggable/vuedraggable.C0aEL1re.js";import{E as Y,c as Ie}from"../element-plus/element-plus.CU5xiOkY.js";import{f as fo}from"../resources/resources.CxsExR5N.js";import{d as go}from"../lodash-es/lodash-es.BLHqGvLj.js";const _o=async(q,t)=>(await new Promise(c=>setTimeout(c,1e3)),{data:{id:`r-${Date.now()}`,name:q.name,url:`https://cdn.example.com/files/${q.name}`,mime:q.type}}),Tt="designer-tour-completed";function vo(){const q=O(!1);function t(){q.value=!0}function c(){q.value=!1}function e(){localStorage.setItem(Tt,"true"),c()}function x(){return localStorage.getItem(Tt)==="true"}function b(){localStorage.removeItem(Tt)}return{isOpen:q,start:t,close:c,onFinish:e,hasCompletedTour:x,resetTourCompletion:b}}const Ma={__name:"BaseStepCard",props:{step:{type:Object,required:!0},stepIndex:{type:Number,required:!0},isFocused:{type:Boolean,default:!1}},emits:["focus","update","delete","configure","duplicate"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=Ae({...e.step});b.type==="service"&&(b.config||(b.config={}),b.config.service_type||(b.config.service_type="Replace"),b.config.device_tag||(b.config.device_tag="P100016"),b.config.quantity||(b.config.quantity=1),b.config.status||(b.config.status="fail"));const r=O(!1),_=O(!1),P=O(!1),B=O(!1),v=z(()=>{var G;return((G=b.config)==null?void 0:G.limits)&&(b.config.limits.lower!==void 0||b.config.limits.upper!==void 0)}),j=[{type:"inspection",name:"Inspection",color:"#67c23a"},{type:"checkbox",name:"Checkbox",color:"#409eff"},{type:"number",name:"Number",color:"#e6a23c"},{type:"text",name:"Text",color:"#909399"},{type:"attachments",name:"Files",color:"#849aec"},{type:"service",name:"Service",color:"#df869d",disabled:!0}];Z(()=>e.step,G=>{Object.assign(b,G)},{deep:!0});const w=G=>{switch(G){case"description":r.value||b.description?(b.description="",r.value=!1,F()):r.value=!0;break;case"preview":_.value=!_.value;break;case"tools":x("configure",e.step.step_id,"tools");break;case"resources":x("configure",e.step.step_id,"resources");break;case"limitations":v.value?V():x("configure",e.step.step_id,"limits");break;case"duplicate":x("duplicate",e.step.step_id);break}},L=()=>{},m=()=>{},S=()=>{F(),b.description||(r.value=!1)},h=()=>{F()},J=()=>{F()},Q=(G,se)=>{b.config||(b.config={}),b.config[G]=se,F()},M=G=>{Object.assign(b,G),F()},$=G=>{const se={};b.config&&b.config.default&&(G==="text"||G==="number")&&(se.default=b.config.default),G==="service"?b.config={service_type:"Replace",device_tag:"P100016",quantity:1,status:"fail",...se}:b.config=se,F()},V=()=>{b.config&&(delete b.config.limits,Object.keys(b.config).length===0&&(b.config=void 0)),F(),Y.success("Number limitations removed successfully")},F=()=>{x("update",e.step.step_id,{...b})},re={props:e,emit:x,localStep:b,showDescriptionEdit:r,showPreview:_,isDeleteHovered:P,showToolsPreview:B,hasLimitations:v,stepTypes:j,handleAction:w,handleLabelChange:L,handleDescriptionChange:m,handleDescriptionBlur:S,handleRequiredChange:h,handleRequiredImageChange:J,updateServiceConfig:Q,handleStepUpdate:M,handleTypeChange:$,handleRemoveLimitations:V,saveChanges:F,getStepTypeLabel:G=>({inspection:"Inspection",checkbox:"Checkbox",number:"Number",text:"Text",attachments:"Files",service:"Service"})[G]||G,getLimitationsText:()=>{var G,se;return Ze((G=b.config)==null?void 0:G.limits,(se=b.config)==null?void 0:se.unit)},getStepComponent:G=>({inspection:gt,checkbox:ft,number:mt,text:pt,attachments:Xe,service:ut})[G]||"div",ref:O,reactive:Ae,watch:Z,computed:z,get MoreFilled(){return xa},get Setting(){return ko},get Tools(){return ct},get Folder(){return Ta},get DocumentCopy(){return So},get Delete(){return Dt},get Rank(){return wo},get Edit(){return dt},get View(){return bo},get Upload(){return yo},get DeleteFilled(){return Ca},get ElMessage(){return Y},InspectionStepPreview:gt,CheckboxStepPreview:ft,NumberStepPreview:mt,TextStepPreview:pt,AttachmentStepPreview:Xe,ServiceStepPreview:ut,get formatLimitsText(){return Ze}};return Object.defineProperty(re,"__isScriptSetup",{enumerable:!1,value:!0}),re}},za=["data-step-id"],ja={class:"step-header"},Wa={class:"step-number"},Ha={class:"step-info"},Ja={class:"step-type-badge"},Ga={class:"step-actions"},Qa={class:"step-content"},Ka={class:"step-label-section"},Ya={class:"type-option"},Xa={class:"type-option-name"},Za={key:0,class:"step-limitations-section"},$a={class:"limitations-content"},el={class:"limitations-text"},tl={key:1,class:"step-service-section"},ol={key:2,class:"step-description-section"},al={key:3,class:"step-config-preview"},ll={class:"step-preview-container"},sl={key:0,class:"preview-bottom-section"},nl={key:0,class:"preview-upload-section"},il={key:1,class:"preview-tools-section"},rl={key:1,class:"preview-tools-list"},dl={class:"tools-list-content"},cl={class:"tool-name"},ul={class:"step-options"},pl={class:"checkbox-group"},ml={class:"step-meta"},fl={class:"drag-handle"};function gl(q,t,c,e,x,b){var h,J,Q,M,$;const r=k("el-icon"),_=k("el-button"),P=k("el-dropdown-item"),B=k("el-dropdown-menu"),v=k("el-dropdown"),j=k("el-input"),w=k("el-option"),L=k("el-select"),m=k("el-input-number"),S=k("el-checkbox");return i(),f("div",{class:Ce(["base-step-card",{focused:c.isFocused,required:e.localStep.required,[`step-type-${e.localStep.type}`]:!0}]),"data-step-id":c.step.step_id,onClick:t[16]||(t[16]=V=>q.$emit("focus",c.step.step_id))},[u(" Step Header "),l("div",ja,[l("div",Wa,T(c.stepIndex+1),1),l("div",Ha,[l("div",Ja,T(e.getStepTypeLabel(e.localStep.type)),1)]),l("div",Ga,[o(v,{trigger:"click",onCommand:e.handleAction,onClick:t[0]||(t[0]=ke(()=>{},["stop"]))},{dropdown:s(()=>[o(B,null,{default:s(()=>[o(P,{command:"description"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Edit)]),_:1}),A(" "+T(e.showDescriptionEdit||e.localStep.description?"Remove Description":"Add Description"),1)]),_:1}),o(P,{command:"preview"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.View)]),_:1}),A(" "+T(e.showPreview?"Hide Preview":"Show Preview"),1)]),_:1}),o(P,{command:"tools"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),t[17]||(t[17]=A(" Tools "))]),_:1,__:[17]}),o(P,{command:"resources"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Folder)]),_:1}),t[18]||(t[18]=A(" Resources "))]),_:1,__:[18]}),e.localStep.type==="number"?(i(),U(P,{key:0,command:"limitations"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Setting)]),_:1}),A(" "+T(e.hasLimitations?"Remove Range":"Add Range"),1)]),_:1})):u("v-if",!0),o(P,{command:"duplicate",divided:""},{default:s(()=>[o(r,null,{default:s(()=>[o(e.DocumentCopy)]),_:1}),t[19]||(t[19]=A(" Duplicate "))]),_:1,__:[19]})]),_:1})]),default:s(()=>[o(_,{type:"text",size:"medium",class:"action-button"},{default:s(()=>[o(r,{class:"dropdown-icon"},{default:s(()=>[o(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),u(" Step Content "),l("div",Qa,[u(" Step Label "),l("div",Ka,[o(j,{modelValue:e.localStep.label,"onUpdate:modelValue":t[1]||(t[1]=V=>e.localStep.label=V),placeholder:"Enter step label",onInput:e.handleLabelChange,onBlur:e.saveChanges,class:"step-label-input"},null,8,["modelValue"]),o(L,{modelValue:e.localStep.type,"onUpdate:modelValue":t[2]||(t[2]=V=>e.localStep.type=V),placeholder:"Select type",onChange:e.handleTypeChange,class:"step-type-dropdown"},{default:s(()=>[(i(),f(X,null,te(e.stepTypes,V=>o(w,{key:V.type,label:V.name,value:V.type,disabled:V.disabled},{default:s(()=>[l("div",Ya,[l("div",{class:"type-option-color",style:fe({backgroundColor:V.color})},null,4),l("span",Xa,T(V.name),1)])]),_:2},1032,["label","value","disabled"])),64))]),_:1},8,["modelValue"])]),u(" Number Limitations Section (only for number type) "),e.localStep.type==="number"&&e.hasLimitations?(i(),f("div",Za,[l("div",$a,[o(r,null,{default:s(()=>[o(e.Setting)]),_:1}),l("span",el,"Range: "+T(e.getLimitationsText()),1),o(_,{type:"text",size:"default",onClick:t[3]||(t[3]=ke(V=>e.emit("configure",e.props.step.step_id,"limits"),["stop"])),class:"edit-limitations-btn"},{default:s(()=>t[20]||(t[20]=[A(" Edit ")])),_:1,__:[20]})])])):u("v-if",!0),u(" Service Configuration Section (only for service type) "),e.localStep.type==="service"?(i(),f("div",tl,[o(L,{"model-value":((h=e.localStep.config)==null?void 0:h.service_type)||"Replace","onUpdate:modelValue":t[4]||(t[4]=V=>e.updateServiceConfig("service_type",V)),placeholder:"Service Type",class:"service-type-select"},{default:s(()=>[o(w,{label:"Replace",value:"Replace"}),o(w,{label:"Repair",value:"Repair"})]),_:1},8,["model-value"]),o(L,{"model-value":((J=e.localStep.config)==null?void 0:J.device_tag)||"P100016","onUpdate:modelValue":t[5]||(t[5]=V=>e.updateServiceConfig("device_tag",V)),placeholder:"Device Tag",class:"device-tag-select"},{default:s(()=>[o(w,{label:"P100016",value:"P100016"}),o(w,{label:"CE79950",value:"CE79950"}),o(w,{label:"P100004",value:"P100004"})]),_:1},8,["model-value"]),o(m,{"model-value":((Q=e.localStep.config)==null?void 0:Q.quantity)||1,"onUpdate:modelValue":t[6]||(t[6]=V=>e.updateServiceConfig("quantity",V)),min:1,max:999,step:1,precision:0,class:"quantity-input"},{suffix:s(()=>t[21]||(t[21]=[l("span",null,"Qty",-1)])),_:1},8,["model-value"])])):u("v-if",!0),u(" Step Description (only show when editing or has content) "),e.showDescriptionEdit||e.localStep.description?(i(),f("div",ol,[o(j,{modelValue:e.localStep.description,"onUpdate:modelValue":t[7]||(t[7]=V=>e.localStep.description=V),type:"textarea",rows:2,placeholder:"Add step description (optional)",onInput:e.handleDescriptionChange,onBlur:e.handleDescriptionBlur,class:"step-description-input"},null,8,["modelValue"])])):u("v-if",!0),u(" Step Configuration Preview "),e.showPreview?(i(),f("div",al,[u(" Step Component Preview "),l("div",ll,[(i(),U(Oe(e.getStepComponent(e.localStep.type)),{step:e.localStep,"preview-mode":!0,onUpdate:e.handleStepUpdate},null,40,["step"])),u(" Preview Bottom Section (show if required image is checked OR tools exist) "),e.localStep.required_image||e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(i(),f("div",sl,[u(" Upload Image Button "),e.localStep.required_image?(i(),f("div",nl,[o(_,{type:"info",size:"small",disabled:""},{default:s(()=>[t[22]||(t[22]=l("span",{class:"required-asterisk"},"*",-1)),o(r,null,{default:s(()=>[o(e.Upload)]),_:1}),t[23]||(t[23]=A(" Upload Image "))]),_:1,__:[22,23]})])):u("v-if",!0),u(" Show Tools Button "),e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(i(),f("div",il,[o(_,{disabled:"",size:"small",plain:"",onClick:t[8]||(t[8]=V=>e.showToolsPreview=!e.showToolsPreview),class:"tools-toggle-btn"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),A(" "+T(e.showToolsPreview?"Hide Tools":"Show Tools")+" ("+T(e.localStep.relevant_tools.length)+") ",1)]),_:1})])):u("v-if",!0)])):u("v-if",!0),u(" Tools List (expandable section) "),e.showToolsPreview&&e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(i(),f("div",rl,[t[24]||(t[24]=l("div",{class:"tools-list-header"},[l("h4",null,"Required Tools")],-1)),l("div",dl,[(i(!0),f(X,null,te(e.localStep.relevant_tools,V=>(i(),f("div",{key:V.tool_id||V.id,class:"tool-item"},[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",cl,T(V.name||"Unnamed Tool"),1)]))),128))])])):u("v-if",!0)])])):u("v-if",!0),u(" Step Options "),l("div",ul,[l("div",pl,[o(S,{modelValue:e.localStep.required,"onUpdate:modelValue":t[9]||(t[9]=V=>e.localStep.required=V),onChange:e.handleRequiredChange},{default:s(()=>t[25]||(t[25]=[A(" Required step ")])),_:1,__:[25]},8,["modelValue"]),o(S,{modelValue:e.localStep.required_image,"onUpdate:modelValue":t[10]||(t[10]=V=>e.localStep.required_image=V),onChange:e.handleRequiredImageChange},{default:s(()=>t[26]||(t[26]=[A(" Required image ")])),_:1,__:[26]},8,["modelValue"])]),l("div",ml,[((M=e.localStep.relevant_tools)==null?void 0:M.length)>0?(i(),U(_,{key:0,type:"info",size:"small",plain:"",onClick:t[11]||(t[11]=ke(V=>e.handleAction("tools"),["stop"])),class:"meta-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),A(" "+T(e.localStep.relevant_tools.length)+" tool(s) ",1)]),_:1})):u("v-if",!0),(($=e.localStep.relevant_resources)==null?void 0:$.length)>0?(i(),U(_,{key:1,type:"warning",size:"small",plain:"",onClick:t[12]||(t[12]=ke(V=>e.handleAction("resources"),["stop"])),class:"meta-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Folder)]),_:1}),A(" "+T(e.localStep.relevant_resources.length)+" resource(s) ",1)]),_:1})):u("v-if",!0)])])]),u(" Drag Handle "),l("div",fl,[o(r,null,{default:s(()=>[o(e.Rank)]),_:1})]),u(" Delete Button "),l("div",{class:"delete-button",onClick:t[13]||(t[13]=ke(V=>e.emit("delete",c.step.step_id),["stop"])),onMouseenter:t[14]||(t[14]=V=>e.isDeleteHovered=!0),onMouseleave:t[15]||(t[15]=V=>e.isDeleteHovered=!1)},[e.isDeleteHovered?(i(),U(r,{key:0},{default:s(()=>[o(e.DeleteFilled)]),_:1})):(i(),U(r,{key:1},{default:s(()=>[o(e.Delete)]),_:1}))],32)],10,za)}const _l=Te(Ma,[["render",gl],["__scopeId","data-v-502bb329"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/StepCards/BaseStepCard.vue"]]),vl={__name:"FloatingPanel",props:{mode:{type:String,default:"add_step",validator:q=>["add_step","reorder_steps"].includes(q)},steps:{type:Array,default:()=>[]},uiHints:{type:Object,default:()=>({showCheckboxes:!0,showDragHandles:!0,showStepNumbers:!0,showTypeIcons:!0,showBulkToolbarOnSelect:!0,rowDensity:"compact"})},interactions:{type:Object,default:()=>({allowMultiSelect:!0,allowGroupDrag:!0,allowInlineRename:!0,confirmOnDelete:!0})},enabledBulkActions:{type:Array,default:()=>["duplicate","mark_required","mark_optional","delete"]}},emits:["add-step","toggle-mode","set-mode","reorder-steps","bulk-action","inline-rename"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=O(""),r=O([]),_=[{type:"inspection",name:"Inspection",description:"Pass/Fail check",icon:xt,color:"#67c23a"},{type:"checkbox",name:"Checkbox",description:"Yes/No confirmation",icon:Ye,color:"#409eff"},{type:"number",name:"Number",description:"Numeric measurement",icon:Kt,color:"#e6a23c"},{type:"text",name:"Text",description:"Text input/notes",icon:dt,color:"#909399"},{type:"attachments",name:"Files",description:"File upload",icon:Yt,color:"#849aec"},{type:"service",name:"Service",description:"Replace/Repair ops",icon:ct,color:"#df869d",disabled:!0}],P=O([]),B=z(()=>{if(!b.value)return e.steps;const D=b.value.toLowerCase();return e.steps.filter(W=>{var C,re;return((C=W.title)==null?void 0:C.toLowerCase().includes(D))||((re=W.type)==null?void 0:re.toLowerCase().includes(D))})});Z(B,D=>{P.value=[...D]},{immediate:!0,deep:!0}),Z(()=>e.steps,D=>{},{immediate:!0,deep:!0});const v=z(()=>r.value.length===0?!1:e.steps.filter(W=>r.value.includes(W.id)).every(W=>W.required)),j=z(()=>[...P.value].sort((C,re)=>C.id>re.id?1:-1).map(C=>`${C.id}-${C.title}-${C.type}`).join(",")),w=D=>{x("add-step",D)},L=D=>{x("set-mode",D)},m=D=>{if(!e.interactions.allowMultiSelect){r.value=r.value.includes(D)?[]:[D];return}const W=r.value.indexOf(D);W>-1?r.value.splice(W,1):r.value.push(D)},S=D=>{},h=D=>{if(D.oldIndex!==D.newIndex){const W=P.value[D.newIndex].id;x("reorder-steps",{stepId:W,sourceIndex:D.oldIndex,targetIndex:D.newIndex})}},J=D=>{},Q=D=>{r.value.length!==0&&(x("bulk-action",{action:D,stepIds:[...r.value]}),r.value=[])},M=D=>{x("inline-rename",D)},$=D=>{const W=_.find(C=>C.type===D);return(W==null?void 0:W.color)||"#c0c4cc"},V=D=>{const W=_.find(C=>C.type===D);return(W==null?void 0:W.icon)||Ye};Z(()=>e.mode,()=>{r.value=[],b.value=""});const F={props:e,emit:x,searchQuery:b,selectedStepIds:r,stepTypes:_,stepsForDrag:P,filteredSteps:B,allSelectedRequired:v,draggableKey:j,handleAddStep:w,setMode:L,toggleStepSelection:m,handleVueDragStart:S,handleVueDragEnd:h,handleVueDragChange:J,handleBulkAction:Q,handleInlineRename:M,getStepTypeColor:$,getStepTypeIcon:V,ref:O,computed:z,watch:Z,get Plus(){return Vt},get Rank(){return wo},get Search(){return Co},get Edit(){return dt},get CircleCheck(){return xt},get Document(){return Ye},get DataAnalysis(){return Kt},get Paperclip(){return Yt},get DocumentCopy(){return So},get Star(){return Va},get StarFilled(){return Da},get Setting(){return ko},get Delete(){return Dt},get Tools(){return ct},get VueDraggable(){return Vo}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}},hl={class:"floating-panel"},yl={class:"panel-header"},bl={class:"mode-selector"},wl={class:"panel-content"},Sl={key:0,class:"add-step-mode"},kl={class:"step-types"},Cl=["onClick"],Tl={class:"step-type-info"},xl={class:"step-type-name"},Dl={class:"step-type-desc"},Vl={class:"reorder-steps-mode"},Pl={class:"reorder-header"},Fl={class:"steps-list-container"},Il=["onClick"],Ol={key:0,class:"step-checkbox"},Al={key:1,class:"step-number"},Rl={key:2,class:"step-type-indicator"},Nl={class:"step-content"},El={class:"step-title"},ql={key:0,class:"required-asterisk"},Ll={class:"step-actions"},Ul={key:1,class:"drag-handle"},Bl={key:1,class:"empty-steps"},Ml={key:0,class:"bulk-actions-toolbar"},zl={class:"bulk-actions-info"},jl={class:"bulk-actions-buttons"};function Wl(q,t,c,e,x,b){const r=k("el-icon"),_=k("el-button"),P=k("el-button-group"),B=k("el-tooltip"),v=k("el-input"),j=k("el-checkbox"),w=k("el-empty"),L=k("el-card");return i(),f("div",hl,[o(L,{class:"panel-card"},{header:s(()=>[l("div",yl,[l("div",bl,[o(P,null,{default:s(()=>[o(_,{type:c.mode==="add_step"?"primary":"",size:"small",onClick:t[0]||(t[0]=m=>e.setMode("add_step")),class:"mode-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Plus)]),_:1}),t[9]||(t[9]=A(" Add "))]),_:1,__:[9]},8,["type"]),o(_,{type:c.mode==="reorder_steps"?"primary":"",size:"small",onClick:t[1]||(t[1]=m=>e.setMode("reorder_steps")),class:"mode-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Setting)]),_:1}),t[10]||(t[10]=A(" Config "))]),_:1,__:[10]},8,["type"])]),_:1})])])]),default:s(()=>[l("div",wl,[u(" Add Step Mode "),c.mode==="add_step"?(i(),f("div",Sl,[l("div",kl,[(i(),f(X,null,te(e.stepTypes,m=>l("div",{key:m.type,class:Ce(["step-type-card",{disabled:m.disabled}]),onClick:S=>!m.disabled&&e.handleAddStep(m.type)},[m.disabled?(i(),U(B,{key:0,content:"Purchase FPS MES Pro to enable this feature",placement:"bottom"},{default:s(()=>[l("div",{class:"step-type-icon",style:fe({backgroundColor:m.color})},[o(r,null,{default:s(()=>[(i(),U(Oe(m.icon)))]),_:2},1024)],4)]),_:2},1024)):(i(),f("div",{key:1,class:"step-type-icon",style:fe({backgroundColor:m.color})},[o(r,null,{default:s(()=>[(i(),U(Oe(m.icon)))]),_:2},1024)],4)),l("div",Tl,[l("div",xl,T(m.name),1),l("div",Dl,T(m.description),1)])],10,Cl)),64))])])):(i(),f(X,{key:1},[u(" Reorder Steps Mode "),l("div",Vl,[l("div",Pl,[o(v,{modelValue:e.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=m=>e.searchQuery=m),placeholder:"Search steps...",size:"default",class:"search-input",clearable:""},{prefix:s(()=>[o(r,null,{default:s(()=>[o(e.Search)]),_:1})]),_:1},8,["modelValue"])]),l("div",Fl,[e.stepsForDrag.length>0?(i(),U(e.VueDraggable,{key:e.draggableKey,modelValue:e.stepsForDrag,"onUpdate:modelValue":t[4]||(t[4]=m=>e.stepsForDrag=m),class:"steps-list","component-data":{tag:"div",type:"transition-group",name:"step-item"},"item-key":"id",animation:200,delay:0,disabled:!1,handle:".drag-handle","ghost-class":"step-ghost","chosen-class":"step-chosen","drag-class":"step-drag",onStart:e.handleVueDragStart,onEnd:e.handleVueDragEnd,onChange:e.handleVueDragChange},{item:s(({element:m})=>[l("div",{class:Ce(["step-item",{selected:e.selectedStepIds.includes(m.id),[`step-type-${m.type}`]:!0}]),onClick:S=>e.toggleStepSelection(m.id)},[c.uiHints.showCheckboxes?(i(),f("div",Ol,[o(j,{"model-value":e.selectedStepIds.includes(m.id),onClick:t[3]||(t[3]=ke(()=>{},["stop"])),onChange:S=>e.toggleStepSelection(m.id)},null,8,["model-value","onChange"])])):u("v-if",!0),c.uiHints.showStepNumbers?(i(),f("div",Al,T(m.order),1)):u("v-if",!0),c.uiHints.showTypeIcons?(i(),f("div",Rl,[o(r,{style:fe({color:e.getStepTypeColor(m.type)})},{default:s(()=>[(i(),U(Oe(e.getStepTypeIcon(m.type))))]),_:2},1032,["style"])])):u("v-if",!0),l("div",Nl,[l("div",El,[m.required?(i(),f("span",ql,"*")):u("v-if",!0),A(" "+T(m.title),1)])]),l("div",Ll,[c.interactions.allowInlineRename?(i(),U(_,{key:0,type:"text",size:"small",onClick:ke(S=>e.handleInlineRename(m.id),["stop"])},{default:s(()=>[o(r,{style:{"font-size":"15px"}},{default:s(()=>[o(e.Edit)]),_:1})]),_:2},1032,["onClick"])):u("v-if",!0),c.uiHints.showDragHandles?(i(),f("div",Ul,[o(r,null,{default:s(()=>[o(e.Rank)]),_:1})])):u("v-if",!0)])],10,Il)]),_:1},8,["modelValue"])):(i(),f("div",Bl,[o(w,{description:"No steps found","image-size":60})]))]),u(" Fixed Bulk Actions Toolbar "),e.selectedStepIds.length>0&&c.uiHints.showBulkToolbarOnSelect?(i(),f("div",Ml,[l("div",zl,T(e.selectedStepIds.length)+" step(s) selected",1),l("div",jl,[c.enabledBulkActions.includes("duplicate")?(i(),U(_,{key:0,type:"text",size:"small",onClick:t[5]||(t[5]=m=>e.handleBulkAction("duplicate"))},{default:s(()=>[o(r,null,{default:s(()=>[o(e.DocumentCopy)]),_:1}),t[11]||(t[11]=A(" Duplicate "))]),_:1,__:[11]})):u("v-if",!0),c.enabledBulkActions.includes("mark_required")&&!e.allSelectedRequired?(i(),U(_,{key:1,type:"text",size:"small",onClick:t[6]||(t[6]=m=>e.handleBulkAction("mark_required"))},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Star)]),_:1}),t[12]||(t[12]=A(" Mark Required "))]),_:1,__:[12]})):u("v-if",!0),c.enabledBulkActions.includes("mark_optional")&&e.allSelectedRequired?(i(),U(_,{key:2,type:"text",size:"small",onClick:t[7]||(t[7]=m=>e.handleBulkAction("mark_optional"))},{default:s(()=>[o(r,null,{default:s(()=>[o(e.StarFilled)]),_:1}),t[13]||(t[13]=A(" Mark Optional "))]),_:1,__:[13]})):u("v-if",!0),c.enabledBulkActions.includes("delete")?(i(),U(_,{key:3,type:"text",size:"small",onClick:t[8]||(t[8]=m=>e.handleBulkAction("delete")),class:"delete-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Delete)]),_:1}),t[14]||(t[14]=A(" Delete "))]),_:1,__:[14]})):u("v-if",!0)])])):u("v-if",!0)])],2112))])]),_:1})])}const Hl=Te(vl,[["render",Wl],["__scopeId","data-v-9ef2f2b9"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/FloatingPanel.vue"]]),Jl={__name:"NumberLimitsPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},initialData:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=O(null),r=Ae({lower:null,upper:null,inclusive:{lower:!0,upper:!0}}),_=z(()=>r.lower!==null&&r.lower!==void 0||r.upper!==null&&r.upper!==void 0),P={lower:[{validator:(w,L,m)=>{L!==null&&r.upper!==null&&L>=r.upper?m(new Error("Lower limit must be less than upper limit")):m()},trigger:"change"}],upper:[{validator:(w,L,m)=>{L!==null&&r.lower!==null&&L<=r.lower?m(new Error("Upper limit must be greater than lower limit")):m()},trigger:"change"}]};Z(()=>e.initialData,w=>{var L,m;w?Object.assign(r,{lower:w.lower!==void 0?w.lower:null,upper:w.upper!==void 0?w.upper:null,inclusive:{lower:((L=w.inclusive)==null?void 0:L.lower)!==!1,upper:((m=w.inclusive)==null?void 0:m.upper)!==!1}}):Object.assign(r,{lower:null,upper:null,inclusive:{lower:!0,upper:!0}})},{immediate:!0});const j={props:e,emit:x,formRef:b,formData:r,hasLimits:_,rules:P,handleSave:async()=>{try{await b.value.validate();const w={...r,lower:r.lower,upper:r.upper,show_limits_hint:!0};x("save",e.stepId,w)}catch(w){console.error("Number limits validation failed:",w)}},getPreviewText:()=>{const w=r.lower,L=r.upper,m=r.inclusive.lower,S=r.inclusive.upper;if(w===null&&L===null)return"No limits set";let h="";return w!==null&&(h+=`${m?"≥":">"} ${w}`),L!==null&&(h&&(h+=" and "),h+=`${S?"≤":"<"} ${L}`),h},ref:O,reactive:Ae,watch:Z,computed:z};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}},Gl={class:"form-section"},Ql={key:0,class:"form-section"},Kl={class:"form-section"},Yl={class:"preview-section"},Xl={class:"preview-text"},Zl={class:"dialog-footer"};function $l(q,t,c,e,x,b){const r=k("el-input-number"),_=k("el-form-item"),P=k("el-col"),B=k("el-row"),v=k("el-checkbox"),j=k("el-form"),w=k("el-button"),L=k("el-dialog");return i(),U(L,{"model-value":c.visible,title:"Configure Number Limits",width:"480px","onUpdate:modelValue":t[5]||(t[5]=m=>q.$emit("close")),onClose:t[6]||(t[6]=m=>q.$emit("close"))},{footer:s(()=>[l("span",Zl,[o(w,{onClick:t[4]||(t[4]=m=>q.$emit("close"))},{default:s(()=>t[10]||(t[10]=[A("Cancel")])),_:1,__:[10]}),o(w,{type:"primary",onClick:e.handleSave,loading:c.loading,disabled:!e.hasLimits},{default:s(()=>t[11]||(t[11]=[A(" Save Limits ")])),_:1,__:[11]},8,["loading","disabled"])])]),default:s(()=>[o(j,{ref:"formRef",model:e.formData,rules:e.rules,"label-position":"top"},{default:s(()=>[u(" Main Limit Values "),l("div",Gl,[o(B,{gutter:16},{default:s(()=>[o(P,{span:12},{default:s(()=>[o(_,{label:"Minimum Value",prop:"lower"},{default:s(()=>[o(r,{modelValue:e.formData.lower,"onUpdate:modelValue":t[0]||(t[0]=m=>e.formData.lower=m),precision:2,placeholder:"No minimum",style:{width:"100%"}},null,8,["modelValue"]),t[7]||(t[7]=l("div",{class:"help-text"},"Leave empty for no lower limit",-1))]),_:1,__:[7]})]),_:1}),o(P,{span:12},{default:s(()=>[o(_,{label:"Maximum Value",prop:"upper"},{default:s(()=>[o(r,{modelValue:e.formData.upper,"onUpdate:modelValue":t[1]||(t[1]=m=>e.formData.upper=m),precision:2,placeholder:"No maximum",style:{width:"100%"}},null,8,["modelValue"]),t[8]||(t[8]=l("div",{class:"help-text"},"Leave empty for no upper limit",-1))]),_:1,__:[8]})]),_:1})]),_:1})]),u(" Inclusion Options "),e.formData.lower!==null||e.formData.upper!==null?(i(),f("div",Ql,[o(B,{gutter:16},{default:s(()=>[e.formData.lower!==null?(i(),U(P,{key:0,span:12},{default:s(()=>[o(_,null,{default:s(()=>[o(v,{modelValue:e.formData.inclusive.lower,"onUpdate:modelValue":t[2]||(t[2]=m=>e.formData.inclusive.lower=m)},{default:s(()=>[A(" Allow exactly "+T(e.formData.lower),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})):u("v-if",!0),e.formData.upper!==null?(i(),U(P,{key:1,span:12},{default:s(()=>[o(_,null,{default:s(()=>[o(v,{modelValue:e.formData.inclusive.upper,"onUpdate:modelValue":t[3]||(t[3]=m=>e.formData.inclusive.upper=m)},{default:s(()=>[A(" Allow exactly "+T(e.formData.upper),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})):u("v-if",!0)]),_:1})])):u("v-if",!0),u(" Preview "),l("div",Kl,[t[9]||(t[9]=l("div",{class:"section-title"},"Preview",-1)),l("div",Yl,[l("div",Xl,T(e.getPreviewText()),1)])])]),_:1},8,["model"])]),_:1},8,["model-value"])}const es=Te(Jl,[["render",$l],["__scopeId","data-v-f52a2810"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/NumberLimitsPanel.vue"]]),ts={__name:"ToolPickerPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},selectedTools:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=O(""),r=O([]),_=O([]),P=O(new Map),B=O(!1),v=O(!1);Z(()=>e.selectedTools,F=>{F.length>0&&typeof F[0]=="object"?_.value=F.map(D=>{const W=Number(D.tool_id);return P.value.set(W,{tool_id:W,name:D.name,spec:D.spec||""}),W}):_.value=F.map(D=>Number(D))},{immediate:!0});const j=z(()=>{if(!b.value)return r.value;const F=b.value.toLowerCase();return r.value.filter(D=>D.name.toLowerCase().includes(F)||D.spec&&D.spec.toLowerCase().includes(F))}),w=F=>_.value.includes(F),L=F=>{w(F.tool_id)?S(F.tool_id):(P.value.set(Number(F.tool_id),{tool_id:Number(F.tool_id),name:F.name,spec:F.spec||""}),m(F.tool_id))},m=F=>{_.value.includes(F)||_.value.push(F)},S=F=>{_.value=_.value.filter(D=>D!==F),P.value.delete(Number(F))},h=()=>{_.value=[],P.value.clear()},J=()=>_.value.map(F=>{const D=P.value.get(Number(F));if(D)return D;const W=r.value.find(C=>Number(C.tool_id)===Number(F));if(W){const C={tool_id:Number(W.tool_id),name:W.name,spec:W.spec||""};return P.value.set(C.tool_id,C),C}return{tool_id:Number(F),name:`Tool #${F}`,spec:""}}),Q=()=>{B.value=!0;const F=J().map(D=>({tool_id:D.tool_id,name:D.name,spec:D.spec}));setTimeout(()=>{x("save",e.stepId,F),B.value=!1},300)},M=async()=>{var F;v.value=!0;try{const D=await fo(1,20,"name","ASC",{keyword:b.value||null}),W=((F=D==null?void 0:D.data)==null?void 0:F.content)||[];r.value=W.map(C=>({tool_id:Number(C.id),name:C.name,spec:C.code||C.tool_class&&C.tool_class.name||""})),r.value.forEach(C=>{_.value.includes(Number(C.tool_id))&&P.value.set(Number(C.tool_id),{tool_id:Number(C.tool_id),name:C.name,spec:C.spec||""})})}catch(D){console.error("Tool load failed:",D),r.value=[]}finally{v.value=!1}},$=go(()=>{e.visible&&M()},300);Z(()=>b.value,()=>{$()}),Z(()=>e.visible,F=>{F&&r.value.length===0&&M()}),Be(()=>{e.visible&&M()});const V={props:e,emit:x,searchQuery:b,availableTools:r,localSelectedTools:_,selectedToolCache:P,saveLoading:B,loading:v,filteredTools:j,isToolSelected:w,toggleTool:L,addSelectedTool:m,removeSelectedTool:S,clearAllTools:h,getSelectedToolObjects:J,handleSave:Q,loadTools:M,debouncedSearch:$,ref:O,computed:z,onMounted:Be,watch:Z,get debounce(){return go},get Search(){return Co},get searchTools(){return fo}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},os={class:"tools-picker"},as={class:"search-section"},ls={class:"available-section"},ss={key:0,class:"loading-container"},ns={key:1,class:"empty-tools"},is={key:2,class:"tools-list"},rs=["onClick"],ds={class:"tool-info"},cs={class:"tool-name"},us={key:0,class:"tool-spec"},ps={class:"tool-actions"},ms={key:0,class:"selected-section"},fs={class:"selected-section-header"},gs={class:"selected-tools"},_s={key:0,class:"tool-spec"},vs={class:"dialog-footer"};function hs(q,t,c,e,x,b){const r=k("el-icon"),_=k("el-input"),P=k("el-skeleton"),B=k("el-empty"),v=k("el-checkbox"),j=k("el-button"),w=k("el-tag"),L=k("el-dialog");return i(),U(L,{"model-value":c.visible,title:"Select Tools",width:"600px","onUpdate:modelValue":t[3]||(t[3]=m=>q.$emit("close")),onClose:t[4]||(t[4]=m=>q.$emit("close")),top:"8vh"},{footer:s(()=>[l("span",vs,[o(j,{onClick:t[2]||(t[2]=m=>q.$emit("close"))},{default:s(()=>t[7]||(t[7]=[A("Cancel")])),_:1,__:[7]}),o(j,{type:"primary",onClick:e.handleSave,loading:e.saveLoading},{default:s(()=>[A(" Save Selection ("+T(e.localSelectedTools.length)+") ",1)]),_:1},8,["loading"])])]),default:s(()=>[l("div",os,[u(" Search "),l("div",as,[o(_,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=m=>e.searchQuery=m),placeholder:"Search tools...",clearable:""},{prefix:s(()=>[o(r,null,{default:s(()=>[o(e.Search)]),_:1})]),_:1},8,["modelValue"])]),u(" Available Tools "),l("div",ls,[t[5]||(t[5]=l("h4",null,"Available Tools",-1)),e.loading?(i(),f("div",ss,[o(P,{rows:3,animated:""})])):e.filteredTools.length===0?(i(),f("div",ns,[o(B,{description:"No tools found","image-size":60})])):(i(),f("div",is,[(i(!0),f(X,null,te(e.filteredTools,m=>(i(),f("div",{key:m.tool_id,class:Ce(["tool-item",{selected:e.isToolSelected(m.tool_id)}]),onClick:S=>e.toggleTool(m)},[l("div",ds,[l("div",cs,T(m.name),1),m.spec?(i(),f("div",us,T(m.spec),1)):u("v-if",!0)]),l("div",ps,[o(v,{"model-value":e.isToolSelected(m.tool_id),onClick:t[1]||(t[1]=ke(()=>{},["stop"])),onChange:S=>e.toggleTool(m)},null,8,["model-value","onChange"])])],10,rs))),128))]))]),u(" Selected Tools "),e.localSelectedTools.length>0?(i(),f("div",ms,[l("div",fs,[l("h4",null,"Selected Tools ("+T(e.localSelectedTools.length)+")",1),o(j,{type:"text",size:"small",onClick:e.clearAllTools,class:"clear-all-btn"},{default:s(()=>t[6]||(t[6]=[A(" Clear All ")])),_:1,__:[6]})]),l("div",gs,[(i(!0),f(X,null,te(e.getSelectedToolObjects(),m=>(i(),U(w,{key:m.tool_id,closable:"",onClose:S=>e.removeSelectedTool(m.tool_id),class:"selected-tool-tag"},{default:s(()=>[A(T(m.name)+" ",1),m.spec?(i(),f("span",_s,"- "+T(m.spec),1)):u("v-if",!0)]),_:2},1032,["onClose"]))),128))])])):u("v-if",!0)])]),_:1},8,["model-value"])}const ys=Te(ts,[["render",hs],["__scopeId","data-v-b04faa9b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/ToolPickerPanel.vue"]]),bs={__name:"ResourceUploaderPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},existingResources:{type:Array,default:()=>[]},uploading:{type:Boolean,default:!1}},emits:["save","close"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=O(null),r=O([]),_=O([]);Z(()=>e.existingResources,h=>{_.value=[...h]},{immediate:!0});const P=(h,J)=>{r.value.push({name:h.name,size:h.size,file:h.raw,uploading:!1,progress:0,error:null})},B=h=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/jpg","image/png","image/gif"].includes(h.type)?(h.size>26214400&&Y.error("File size cannot exceed 25MB."),!1):(Y.error("Unsupported file type. Please upload PDF, DOC, DOCX, or image files."),!1),v=h=>{r.value.splice(h,1)},j=h=>{_.value=_.value.filter(J=>J.id!==h)},w=async()=>{try{const h=[];for(let Q=0;Q<r.value.length;Q++){const M=r.value[Q];M.uploading=!0,M.progress=0;try{const $=setInterval(()=>{M.progress<90&&(M.progress+=10)},100),V=await _o(M.file,e.stepId);clearInterval($),M.progress=100,h.push(V.data)}catch($){M.error="Upload failed",M.uploading=!1,console.error("Upload failed:",$)}}const J=[..._.value,...h];x("save",e.stepId,J)}catch(h){Y.error("Failed to upload resources"),console.error("Upload failed:",h)}},L=h=>{var Q;switch((Q=h.split(".").pop())==null?void 0:Q.toLowerCase()){case"pdf":case"doc":case"docx":return Ye;case"jpg":case"jpeg":case"png":case"gif":return Zt;default:return Xt}},m=h=>{if(h===0)return"0 Bytes";const J=1024,Q=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(h)/Math.log(J));return parseFloat((h/Math.pow(J,M)).toFixed(2))+" "+Q[M]};Z(()=>e.visible,h=>{h||(r.value=[])});const S={props:e,emit:x,uploadRef:b,fileList:r,existingResources:_,handleFileChange:P,beforeUpload:B,removeFile:v,removeExistingResource:j,handleSave:w,getFileIcon:L,formatFileSize:m,ref:O,watch:Z,get UploadFilled(){return xo},get Close(){return To},get Document(){return Ye},get Picture(){return Zt},get Files(){return Xt},get ElMessage(){return Y},get uploadResource(){return _o}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},ws={class:"resource-uploader"},Ss={class:"upload-section"},ks={key:0,class:"files-section"},Cs={class:"files-list"},Ts={class:"file-info"},xs={class:"file-icon"},Ds={class:"file-details"},Vs={class:"file-name"},Ps={class:"file-size"},Fs={key:0,class:"file-error"},Is={class:"file-actions"},Os={key:0,class:"upload-progress"},As={key:1,class:"existing-section"},Rs={class:"existing-list"},Ns={class:"resource-info"},Es={class:"resource-icon"},qs={class:"resource-details"},Ls={class:"resource-name"},Us={class:"resource-url"},Bs=["href"],Ms={key:2,class:"empty-state"},zs={class:"dialog-footer"};function js(q,t,c,e,x,b){const r=k("el-icon"),_=k("el-upload"),P=k("el-progress"),B=k("el-button"),v=k("el-empty"),j=k("el-dialog");return i(),U(j,{"model-value":c.visible,title:"Upload Resources",width:"600px","onUpdate:modelValue":t[1]||(t[1]=w=>q.$emit("close")),onClose:t[2]||(t[2]=w=>q.$emit("close")),top:"8vh"},{footer:s(()=>[l("span",zs,[o(B,{onClick:t[0]||(t[0]=w=>q.$emit("close"))},{default:s(()=>t[6]||(t[6]=[A("Cancel")])),_:1,__:[6]}),o(B,{type:"primary",onClick:e.handleSave,loading:c.uploading,disabled:e.fileList.length===0&&e.existingResources.length===0},{default:s(()=>[A(T(c.uploading?"Uploading...":"Save Resources"),1)]),_:1},8,["loading","disabled"])])]),default:s(()=>[l("div",ws,[u(" Upload Area "),l("div",Ss,[o(_,{ref:"uploadRef",class:"upload-demo",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":e.handleFileChange,"before-upload":e.beforeUpload,multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},{tip:s(()=>t[3]||(t[3]=[l("div",{class:"el-upload__tip"},"Supported formats: PDF, DOC, DOCX, JPG, PNG, GIF (max 25MB each)",-1)])),default:s(()=>[o(r,{class:"el-icon--upload"},{default:s(()=>[o(e.UploadFilled)]),_:1}),t[4]||(t[4]=l("div",{class:"el-upload__text"},"Add images or files",-1))]),_:1,__:[4]},512)]),u(" File List "),e.fileList.length>0?(i(),f("div",ks,[l("h4",null,"Files to Upload ("+T(e.fileList.length)+")",1),l("div",Cs,[(i(!0),f(X,null,te(e.fileList,(w,L)=>(i(),f("div",{key:L,class:Ce(["file-item",{uploading:w.uploading,error:w.error}])},[l("div",Ts,[l("div",xs,[o(r,null,{default:s(()=>[(i(),U(Oe(e.getFileIcon(w.name))))]),_:2},1024)]),l("div",Ds,[l("div",Vs,T(w.name),1),l("div",Ps,T(e.formatFileSize(w.size)),1),w.error?(i(),f("div",Fs,T(w.error),1)):u("v-if",!0)])]),l("div",Is,[w.uploading?(i(),f("div",Os,[o(P,{percentage:w.progress||0,"stroke-width":4,status:"success"},null,8,["percentage"])])):(i(),U(B,{key:1,type:"text",size:"small",onClick:m=>e.removeFile(L),class:"remove-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Close)]),_:1})]),_:2},1032,["onClick"]))])],2))),128))])])):u("v-if",!0),u(" Existing Resources "),e.existingResources.length>0?(i(),f("div",As,[t[5]||(t[5]=l("h4",null,"Current Resources",-1)),l("div",Rs,[(i(!0),f(X,null,te(e.existingResources,w=>(i(),f("div",{key:w.id,class:"existing-item"},[l("div",Ns,[l("div",Es,[o(r,null,{default:s(()=>[(i(),U(Oe(e.getFileIcon(w.name))))]),_:2},1024)]),l("div",qs,[l("div",Ls,T(w.name),1),l("div",Us,[l("a",{href:w.url,target:"_blank",class:"resource-link"}," View Resource ",8,Bs)])])]),o(B,{type:"text",size:"small",onClick:L=>e.removeExistingResource(w.id),class:"remove-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Close)]),_:1})]),_:2},1032,["onClick"])]))),128))])])):u("v-if",!0),u(" Empty State "),e.fileList.length===0&&e.existingResources.length===0?(i(),f("div",Ms,[o(v,{description:"No resources added yet","image-size":60})])):u("v-if",!0)])]),_:1},8,["model-value"])}const Ws=Te(bs,[["render",js],["__scopeId","data-v-f43d61e6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/ResourceUploaderPanel.vue"]]),Hs={__name:"PreviewDialog",props:{visible:{type:Boolean,default:!1},templateForm:{type:Object,required:!0},dialogConfig:{type:Object,default:()=>({title:"Preview Procedure",width:"60%",fullscreen:!1,closeOnClickModal:!0,appendToBody:!0,customClass:""})},headerConfig:{type:Object,default:()=>({showSubtitle:!0,showMeta:!0,metaFields:["category","estimated_minutes","applicable_assets"]})},toolbarConfig:{type:Object,default:()=>({showStepNumbersToggle:!0,showViewportSwitcher:!0,viewportOptions:["desktop","mobile"],interactionMode:"static"})},layoutConfig:{type:Object,default:()=>({sectionCollapsible:!0,sectionsInitiallyExpanded:!0,showStepNumbers:!0,requiredMark:"*",density:"comfortable"})},contentConfig:{type:Object,default:()=>({grouping:"by_section_field",sectionTitleField:"section",unknownSectionTitle:"General",widgets:{inspection:{options:["pass","flag","fail"],buttonStyle:"pill"},checkbox:{stackDirection:"vertical"},number:{showUnits:!0,showLimits:!0,unitsField:"uom",limitsField:"limits"},text:{placeholderField:"placeholder",rows:3},files:{acceptImages:!0,acceptDocuments:!0}}})},footerConfig:{type:Object,default:()=>({showClose:!0,showPrint:!1})}},emits:["open","close","print"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=O("desktop"),r=O(!1),_=Ae({}),P=O(window.innerWidth),B=Ae({}),v=O([]),j=z(()=>b.value==="mobile"),w=z(()=>e.toolbarConfig.showStepNumbersToggle||e.toolbarConfig.showViewportSwitcher),L=z(()=>!e.templateForm||!e.templateForm.steps?{title:"",subtitle:"",sections:[]}:{title:e.templateForm.name||"Untitled Procedure",subtitle:e.templateForm.description||"",sections:[]});Z(()=>e.layoutConfig.sectionsInitiallyExpanded,I=>{Object.keys(_).forEach(H=>{_[H]=I})},{immediate:!0});const m=I=>{if(e.contentConfig.grouping==="none")return[{sectionId:"default",title:e.contentConfig.unknownSectionTitle,expanded:e.layoutConfig.sectionsInitiallyExpanded,steps:I.map(ge=>S(ge))}];const H={},he=e.contentConfig.sectionTitleField;return I.forEach(ge=>{const ye=ge[he]||e.contentConfig.unknownSectionTitle,be=ye.toLowerCase().replace(/\s+/g,"_");H[be]||(H[be]={sectionId:be,title:ye,expanded:_[be]??e.layoutConfig.sectionsInitiallyExpanded,steps:[]}),H[be].steps.push(S(ge))}),Object.values(H).sort((ge,ye)=>ge.title.localeCompare(ye.title))},S=I=>({id:I.step_id,order:I.order,type:I.type,title:I.label||`${I.type} step`,required:I.required||!1,ui:{...I.config,description:I.description,relevant_tools:I.relevant_tools,relevant_resources:I.relevant_resources}}),h=I=>({inspection:gt,checkbox:ft,number:mt,text:pt,files:Xe,attachments:Xe,service:ut})[I]||"div",J=(I,H)=>e.layoutConfig.showStepNumbers?{...I,label:`${H+1}. ${I.label||`${$(I.type)} step`}`}:I,Q=I=>({category:"Category",estimated_minutes:"Est. Time",applicable_assets:"Assets"})[I]||I,M=I=>{if(!e.templateForm)return"";const H=e.templateForm[I];return I==="estimated_minutes"?`${H||0} min`:I==="applicable_assets"&&Array.isArray(H)?H.length>0?`${H.length} asset(s)`:"Any asset":H||""},$=I=>({inspection:"Inspection",checkbox:"Checkbox",number:"Number",text:"Text",attachments:"Files",files:"Files",service:"Service"})[I]||I,V=I=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec",files:"#849aec",service:"#df869d"})[I]||"#c0c4cc",F=()=>{x("toggle-step-numbers")},D=I=>{e.layoutConfig.sectionCollapsible&&(_[I]=!_[I])},W=I=>{b.value=I},C=I=>{B[I]=!B[I]},re=I=>!!B[I],G=()=>{x("open")},se=()=>{x("close")},Me=()=>{x("print"),window.print()},Re=()=>{P.value=window.innerWidth};Be(()=>{window.addEventListener("resize",Re)}),io(()=>{window.removeEventListener("resize",Re)}),Z(()=>L.value.sections,I=>{I.forEach(H=>{H.sectionId in _||(_[H.sectionId]=H.expanded)})},{immediate:!0});const xe={props:e,emit:x,currentViewport:b,isInteractive:r,sectionStates:_,windowWidth:P,stepToolsVisible:B,mobileToolsCollapsed:v,isMobileView:j,showToolbar:w,renderSnapshot:L,groupStepsIntoSections:m,transformStepForPreview:S,getStepComponent:h,getStepWithNumber:J,getMetaLabel:Q,getMetaValue:M,getStepTypeLabel:$,getStepTypeColor:V,toggleStepNumbers:F,toggleSection:D,setViewport:W,toggleStepTools:C,getStepToolsVisible:re,handleOpen:G,handleClose:se,handlePrint:Me,handleResize:Re,ref:O,computed:z,watch:Z,reactive:Ae,onMounted:Be,onUnmounted:io,get Monitor(){return Ia},get Iphone(){return Fa},get Printer(){return Pa},get UploadFilled(){return xo},get Upload(){return yo},get Tools(){return ct},InspectionStepPreview:gt,CheckboxStepPreview:ft,NumberStepPreview:mt,TextStepPreview:pt,AttachmentStepPreview:Xe,ServiceStepPreview:ut};return Object.defineProperty(xe,"__isScriptSetup",{enumerable:!1,value:!0}),xe}},Js={class:"preview-content"},Gs={key:0,class:"preview-toolbar"},Qs={class:"toolbar-right"},Ks={key:0,class:"viewport-switcher"},Ys={class:"preview-section"},Xs={class:"section-content"},Zs={class:"step-config-preview"},$s={key:0,class:"preview-bottom-section"},en={key:0,class:"mobile-upload-section"},tn={key:0,class:"upload-preview"},on={key:1,class:"desktop-upload-button"},an={key:1,class:"mobile-tools-section"},ln={class:"mobile-tools-list"},sn={class:"tool-name"},nn={key:2,class:"desktop-tools-list"},rn={class:"tools-list-content"},dn={class:"tool-name"},cn={key:0,class:"empty-preview"},un={class:"preview-footer"};function pn(q,t,c,e,x,b){const r=k("el-icon"),_=k("el-button"),P=k("el-button-group"),B=k("el-switch"),v=k("el-upload"),j=k("el-collapse-item"),w=k("el-collapse"),L=k("el-empty"),m=k("el-dialog");return i(),U(m,{top:"5vh","model-value":c.visible,title:c.dialogConfig.title,width:c.dialogConfig.width,fullscreen:c.dialogConfig.fullscreen,"close-on-click-modal":c.dialogConfig.closeOnClickModal,"append-to-body":c.dialogConfig.appendToBody,"custom-class":c.dialogConfig.customClass,"onUpdate:modelValue":e.handleClose,onOpen:e.handleOpen,onClose:e.handleClose,class:"preview-dialog"},{footer:s(()=>[l("div",un,[c.footerConfig.showPrint?(i(),U(_,{key:0,onClick:e.handlePrint},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Printer)]),_:1}),t[11]||(t[11]=A(" Print "))]),_:1,__:[11]})):u("v-if",!0),c.footerConfig.showClose?(i(),U(_,{key:1,onClick:e.handleClose},{default:s(()=>t[12]||(t[12]=[A(" Close ")])),_:1,__:[12]})):u("v-if",!0)])]),default:s(()=>[l("div",Js,[u(" Toolbar Section "),e.showToolbar?(i(),f("div",Gs,[t[6]||(t[6]=l("div",{class:"toolbar-left"},[u(" Reset button moved to main designer header ")],-1)),l("div",Qs,[c.toolbarConfig.showViewportSwitcher?(i(),f("div",Ks,[o(P,null,{default:s(()=>[o(_,{type:e.currentViewport==="desktop"?"primary":"",size:"default",onClick:t[0]||(t[0]=S=>e.setViewport("desktop"))},{default:s(()=>[o(r,{style:{"margin-right":"5px"}},{default:s(()=>[o(e.Monitor)]),_:1}),t[4]||(t[4]=A(" Desktop "))]),_:1,__:[4]},8,["type"]),o(_,{type:e.currentViewport==="mobile"?"primary":"",size:"default",onClick:t[1]||(t[1]=S=>e.setViewport("mobile"))},{default:s(()=>[o(r,{style:{"margin-right":"5px"}},{default:s(()=>[o(e.Iphone)]),_:1}),t[5]||(t[5]=A(" Mobile "))]),_:1,__:[5]},8,["type"])]),_:1})])):u("v-if",!0),o(B,{modelValue:e.isInteractive,"onUpdate:modelValue":t[2]||(t[2]=S=>e.isInteractive=S),size:"default","active-text":"Interactive","inactive-text":"Static",class:"interaction-toggle"},null,8,["modelValue"])])])):u("v-if",!0),u(" Main Content Area "),l("div",{class:Ce(["preview-main",[`viewport-${e.currentViewport}`,`density-${c.layoutConfig.density}`,{"interactive-mode":e.isInteractive}]])},[u(" Steps (simplified to show only step-config-preview) "),l("div",Ys,[l("div",Xs,[(i(!0),f(X,null,te(c.templateForm.steps,(S,h)=>{var J,Q;return i(),f("div",{key:S.step_id||h,class:"preview-step-simple"},[u(" Step Config Preview with numbered title "),l("div",Zs,[(i(),U(Oe(e.getStepComponent(S.type)),{step:e.getStepWithNumber(S,h),"preview-mode":!0,interactive:e.isInteractive},null,8,["step","interactive"])),u(" Preview Bottom Section (show if required image is checked OR tools exist) "),S.required_image||S.relevant_tools&&S.relevant_tools.length>0?(i(),f("div",$s,[e.isMobileView?(i(),f("div",en,[S.required_image?(i(),f("div",tn,[o(v,{class:"upload-demo",drag:"",disabled:!e.isInteractive,"show-file-list":!1,"list-type":((Q=(J=S.config)==null?void 0:J.upload_style)==null?void 0:Q.list_type)||"picture-card"},{default:s(()=>[o(r,{class:"el-icon--upload"},{default:s(()=>[o(e.UploadFilled)]),_:1}),t[7]||(t[7]=l("div",{class:"el-upload__text"},"Add images or files",-1))]),_:2,__:[7]},1032,["disabled","list-type"])])):u("v-if",!0)])):(i(),f("div",on,[S.required_image?(i(),U(_,{key:0,type:"info",size:"small",disabled:!e.isInteractive},{default:s(()=>[t[8]||(t[8]=l("span",{class:"required-asterisk"},"*",-1)),o(r,null,{default:s(()=>[o(e.Upload)]),_:1}),t[9]||(t[9]=A(" Upload Image "))]),_:1,__:[8,9]},8,["disabled"])):u("v-if",!0),u(" Show Tools Button (Desktop) "),S.relevant_tools&&S.relevant_tools.length>0?(i(),U(_,{key:1,disabled:!e.isInteractive,size:"small",plain:"",onClick:M=>e.toggleStepTools(S.step_id),class:"tools-toggle-btn",style:{"margin-left":"8px"}},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),A(" "+T(e.getStepToolsVisible(S.step_id)?"Hide Tools":"Show Tools")+" ("+T(S.relevant_tools.length)+") ",1)]),_:2},1032,["disabled","onClick"])):u("v-if",!0)]))])):u("v-if",!0),u(" Mobile Tools Section (Expandable/Collapsible) "),e.isMobileView&&S.relevant_tools&&S.relevant_tools.length>0?(i(),f("div",an,[o(w,{modelValue:e.mobileToolsCollapsed,"onUpdate:modelValue":t[3]||(t[3]=M=>e.mobileToolsCollapsed=M),disabled:!e.isInteractive},{default:s(()=>[o(j,{title:`Tools Required (${S.relevant_tools.length})`,name:S.step_id,disabled:!e.isInteractive},{default:s(()=>[l("div",ln,[(i(!0),f(X,null,te(S.relevant_tools,M=>(i(),f("div",{key:M.tool_id||M.id,class:"mobile-tool-item"},[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",sn,T(M.name||"Unnamed Tool"),1)]))),128))])]),_:2},1032,["title","name","disabled"])]),_:2},1032,["modelValue","disabled"])])):u("v-if",!0),u(" Desktop Tools List (toggleable) "),!e.isMobileView&&e.getStepToolsVisible(S.step_id)&&S.relevant_tools&&S.relevant_tools.length>0?(i(),f("div",nn,[t[10]||(t[10]=l("div",{class:"tools-list-header"},[l("h4",null,"Required Tools")],-1)),l("div",rn,[(i(!0),f(X,null,te(S.relevant_tools,M=>(i(),f("div",{key:M.tool_id||M.id,class:"tool-item"},[o(r,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",dn,T(M.name||"Unnamed Tool"),1)]))),128))])])):u("v-if",!0)])])}),128))])]),u(" Empty State "),!c.templateForm.steps||c.templateForm.steps.length===0?(i(),f("div",cn,[o(L,{description:"No steps to preview","image-size":80})])):u("v-if",!0)],2)])]),_:1},8,["model-value","title","width","fullscreen","close-on-click-modal","append-to-body","custom-class"])}const mn=Te(Hs,[["render",pn],["__scopeId","data-v-3641912d"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/PreviewDialog.vue"]]),fn=_t({name:"ChangeSummaryDialog"}),gn=Object.assign(fn,{props:{visible:{type:Boolean,default:!1},changes:{type:Object,default:()=>({metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]})},loading:{type:Boolean,default:!1},currentSteps:{type:Array,default:()=>[]}},emits:["confirm","cancel","close"],setup(q,{expose:t,emit:c}){t();const e=q,x=c,b=z(()=>e.changes.metadata.length>0||e.changes.steps_added.length>0||e.changes.steps_modified.length>0||e.changes.steps_deleted.length>0||e.changes.steps_reordered.length>0),r=S=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec",service:"#df869d"})[S]||"#c0c4cc",m={props:e,emit:x,hasAnyChanges:b,getStepTypeColor:r,getStepNumberStyle:S=>{const h=r(S);return{backgroundColor:"white",color:h,border:`2px solid ${h}`}},getStepPosition:S=>{const h=e.currentSteps.findIndex(J=>J.step_id===S);return h!==-1?h+1:"?"},getStepType:S=>{const h=e.currentSteps.find(J=>J.step_id===S);return(h==null?void 0:h.type)||"text"},capitalizeFirst:S=>S.charAt(0).toUpperCase()+S.slice(1),handleClose:S=>{e.loading||(typeof S=="function"&&S(),x("close"))},handleConfirm:()=>{x("confirm")},handleCancel:()=>{x("cancel")},__MACROS_defineComponent:_t,computed:z,get Edit(){return dt},get Plus(){return Vt},get Delete(){return Dt},get Sort(){return Ra},get Right(){return Aa},get Check(){return Do},get Close(){return To},get InfoFilled(){return Oa}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),_n={class:"dialog-content"},vn={key:0,class:"no-changes"},hn={class:"changes-summary"},yn={key:0,class:"change-section"},bn={class:"section-header"},wn={class:"changes-list"},Sn={class:"change-label"},kn={class:"change-values"},Cn={class:"original-value"},Tn={class:"value"},xn={class:"current-value"},Dn={class:"value"},Vn={key:1,class:"change-section"},Pn={class:"section-header"},Fn={class:"changes-list"},In={class:"step-info"},On={class:"step-details"},An={class:"step-name"},Rn={class:"step-meta"},Nn={key:2,class:"change-section"},En={class:"section-header"},qn={class:"changes-list"},Ln={class:"step-info"},Un={class:"step-details"},Bn={class:"step-name"},Mn={class:"step-changes"},zn={class:"change-field"},jn={class:"change-from"},Wn={class:"change-to"},Hn={key:3,class:"change-section"},Jn={class:"section-header"},Gn={class:"changes-list"},Qn={class:"step-info"},Kn={class:"step-details"},Yn={class:"step-name deleted"},Xn={class:"step-meta"},Zn={key:4,class:"change-section"},$n={class:"section-header"},ei={class:"changes-list"},ti={class:"step-info"},oi={class:"step-details"},ai={class:"step-name"},li={class:"step-position-change"},si={class:"dialog-footer"};function ni(q,t,c,e,x,b){const r=k("el-icon"),_=k("el-tag"),P=k("el-button"),B=k("el-dialog");return i(),U(B,{"model-value":c.visible,"onUpdate:modelValue":t[0]||(t[0]=v=>q.$emit("close")),title:"Confirm Changes",width:"40%","before-close":e.handleClose,class:"change-summary-dialog"},{footer:s(()=>[l("div",si,[o(P,{onClick:e.handleCancel,disabled:c.loading},{default:s(()=>t[11]||(t[11]=[A(" Cancel ")])),_:1,__:[11]},8,["disabled"]),e.hasAnyChanges?(i(),U(P,{key:0,type:"primary",onClick:e.handleConfirm,loading:c.loading},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Check)]),_:1}),t[12]||(t[12]=A(" Save Changes "))]),_:1,__:[12]},8,["loading"])):u("v-if",!0)])]),default:s(()=>[l("div",_n,[u(" No Changes State "),e.hasAnyChanges?(i(),f(X,{key:1},[u(" Changes Summary "),l("div",hn,[t[10]||(t[10]=l("div",{class:"summary-header"},[l("p",{style:{"font-size":"15px"}},"Review the following modifications before saving:")],-1)),u(" Metadata Changes "),c.changes.metadata.length>0?(i(),f("div",yn,[l("div",bn,[o(r,{class:"section-icon"},{default:s(()=>[o(e.Edit)]),_:1}),t[3]||(t[3]=l("h4",null,"Template Information",-1)),o(_,{size:"default",type:"warning",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[A(T(c.changes.metadata.length)+" change(s)",1)]),_:1})]),l("div",wn,[(i(!0),f(X,null,te(c.changes.metadata,v=>(i(),f("div",{key:v.field,class:"change-item metadata-change"},[l("div",Sn,T(v.label),1),l("div",kn,[l("div",Cn,[t[4]||(t[4]=l("span",{class:"value-label"},"From:",-1)),l("span",Tn,T(v.original),1)]),o(r,{class:"arrow-icon"},{default:s(()=>[o(e.Right)]),_:1}),l("div",xn,[t[5]||(t[5]=l("span",{class:"value-label"},"To:",-1)),l("span",Dn,T(v.current),1)])])]))),128))])])):u("v-if",!0),u(" Steps Added "),c.changes.steps_added.length>0?(i(),f("div",Vn,[l("div",Pn,[o(r,{class:"section-icon"},{default:s(()=>[o(e.Plus)]),_:1}),t[6]||(t[6]=l("h4",null,"Steps Added",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[A(T(c.changes.steps_added.length)+" step(s)",1)]),_:1})]),l("div",Fn,[(i(!0),f(X,null,te(c.changes.steps_added,v=>(i(),f("div",{key:v.step_id,class:"change-item step-added"},[l("div",In,[l("div",{class:"step-number",style:fe(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",On,[l("div",An,T(v.label),1),l("div",Rn,T(e.capitalizeFirst(v.type))+" step • Position "+T(v.position),1)])])]))),128))])])):u("v-if",!0),u(" Steps Modified "),c.changes.steps_modified.length>0?(i(),f("div",Nn,[l("div",En,[o(r,{class:"section-icon"},{default:s(()=>[o(e.Edit)]),_:1}),t[7]||(t[7]=l("h4",null,"Steps Modified",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[A(T(c.changes.steps_modified.length)+" step(s)",1)]),_:1})]),l("div",qn,[(i(!0),f(X,null,te(c.changes.steps_modified,v=>(i(),f("div",{key:v.step_id,class:"change-item step-modified"},[l("div",Ln,[l("div",{class:"step-number",style:fe(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",Un,[l("div",Bn,T(v.label),1),l("div",Mn,[(i(!0),f(X,null,te(v.changes,j=>(i(),f("div",{key:j.field,class:"step-change-detail"},[l("span",zn,T(j.label)+":",1),l("span",jn,T(j.original),1),o(r,{class:"arrow-mini"},{default:s(()=>[o(e.Right)]),_:1}),l("span",Wn,T(j.current),1)]))),128))])])])]))),128))])])):u("v-if",!0),u(" Steps Deleted "),c.changes.steps_deleted.length>0?(i(),f("div",Hn,[l("div",Jn,[o(r,{class:"section-icon"},{default:s(()=>[o(e.Delete)]),_:1}),t[8]||(t[8]=l("h4",null,"Steps Deleted",-1)),o(_,{size:"default",type:"danger",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[A(T(c.changes.steps_deleted.length)+" step(s)",1)]),_:1})]),l("div",Gn,[(i(!0),f(X,null,te(c.changes.steps_deleted,v=>(i(),f("div",{key:v.step_id,class:"change-item step-deleted"},[l("div",Qn,[l("div",{class:"step-number deleted",style:fe(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",Kn,[l("div",Yn,T(v.label),1),l("div",Xn,T(e.capitalizeFirst(v.type))+" step • Was at position "+T(v.position),1)])])]))),128))])])):u("v-if",!0),u(" Steps Reordered "),c.changes.steps_reordered.length>0?(i(),f("div",Zn,[l("div",$n,[o(r,{class:"section-icon"},{default:s(()=>[o(e.Sort)]),_:1}),t[9]||(t[9]=l("h4",null,"Steps Reordered",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[A(T(c.changes.steps_reordered.length)+" step(s)",1)]),_:1})]),l("div",ei,[(i(!0),f(X,null,te(c.changes.steps_reordered,v=>(i(),f("div",{key:v.step_id,class:"change-item step-reordered"},[l("div",ti,[l("div",{class:"step-number",style:fe(e.getStepNumberStyle(e.getStepType(v.step_id)))},T(e.getStepPosition(v.step_id)),5),l("div",oi,[l("div",ai,T(v.label),1),l("div",li,[l("span",null,"Position "+T(v.original_position),1),o(r,{class:"arrow-mini"},{default:s(()=>[o(e.Right)]),_:1}),l("span",null,"Position "+T(v.new_position),1)])])])]))),128))])])):u("v-if",!0)])],2112)):(i(),f("div",vn,[o(r,{class:"no-changes-icon"},{default:s(()=>[o(e.InfoFilled)]),_:1}),t[1]||(t[1]=l("h3",null,"No Changes Detected",-1)),t[2]||(t[2]=l("p",null,"No modifications were made to this task template.",-1))]))])]),_:1},8,["model-value"])}const ii=Te(gn,[["render",ni],["__scopeId","data-v-17754755"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ChangeSummaryDialog.vue"]]);function ho(){const q=z(()=>({title:"Preview Procedure",width:"70%",fullscreen:!1,closeOnClickModal:!0,appendToBody:!0,customClass:"template-preview-dialog"})),t=z(()=>({showSubtitle:!0,showMeta:!0,metaFields:["category","estimated_minutes","applicable_assets"]})),c=z(()=>({showStepNumbersToggle:!0,showViewportSwitcher:!0,viewportOptions:["desktop","mobile"],interactionMode:"static"})),e=z(()=>({sectionCollapsible:!0,sectionsInitiallyExpanded:!0,showStepNumbers:!0,requiredMark:"*",density:"comfortable"})),x=z(()=>({grouping:"by_section_field",sectionTitleField:"section",unknownSectionTitle:"General",widgets:{inspection:{options:["pass","flag","fail"],buttonStyle:"pill"},checkbox:{stackDirection:"vertical"},number:{showUnits:!0,showLimits:!0,unitsField:"unit",limitsField:"limits"},text:{placeholderField:"placeholder",rows:3},files:{acceptImages:!0,acceptDocuments:!0}}})),b=z(()=>({showClose:!0,showPrint:!1}));return{previewDialogConfig:q,previewHeaderConfig:t,previewToolbarConfig:c,previewLayoutConfig:e,previewContentConfig:x,previewFooterConfig:b}}const ri=_t({name:"TemplateDesignerView"}),di=Object.assign(ri,{setup(q,{expose:t}){t();const c=Jt(),e=Gt(),x=$t(),b=z(()=>c.query.fromWorkOrder==="true"),r=z(()=>(typeof c.query.returnRoute=="string"?c.query.returnRoute:null)||x.returnRoute||"/work-order/table"),_=z(()=>(typeof c.query.returnPanel=="string"?c.query.returnPanel:null)||x.returnPanel||null),P=z(()=>{const a=typeof c.query.returnWorkOrderId=="string"?c.query.returnWorkOrderId:null;return a||(x.returnWorkOrderId!=null?String(x.returnWorkOrderId):null)}),{loadTemplates:B,createTemplate:v,updateTemplate:j,validateTemplate:w}=eo(),{isOpen:L,start:m,onFinish:S}=vo(),h=O({focused_step_id:null,dragging:{is_dragging:!1,source_step_id:null,target_step_id:null},floating_panel:{visible:!0,mode:"add_step"},dialogs:{number_limits:{visible:!1,for_step_id:null,loading:!1,form_data:{}},relevant_tools_picker:{visible:!1,for_step_id:null,selected_tools:[],loading:!1},resource_uploader:{visible:!1,for_step_id:null,upload_progress:0,uploading:!1,form_data:{}},change_summary:{visible:!1,loading:!1,changes:{metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]}}}}),J=a=>{h.value.focused_step_id=a},Q=()=>{const a=h.value.floating_panel.mode;h.value.floating_panel.mode=a==="add_step"?"reorder_steps":"add_step"},M=a=>{h.value.floating_panel.mode=a},$=a=>{if(!We.value){console.warn("stepsListRef not available for scrolling");return}const n=We.value.querySelector(`[data-step-id="${a}"]`);n?n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):(console.warn(`Step card with ID ${a} not found, scrolling to bottom`),We.value.scrollTo({top:We.value.scrollHeight,behavior:"smooth"}))},V=(a,n={})=>{h.value.dialogs.number_limits={visible:!0,for_step_id:a,loading:!1,form_data:n}},F=()=>{h.value.dialogs.number_limits.visible=!1},D=(a,n=[])=>{h.value.dialogs.relevant_tools_picker={visible:!0,for_step_id:a,selected_tools:n,loading:!1}},W=()=>{h.value.dialogs.relevant_tools_picker.visible=!1},C=(a,n={})=>{h.value.dialogs.resource_uploader={visible:!0,for_step_id:a,upload_progress:0,uploading:!1,form_data:n}},re=()=>{h.value.dialogs.resource_uploader.visible=!1},G=a=>{h.value.dialogs.change_summary={visible:!0,loading:!1,changes:a}},se=()=>{h.value.dialogs.change_summary.visible=!1},Me=a=>{h.value.dialogs.change_summary.loading=a},Re=(a,n)=>{Ie({title:"Save Confirmation",message:`Do you want to save this edit locally only for Work Order ${n||a||"Work Order"} or do you want to alter the template?`,showCancelButton:!0,showConfirmButton:!0,cancelButtonText:"Save Locally (Work Order Only)",confirmButtonText:"Alter Template",type:"question",distinguishCancelAndClose:!0,customClass:"work-order-save-confirmation"}).then(()=>Le({mode:"template",fromWorkOrderContext:!0})).catch(async p=>{if(p==="cancel"){const g=Array.isArray(ue.value)?ue.value.find(E=>E.value===y.value.category):null,R=rt(y.value,g);x.appendTask(R),await qe("Task added to the work order.")}})},xe=()=>{h.value={focused_step_id:null,dragging:{is_dragging:!1,source_step_id:null,target_step_id:null},floating_panel:{visible:!0,mode:"add_step"},dialogs:{number_limits:{visible:!1,for_step_id:null,loading:!1,form_data:{}},relevant_tools_picker:{visible:!1,for_step_id:null,selected_tools:[],loading:!1},resource_uploader:{visible:!1,for_step_id:null,upload_progress:0,uploading:!1,form_data:{}},change_summary:{visible:!1,loading:!1,changes:{metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]}}}}},I=ao(),H=lo(),he=so(),{saveState:ge,saveStateByKey:ye,restoreState:be,restoreStateByKey:$e,restoreStateByTemplateId:Pt,hasCachedState:Ft,hasCachedStateByKey:It,clearState:Ot,clearStateByKey:De,getCacheStats:At}=no(),ze=O({path:c.path,params:{...c.params||{}}}),ie=O(null),je=O(null),We=O(null),we=()=>({path:ze.value.path,params:{...ze.value.params||{}}}),vt=()=>Ft(we()),Rt=()=>be(we()),Po=a=>ge(we(),a),Fo=()=>Ot(we()),He=O(!1),y=O({name:"",description:"",category:"",estimated_minutes:30,applicable_assets:null,steps:[]}),de=O(null),ne=O(null),oe=O(!1),Je=O(!1),Ne=O(!1),Se=O(null),et=O(null),Io=O(!1),tt=O([]),Nt=O([]),ue=O([]),ot=O(!1),at=O(!1),ht=O(50),lt=O(34),Oo=z(()=>{const a=ht.value+lt.value;return`calc(100vh - ${a>0?a:84}px)`}),yt=O(!1),Ve=z(()=>!!c.params.id&&c.params.id!=="standalone"),Ee=z(()=>c.params.id==="standalone"&&c.query.standalone==="true"),Et=z(()=>w(y.value)),st=O(!1),pe=O(!1),Ao=z(()=>st.value||ot.value||at.value||!pe.value),Ro=z(()=>({inspection:"Perfect for equipment condition verification with pass/fail outcomes, commonly used in safety checks and quality control procedures.",checkbox:"Ideal for simple yes/no confirmations, compliance checklists, and ensuring critical steps are acknowledged before proceeding.",number:"Essential for recording measurements, sensor readings, and quantitative data with optional unit specifications and validation limits.",text:"Best for capturing detailed observations, technician notes, and contextual information that structured data cannot represent.",attachments:"Critical for visual documentation, before/after photos, and creating comprehensive maintenance records for compliance and audit trails.",service:"Designed for maintenance operations requiring specific device tag identification and service type specification, supporting Replace and Repair workflows with quantity tracking."})),No=z(()=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec"})),Eo=z(()=>{if(!h.value.focused_step_id)return null;const a=y.value.steps.find(n=>n.step_id===h.value.focused_step_id);return(a==null?void 0:a.type)||null}),qo=z(()=>ue.value.sort((a,n)=>a.label.localeCompare(n.label))),nt=O(!0),_e=async()=>{if(je.value)try{await je.value.validate(),nt.value=!0}catch{nt.value=!1}};Z([()=>y.value.name,()=>y.value.category,()=>y.value.estimated_minutes],()=>{me(()=>{_e()})},{immediate:!1});const Lo=z(()=>{const a=y.value.name&&typeof y.value.name=="string"&&y.value.name.trim().length>0,n=y.value.category;let d=!1;if(typeof n=="number")d=n>0;else if(typeof n=="string")d=n.trim().length>0;else if(n&&typeof n=="object"){const E=n.id??n.value??null,K=n.name??n.label??"";d=!!(E&&E>0||K&&K.trim().length>0)}const p=y.value.estimated_minutes>0,g=Et.value.length===0,R=je.value?nt.value:!0;return a&&d&&p&&g&&R});Z(()=>pe.value,a=>{a&&me(()=>_e())});const Uo=z(()=>y.value.steps.map(n=>({id:n.step_id,order:n.order,type:n.type,title:n.label||`Untitled ${n.type} step`,required:n.required||!1}))),Bo=z(()=>({showCheckboxes:!0,showDragHandles:!0,showStepNumbers:!0,showTypeIcons:!0,showBulkToolbarOnSelect:!0,rowDensity:"compact"})),Mo=z(()=>({allowMultiSelect:!0,allowGroupDrag:!0,allowInlineRename:!0,confirmOnDelete:!0})),zo=z(()=>["duplicate","mark_required","mark_optional","delete"]),{previewDialogConfig:jo,previewHeaderConfig:Wo,previewToolbarConfig:Ho,previewLayoutConfig:Jo,previewContentConfig:Go,previewFooterConfig:Qo}=ho(),Ko={name:[{required:!0,message:"Task name is required",trigger:"blur"},{min:3,max:200,message:"Name should be 3-200 characters",trigger:"blur"}],category:[{required:!0,message:"Category is required",trigger:"change"}],estimated_minutes:[{required:!0,message:"Estimated time is required",trigger:"change"},{type:"number",min:1,message:"Time must be at least 1 minute",trigger:"change"}]},Yo=()=>{const a=()=>{et.value&&!I.sidebar.opened&&I.TOGGLE_SIDEBAR(),e.push({name:"TaskLibrary"})};oe.value?(Se.value=a,Ne.value=!0):a()},qe=async a=>{const n=r.value||"/work-order/table",d=_.value,p=P.value,g=new URL(n,window.location.origin);let R=g.pathname||"/work-order/table";R==="/"&&g.hash&&g.hash.startsWith("#/")&&(R=g.hash.slice(1));const K={...Object.fromEntries(g.searchParams.entries())},ae=d==="edit"&&p,N=d==="create"||!d&&x.shouldOpenCreatePanel;ae&&!x.isEditMode?(console.warn("Context mismatch: Navigation indicates edit mode but draft store is not in edit mode"),x.setContext("edit")):N&&!x.isCreateMode&&(console.warn("Context mismatch: Navigation indicates create mode but draft store is not in create mode"),x.setCreateMode());const le=N;le?(K.panel="create","showCreate"in K||(K.showCreate="1")):ae&&(K.panel="edit",p&&(K.workOrderId=p)),x.setShouldOpenCreatePanel(le),a&&Y.success(a),H.tagsView&&await he.DEL_VIEW(c),await e.push({path:R,query:K})},qt=async()=>{try{await Ie.confirm("Do you want to save this as a template or only for this work order?","Save Task",{confirmButtonText:"Save as Template",cancelButtonText:"Save Only for Work Order",distinguishCancelAndClose:!0,type:"info"}),await Le({mode:"template",fromWorkOrderContext:!0})}catch(a){a==="cancel"&&await Le({mode:"adhoc",fromWorkOrderContext:!0})}},Xo=async()=>{try{if(await je.value.validate(),Ee.value&&de.value){const a={categories:ue.value,equipmentTree:tt.value},n=St(de.value,y.value,a);G(n)}else if(Ve.value&&de.value){const a={categories:ue.value,equipmentTree:tt.value},n=St(de.value,y.value,a);G(n)}else b.value?await qt():await Le({mode:"template",fromWorkOrderContext:!1})}catch(a){console.error("Validation error:",a),a.fields?Y.error("Please fix validation errors before saving"):Y.error("Please check your data and try again")}},Le=async({mode:a="template",fromWorkOrderContext:n=!1}={})=>{var d,p;try{if(Je.value=!0,Ve.value){const g=c.params.id;if(!g)throw new Error("Template ID is required for editing");const R=await j(g,y.value);if(oe.value=!1,De(ie.value),de.value=JSON.parse(JSON.stringify(y.value)),n){const E=_.value,K=P.value,ae=E==="edit"&&K,N=E==="create";ae&&!x.isEditMode?(console.warn("Template update: Setting edit mode context for consistency"),x.setContext("edit")):N&&!x.isCreateMode&&(console.warn("Template update: Setting create mode context for consistency"),x.setCreateMode()),x.updateTasksWithTemplate(R),x.setShouldOpenCreatePanel(N),await qe("Template updated and task refreshed.");return}if(H.tagsView){const{visitedViews:E}=await he.DEL_VIEW(c);await B();const K=E.slice(-1)[0];K?e.push(K.fullPath):e.push({name:"TaskLibrary"})}else e.push({name:"TaskLibrary",query:{focusTemplate:g,refresh:!0}})}else if(a==="template"){const g=await v(y.value);if(oe.value=!1,De(ie.value),n){x.appendTask(to(g)),await qe("Template saved and added to the work order.");return}const R=g.id||g.template_id;H.tagsView?(await he.DEL_VIEW(c),await B(),e.push({name:"TaskLibrary",query:{focusTemplate:R,refresh:!0}})):e.push({name:"TaskLibrary",query:{focusTemplate:R,refresh:!0}})}else if(a==="adhoc"){const g=Array.isArray(ue.value)?ue.value.find(E=>E.value===y.value.category):null,R=rt(y.value,g);x.appendTask(R),oe.value=!1,De(ie.value),await qe("Task added to the work order.")}}catch(g){console.error("Save error:",g),g.fields?Y.error("Please fix validation errors before saving"):(p=(d=g.response)==null?void 0:d.data)!=null&&p.message?Y.error(`Save failed: ${g.response.data.message}`):g.message?Y.error(`Save failed: ${g.message}`):Y.error("Failed to save task. Please check your data and try again.")}finally{Je.value=!1}},Lt=async()=>{try{Je.value=!0;const a=c.query.taskId;if(!a)throw new Error("Original task ID not found");const n=Array.isArray(ue.value)?ue.value.find(g=>g.value===y.value.category):null,d=rt(y.value,n),p={id:a,name:d.name,description:d.description,category:d.category,category_name:d.category_name,estimated_minutes:d.estimated_minutes,steps:d.steps,source:"adhoc",payload:d.payload};x.updateTask(a,p),oe.value=!1,De(ie.value),await qe("Standalone task updated successfully.")}catch(a){console.error("Standalone save error:",a),a.message?Y.error(`Update failed: ${a.message}`):Y.error("Failed to update standalone task. Please try again.")}finally{Je.value=!1}},Zo=()=>{yt.value=!0},$o=async()=>{try{if(await Ie.confirm("Are you sure you want to reset all changes? This action cannot be undone.","Reset Confirmation",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}),Ee.value||Ve.value)if(de.value){const a=JSON.parse(JSON.stringify(de.value));y.value.name=a.name||"",y.value.description=a.description||"",y.value.category=a.category||"",y.value.estimated_minutes=a.estimated_minutes||30,y.value.applicable_assets=a.applicable_assets||null,y.value.steps=a.steps||[],xe(),oe.value=!1;const n=Ee.value?"Standalone task restored to original state":"Template restored to original state";Y.success(n),De(ie.value)}else Y.error("No original task data available");else y.value.name="",y.value.description="",y.value.category="",y.value.estimated_minutes=30,y.value.applicable_assets=null,y.value.steps=[],xe(),oe.value=!1,Y.success("All inputs cleared"),De(ie.value)}catch(a){a!=="cancel"&&(Y.error("Reset operation failed"),console.error("Reset error:",a))}},ve=()=>{oe.value=!0},ea=a=>{J(a)},ta=async()=>{try{await Ie.confirm("This will remove all procedure steps. This action cannot be undone.","Clear All Steps",{confirmButtonText:"Continue",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--primary"}),y.value.steps=[],ve(),Y.success("All steps have been cleared")}catch{}},oa=a=>{const n={step_id:`step-${Date.now()}`,order:y.value.steps.length+1,type:a,label:`New ${a} step`,description:"",required:!1,required_image:!1,relevant_resources:[],relevant_tools:[],config:Ct(a)};y.value.steps.push(n),ve(),J(n.step_id),me(()=>{setTimeout(()=>{$(n.step_id)},100)})},it=(a,n)=>{const d=y.value.steps.findIndex(p=>p.step_id===a);d!==-1&&(Object.assign(y.value.steps[d],n),n.type&&(y.value.steps=[...y.value.steps]),ve())},aa=async a=>{try{await Ie.confirm("Are you sure you want to delete this step?","Delete Step",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),y.value.steps=y.value.steps.filter(n=>n.step_id!==a),y.value.steps.forEach((n,d)=>{n.order=d+1}),ve(),h.value.focused_step_id===a&&J(null)}catch{}},la=a=>{const n=y.value.steps.findIndex(g=>g.step_id===a);if(n===-1)return;const d=y.value.steps[n],p={...d,step_id:`step-${Date.now()}`,label:`${d.label} (Copy)`,config:d.config?JSON.parse(JSON.stringify(d.config)):{},relevant_tools:d.relevant_tools?[...d.relevant_tools]:[],relevant_resources:d.relevant_resources?[...d.relevant_resources]:[]};y.value.steps.splice(n+1,0,p),y.value.steps.forEach((g,R)=>{g.order=R+1}),ve(),J(p.step_id),me(()=>{setTimeout(()=>{$(p.step_id)},100)})},sa=(a,n)=>{const d=y.value.steps.find(p=>p.step_id===a);if(d)switch(n){case"limits":V(a,d.config.limits||{});break;case"tools":const p=Array.isArray(d.relevant_tools)&&d.relevant_tools.length>0&&typeof d.relevant_tools[0]=="object"?d.relevant_tools.map(g=>g.tool_id):d.relevant_tools||[];D(a,p);break;case"resources":C(a,d.relevant_resources||[]);break}},na=a=>{},ia=a=>{bt(),ve()},ra=a=>{bt()},bt=()=>{y.value.steps.forEach((a,n)=>{a.order=n+1})},da=({stepId:a,sourceIndex:n,targetIndex:d})=>{if(n===d)return;const p=[...y.value.steps],g=p[n];p.splice(n,1),p.splice(d,0,g),p.forEach((R,E)=>{R.order=E+1}),y.value.steps=p,ve()},ca=async({action:a,stepIds:n})=>{const d=n.map(p=>y.value.steps.findIndex(g=>g.step_id===p)).filter(p=>p!==-1);switch(a){case"duplicate":const p=d.map(g=>{const R=y.value.steps[g];return{...R,step_id:`step-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,label:`${R.label} (Copy)`,order:y.value.steps.length+1}});y.value.steps.push(...p);break;case"mark_required":d.forEach(g=>{y.value.steps[g].required=!0});break;case"mark_optional":d.forEach(g=>{y.value.steps[g].required=!1});break;case"delete":try{await Ie.confirm(`Are you sure you want to delete ${n.length} step(s)? This action cannot be undone.`,"Delete Steps",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),d.sort((R,E)=>E-R).forEach(R=>{y.value.steps.splice(R,1)})}catch{return}break}y.value.steps.forEach((p,g)=>{p.order=g+1}),ve()},ua=a=>{J(a),setTimeout(()=>{const n=document.querySelector(`[data-step-id="${a}"] .step-label-input input`);n&&(n.focus(),n.select())},100)},pa=a=>{M(a)},ma=(a,n)=>{var d;it(a,{config:{...(d=y.value.steps.find(p=>p.step_id===a))==null?void 0:d.config,limits:n}}),F()},fa=(a,n)=>{it(a,{relevant_tools:n}),W()},ga=(a,n)=>{it(a,{relevant_resources:n}),re()},_a=()=>{Ne.value=!1,Se.value=null},va=()=>{oe.value=!1,Ne.value=!1,Se.value&&(Se.value(),Se.value=null)},Ge=()=>{me(()=>{const a=document.querySelector(".navbar");a&&a.offsetHeight>0&&(ht.value=a.offsetHeight);const n=document.querySelector("#tags-view-container");H.tagsView&&n&&n.offsetHeight>0?lt.value=n.offsetHeight:lt.value=0})},wt=()=>{Ge()},Ut=(a,n)=>{var R,E,K,ae,N,le;const d=[],p=a.config||{},g=n.config||{};if(n.type==="number"){const ee=p.limits,Pe=g.limits;if(JSON.stringify(ee)!==JSON.stringify(Pe)){const Fe=Ze(ee,p.unit),ce=Ze(Pe,g.unit);d.push({field:"limits",label:"Range",original:Fe,current:ce})}p.unit!==g.unit&&d.push({field:"unit",label:"Unit",original:p.unit||"None",current:g.unit||"None"}),p.decimal_places!==g.decimal_places&&d.push({field:"decimal_places",label:"Decimal Places",original:((R=p.decimal_places)==null?void 0:R.toString())||"0",current:((E=g.decimal_places)==null?void 0:E.toString())||"0"}),p.default_value!==g.default_value&&d.push({field:"default_value",label:"Default Value",original:((K=p.default_value)==null?void 0:K.toString())||"None",current:((ae=g.default_value)==null?void 0:ae.toString())||"None"})}else n.type==="checkbox"?p.default!==g.default&&d.push({field:"default",label:"Default Value",original:p.default?"Checked":"Unchecked",current:g.default?"Checked":"Unchecked"}):n.type==="text"?(p.default_value!==g.default_value&&d.push({field:"default_value",label:"Default Value",original:p.default_value||"None",current:g.default_value||"None"}),p.max_length!==g.max_length&&d.push({field:"max_length",label:"Max Length",original:((N=p.max_length)==null?void 0:N.toString())||"Unlimited",current:((le=g.max_length)==null?void 0:le.toString())||"Unlimited"})):n.type==="inspection"&&p.default!==g.default&&d.push({field:"default",label:"Default Value",original:p.default||"None",current:g.default||"None"});return d.length===0&&JSON.stringify(p)!==JSON.stringify(g)&&d.push({field:"config",label:"Configuration",original:"Modified",current:"Modified"}),d},St=(a,n,d={})=>{const p={metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]};[{key:"name",label:"Task Name"},{key:"description",label:"Description"},{key:"category",label:"Category"},{key:"estimated_minutes",label:"Estimated Time"},{key:"applicable_assets",label:"Applicable Assets"}].forEach(N=>{const le=a[N.key],ee=n[N.key];JSON.stringify(le)!==JSON.stringify(ee)&&p.metadata.push({field:N.key,label:N.label,original:Qe(le,N.key,d),current:Qe(ee,N.key,d)})});const R=a.steps||[],E=n.steps||[],K=new Map(R.map(N=>[N.step_id,N])),ae=new Map(E.map(N=>[N.step_id,N]));if(E.forEach(N=>{K.has(N.step_id)||p.steps_added.push({step_id:N.step_id,label:N.label,type:N.type,position:N.order})}),R.forEach(N=>{ae.has(N.step_id)||p.steps_deleted.push({step_id:N.step_id,label:N.label,type:N.type,position:N.order})}),E.forEach(N=>{const le=K.get(N.step_id);if(le){const ee=[];[{key:"label",label:"Name"},{key:"description",label:"Description"},{key:"required",label:"Required"},{key:"required_image",label:"Image Required"},{key:"type",label:"Type"}].forEach(ce=>{le[ce.key]!==N[ce.key]&&ee.push({field:ce.key,label:ce.label,original:Qe(le[ce.key],ce.key,d),current:Qe(N[ce.key],ce.key,d)})});const Fe=Ut(le,N);Fe.length>0&&ee.push(...Fe),JSON.stringify(le.relevant_tools)!==JSON.stringify(N.relevant_tools)&&ee.push({field:"relevant_tools",label:"Tools",original:`${(le.relevant_tools||[]).length} tools`,current:`${(N.relevant_tools||[]).length} tools`}),ee.length>0&&p.steps_modified.push({step_id:N.step_id,label:N.label,type:N.type,changes:ee})}}),R.length===E.length){const N=R.map(ee=>ee.step_id),le=E.map(ee=>ee.step_id);if(JSON.stringify(N)!==JSON.stringify(le)){const ee=[];E.forEach((Pe,Fe)=>{const ce=R.findIndex(ka=>ka.step_id===Pe.step_id);ce!==-1&&ce!==Fe&&ee.push({step_id:Pe.step_id,label:Pe.label,original_position:ce+1,new_position:Fe+1})}),p.steps_reordered=ee}}return p},Qe=(a,n="",d={})=>{if(a==null)return"None";if(n==="category"){if(typeof a=="number"&&d.categories){const p=d.categories.find(g=>g.value===a||g.id===a);return p?p.label:`Category ID: ${a}`}return typeof a=="string"&&a.trim()===""?"None":a.toString()}if(n==="applicable_assets"){if(Array.isArray(a)){if(a.length===0)return"None";if(d.equipmentTree&&d.equipmentTree.length>0){const p=a.map(g=>{const R=Ke(d.equipmentTree,g);if(R)return R.label;const E=parseInt(g);if(!isNaN(E)){const K=Ke(d.equipmentTree,E);return K?K.label:`Asset ID: ${g}`}return`Asset ID: ${g}`}).filter(Boolean);return p.length>0?p.join(", "):"None"}return`${a.length} asset(s)`}if(typeof a=="number"||typeof a=="string"&&a.trim()!==""){if(d.equipmentTree&&d.equipmentTree.length>0){const p=Ke(d.equipmentTree,a);return p?p.label:`Asset ID: ${a}`}return`Asset ID: ${a}`}return"None"}return Array.isArray(a)?a.length===0?"None":a.join(", "):typeof a=="boolean"?a?"Yes":"No":typeof a=="number"?n==="estimated_minutes"?`${a} minutes`:a.toString():typeof a=="string"&&a.trim()===""?"None":a.toString()},Ke=(a,n)=>{if(!Array.isArray(a))return null;for(const d of a){if(d.value===n||d.id===n||parseInt(d.value)===parseInt(n)||parseInt(d.id)===parseInt(n))return d;if(d.children&&d.children.length>0){const p=Ke(d.children,n);if(p)return p}}return null},Bt=async()=>{var a;at.value=!0;try{const n=await po(),d=g=>({value:g.id,label:g.name,children:g.children&&g.children.length>0?g.children.map(d):void 0});let p;(a=n.data)!=null&&a.data?p=n.data.data:Array.isArray(n.data)?p=n.data:n.data?p=[n.data]:p=[],tt.value=p.map(g=>d(g))}catch(n){console.error("Equipment tree load failed:",n),Y.error("Failed to load asset data.")}finally{at.value=!1}},Mt=async()=>{ot.value=!0;try{const a=await mo();Nt.value=a.data||[],ue.value=a.data.map(n=>({label:n.name,value:n.id}))}catch(a){console.error("Categories load failed:",a),Y.error("Failed to load category data."),ue.value=[{label:"Preventive Maintenance",value:1},{label:"Inspection",value:2},{label:"Repair",value:3},{label:"Calibration",value:4},{label:"Safety Check",value:5},{label:"Other",value:6}]}finally{ot.value=!1}},zt=a=>{if(!a.category)return"";if(typeof a.category=="object"&&a.category.id)return a.category.id;if(typeof a.category=="string"){const n=ue.value.find(d=>d.label===a.category);if(n)return n.value}return typeof a.category=="number"?a.category:""},jt=async a=>{var n;st.value=!0;try{const d=await oo(a);return(n=d==null?void 0:d.data)!=null&&n.data?d.data.data:d==null?void 0:d.data}finally{st.value=!1}},Wt=(a,n)=>{var R;if(a.step_id&&a.type&&a.config)return a;if(a.value&&a.value.type)return kt(a,n);const d=a.type||"text",g={template:"text",numeric:"number",boolean:"checkbox",file:"attachments",checkbox:"checkbox",text:"text",inspection:"inspection",number:"number",attachments:"attachments"}[d]||"text";return{step_id:a.id||a._id||`step-${Date.now()}-${n}`,order:n+1,type:g,label:a.name||`Step ${n+1}`,description:a.description||"",required:!!a.required,required_image:!!((R=a.value)!=null&&R.require_image),relevant_tools:a.tools||[],relevant_resources:a.relevant_resources||[],config:Ct(g)}},Ue=async()=>{var a;if(Ee.value)try{const n=c.query.taskData;if(!n)throw new Error("No task data provided for standalone task");const d=JSON.parse(n);if(y.value={name:d.name||"",description:d.description||"",category:d.category||"",estimated_minutes:d.estimated_minutes||30,applicable_assets:d.equipment_node_id||null,steps:Array.isArray(d.steps)?d.steps.map(Wt):[]},ne.value={id:d.id,name:d.name,description:d.description,steps:d.steps||[],isStandalone:!0},de.value=JSON.parse(JSON.stringify(y.value)),oe.value=!1,H.tagsView){const p=`Edit Standalone Task - ${d.name||d.id}`;he.UPDATE_VISITED_VIEW_TITLE(c.path,p)}me(()=>{_e()})}catch(n){console.error("Standalone task load failed:",n),Y.error("Failed to load standalone task data"),e.push({name:"TaskLibrary"})}else if(Ve.value)try{const n=await jt(c.params.id);if(!n)throw new Error("Template not found");if(y.value={name:n.name||"",description:n.description||"",category:zt(n),estimated_minutes:n.time_estimate_sec?Math.round(n.time_estimate_sec/60):n.estimated_minutes||30,applicable_assets:((a=n.equipment_node)==null?void 0:a.id)||n.equipment_node_id||null,steps:Array.isArray(n.steps)?n.steps.map(kt):[]},ne.value=n,de.value=JSON.parse(JSON.stringify(y.value)),oe.value=!1,H.tagsView&&n.reference_id){const d=`Edit Task - ${n.reference_id}`;he.UPDATE_VISITED_VIEW_TITLE(c.path,d)}me(()=>{_e()})}catch(n){console.error("Template load failed:",n),Y.error("Failed to load task"),e.push({name:"TaskLibrary"})}else ne.value=null,y.value={name:"",description:"",category:"",estimated_minutes:30,applicable_assets:null,steps:[]},oe.value=!1,me(()=>{_e()})};Be(async()=>{var a;ze.value={path:c.path,params:{...c.params||{}}},typeof window<"u"&&(window.__designerCacheStats=At),pe.value=!1,ie.value=(a=c.params)!=null&&a.id?`designer-edit-${c.params.id}`:"designer-create",et.value=I.sidebar.opened,I.sidebar.opened&&window.innerWidth<1600&&I.CLOSE_SIDEBAR(!1),Ge(),window.addEventListener("resize",wt),await Promise.all([Mt(),Bt()]),!(H.tagsView&&vt())&&(await Ue(),pe.value=!0,await me(()=>_e()))}),ro(()=>{window.removeEventListener("resize",wt),et.value&&!I.sidebar.opened&&I.TOGGLE_SIDEBAR(),xe()}),co(async()=>{if(He.value=!0,ze.value={path:c.path,params:{...c.params||{}}},Ge(),pe.value=!1,H.tagsView&&(It(ie.value)||vt())){const n=$e(ie.value)||Rt();if(n){(p=>{if(!p||typeof p!="object")return!0;const g=typeof p.name=="string"&&p.name.trim().length>0,R=Array.isArray(p.steps)&&p.steps.length>0,E=!!p.category;return!(g||R||E)})(n.templateForm)&&n.originalTemplate?(console.warn("[Designer] Cached templateForm empty; rebuilding from originalTemplate snapshot"),y.value=JSON.parse(JSON.stringify(n.originalTemplate))):y.value=n.templateForm,de.value=n.originalTemplate,ne.value=n.currentTemplate,oe.value=n.hasUnsavedChanges,n.designerState&&Object.assign(h.value,n.designerState),pe.value=!0,await me(()=>{_e()}),Ve.value&&ne.value&&(ne.value.id||ne.value.template_id)!==c.params.id&&(console.warn("[Designer] Cached template id mismatch; reloading by route id","cached:",ne.value.id||ne.value.template_id,"route:",c.params.id),await Ue(),pe.value=!0);return}}if(H.tagsView&&Ve.value&&c.params.id){const n=Pt(c.params.id,we());if(n){(p=>{if(!p||typeof p!="object")return!0;const g=typeof p.name=="string"&&p.name.trim().length>0,R=Array.isArray(p.steps)&&p.steps.length>0,E=!!p.category;return!(g||R||E)})(n.templateForm)&&n.originalTemplate?(console.warn("[Designer] Cached templateForm empty (templateId path); rebuilding from originalTemplate"),y.value=JSON.parse(JSON.stringify(n.originalTemplate))):y.value=n.templateForm,de.value=n.originalTemplate,ne.value=n.currentTemplate,oe.value=n.hasUnsavedChanges,n.designerState&&Object.assign(h.value,n.designerState),pe.value=!0,await me(()=>_e());return}}!y.value.name&&!y.value.description&&y.value.steps.length===0&&(await Ue(),pe.value=!0)}),uo(()=>{var a,n;if(He.value=!1,H.tagsView){const d=E=>{if(!E||typeof E!="object")return!0;const K=typeof E.name=="string"&&E.name.trim().length>0,ae=Array.isArray(E.steps)&&E.steps.length>0,N=!!E.category;return!(K||ae||N)};let p=y.value;const g=$e(ie.value);d(p)&&(g!=null&&g.templateForm)&&(console.warn("[Designer] Avoiding empty-form save by using previous cached form for key:",ie.value),p=g.templateForm);const R={templateForm:p,originalTemplate:de.value,currentTemplate:ne.value,hasUnsavedChanges:oe.value,designerState:h.value};ye(ie.value,R,we(),((a=ne.value)==null?void 0:a.id)||((n=ne.value)==null?void 0:n.template_id)||c.params.id||null)}});const ha=()=>{},ya=()=>{yt.value=!1},ba=()=>{window.print()},wa=async()=>{Me(!0);const a=c.query.workOrderName,n=c.query.workOrderId;try{Ee.value?(await Lt(),se()):b.value?(se(),Re(n,a)):(await Le({mode:"template",fromWorkOrderContext:!1}),se())}catch{}finally{Me(!1)}},Sa=()=>{se()};Z(()=>c.params.id,(a,n)=>{var d,p;if(a!==n&&!(H.tagsView&&!He.value)){if(H.tagsView&&He.value){const g=ae=>{if(!ae||typeof ae!="object")return!0;const N=typeof ae.name=="string"&&ae.name.trim().length>0,le=Array.isArray(ae.steps)&&ae.steps.length>0,ee=!!ae.category;return!(N||le||ee)};let R=y.value;const E=$e(ie.value);g(R)&&(E!=null&&E.templateForm)&&(console.warn("[Designer] Avoiding empty-form preemptive save by using previous cached form for key:",ie.value),R=E.templateForm);const K={templateForm:R,originalTemplate:de.value,currentTemplate:ne.value,hasUnsavedChanges:oe.value,designerState:h.value};ye(ie.value,K,we(),((d=ne.value)==null?void 0:d.id)||((p=ne.value)==null?void 0:p.template_id)||n||null),pe.value=!1}oe.value&&!H.tagsView?(Se.value=()=>Ue(),Ne.value=!0):(Ue(),pe.value=!0)}}),Z(()=>H.tagsView,()=>{Ge()},{immediate:!1}),Qt((a,n,d)=>{!H.tagsView&&oe.value?(Se.value=()=>d(),Ne.value=!0):d()});const Ht={route:c,router:e,workOrderDraftStore:x,fromWorkOrder:b,workOrderReturnRoute:r,workOrderReturnPanel:_,workOrderReturnWorkOrderId:P,loadTemplates:B,createTemplate:v,updateTemplate:j,validateTemplate:w,tourOpen:L,startTour:m,onTourFinish:S,designerState:h,setFocusedStep:J,toggleFloatingPanelMode:Q,setFloatingPanelMode:M,scrollToNewStep:$,openNumberLimitsDialog:V,closeNumberLimitsDialog:F,openToolsDialog:D,closeToolsDialog:W,openResourcesDialog:C,closeResourcesDialog:re,openChangeSummaryDialog:G,closeChangeSummaryDialog:se,setChangeSummaryLoading:Me,showWorkOrderSaveConfirmation:Re,resetDesignerState:xe,appStore:I,settingsStore:H,tagsViewStore:he,saveState:ge,saveStateByKey:ye,restoreState:be,restoreStateByKey:$e,restoreStateByTemplateId:Pt,hasCachedState:Ft,hasCachedStateByKey:It,clearState:Ot,clearStateByKey:De,getCacheStats:At,routeSnapshot:ze,stableCacheKey:ie,metadataFormRef:je,stepsListRef:We,snapshotRoute:we,hasCache:vt,restoreCache:Rt,saveCache:Po,clearCache:Fo,isComponentActive:He,templateForm:y,originalTemplate:de,currentTemplate:ne,hasUnsavedChanges:oe,saving:Je,showUnsavedDialog:Ne,pendingNavigation:Se,originalSidebarState:et,showComponentTips:Io,equipmentTreeData:tt,allCategories:Nt,categoriesForDropdown:ue,categoriesLoading:ot,equipmentTreeLoading:at,navbarHeight:ht,tagsViewHeight:lt,containerHeight:Oo,showPreviewDialog:yt,isEditing:Ve,isStandaloneTask:Ee,validationErrors:Et,detailLoading:st,renderReady:pe,isDataLoading:Ao,componentUsageTips:Ro,stepTypeColors:No,focusedStepType:Eo,availableCategories:qo,isElementFormValid:nt,validateElementForm:_e,isFormValid:Lo,stepsForPanel:Uo,floatingPanelUiHints:Bo,floatingPanelInteractions:Mo,enabledBulkActions:zo,previewDialogConfig:jo,previewHeaderConfig:Wo,previewToolbarConfig:Ho,previewLayoutConfig:Jo,previewContentConfig:Go,previewFooterConfig:Qo,metadataRules:Ko,handleBack:Yo,navigateBackToWorkOrder:qe,promptWorkOrderSaveMode:qt,handleSave:Xo,performSave:Le,performStandaloneSave:Lt,handlePreview:Zo,handleReset:$o,markAsChanged:ve,handleStepFocus:ea,handleResetSteps:ta,handleAddStep:oa,handleStepUpdate:it,handleStepDelete:aa,handleStepDuplicate:la,handleStepConfigure:sa,handleVueDragStart:na,handleVueDragEnd:ia,handleVueDragChange:ra,updateStepOrders:bt,handleReorderSteps:da,handleBulkAction:ca,handleInlineRename:ua,handleSetMode:pa,handleNumberLimitsSave:ma,handleToolsSave:fa,handleResourcesSave:ga,handleUnsavedDialogClose:_a,discardChanges:va,calculateDynamicHeights:Ge,handleResize:wt,getDetailedConfigChanges:Ut,generateChangesSummary:St,formatValue:Qe,findAssetInTree:Ke,fetchEquipmentTreeData:Bt,fetchCategories:Mt,resolveCategoryFromApiTemplate:zt,fetchTemplateByIdLocal:jt,transformStandaloneStepToDesigner:Wt,initializeTemplate:Ue,handlePreviewOpen:ha,handlePreviewClose:ya,handlePreviewPrint:ba,handleChangeSummaryConfirm:wa,handleChangeSummaryCancel:Sa,__MACROS_defineComponent:_t,ref:O,computed:z,onMounted:Be,onBeforeUnmount:ro,onActivated:co,onDeactivated:uo,watch:Z,nextTick:me,get useRoute(){return Jt},get useRouter(){return Gt},get onBeforeRouteLeave(){return Qt},get ArrowLeft(){return Ba},get Check(){return Do},get View(){return bo},get Warning(){return Ua},get DocumentAdd(){return La},get Plus(){return Vt},get Switch(){return qa},get CircleCheck(){return xt},get RefreshLeft(){return Ea},get QuestionFilled(){return Na},get ElMessage(){return Y},get ElMessageBox(){return Ie},get useTaskLibrary(){return eo},get getTaskTemplateById(){return oo},get useDesignerStateCache(){return no},get useDesignerTour(){return vo},get useAppStore(){return ao},get useSettingsStore(){return lo},get useTagsViewStore(){return so},get useWorkOrderDraftStore(){return $t},get buildDisplayTaskFromTemplate(){return to},get buildDisplayTaskFromDesigner(){return rt},get getEquipmentTree(){return po},get getAllCategories(){return mo},get VueDraggable(){return Vo},BaseStepCard:_l,FloatingPanel:Hl,NumberLimitsPanel:es,ToolPickerPanel:ys,ResourceUploaderPanel:Ws,PreviewDialog:mn,ChangeSummaryDialog:ii,get usePreviewConfigs(){return ho},get getDefaultStepConfig(){return Ct},get transformApiStepToDesignerStep(){return kt},get formatLimitsText(){return Ze}};return Object.defineProperty(Ht,"__isScriptSetup",{enumerable:!1,value:!0}),Ht}}),ci={class:"designer-header"},ui={class:"header-left"},pi={class:"header-title"},mi={class:"title-with-help"},fi={key:1,class:"template-status"},gi={key:0,class:"unsaved-indicator"},_i={class:"header-actions"},vi={class:"designer-content"},hi={class:"left-panel"},yi={key:0,class:"panel-loading"},bi={style:{padding:"14px"}},wi={class:"card-header-with-toggle"},Si={class:"card-title"},ki={key:0},Ci={key:0,class:"validation-list"},Ti={key:1,class:"no-issues"},xi={key:0,class:"tips-list"},Di={class:"tip-description"},Vi={key:1,class:"no-tips"},Pi={class:"center-panel"},Fi={class:"steps-header"},Ii={class:"steps-title"},Oi={key:0,class:"steps-count"},Ai={class:"steps-actions"},Ri={key:0,class:"center-panel-loading"},Ni={style:{padding:"16px"}},Ei={style:{display:"flex","align-items":"center",padding:"16px",border:"1px solid #eee","border-radius":"4px",background:"white"}},qi={style:{flex:"1"}},Li={style:{display:"flex",gap:"8px"}},Ui={key:0,class:"empty-steps"},Bi={class:"empty-content"},Mi={ref:"stepsListRef",class:"steps-list"},zi={class:"right-panel"},ji={key:0,class:"panel-loading"},Wi={style:{padding:"16px",background:"white","border-radius":"4px"}},Hi={style:{display:"flex",gap:"8px","margin-bottom":"16px"}},Ji={style:{display:"flex","flex-direction":"column",gap:"8px"}},Gi={class:"dialog-footer"};function Qi(q,t,c,e,x,b){var D,W;const r=k("el-icon"),_=k("el-button"),P=k("el-tooltip"),B=k("el-tag"),v=k("el-skeleton-item"),j=k("el-card"),w=k("el-skeleton"),L=k("el-input"),m=k("el-form-item"),S=k("el-option"),h=k("el-select"),J=k("el-input-number"),Q=k("el-tree-select"),M=k("el-form"),$=k("el-dialog"),V=k("el-tour-step"),F=k("el-tour");return i(),f("div",{class:"template-designer-view",style:fe({height:e.containerHeight})},[u(" Designer Header "),l("div",ci,[l("div",ui,[e.settingsStore.tagsView?u("v-if",!0):(i(),U(_,{key:0,type:"text",onClick:e.handleBack,class:"back-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.ArrowLeft)]),_:1})]),_:1})),l("div",pi,[l("div",mi,[l("h1",null,T(e.isStandaloneTask?"Edit Standalone Task":e.isEditing?"Edit Task":"Create New Task"),1),o(P,{content:"Show guided tour",placement:"bottom",effect:"dark"},{default:s(()=>[o(_,{type:"text",size:"default",onClick:e.startTour,class:"help-button",icon:e.QuestionFilled},null,8,["onClick","icon"])]),_:1})]),e.isEditing&&((D=e.currentTemplate)!=null&&D.reference_id)?(i(),U(B,{key:0,type:"info",class:"template-id-header"},{default:s(()=>[A(" #"+T(e.currentTemplate.reference_id),1)]),_:1})):u("v-if",!0),e.currentTemplate?(i(),f("div",fi,[e.hasUnsavedChanges?(i(),f("span",gi,[o(r,null,{default:s(()=>[o(e.Warning)]),_:1}),t[11]||(t[11]=A(" Unsaved changes "))])):u("v-if",!0)])):u("v-if",!0)])]),l("div",_i,[o(_,{onClick:e.handleReset,plain:"",style:{"font-weight":"500"}},{default:s(()=>[o(r,null,{default:s(()=>[o(e.RefreshLeft)]),_:1}),t[12]||(t[12]=A(" Reset "))]),_:1,__:[12]}),o(_,{type:"primary",onClick:e.handlePreview,plain:"",style:{"font-weight":"500"}},{default:s(()=>[o(r,null,{default:s(()=>[o(e.View)]),_:1}),t[13]||(t[13]=A(" Preview "))]),_:1,__:[13]}),o(P,{content:e.isFormValid?"":"Please fix validation issues",disabled:e.isFormValid,placement:"bottom",effect:"dark"},{default:s(()=>[o(_,{type:"primary",size:"default",onClick:e.handleSave,loading:e.saving,disabled:!e.isFormValid,class:Ce({"shake-on-hover":!e.isFormValid}),style:{"font-weight":"550"}},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Check)]),_:1}),A(" "+T(e.isStandaloneTask?"Update Task":e.isEditing?"Save Changes":"Save Task"),1)]),_:1},8,["loading","disabled","class"])]),_:1},8,["content","disabled"])])]),u(" Designer Content "),l("div",vi,[u(" Left Panel - Template Metadata "),l("div",hi,[e.isDataLoading?(i(),f("div",yi,[o(w,{animated:""},{template:s(()=>[o(j,{class:"metadata-card"},{header:s(()=>[o(v,{variant:"text",style:{width:"40%"}})]),default:s(()=>[l("div",bi,[o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"80px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"40%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"40%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px"}})])]),_:1})]),_:1})])):(i(),U(j,{key:1,class:"metadata-card"},{header:s(()=>t[14]||(t[14]=[l("span",{class:"card-title"},"Task Information",-1)])),default:s(()=>[o(M,{ref:"metadataFormRef",model:e.templateForm,rules:e.metadataRules,"label-position":"top",class:"metadata-form"},{default:s(()=>[o(m,{label:"Task Name",prop:"name",required:""},{default:s(()=>[o(L,{modelValue:e.templateForm.name,"onUpdate:modelValue":t[0]||(t[0]=C=>e.templateForm.name=C),placeholder:"Enter task name",onInput:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(m,{label:"Description",prop:"description"},{default:s(()=>[o(L,{modelValue:e.templateForm.description,"onUpdate:modelValue":t[1]||(t[1]=C=>e.templateForm.description=C),type:"textarea",rows:4,placeholder:"Describe what this task is for",onInput:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(m,{label:"Category",prop:"category",required:""},{default:s(()=>[o(h,{modelValue:e.templateForm.category,"onUpdate:modelValue":t[2]||(t[2]=C=>e.templateForm.category=C),placeholder:"Select category",style:{width:"100%"},onChange:e.markAsChanged},{default:s(()=>[(i(!0),f(X,null,te(e.availableCategories,C=>(i(),U(S,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"Estimated Time (minutes)",prop:"estimated_minutes",required:""},{default:s(()=>[o(J,{modelValue:e.templateForm.estimated_minutes,"onUpdate:modelValue":t[3]||(t[3]=C=>e.templateForm.estimated_minutes=C),min:1,max:480,style:{width:"100%"},onChange:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(m,{label:"Applicable Assets",prop:"applicable_assets"},{default:s(()=>[o(Q,{modelValue:e.templateForm.applicable_assets,"onUpdate:modelValue":t[4]||(t[4]=C=>e.templateForm.applicable_assets=C),placeholder:"Select applicable assets",data:e.equipmentTreeData,filterable:"","check-strictly":"","node-key":"value",props:{children:"children",label:"label"},multiple:!1,style:{width:"100%"},onChange:e.markAsChanged},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1})),u(" Template Validation & Usage Tips "),e.validationErrors.length>0||e.templateForm.steps.length>0?(i(),U(j,{key:2,class:"validation-card"},{header:s(()=>[l("div",wi,[l("span",Si,T(e.showComponentTips?"Component Usage Tips":"Validation Issues"),1),o(P,{content:e.showComponentTips?"Switch to Validation Issues":"Switch to Component Usage Tips",placement:"top"},{default:s(()=>[o(_,{type:"text",size:"small",onClick:t[5]||(t[5]=C=>e.showComponentTips=!e.showComponentTips),class:"toggle-button"},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Switch)]),_:1})]),_:1})]),_:1},8,["content"])])]),default:s(()=>[e.showComponentTips?(i(),f(X,{key:1},[u(" Component Usage Tips View "),l("div",null,[e.focusedStepType?(i(),f("div",xi,[l("div",{class:"tip-item",style:fe({borderLeftColor:e.stepTypeColors[e.focusedStepType]})},[l("div",{class:"tip-type",style:fe({color:e.stepTypeColors[e.focusedStepType]})},T(e.focusedStepType.charAt(0).toUpperCase()+e.focusedStepType.slice(1))+" Step: ",5),l("div",Di,T(e.componentUsageTips[e.focusedStepType]),1)],4)])):(i(),f("div",Vi,t[16]||(t[16]=[l("span",null,"Select a step to see its usage tip",-1)])))])],2112)):(i(),f("div",ki,[e.validationErrors.length>0?(i(),f("ul",Ci,[(i(!0),f(X,null,te(e.validationErrors,C=>(i(),f("li",{key:C,class:"validation-error"},T(C),1))),128))])):(i(),f("div",Ti,[o(r,{class:"success-icon"},{default:s(()=>[o(e.CircleCheck)]),_:1}),t[15]||(t[15]=l("span",null,"No validation issues found",-1))]))]))]),_:1})):u("v-if",!0)]),u(" Center Panel - Steps Designer "),l("div",Pi,[l("div",Fi,[l("div",Ii,[t[17]||(t[17]=l("h3",null,"Procedure Designer",-1)),e.isDataLoading?(i(),U(w,{key:1,style:{width:"60px",height:"18px"},animated:""})):(i(),f("span",Oi,T(e.templateForm.steps.length)+" steps",1))]),l("div",Ai,[o(P,{content:"Clear all steps",placement:"top"},{default:s(()=>[o(_,{type:"text",size:"small",onClick:e.handleResetSteps,disabled:e.templateForm.steps.length===0||e.isDataLoading,class:"reset-steps-btn"},{default:s(()=>[o(r,{style:{"font-size":"18px"}},{default:s(()=>[o(e.RefreshLeft)]),_:1})]),_:1},8,["disabled"])]),_:1})])]),e.isDataLoading?(i(),f("div",Ri,[o(w,{animated:""},{template:s(()=>[l("div",Ni,[(i(),f(X,null,te(3,C=>l("div",{key:C,style:{"margin-bottom":"16px"}},[l("div",Ei,[o(v,{variant:"circle",style:{width:"24px",height:"24px","margin-right":"12px"}}),l("div",qi,[o(v,{variant:"text",style:{width:"60%","margin-bottom":"8px"}}),o(v,{variant:"text",style:{width:"40%"}})]),l("div",Li,[o(v,{variant:"button",style:{width:"24px",height:"24px"}}),o(v,{variant:"button",style:{width:"24px",height:"24px"}}),o(v,{variant:"button",style:{width:"24px",height:"24px"}})])])])),64))])]),_:1})])):(i(),f("div",{key:1,class:Ce(["steps-container",{"no-steps":e.templateForm.steps.length===0}])},[u(" Empty State "),e.templateForm.steps.length===0?(i(),f("div",Ui,[l("div",Bi,[o(r,{class:"empty-icon"},{default:s(()=>[o(e.DocumentAdd)]),_:1}),t[19]||(t[19]=l("h4",null,"No Steps Added",-1)),t[20]||(t[20]=l("p",null,"Add your first step to start building the procedure",-1)),o(_,{type:"primary",onClick:t[6]||(t[6]=C=>e.handleAddStep("inspection"))},{default:s(()=>[o(r,null,{default:s(()=>[o(e.Plus)]),_:1}),t[18]||(t[18]=A(" Add First Step "))]),_:1,__:[18]})])])):(i(),f(X,{key:1},[u(" Steps List "),l("div",Mi,[o(e.VueDraggable,{modelValue:e.templateForm.steps,"onUpdate:modelValue":t[7]||(t[7]=C=>e.templateForm.steps=C),class:"steps-container","component-data":{tag:"div",type:"transition-group",name:"step-card"},"item-key":"step_id",animation:200,delay:0,disabled:!1,handle:".drag-handle","ghost-class":"step-ghost","chosen-class":"step-chosen","drag-class":"step-drag",onStart:e.handleVueDragStart,onEnd:e.handleVueDragEnd,onChange:e.handleVueDragChange},{item:s(({element:C,index:re})=>[o(e.BaseStepCard,{step:C,"step-index":re,"is-focused":e.designerState.focused_step_id===C.step_id,onFocus:e.handleStepFocus,onUpdate:e.handleStepUpdate,onDelete:e.handleStepDelete,onConfigure:e.handleStepConfigure,onDuplicate:e.handleStepDuplicate},null,8,["step","step-index","is-focused"])]),_:1},8,["modelValue"])],512)],2112))],2))]),u(" Right Panel - Floating Actions "),l("div",zi,[e.isDataLoading?(i(),f("div",ji,[o(w,{animated:""},{template:s(()=>[l("div",Wi,[o(v,{variant:"text",style:{width:"50%","margin-bottom":"16px"}}),l("div",Hi,[o(v,{variant:"button",style:{width:"60px",height:"28px"}}),o(v,{variant:"button",style:{width:"60px",height:"28px"}}),o(v,{variant:"button",style:{width:"60px",height:"28px"}})]),l("div",Ji,[(i(),f(X,null,te(6,C=>l("div",{key:C,style:{display:"flex","align-items":"center",padding:"8px 0","border-bottom":"1px solid #f0f2f5"}},[o(v,{variant:"circle",style:{width:"20px",height:"20px","margin-right":"12px"}}),o(v,{variant:"text",style:{width:"70%"}})])),64))])])]),_:1})])):e.designerState.floating_panel.visible?(i(),f(X,{key:1},[u(" Floating Panel for adding/managing steps "),o(e.FloatingPanel,{mode:e.designerState.floating_panel.mode,steps:e.stepsForPanel,"ui-hints":e.floatingPanelUiHints,interactions:e.floatingPanelInteractions,"enabled-bulk-actions":e.enabledBulkActions,onAddStep:e.handleAddStep,onToggleMode:e.toggleFloatingPanelMode,onSetMode:e.handleSetMode,onReorderSteps:e.handleReorderSteps,onBulkAction:e.handleBulkAction,onInlineRename:e.handleInlineRename},null,8,["mode","steps","ui-hints","interactions","enabled-bulk-actions"])],2112)):u("v-if",!0)])]),u(" Configuration Dialogs "),e.designerState.dialogs.number_limits.visible?(i(),U(e.NumberLimitsPanel,{key:0,visible:e.designerState.dialogs.number_limits.visible,"step-id":e.designerState.dialogs.number_limits.for_step_id,"initial-data":e.designerState.dialogs.number_limits.form_data,onSave:e.handleNumberLimitsSave,onClose:e.closeNumberLimitsDialog},null,8,["visible","step-id","initial-data"])):u("v-if",!0),e.designerState.dialogs.relevant_tools_picker.visible?(i(),U(e.ToolPickerPanel,{key:1,visible:e.designerState.dialogs.relevant_tools_picker.visible,"step-id":e.designerState.dialogs.relevant_tools_picker.for_step_id,"selected-tools":e.designerState.dialogs.relevant_tools_picker.selected_tools,onSave:e.handleToolsSave,onClose:e.closeToolsDialog},null,8,["visible","step-id","selected-tools"])):u("v-if",!0),e.designerState.dialogs.resource_uploader.visible?(i(),U(e.ResourceUploaderPanel,{key:2,visible:e.designerState.dialogs.resource_uploader.visible,"step-id":e.designerState.dialogs.resource_uploader.for_step_id,"existing-resources":((W=e.designerState.dialogs.resource_uploader.form_data)==null?void 0:W.existing_resources)||[],onSave:e.handleResourcesSave,onClose:e.closeResourcesDialog},null,8,["visible","step-id","existing-resources"])):u("v-if",!0),u(" Preview Dialog "),o(e.PreviewDialog,{visible:e.showPreviewDialog,"template-form":e.templateForm,"dialog-config":e.previewDialogConfig,"header-config":e.previewHeaderConfig,"toolbar-config":e.previewToolbarConfig,"layout-config":e.previewLayoutConfig,"content-config":e.previewContentConfig,"footer-config":e.previewFooterConfig,onOpen:e.handlePreviewOpen,onClose:e.handlePreviewClose,onPrint:e.handlePreviewPrint},null,8,["visible","template-form","dialog-config","header-config","toolbar-config","layout-config","content-config","footer-config"]),u(" Change Summary Dialog "),o(e.ChangeSummaryDialog,{visible:e.designerState.dialogs.change_summary.visible,changes:e.designerState.dialogs.change_summary.changes,loading:e.designerState.dialogs.change_summary.loading,"current-steps":e.templateForm.steps,onConfirm:e.handleChangeSummaryConfirm,onCancel:e.handleChangeSummaryCancel,onClose:e.handleChangeSummaryCancel},null,8,["visible","changes","loading","current-steps"]),u(" Unsaved Changes Dialog "),o($,{"model-value":e.showUnsavedDialog,"onUpdate:modelValue":t[9]||(t[9]=C=>e.showUnsavedDialog=C),title:"Unsaved Changes",width:"450px","before-close":e.handleUnsavedDialogClose},{footer:s(()=>[l("span",Gi,[o(_,{onClick:t[8]||(t[8]=C=>e.showUnsavedDialog=!1)},{default:s(()=>t[21]||(t[21]=[A("Cancel")])),_:1,__:[21]}),o(_,{type:"primary",onClick:e.discardChanges},{default:s(()=>t[22]||(t[22]=[A("Continue")])),_:1,__:[22]})])]),default:s(()=>[t[23]||(t[23]=l("p",null,"You have unsaved changes. What would you like to do?",-1))]),_:1,__:[23]},8,["model-value"]),u(" Tour Component "),o(F,{modelValue:e.tourOpen,"onUpdate:modelValue":t[10]||(t[10]=C=>e.tourOpen=C),type:"primary",mask:!0,onFinish:e.onTourFinish},{default:s(()=>[o(V,{target:".designer-header",title:"Designer Header",description:"This is the header of the designer with all the main actions."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button",title:"Reset",description:"This is where you can reset the entire task template to its original state."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button:nth-child(2)",title:"Preview",description:"You can preview your task on both mobile and desktop devices."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button:nth-child(3)",title:"Save Task",description:"This will save the task template you created to the system, where it can be used for work orders."}),o(V,{target:".left-panel",title:"Task Information",description:"Edit the task name, description, and other required metadata fields here."}),o(V,{target:".center-panel",title:"Procedure Designer",description:"This is your main design area. Add and arrange procedure steps here. Start by adding your first step to build the task workflow."}),o(V,{target:".right-panel",title:"+ Add Panel",description:"Click any step type card here to append a new step to your procedure."}),o(V,{target:".mode-selector .el-button-group button.el-button:nth-of-type(2)",title:"Click the Config Tab",description:"Please click the Config tab now to switch to Configuration mode."}),o(V,{target:"div.panel-content > div.reorder-steps-mode > div.steps-list-container",title:"Configuration Panel",description:"Here you can duplicate multiple steps, mark them as required/optional, delete selected steps, and drag-drop to reorder positions."})]),_:1},8,["modelValue","onFinish"])],4)}const rr=Te(di,[["render",Qi],["__scopeId","data-v-b86adab6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/views/TemplateDesignerView.vue"]]);export{rr as T};
