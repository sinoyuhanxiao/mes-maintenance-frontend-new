import"../vue/vue.Dfo81L2Q.js";import{u as Gt,a as Yt,o as Xt}from"../vue-router/vue-router.30cuaQZO.js";import{as as Da,a1 as wo,v as So,$ as dt,at as Co,P as It,a2 as To,ad as Va,a0 as ct,W as xo,E as Ia,d as Vt,O as Ye,aq as Zt,au as $t,G as Pa,H as Fa,M as Do,B as Pt,ar as eo,Y as to,a as Vo,af as Io,ab as qa,av as Ea,aw as Oa,i as Aa,j as Po,ax as Na,ay as Ra,F as La,x as Ua,az as Ba,aa as Ma,a6 as za,f as ja}from"../@element-plus/@element-plus.BNeHluFm.js";import{S as ut,A as Xe,T as pt,N as mt,C as gt,I as ft,a as oo,u as ao,f as rt,e as lo}from"../ServiceStepPreview/ServiceStepPreview.BMli3z6c.js";import{l as Ze,j as Ct,m as Tt,a as so}from"../task-library/task-library.-tD9DWhJ.js";import{a as xt}from"../task-entry/task-entry.Cwygjfo-.js";import{_ as xe,b as no,d as io,c as ro,e as co}from"../../assets/index-CE-d1vf_.js";import{r as q,am as S,c as f,o as d,O as m,a as l,R as T,S as o,L as s,K as M,Q as L,Y as Ce,F as ee,a8 as ae,E as _e,P as Ae,G as Te,_ as Ne,j,w as te,q as Be,W as uo,d as _t,t as fe,Z as po,$ as mo,a5 as go}from"../@vue/@vue.CVGyaoMH.js";import{d as fo}from"../equipment/equipment.hEuZPeX-.js";import{a as _o}from"../common/common.CFlva48m.js";import{V as Fo}from"../vuedraggable/vuedraggable.C0aEL1re.js";import{E as $,c as Oe}from"../element-plus/element-plus.CU5xiOkY.js";import{f as vo}from"../resources/resources.CSqmz1TP.js";import{d as ho}from"../lodash-es/lodash-es.BLHqGvLj.js";const yo=async(B,t)=>(await new Promise(r=>setTimeout(r,1e3)),{data:{id:`r-${Date.now()}`,name:B.name,url:`https://cdn.example.com/files/${B.name}`,mime:B.type}}),Dt="designer-tour-completed";function bo(){const B=q(!1);function t(){B.value=!0}function r(){B.value=!1}function e(){localStorage.setItem(Dt,"true"),r()}function w(){return localStorage.getItem(Dt)==="true"}function y(){localStorage.removeItem(Dt)}return{isOpen:B,start:t,close:r,onFinish:e,hasCompletedTour:w,resetTourCompletion:y}}const Wa={__name:"BaseStepCard",props:{step:{type:Object,required:!0},stepIndex:{type:Number,required:!0},isFocused:{type:Boolean,default:!1}},emits:["focus","update","delete","configure","duplicate"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=Ne({...e.step});y.type==="service"&&(y.config||(y.config={}),y.config.service_type||(y.config.service_type="Replace"),y.config.device_tag||(y.config.device_tag="P100016"),y.config.quantity||(y.config.quantity=1),y.config.status||(y.config.status="fail"));const u=q(!1),_=q(!1),E=q(!1),z=q(!1),v=j(()=>{var Y;return((Y=y.config)==null?void 0:Y.limits)&&(y.config.limits.lower!==void 0||y.config.limits.upper!==void 0)}),W=[{type:"inspection",name:"Inspection",color:"#67c23a"},{type:"checkbox",name:"Checkbox",color:"#409eff"},{type:"number",name:"Number",color:"#e6a23c"},{type:"text",name:"Text",color:"#909399"},{type:"attachments",name:"Files",color:"#849aec"},{type:"service",name:"Service",color:"#df869d",disabled:!0}];te(()=>e.step,Y=>{Object.assign(y,Y)},{deep:!0});const b=Y=>{switch(Y){case"description":u.value||y.description?(y.description="",u.value=!1,O()):u.value=!0;break;case"preview":_.value=!_.value;break;case"tools":w("configure",e.step.step_id,"tools");break;case"resources":w("configure",e.step.step_id,"resources");break;case"limitations":v.value?V():w("configure",e.step.step_id,"limits");break;case"duplicate":w("duplicate",e.step.step_id);break}},U=()=>{},g=()=>{},k=()=>{O(),y.description||(u.value=!1)},D=()=>{O()},N=()=>{O()},K=(Y,ie)=>{y.config||(y.config={}),y.config[Y]=ie,O()},H=Y=>{Object.assign(y,Y),O()},oe=Y=>{const ie={};y.config&&y.config.default&&(Y==="text"||Y==="number")&&(ie.default=y.config.default),Y==="service"?y.config={service_type:"Replace",device_tag:"P100016",quantity:1,status:"fail",...ie}:y.config=ie,O()},V=()=>{y.config&&(delete y.config.limits,Object.keys(y.config).length===0&&(y.config=void 0)),O(),$.success("Number limitations removed successfully")},O=()=>{w("update",e.step.step_id,{...y})},ce={props:e,emit:w,localStep:y,showDescriptionEdit:u,showPreview:_,isDeleteHovered:E,showToolsPreview:z,hasLimitations:v,stepTypes:W,handleAction:b,handleLabelChange:U,handleDescriptionChange:g,handleDescriptionBlur:k,handleRequiredChange:D,handleRequiredImageChange:N,updateServiceConfig:K,handleStepUpdate:H,handleTypeChange:oe,handleRemoveLimitations:V,saveChanges:O,getStepTypeLabel:Y=>({inspection:"Inspection",checkbox:"Checkbox",number:"Number",text:"Text",attachments:"Files",service:"Service"})[Y]||Y,getLimitationsText:()=>{var Y,ie;return Ze((Y=y.config)==null?void 0:Y.limits,(ie=y.config)==null?void 0:ie.unit)},getStepComponent:Y=>({inspection:ft,checkbox:gt,number:mt,text:pt,attachments:Xe,service:ut})[Y]||"div",ref:q,reactive:Ne,watch:te,computed:j,get MoreFilled(){return Ia},get Setting(){return xo},get Tools(){return ct},get Folder(){return Va},get DocumentCopy(){return To},get Delete(){return It},get Rank(){return Co},get Edit(){return dt},get View(){return So},get Upload(){return wo},get DeleteFilled(){return Da},get ElMessage(){return $},InspectionStepPreview:ft,CheckboxStepPreview:gt,NumberStepPreview:mt,TextStepPreview:pt,AttachmentStepPreview:Xe,ServiceStepPreview:ut,get formatLimitsText(){return Ze}};return Object.defineProperty(ce,"__isScriptSetup",{enumerable:!1,value:!0}),ce}},Ha=["data-step-id"],Ja={class:"step-header"},Qa={class:"step-number"},Ka={class:"step-info"},Ga={class:"step-type-badge"},Ya={class:"step-actions"},Xa={class:"step-content"},Za={class:"step-label-section"},$a={class:"type-option"},el={class:"type-option-name"},tl={key:0,class:"step-limitations-section"},ol={class:"limitations-content"},al={class:"limitations-text"},ll={key:1,class:"step-service-section"},sl={key:2,class:"step-description-section"},nl={key:3,class:"step-config-preview"},il={class:"step-preview-container"},rl={key:0,class:"preview-bottom-section"},dl={key:0,class:"preview-upload-section"},cl={key:1,class:"preview-tools-section"},ul={key:1,class:"preview-tools-list"},pl={class:"tools-list-content"},ml={class:"tool-name"},gl={class:"step-options"},fl={class:"checkbox-group"},_l={class:"step-meta"},vl={class:"drag-handle"};function hl(B,t,r,e,w,y){var D,N,K,H,oe;const u=S("el-icon"),_=S("el-button"),E=S("el-dropdown-item"),z=S("el-dropdown-menu"),v=S("el-dropdown"),W=S("el-input"),b=S("el-option"),U=S("el-select"),g=S("el-input-number"),k=S("el-checkbox");return d(),f("div",{class:Te(["base-step-card",{focused:r.isFocused,required:e.localStep.required,[`step-type-${e.localStep.type}`]:!0}]),"data-step-id":r.step.step_id,onClick:t[16]||(t[16]=V=>B.$emit("focus",r.step.step_id))},[m(" Step Header "),l("div",Ja,[l("div",Qa,T(r.stepIndex+1),1),l("div",Ka,[l("div",Ga,T(e.getStepTypeLabel(e.localStep.type)),1)]),l("div",Ya,[o(v,{trigger:"click",onCommand:e.handleAction,onClick:t[0]||(t[0]=Ce(()=>{},["stop"]))},{dropdown:s(()=>[o(z,null,{default:s(()=>[o(E,{command:"description"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Edit)]),_:1}),L(" "+T(e.showDescriptionEdit||e.localStep.description?"Remove Description":"Add Description"),1)]),_:1}),o(E,{command:"preview"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.View)]),_:1}),L(" "+T(e.showPreview?"Hide Preview":"Show Preview"),1)]),_:1}),o(E,{command:"tools"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),t[17]||(t[17]=L(" Tools "))]),_:1,__:[17]}),o(E,{command:"resources"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Folder)]),_:1}),t[18]||(t[18]=L(" Resources "))]),_:1,__:[18]}),e.localStep.type==="number"?(d(),M(E,{key:0,command:"limitations"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Setting)]),_:1}),L(" "+T(e.hasLimitations?"Remove Range":"Add Range"),1)]),_:1})):m("v-if",!0),o(E,{command:"duplicate",divided:""},{default:s(()=>[o(u,null,{default:s(()=>[o(e.DocumentCopy)]),_:1}),t[19]||(t[19]=L(" Duplicate "))]),_:1,__:[19]})]),_:1})]),default:s(()=>[o(_,{type:"text",size:"medium",class:"action-button"},{default:s(()=>[o(u,{class:"dropdown-icon"},{default:s(()=>[o(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),m(" Step Content "),l("div",Xa,[m(" Step Label "),l("div",Za,[o(W,{modelValue:e.localStep.label,"onUpdate:modelValue":t[1]||(t[1]=V=>e.localStep.label=V),placeholder:"Enter step label",onInput:e.handleLabelChange,onBlur:e.saveChanges,class:"step-label-input"},null,8,["modelValue"]),o(U,{modelValue:e.localStep.type,"onUpdate:modelValue":t[2]||(t[2]=V=>e.localStep.type=V),placeholder:"Select type",onChange:e.handleTypeChange,class:"step-type-dropdown"},{default:s(()=>[(d(),f(ee,null,ae(e.stepTypes,V=>o(b,{key:V.type,label:V.name,value:V.type,disabled:V.disabled},{default:s(()=>[l("div",$a,[l("div",{class:"type-option-color",style:_e({backgroundColor:V.color})},null,4),l("span",el,T(V.name),1)])]),_:2},1032,["label","value","disabled"])),64))]),_:1},8,["modelValue"])]),m(" Number Limitations Section (only for number type) "),e.localStep.type==="number"&&e.hasLimitations?(d(),f("div",tl,[l("div",ol,[o(u,null,{default:s(()=>[o(e.Setting)]),_:1}),l("span",al,"Range: "+T(e.getLimitationsText()),1),o(_,{type:"text",size:"default",onClick:t[3]||(t[3]=Ce(V=>e.emit("configure",e.props.step.step_id,"limits"),["stop"])),class:"edit-limitations-btn"},{default:s(()=>t[20]||(t[20]=[L(" Edit ")])),_:1,__:[20]})])])):m("v-if",!0),m(" Service Configuration Section (only for service type) "),e.localStep.type==="service"?(d(),f("div",ll,[o(U,{"model-value":((D=e.localStep.config)==null?void 0:D.service_type)||"Replace","onUpdate:modelValue":t[4]||(t[4]=V=>e.updateServiceConfig("service_type",V)),placeholder:"Service Type",class:"service-type-select"},{default:s(()=>[o(b,{label:"Replace",value:"Replace"}),o(b,{label:"Repair",value:"Repair"})]),_:1},8,["model-value"]),o(U,{"model-value":((N=e.localStep.config)==null?void 0:N.device_tag)||"P100016","onUpdate:modelValue":t[5]||(t[5]=V=>e.updateServiceConfig("device_tag",V)),placeholder:"Device Tag",class:"device-tag-select"},{default:s(()=>[o(b,{label:"P100016",value:"P100016"}),o(b,{label:"CE79950",value:"CE79950"}),o(b,{label:"P100004",value:"P100004"})]),_:1},8,["model-value"]),o(g,{"model-value":((K=e.localStep.config)==null?void 0:K.quantity)||1,"onUpdate:modelValue":t[6]||(t[6]=V=>e.updateServiceConfig("quantity",V)),min:1,max:999,step:1,precision:0,class:"quantity-input"},{suffix:s(()=>t[21]||(t[21]=[l("span",null,"Qty",-1)])),_:1},8,["model-value"])])):m("v-if",!0),m(" Step Description (only show when editing or has content) "),e.showDescriptionEdit||e.localStep.description?(d(),f("div",sl,[o(W,{modelValue:e.localStep.description,"onUpdate:modelValue":t[7]||(t[7]=V=>e.localStep.description=V),type:"textarea",rows:2,placeholder:"Add step description (optional)",onInput:e.handleDescriptionChange,onBlur:e.handleDescriptionBlur,class:"step-description-input"},null,8,["modelValue"])])):m("v-if",!0),m(" Step Configuration Preview "),e.showPreview?(d(),f("div",nl,[m(" Step Component Preview "),l("div",il,[(d(),M(Ae(e.getStepComponent(e.localStep.type)),{step:e.localStep,"preview-mode":!0,onUpdate:e.handleStepUpdate},null,40,["step"])),m(" Preview Bottom Section (show if required image is checked OR tools exist) "),e.localStep.required_image||e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(d(),f("div",rl,[m(" Upload Image Button "),e.localStep.required_image?(d(),f("div",dl,[o(_,{type:"info",size:"small",disabled:""},{default:s(()=>[t[22]||(t[22]=l("span",{class:"required-asterisk"},"*",-1)),o(u,null,{default:s(()=>[o(e.Upload)]),_:1}),t[23]||(t[23]=L(" Upload Image "))]),_:1,__:[22,23]})])):m("v-if",!0),m(" Show Tools Button "),e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(d(),f("div",cl,[o(_,{disabled:"",size:"small",plain:"",onClick:t[8]||(t[8]=V=>e.showToolsPreview=!e.showToolsPreview),class:"tools-toggle-btn"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),L(" "+T(e.showToolsPreview?"Hide Tools":"Show Tools")+" ("+T(e.localStep.relevant_tools.length)+") ",1)]),_:1})])):m("v-if",!0)])):m("v-if",!0),m(" Tools List (expandable section) "),e.showToolsPreview&&e.localStep.relevant_tools&&e.localStep.relevant_tools.length>0?(d(),f("div",ul,[t[24]||(t[24]=l("div",{class:"tools-list-header"},[l("h4",null,"Required Tools")],-1)),l("div",pl,[(d(!0),f(ee,null,ae(e.localStep.relevant_tools,V=>(d(),f("div",{key:V.tool_id||V.id,class:"tool-item"},[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",ml,T(V.name||"Unnamed Tool"),1)]))),128))])])):m("v-if",!0)])])):m("v-if",!0),m(" Step Options "),l("div",gl,[l("div",fl,[o(k,{modelValue:e.localStep.required,"onUpdate:modelValue":t[9]||(t[9]=V=>e.localStep.required=V),onChange:e.handleRequiredChange},{default:s(()=>t[25]||(t[25]=[L(" Required step ")])),_:1,__:[25]},8,["modelValue"]),o(k,{modelValue:e.localStep.required_image,"onUpdate:modelValue":t[10]||(t[10]=V=>e.localStep.required_image=V),onChange:e.handleRequiredImageChange},{default:s(()=>t[26]||(t[26]=[L(" Required image ")])),_:1,__:[26]},8,["modelValue"])]),l("div",_l,[((H=e.localStep.relevant_tools)==null?void 0:H.length)>0?(d(),M(_,{key:0,type:"info",size:"small",plain:"",onClick:t[11]||(t[11]=Ce(V=>e.handleAction("tools"),["stop"])),class:"meta-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),L(" "+T(e.localStep.relevant_tools.length)+" tool(s) ",1)]),_:1})):m("v-if",!0),((oe=e.localStep.relevant_resources)==null?void 0:oe.length)>0?(d(),M(_,{key:1,type:"warning",size:"small",plain:"",onClick:t[12]||(t[12]=Ce(V=>e.handleAction("resources"),["stop"])),class:"meta-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Folder)]),_:1}),L(" "+T(e.localStep.relevant_resources.length)+" resource(s) ",1)]),_:1})):m("v-if",!0)])])]),m(" Drag Handle "),l("div",vl,[o(u,null,{default:s(()=>[o(e.Rank)]),_:1})]),m(" Delete Button "),l("div",{class:"delete-button",onClick:t[13]||(t[13]=Ce(V=>e.emit("delete",r.step.step_id),["stop"])),onMouseenter:t[14]||(t[14]=V=>e.isDeleteHovered=!0),onMouseleave:t[15]||(t[15]=V=>e.isDeleteHovered=!1)},[e.isDeleteHovered?(d(),M(u,{key:0},{default:s(()=>[o(e.DeleteFilled)]),_:1})):(d(),M(u,{key:1},{default:s(()=>[o(e.Delete)]),_:1}))],32)],10,Ha)}const yl=xe(Wa,[["render",hl],["__scopeId","data-v-502bb329"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/StepCards/BaseStepCard.vue"]]),bl={__name:"FloatingPanel",props:{mode:{type:String,default:"add_step",validator:B=>["add_step","reorder_steps"].includes(B)},steps:{type:Array,default:()=>[]},uiHints:{type:Object,default:()=>({showCheckboxes:!0,showDragHandles:!0,showStepNumbers:!0,showTypeIcons:!0,showBulkToolbarOnSelect:!0,rowDensity:"compact"})},interactions:{type:Object,default:()=>({allowMultiSelect:!0,allowGroupDrag:!0,allowInlineRename:!0,confirmOnDelete:!0})},enabledBulkActions:{type:Array,default:()=>["duplicate","mark_required","mark_optional","delete"]}},emits:["add-step","toggle-mode","set-mode","reorder-steps","bulk-action","inline-rename"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=q(""),u=q([]),_=[{type:"inspection",name:"Inspection",description:"Pass/Fail check",icon:Vt,color:"#67c23a"},{type:"checkbox",name:"Checkbox",description:"Yes/No confirmation",icon:Ye,color:"#409eff"},{type:"number",name:"Number",description:"Numeric measurement",icon:Zt,color:"#e6a23c"},{type:"text",name:"Text",description:"Text input/notes",icon:dt,color:"#909399"},{type:"attachments",name:"Files",description:"File upload",icon:$t,color:"#849aec"},{type:"service",name:"Service",description:"Replace/Repair ops",icon:ct,color:"#df869d",disabled:!0}],E=q([]),z=j(()=>{if(!y.value)return e.steps;const x=y.value.toLowerCase();return e.steps.filter(J=>{var C,ce;return((C=J.title)==null?void 0:C.toLowerCase().includes(x))||((ce=J.type)==null?void 0:ce.toLowerCase().includes(x))})});te(z,x=>{E.value=[...x]},{immediate:!0,deep:!0}),te(()=>e.steps,x=>{},{immediate:!0,deep:!0});const v=j(()=>u.value.length===0?!1:e.steps.filter(J=>u.value.includes(J.id)).every(J=>J.required)),W=j(()=>[...E.value].sort((C,ce)=>C.id>ce.id?1:-1).map(C=>`${C.id}-${C.title}-${C.type}`).join(",")),b=x=>{w("add-step",x)},U=x=>{w("set-mode",x)},g=x=>{if(!e.interactions.allowMultiSelect){u.value=u.value.includes(x)?[]:[x];return}const J=u.value.indexOf(x);J>-1?u.value.splice(J,1):u.value.push(x)},k=x=>{},D=x=>{if(x.oldIndex!==x.newIndex){const J=E.value[x.newIndex].id;w("reorder-steps",{stepId:J,sourceIndex:x.oldIndex,targetIndex:x.newIndex})}},N=x=>{},K=x=>{u.value.length!==0&&(w("bulk-action",{action:x,stepIds:[...u.value]}),u.value=[])},H=x=>{w("inline-rename",x)},oe=x=>{const J=_.find(C=>C.type===x);return(J==null?void 0:J.color)||"#c0c4cc"},V=x=>{const J=_.find(C=>C.type===x);return(J==null?void 0:J.icon)||Ye};te(()=>e.mode,()=>{u.value=[],y.value=""});const O={props:e,emit:w,searchQuery:y,selectedStepIds:u,stepTypes:_,stepsForDrag:E,filteredSteps:z,allSelectedRequired:v,draggableKey:W,handleAddStep:b,setMode:U,toggleStepSelection:g,handleVueDragStart:k,handleVueDragEnd:D,handleVueDragChange:N,handleBulkAction:K,handleInlineRename:H,getStepTypeColor:oe,getStepTypeIcon:V,ref:q,computed:j,watch:te,get Plus(){return Pt},get Rank(){return Co},get Search(){return Do},get Edit(){return dt},get CircleCheck(){return Vt},get Document(){return Ye},get DataAnalysis(){return Zt},get Paperclip(){return $t},get DocumentCopy(){return To},get Star(){return Fa},get StarFilled(){return Pa},get Setting(){return xo},get Delete(){return It},get Tools(){return ct},get VueDraggable(){return Fo}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}},kl={class:"floating-panel"},wl={class:"panel-header"},Sl={class:"mode-selector"},Cl={class:"panel-content"},Tl={key:0,class:"add-step-mode"},xl={class:"step-types"},Dl=["onClick"],Vl={class:"step-type-info"},Il={class:"step-type-name"},Pl={class:"step-type-desc"},Fl={class:"reorder-steps-mode"},ql={class:"reorder-header"},El={class:"steps-list-container"},Ol=["onClick"],Al={key:0,class:"step-checkbox"},Nl={key:1,class:"step-number"},Rl={key:2,class:"step-type-indicator"},Ll={class:"step-content"},Ul={class:"step-title"},Bl={key:0,class:"required-asterisk"},Ml={class:"step-actions"},zl={key:1,class:"drag-handle"},jl={key:1,class:"empty-steps"},Wl={key:0,class:"bulk-actions-toolbar"},Hl={class:"bulk-actions-info"},Jl={class:"bulk-actions-buttons"};function Ql(B,t,r,e,w,y){const u=S("el-icon"),_=S("el-button"),E=S("el-button-group"),z=S("el-tooltip"),v=S("el-input"),W=S("el-checkbox"),b=S("el-empty"),U=S("el-card");return d(),f("div",kl,[o(U,{class:"panel-card"},{header:s(()=>[l("div",wl,[l("div",Sl,[o(E,null,{default:s(()=>[o(_,{type:r.mode==="add_step"?"primary":"",size:"small",onClick:t[0]||(t[0]=g=>e.setMode("add_step")),class:"mode-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Plus)]),_:1}),t[9]||(t[9]=L(" Add "))]),_:1,__:[9]},8,["type"]),o(_,{type:r.mode==="reorder_steps"?"primary":"",size:"small",onClick:t[1]||(t[1]=g=>e.setMode("reorder_steps")),class:"mode-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Setting)]),_:1}),t[10]||(t[10]=L(" Config "))]),_:1,__:[10]},8,["type"])]),_:1})])])]),default:s(()=>[l("div",Cl,[m(" Add Step Mode "),r.mode==="add_step"?(d(),f("div",Tl,[l("div",xl,[(d(),f(ee,null,ae(e.stepTypes,g=>l("div",{key:g.type,class:Te(["step-type-card",{disabled:g.disabled}]),onClick:k=>!g.disabled&&e.handleAddStep(g.type)},[g.disabled?(d(),M(z,{key:0,content:"Purchase FPS MES Pro to enable this feature",placement:"bottom"},{default:s(()=>[l("div",{class:"step-type-icon",style:_e({backgroundColor:g.color})},[o(u,null,{default:s(()=>[(d(),M(Ae(g.icon)))]),_:2},1024)],4)]),_:2},1024)):(d(),f("div",{key:1,class:"step-type-icon",style:_e({backgroundColor:g.color})},[o(u,null,{default:s(()=>[(d(),M(Ae(g.icon)))]),_:2},1024)],4)),l("div",Vl,[l("div",Il,T(g.name),1),l("div",Pl,T(g.description),1)])],10,Dl)),64))])])):(d(),f(ee,{key:1},[m(" Reorder Steps Mode "),l("div",Fl,[l("div",ql,[o(v,{modelValue:e.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=g=>e.searchQuery=g),placeholder:"Search steps...",size:"default",class:"search-input",clearable:""},{prefix:s(()=>[o(u,null,{default:s(()=>[o(e.Search)]),_:1})]),_:1},8,["modelValue"])]),l("div",El,[e.stepsForDrag.length>0?(d(),M(e.VueDraggable,{key:e.draggableKey,modelValue:e.stepsForDrag,"onUpdate:modelValue":t[4]||(t[4]=g=>e.stepsForDrag=g),class:"steps-list","component-data":{tag:"div",type:"transition-group",name:"step-item"},"item-key":"id",animation:200,delay:0,disabled:!1,handle:".drag-handle","ghost-class":"step-ghost","chosen-class":"step-chosen","drag-class":"step-drag",onStart:e.handleVueDragStart,onEnd:e.handleVueDragEnd,onChange:e.handleVueDragChange},{item:s(({element:g})=>[l("div",{class:Te(["step-item",{selected:e.selectedStepIds.includes(g.id),[`step-type-${g.type}`]:!0}]),onClick:k=>e.toggleStepSelection(g.id)},[r.uiHints.showCheckboxes?(d(),f("div",Al,[o(W,{"model-value":e.selectedStepIds.includes(g.id),onClick:t[3]||(t[3]=Ce(()=>{},["stop"])),onChange:k=>e.toggleStepSelection(g.id)},null,8,["model-value","onChange"])])):m("v-if",!0),r.uiHints.showStepNumbers?(d(),f("div",Nl,T(g.order),1)):m("v-if",!0),r.uiHints.showTypeIcons?(d(),f("div",Rl,[o(u,{style:_e({color:e.getStepTypeColor(g.type)})},{default:s(()=>[(d(),M(Ae(e.getStepTypeIcon(g.type))))]),_:2},1032,["style"])])):m("v-if",!0),l("div",Ll,[l("div",Ul,[g.required?(d(),f("span",Bl,"*")):m("v-if",!0),L(" "+T(g.title),1)])]),l("div",Ml,[r.interactions.allowInlineRename?(d(),M(_,{key:0,type:"text",size:"small",onClick:Ce(k=>e.handleInlineRename(g.id),["stop"])},{default:s(()=>[o(u,{style:{"font-size":"15px"}},{default:s(()=>[o(e.Edit)]),_:1})]),_:2},1032,["onClick"])):m("v-if",!0),r.uiHints.showDragHandles?(d(),f("div",zl,[o(u,null,{default:s(()=>[o(e.Rank)]),_:1})])):m("v-if",!0)])],10,Ol)]),_:1},8,["modelValue"])):(d(),f("div",jl,[o(b,{description:"No steps found","image-size":60})]))]),m(" Fixed Bulk Actions Toolbar "),e.selectedStepIds.length>0&&r.uiHints.showBulkToolbarOnSelect?(d(),f("div",Wl,[l("div",Hl,T(e.selectedStepIds.length)+" step(s) selected",1),l("div",Jl,[r.enabledBulkActions.includes("duplicate")?(d(),M(_,{key:0,type:"text",size:"small",onClick:t[5]||(t[5]=g=>e.handleBulkAction("duplicate"))},{default:s(()=>[o(u,null,{default:s(()=>[o(e.DocumentCopy)]),_:1}),t[11]||(t[11]=L(" Duplicate "))]),_:1,__:[11]})):m("v-if",!0),r.enabledBulkActions.includes("mark_required")&&!e.allSelectedRequired?(d(),M(_,{key:1,type:"text",size:"small",onClick:t[6]||(t[6]=g=>e.handleBulkAction("mark_required"))},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Star)]),_:1}),t[12]||(t[12]=L(" Mark Required "))]),_:1,__:[12]})):m("v-if",!0),r.enabledBulkActions.includes("mark_optional")&&e.allSelectedRequired?(d(),M(_,{key:2,type:"text",size:"small",onClick:t[7]||(t[7]=g=>e.handleBulkAction("mark_optional"))},{default:s(()=>[o(u,null,{default:s(()=>[o(e.StarFilled)]),_:1}),t[13]||(t[13]=L(" Mark Optional "))]),_:1,__:[13]})):m("v-if",!0),r.enabledBulkActions.includes("delete")?(d(),M(_,{key:3,type:"text",size:"small",onClick:t[8]||(t[8]=g=>e.handleBulkAction("delete")),class:"delete-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Delete)]),_:1}),t[14]||(t[14]=L(" Delete "))]),_:1,__:[14]})):m("v-if",!0)])])):m("v-if",!0)])],2112))])]),_:1})])}const Kl=xe(bl,[["render",Ql],["__scopeId","data-v-9ef2f2b9"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/FloatingPanel.vue"]]),Gl={__name:"NumberLimitsPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},initialData:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=q(null),u=Ne({lower:null,upper:null,inclusive:{lower:!0,upper:!0}}),_=j(()=>u.lower!==null&&u.lower!==void 0||u.upper!==null&&u.upper!==void 0),E={lower:[{validator:(b,U,g)=>{U!==null&&u.upper!==null&&U>=u.upper?g(new Error("Lower limit must be less than upper limit")):g()},trigger:"change"}],upper:[{validator:(b,U,g)=>{U!==null&&u.lower!==null&&U<=u.lower?g(new Error("Upper limit must be greater than lower limit")):g()},trigger:"change"}]};te(()=>e.initialData,b=>{var U,g;b?Object.assign(u,{lower:b.lower!==void 0?b.lower:null,upper:b.upper!==void 0?b.upper:null,inclusive:{lower:((U=b.inclusive)==null?void 0:U.lower)!==!1,upper:((g=b.inclusive)==null?void 0:g.upper)!==!1}}):Object.assign(u,{lower:null,upper:null,inclusive:{lower:!0,upper:!0}})},{immediate:!0});const W={props:e,emit:w,formRef:y,formData:u,hasLimits:_,rules:E,handleSave:async()=>{try{await y.value.validate();const b={...u,lower:u.lower,upper:u.upper,show_limits_hint:!0};w("save",e.stepId,b)}catch(b){console.error("Number limits validation failed:",b)}},getPreviewText:()=>{const b=u.lower,U=u.upper,g=u.inclusive.lower,k=u.inclusive.upper;if(b===null&&U===null)return"No limits set";let D="";return b!==null&&(D+=`${g?"≥":">"} ${b}`),U!==null&&(D&&(D+=" and "),D+=`${k?"≤":"<"} ${U}`),D},ref:q,reactive:Ne,watch:te,computed:j};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}},Yl={class:"form-section"},Xl={key:0,class:"form-section"},Zl={class:"form-section"},$l={class:"preview-section"},es={class:"preview-text"},ts={class:"dialog-footer"};function os(B,t,r,e,w,y){const u=S("el-input-number"),_=S("el-form-item"),E=S("el-col"),z=S("el-row"),v=S("el-checkbox"),W=S("el-form"),b=S("el-button"),U=S("el-dialog");return d(),M(U,{"model-value":r.visible,title:"Configure Number Limits",width:"480px","onUpdate:modelValue":t[5]||(t[5]=g=>B.$emit("close")),onClose:t[6]||(t[6]=g=>B.$emit("close"))},{footer:s(()=>[l("span",ts,[o(b,{onClick:t[4]||(t[4]=g=>B.$emit("close"))},{default:s(()=>t[10]||(t[10]=[L("Cancel")])),_:1,__:[10]}),o(b,{type:"primary",onClick:e.handleSave,loading:r.loading,disabled:!e.hasLimits},{default:s(()=>t[11]||(t[11]=[L(" Save Limits ")])),_:1,__:[11]},8,["loading","disabled"])])]),default:s(()=>[o(W,{ref:"formRef",model:e.formData,rules:e.rules,"label-position":"top"},{default:s(()=>[m(" Main Limit Values "),l("div",Yl,[o(z,{gutter:16},{default:s(()=>[o(E,{span:12},{default:s(()=>[o(_,{label:"Minimum Value",prop:"lower"},{default:s(()=>[o(u,{modelValue:e.formData.lower,"onUpdate:modelValue":t[0]||(t[0]=g=>e.formData.lower=g),precision:2,placeholder:"No minimum",style:{width:"100%"}},null,8,["modelValue"]),t[7]||(t[7]=l("div",{class:"help-text"},"Leave empty for no lower limit",-1))]),_:1,__:[7]})]),_:1}),o(E,{span:12},{default:s(()=>[o(_,{label:"Maximum Value",prop:"upper"},{default:s(()=>[o(u,{modelValue:e.formData.upper,"onUpdate:modelValue":t[1]||(t[1]=g=>e.formData.upper=g),precision:2,placeholder:"No maximum",style:{width:"100%"}},null,8,["modelValue"]),t[8]||(t[8]=l("div",{class:"help-text"},"Leave empty for no upper limit",-1))]),_:1,__:[8]})]),_:1})]),_:1})]),m(" Inclusion Options "),e.formData.lower!==null||e.formData.upper!==null?(d(),f("div",Xl,[o(z,{gutter:16},{default:s(()=>[e.formData.lower!==null?(d(),M(E,{key:0,span:12},{default:s(()=>[o(_,null,{default:s(()=>[o(v,{modelValue:e.formData.inclusive.lower,"onUpdate:modelValue":t[2]||(t[2]=g=>e.formData.inclusive.lower=g)},{default:s(()=>[L(" Allow exactly "+T(e.formData.lower),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})):m("v-if",!0),e.formData.upper!==null?(d(),M(E,{key:1,span:12},{default:s(()=>[o(_,null,{default:s(()=>[o(v,{modelValue:e.formData.inclusive.upper,"onUpdate:modelValue":t[3]||(t[3]=g=>e.formData.inclusive.upper=g)},{default:s(()=>[L(" Allow exactly "+T(e.formData.upper),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})):m("v-if",!0)]),_:1})])):m("v-if",!0),m(" Preview "),l("div",Zl,[t[9]||(t[9]=l("div",{class:"section-title"},"Preview",-1)),l("div",$l,[l("div",es,T(e.getPreviewText()),1)])])]),_:1},8,["model"])]),_:1},8,["model-value"])}const as=xe(Gl,[["render",os],["__scopeId","data-v-f52a2810"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/NumberLimitsPanel.vue"]]),ls={__name:"ToolPickerPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},selectedTools:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=q(""),u=q([]),_=q([]),E=q(new Map),z=q(!1),v=q(!1);te(()=>e.selectedTools,O=>{O.length>0&&typeof O[0]=="object"?_.value=O.map(x=>{const J=Number(x.tool_id);return E.value.set(J,{tool_id:J,name:x.name,spec:x.spec||""}),J}):_.value=O.map(x=>Number(x))},{immediate:!0});const W=j(()=>{if(!y.value)return u.value;const O=y.value.toLowerCase();return u.value.filter(x=>x.name.toLowerCase().includes(O)||x.spec&&x.spec.toLowerCase().includes(O))}),b=O=>_.value.includes(O),U=O=>{b(O.tool_id)?k(O.tool_id):(E.value.set(Number(O.tool_id),{tool_id:Number(O.tool_id),name:O.name,spec:O.spec||""}),g(O.tool_id))},g=O=>{_.value.includes(O)||_.value.push(O)},k=O=>{_.value=_.value.filter(x=>x!==O),E.value.delete(Number(O))},D=()=>{_.value=[],E.value.clear()},N=()=>_.value.map(O=>{const x=E.value.get(Number(O));if(x)return x;const J=u.value.find(C=>Number(C.tool_id)===Number(O));if(J){const C={tool_id:Number(J.tool_id),name:J.name,spec:J.spec||""};return E.value.set(C.tool_id,C),C}return{tool_id:Number(O),name:`Tool #${O}`,spec:""}}),K=()=>{z.value=!0;const O=N().map(x=>({tool_id:x.tool_id,name:x.name,spec:x.spec}));setTimeout(()=>{w("save",e.stepId,O),z.value=!1},300)},H=async()=>{var O;v.value=!0;try{const x=await vo(1,20,"name","ASC",{keyword:y.value||null}),J=((O=x==null?void 0:x.data)==null?void 0:O.content)||[];u.value=J.map(C=>({tool_id:Number(C.id),name:C.name,spec:C.code||C.tool_class&&C.tool_class.name||""})),u.value.forEach(C=>{_.value.includes(Number(C.tool_id))&&E.value.set(Number(C.tool_id),{tool_id:Number(C.tool_id),name:C.name,spec:C.spec||""})})}catch(x){console.error("Tool load failed:",x),u.value=[]}finally{v.value=!1}},oe=ho(()=>{e.visible&&H()},300);te(()=>y.value,()=>{oe()}),te(()=>e.visible,O=>{O&&u.value.length===0&&H()}),Be(()=>{e.visible&&H()});const V={props:e,emit:w,searchQuery:y,availableTools:u,localSelectedTools:_,selectedToolCache:E,saveLoading:z,loading:v,filteredTools:W,isToolSelected:b,toggleTool:U,addSelectedTool:g,removeSelectedTool:k,clearAllTools:D,getSelectedToolObjects:N,handleSave:K,loadTools:H,debouncedSearch:oe,ref:q,computed:j,onMounted:Be,watch:te,get debounce(){return ho},get Search(){return Do},get searchTools(){return vo}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},ss={class:"tools-picker"},ns={class:"search-section"},is={class:"available-section"},rs={key:0,class:"loading-container"},ds={key:1,class:"empty-tools"},cs={key:2,class:"tools-list"},us=["onClick"],ps={class:"tool-info"},ms={class:"tool-name"},gs={key:0,class:"tool-spec"},fs={class:"tool-actions"},_s={key:0,class:"selected-section"},vs={class:"selected-section-header"},hs={class:"selected-tools"},ys={key:0,class:"tool-spec"},bs={class:"dialog-footer"};function ks(B,t,r,e,w,y){const u=S("el-icon"),_=S("el-input"),E=S("el-skeleton"),z=S("el-empty"),v=S("el-checkbox"),W=S("el-button"),b=S("el-tag"),U=S("el-dialog");return d(),M(U,{"model-value":r.visible,title:"Select Tools",width:"600px","onUpdate:modelValue":t[3]||(t[3]=g=>B.$emit("close")),onClose:t[4]||(t[4]=g=>B.$emit("close")),top:"8vh"},{footer:s(()=>[l("span",bs,[o(W,{onClick:t[2]||(t[2]=g=>B.$emit("close"))},{default:s(()=>t[7]||(t[7]=[L("Cancel")])),_:1,__:[7]}),o(W,{type:"primary",onClick:e.handleSave,loading:e.saveLoading},{default:s(()=>[L(" Save Selection ("+T(e.localSelectedTools.length)+") ",1)]),_:1},8,["loading"])])]),default:s(()=>[l("div",ss,[m(" Search "),l("div",ns,[o(_,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=g=>e.searchQuery=g),placeholder:"Search tools...",clearable:""},{prefix:s(()=>[o(u,null,{default:s(()=>[o(e.Search)]),_:1})]),_:1},8,["modelValue"])]),m(" Available Tools "),l("div",is,[t[5]||(t[5]=l("h4",null,"Available Tools",-1)),e.loading?(d(),f("div",rs,[o(E,{rows:3,animated:""})])):e.filteredTools.length===0?(d(),f("div",ds,[o(z,{description:"No tools found","image-size":60})])):(d(),f("div",cs,[(d(!0),f(ee,null,ae(e.filteredTools,g=>(d(),f("div",{key:g.tool_id,class:Te(["tool-item",{selected:e.isToolSelected(g.tool_id)}]),onClick:k=>e.toggleTool(g)},[l("div",ps,[l("div",ms,T(g.name),1),g.spec?(d(),f("div",gs,T(g.spec),1)):m("v-if",!0)]),l("div",fs,[o(v,{"model-value":e.isToolSelected(g.tool_id),onClick:t[1]||(t[1]=Ce(()=>{},["stop"])),onChange:k=>e.toggleTool(g)},null,8,["model-value","onChange"])])],10,us))),128))]))]),m(" Selected Tools "),e.localSelectedTools.length>0?(d(),f("div",_s,[l("div",vs,[l("h4",null,"Selected Tools ("+T(e.localSelectedTools.length)+")",1),o(W,{type:"text",size:"small",onClick:e.clearAllTools,class:"clear-all-btn"},{default:s(()=>t[6]||(t[6]=[L(" Clear All ")])),_:1,__:[6]})]),l("div",hs,[(d(!0),f(ee,null,ae(e.getSelectedToolObjects(),g=>(d(),M(b,{key:g.tool_id,closable:"",onClose:k=>e.removeSelectedTool(g.tool_id),class:"selected-tool-tag"},{default:s(()=>[L(T(g.name)+" ",1),g.spec?(d(),f("span",ys,"- "+T(g.spec),1)):m("v-if",!0)]),_:2},1032,["onClose"]))),128))])])):m("v-if",!0)])]),_:1},8,["model-value"])}const ws=xe(ls,[["render",ks],["__scopeId","data-v-b04faa9b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/ToolPickerPanel.vue"]]),Ss={__name:"ResourceUploaderPanel",props:{visible:{type:Boolean,default:!1},stepId:{type:String,required:!0},existingResources:{type:Array,default:()=>[]},uploading:{type:Boolean,default:!1}},emits:["save","close"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=q(null),u=q([]),_=q([]);te(()=>e.existingResources,D=>{_.value=[...D]},{immediate:!0});const E=(D,N)=>{u.value.push({name:D.name,size:D.size,file:D.raw,uploading:!1,progress:0,error:null})},z=D=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/jpg","image/png","image/gif"].includes(D.type)?(D.size>26214400&&$.error("File size cannot exceed 25MB."),!1):($.error("Unsupported file type. Please upload PDF, DOC, DOCX, or image files."),!1),v=D=>{u.value.splice(D,1)},W=D=>{_.value=_.value.filter(N=>N.id!==D)},b=async()=>{try{const D=[];for(let K=0;K<u.value.length;K++){const H=u.value[K];H.uploading=!0,H.progress=0;try{const oe=setInterval(()=>{H.progress<90&&(H.progress+=10)},100),V=await yo(H.file,e.stepId);clearInterval(oe),H.progress=100,D.push(V.data)}catch(oe){H.error="Upload failed",H.uploading=!1,console.error("Upload failed:",oe)}}const N=[..._.value,...D];w("save",e.stepId,N)}catch(D){$.error("Failed to upload resources"),console.error("Upload failed:",D)}},U=D=>{var K;switch((K=D.split(".").pop())==null?void 0:K.toLowerCase()){case"pdf":case"doc":case"docx":return Ye;case"jpg":case"jpeg":case"png":case"gif":return to;default:return eo}},g=D=>{if(D===0)return"0 Bytes";const N=1024,K=["Bytes","KB","MB","GB"],H=Math.floor(Math.log(D)/Math.log(N));return parseFloat((D/Math.pow(N,H)).toFixed(2))+" "+K[H]};te(()=>e.visible,D=>{D||(u.value=[])});const k={props:e,emit:w,uploadRef:y,fileList:u,existingResources:_,handleFileChange:E,beforeUpload:z,removeFile:v,removeExistingResource:W,handleSave:b,getFileIcon:U,formatFileSize:g,ref:q,watch:te,get UploadFilled(){return Io},get Close(){return Vo},get Document(){return Ye},get Picture(){return to},get Files(){return eo},get ElMessage(){return $},get uploadResource(){return yo}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}},Cs={class:"resource-uploader"},Ts={class:"upload-section"},xs={key:0,class:"files-section"},Ds={class:"files-list"},Vs={class:"file-info"},Is={class:"file-icon"},Ps={class:"file-details"},Fs={class:"file-name"},qs={class:"file-size"},Es={key:0,class:"file-error"},Os={class:"file-actions"},As={key:0,class:"upload-progress"},Ns={key:1,class:"existing-section"},Rs={class:"existing-list"},Ls={class:"resource-info"},Us={class:"resource-icon"},Bs={class:"resource-details"},Ms={class:"resource-name"},zs={class:"resource-url"},js=["href"],Ws={key:2,class:"empty-state"},Hs={class:"dialog-footer"};function Js(B,t,r,e,w,y){const u=S("el-icon"),_=S("el-upload"),E=S("el-progress"),z=S("el-button"),v=S("el-empty"),W=S("el-dialog");return d(),M(W,{"model-value":r.visible,title:"Upload Resources",width:"600px","onUpdate:modelValue":t[1]||(t[1]=b=>B.$emit("close")),onClose:t[2]||(t[2]=b=>B.$emit("close")),top:"8vh"},{footer:s(()=>[l("span",Hs,[o(z,{onClick:t[0]||(t[0]=b=>B.$emit("close"))},{default:s(()=>t[6]||(t[6]=[L("Cancel")])),_:1,__:[6]}),o(z,{type:"primary",onClick:e.handleSave,loading:r.uploading,disabled:e.fileList.length===0&&e.existingResources.length===0},{default:s(()=>[L(T(r.uploading?"Uploading...":"Save Resources"),1)]),_:1},8,["loading","disabled"])])]),default:s(()=>[l("div",Cs,[m(" Upload Area "),l("div",Ts,[o(_,{ref:"uploadRef",class:"upload-demo",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":e.handleFileChange,"before-upload":e.beforeUpload,multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"},{tip:s(()=>t[3]||(t[3]=[l("div",{class:"el-upload__tip"},"Supported formats: PDF, DOC, DOCX, JPG, PNG, GIF (max 25MB each)",-1)])),default:s(()=>[o(u,{class:"el-icon--upload"},{default:s(()=>[o(e.UploadFilled)]),_:1}),t[4]||(t[4]=l("div",{class:"el-upload__text"},"Add images or files",-1))]),_:1,__:[4]},512)]),m(" File List "),e.fileList.length>0?(d(),f("div",xs,[l("h4",null,"Files to Upload ("+T(e.fileList.length)+")",1),l("div",Ds,[(d(!0),f(ee,null,ae(e.fileList,(b,U)=>(d(),f("div",{key:U,class:Te(["file-item",{uploading:b.uploading,error:b.error}])},[l("div",Vs,[l("div",Is,[o(u,null,{default:s(()=>[(d(),M(Ae(e.getFileIcon(b.name))))]),_:2},1024)]),l("div",Ps,[l("div",Fs,T(b.name),1),l("div",qs,T(e.formatFileSize(b.size)),1),b.error?(d(),f("div",Es,T(b.error),1)):m("v-if",!0)])]),l("div",Os,[b.uploading?(d(),f("div",As,[o(E,{percentage:b.progress||0,"stroke-width":4,status:"success"},null,8,["percentage"])])):(d(),M(z,{key:1,type:"text",size:"small",onClick:g=>e.removeFile(U),class:"remove-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Close)]),_:1})]),_:2},1032,["onClick"]))])],2))),128))])])):m("v-if",!0),m(" Existing Resources "),e.existingResources.length>0?(d(),f("div",Ns,[t[5]||(t[5]=l("h4",null,"Current Resources",-1)),l("div",Rs,[(d(!0),f(ee,null,ae(e.existingResources,b=>(d(),f("div",{key:b.id,class:"existing-item"},[l("div",Ls,[l("div",Us,[o(u,null,{default:s(()=>[(d(),M(Ae(e.getFileIcon(b.name))))]),_:2},1024)]),l("div",Bs,[l("div",Ms,T(b.name),1),l("div",zs,[l("a",{href:b.url,target:"_blank",class:"resource-link"}," View Resource ",8,js)])])]),o(z,{type:"text",size:"small",onClick:U=>e.removeExistingResource(b.id),class:"remove-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Close)]),_:1})]),_:2},1032,["onClick"])]))),128))])])):m("v-if",!0),m(" Empty State "),e.fileList.length===0&&e.existingResources.length===0?(d(),f("div",Ws,[o(v,{description:"No resources added yet","image-size":60})])):m("v-if",!0)])]),_:1},8,["model-value"])}const Qs=xe(Ss,[["render",Js],["__scopeId","data-v-f43d61e6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ConfigPanels/ResourceUploaderPanel.vue"]]),Ks={__name:"PreviewDialog",props:{visible:{type:Boolean,default:!1},templateForm:{type:Object,required:!0},dialogConfig:{type:Object,default:()=>({title:"Preview Procedure",width:"60%",fullscreen:!1,closeOnClickModal:!0,appendToBody:!0,customClass:""})},headerConfig:{type:Object,default:()=>({showSubtitle:!0,showMeta:!0,metaFields:["category","estimated_minutes","applicable_assets"]})},toolbarConfig:{type:Object,default:()=>({showStepNumbersToggle:!0,showViewportSwitcher:!0,viewportOptions:["desktop","mobile"],interactionMode:"static"})},layoutConfig:{type:Object,default:()=>({sectionCollapsible:!0,sectionsInitiallyExpanded:!0,showStepNumbers:!0,requiredMark:"*",density:"comfortable"})},contentConfig:{type:Object,default:()=>({grouping:"by_section_field",sectionTitleField:"section",unknownSectionTitle:"General",widgets:{inspection:{options:["pass","flag","fail"],buttonStyle:"pill"},checkbox:{stackDirection:"vertical"},number:{showUnits:!0,showLimits:!0,unitsField:"uom",limitsField:"limits"},text:{placeholderField:"placeholder",rows:3},files:{acceptImages:!0,acceptDocuments:!0}}})},footerConfig:{type:Object,default:()=>({showClose:!0,showPrint:!1})}},emits:["open","close","print"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=q("desktop"),u=q(!1),_=Ne({}),E=q(window.innerWidth),z=Ne({}),v=q([]),W=j(()=>y.value==="mobile"),b=j(()=>e.toolbarConfig.showStepNumbersToggle||e.toolbarConfig.showViewportSwitcher),U=j(()=>!e.templateForm||!e.templateForm.steps?{title:"",subtitle:"",sections:[]}:{title:e.templateForm.name||"Untitled Procedure",subtitle:e.templateForm.description||"",sections:[]});te(()=>e.layoutConfig.sectionsInitiallyExpanded,R=>{Object.keys(_).forEach(G=>{_[G]=R})},{immediate:!0});const g=R=>{if(e.contentConfig.grouping==="none")return[{sectionId:"default",title:e.contentConfig.unknownSectionTitle,expanded:e.layoutConfig.sectionsInitiallyExpanded,steps:R.map(me=>k(me))}];const G={},se=e.contentConfig.sectionTitleField;return R.forEach(me=>{const Ie=me[se]||e.contentConfig.unknownSectionTitle,he=Ie.toLowerCase().replace(/\s+/g,"_");G[he]||(G[he]={sectionId:he,title:Ie,expanded:_[he]??e.layoutConfig.sectionsInitiallyExpanded,steps:[]}),G[he].steps.push(k(me))}),Object.values(G).sort((me,Ie)=>me.title.localeCompare(Ie.title))},k=R=>({id:R.step_id,order:R.order,type:R.type,title:R.label||`${R.type} step`,required:R.required||!1,ui:{...R.config,description:R.description,relevant_tools:R.relevant_tools,relevant_resources:R.relevant_resources}}),D=R=>({inspection:ft,checkbox:gt,number:mt,text:pt,files:Xe,attachments:Xe,service:ut})[R]||"div",N=(R,G)=>e.layoutConfig.showStepNumbers?{...R,label:`${G+1}. ${R.label||`${oe(R.type)} step`}`}:R,K=R=>({category:"Category",estimated_minutes:"Est. Time",applicable_assets:"Assets"})[R]||R,H=R=>{if(!e.templateForm)return"";const G=e.templateForm[R];return R==="estimated_minutes"?`${G||0} min`:R==="applicable_assets"&&Array.isArray(G)?G.length>0?`${G.length} asset(s)`:"Any asset":G||""},oe=R=>({inspection:"Inspection",checkbox:"Checkbox",number:"Number",text:"Text",attachments:"Files",files:"Files",service:"Service"})[R]||R,V=R=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec",files:"#849aec",service:"#df869d"})[R]||"#c0c4cc",O=()=>{w("toggle-step-numbers")},x=R=>{e.layoutConfig.sectionCollapsible&&(_[R]=!_[R])},J=R=>{y.value=R},C=R=>{z[R]=!z[R]},ce=R=>!!z[R],Y=()=>{w("open")},ie=()=>{w("close")},De=()=>{w("print"),window.print()},Ve=()=>{E.value=window.innerWidth};Be(()=>{window.addEventListener("resize",Ve)}),uo(()=>{window.removeEventListener("resize",Ve)}),te(()=>U.value.sections,R=>{R.forEach(G=>{G.sectionId in _||(_[G.sectionId]=G.expanded)})},{immediate:!0});const Me={props:e,emit:w,currentViewport:y,isInteractive:u,sectionStates:_,windowWidth:E,stepToolsVisible:z,mobileToolsCollapsed:v,isMobileView:W,showToolbar:b,renderSnapshot:U,groupStepsIntoSections:g,transformStepForPreview:k,getStepComponent:D,getStepWithNumber:N,getMetaLabel:K,getMetaValue:H,getStepTypeLabel:oe,getStepTypeColor:V,toggleStepNumbers:O,toggleSection:x,setViewport:J,toggleStepTools:C,getStepToolsVisible:ce,handleOpen:Y,handleClose:ie,handlePrint:De,handleResize:Ve,ref:q,computed:j,watch:te,reactive:Ne,onMounted:Be,onUnmounted:uo,get Monitor(){return Oa},get Iphone(){return Ea},get Printer(){return qa},get UploadFilled(){return Io},get Upload(){return wo},get Tools(){return ct},InspectionStepPreview:ft,CheckboxStepPreview:gt,NumberStepPreview:mt,TextStepPreview:pt,AttachmentStepPreview:Xe,ServiceStepPreview:ut};return Object.defineProperty(Me,"__isScriptSetup",{enumerable:!1,value:!0}),Me}},Gs={class:"preview-content"},Ys={key:0,class:"preview-toolbar"},Xs={class:"toolbar-right"},Zs={key:0,class:"viewport-switcher"},$s={class:"preview-section"},en={class:"section-content"},tn={class:"step-config-preview"},on={key:0,class:"preview-bottom-section"},an={key:0,class:"mobile-upload-section"},ln={key:0,class:"upload-preview"},sn={key:1,class:"desktop-upload-button"},nn={key:1,class:"mobile-tools-section"},rn={class:"mobile-tools-list"},dn={class:"tool-name"},cn={key:2,class:"desktop-tools-list"},un={class:"tools-list-content"},pn={class:"tool-name"},mn={key:0,class:"empty-preview"},gn={class:"preview-footer"};function fn(B,t,r,e,w,y){const u=S("el-icon"),_=S("el-button"),E=S("el-button-group"),z=S("el-switch"),v=S("el-upload"),W=S("el-collapse-item"),b=S("el-collapse"),U=S("el-empty"),g=S("el-dialog");return d(),M(g,{top:"5vh","model-value":r.visible,title:r.dialogConfig.title,width:r.dialogConfig.width,fullscreen:r.dialogConfig.fullscreen,"close-on-click-modal":r.dialogConfig.closeOnClickModal,"append-to-body":r.dialogConfig.appendToBody,"custom-class":r.dialogConfig.customClass,"onUpdate:modelValue":e.handleClose,onOpen:e.handleOpen,onClose:e.handleClose,class:"preview-dialog"},{footer:s(()=>[l("div",gn,[r.footerConfig.showPrint?(d(),M(_,{key:0,onClick:e.handlePrint},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Printer)]),_:1}),t[11]||(t[11]=L(" Print "))]),_:1,__:[11]})):m("v-if",!0),r.footerConfig.showClose?(d(),M(_,{key:1,onClick:e.handleClose},{default:s(()=>t[12]||(t[12]=[L(" Close ")])),_:1,__:[12]})):m("v-if",!0)])]),default:s(()=>[l("div",Gs,[m(" Toolbar Section "),e.showToolbar?(d(),f("div",Ys,[t[6]||(t[6]=l("div",{class:"toolbar-left"},[m(" Reset button moved to main designer header ")],-1)),l("div",Xs,[r.toolbarConfig.showViewportSwitcher?(d(),f("div",Zs,[o(E,null,{default:s(()=>[o(_,{type:e.currentViewport==="desktop"?"primary":"",size:"default",onClick:t[0]||(t[0]=k=>e.setViewport("desktop"))},{default:s(()=>[o(u,{style:{"margin-right":"5px"}},{default:s(()=>[o(e.Monitor)]),_:1}),t[4]||(t[4]=L(" Desktop "))]),_:1,__:[4]},8,["type"]),o(_,{type:e.currentViewport==="mobile"?"primary":"",size:"default",onClick:t[1]||(t[1]=k=>e.setViewport("mobile"))},{default:s(()=>[o(u,{style:{"margin-right":"5px"}},{default:s(()=>[o(e.Iphone)]),_:1}),t[5]||(t[5]=L(" Mobile "))]),_:1,__:[5]},8,["type"])]),_:1})])):m("v-if",!0),o(z,{modelValue:e.isInteractive,"onUpdate:modelValue":t[2]||(t[2]=k=>e.isInteractive=k),size:"default","active-text":"Interactive","inactive-text":"Static",class:"interaction-toggle"},null,8,["modelValue"])])])):m("v-if",!0),m(" Main Content Area "),l("div",{class:Te(["preview-main",[`viewport-${e.currentViewport}`,`density-${r.layoutConfig.density}`,{"interactive-mode":e.isInteractive}]])},[m(" Steps (simplified to show only step-config-preview) "),l("div",$s,[l("div",en,[(d(!0),f(ee,null,ae(r.templateForm.steps,(k,D)=>{var N,K;return d(),f("div",{key:k.step_id||D,class:"preview-step-simple"},[m(" Step Config Preview with numbered title "),l("div",tn,[(d(),M(Ae(e.getStepComponent(k.type)),{step:e.getStepWithNumber(k,D),"preview-mode":!0,interactive:e.isInteractive},null,8,["step","interactive"])),m(" Preview Bottom Section (show if required image is checked OR tools exist) "),k.required_image||k.relevant_tools&&k.relevant_tools.length>0?(d(),f("div",on,[e.isMobileView?(d(),f("div",an,[k.required_image?(d(),f("div",ln,[o(v,{class:"upload-demo",drag:"",disabled:!e.isInteractive,"show-file-list":!1,"list-type":((K=(N=k.config)==null?void 0:N.upload_style)==null?void 0:K.list_type)||"picture-card"},{default:s(()=>[o(u,{class:"el-icon--upload"},{default:s(()=>[o(e.UploadFilled)]),_:1}),t[7]||(t[7]=l("div",{class:"el-upload__text"},"Add images or files",-1))]),_:2,__:[7]},1032,["disabled","list-type"])])):m("v-if",!0)])):(d(),f("div",sn,[k.required_image?(d(),M(_,{key:0,type:"info",size:"small",disabled:!e.isInteractive},{default:s(()=>[t[8]||(t[8]=l("span",{class:"required-asterisk"},"*",-1)),o(u,null,{default:s(()=>[o(e.Upload)]),_:1}),t[9]||(t[9]=L(" Upload Image "))]),_:1,__:[8,9]},8,["disabled"])):m("v-if",!0),m(" Show Tools Button (Desktop) "),k.relevant_tools&&k.relevant_tools.length>0?(d(),M(_,{key:1,disabled:!e.isInteractive,size:"small",plain:"",onClick:H=>e.toggleStepTools(k.step_id),class:"tools-toggle-btn",style:{"margin-left":"8px"}},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),L(" "+T(e.getStepToolsVisible(k.step_id)?"Hide Tools":"Show Tools")+" ("+T(k.relevant_tools.length)+") ",1)]),_:2},1032,["disabled","onClick"])):m("v-if",!0)]))])):m("v-if",!0),m(" Mobile Tools Section (Expandable/Collapsible) "),e.isMobileView&&k.relevant_tools&&k.relevant_tools.length>0?(d(),f("div",nn,[o(b,{modelValue:e.mobileToolsCollapsed,"onUpdate:modelValue":t[3]||(t[3]=H=>e.mobileToolsCollapsed=H),disabled:!e.isInteractive},{default:s(()=>[o(W,{title:`Tools Required (${k.relevant_tools.length})`,name:k.step_id,disabled:!e.isInteractive},{default:s(()=>[l("div",rn,[(d(!0),f(ee,null,ae(k.relevant_tools,H=>(d(),f("div",{key:H.tool_id||H.id,class:"mobile-tool-item"},[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",dn,T(H.name||"Unnamed Tool"),1)]))),128))])]),_:2},1032,["title","name","disabled"])]),_:2},1032,["modelValue","disabled"])])):m("v-if",!0),m(" Desktop Tools List (toggleable) "),!e.isMobileView&&e.getStepToolsVisible(k.step_id)&&k.relevant_tools&&k.relevant_tools.length>0?(d(),f("div",cn,[t[10]||(t[10]=l("div",{class:"tools-list-header"},[l("h4",null,"Required Tools")],-1)),l("div",un,[(d(!0),f(ee,null,ae(k.relevant_tools,H=>(d(),f("div",{key:H.tool_id||H.id,class:"tool-item"},[o(u,null,{default:s(()=>[o(e.Tools)]),_:1}),l("span",pn,T(H.name||"Unnamed Tool"),1)]))),128))])])):m("v-if",!0)])])}),128))])]),m(" Empty State "),!r.templateForm.steps||r.templateForm.steps.length===0?(d(),f("div",mn,[o(U,{description:"No steps to preview","image-size":80})])):m("v-if",!0)],2)])]),_:1},8,["model-value","title","width","fullscreen","close-on-click-modal","append-to-body","custom-class"])}const _n=xe(Ks,[["render",fn],["__scopeId","data-v-3641912d"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/PreviewDialog.vue"]]),vn=_t({name:"ChangeSummaryDialog"}),hn=Object.assign(vn,{props:{visible:{type:Boolean,default:!1},changes:{type:Object,default:()=>({metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]})},loading:{type:Boolean,default:!1},currentSteps:{type:Array,default:()=>[]}},emits:["confirm","cancel","close"],setup(B,{expose:t,emit:r}){t();const e=B,w=r,y=j(()=>e.changes.metadata.length>0||e.changes.steps_added.length>0||e.changes.steps_modified.length>0||e.changes.steps_deleted.length>0||e.changes.steps_reordered.length>0),u=k=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec",service:"#df869d"})[k]||"#c0c4cc",g={props:e,emit:w,hasAnyChanges:y,getStepTypeColor:u,getStepNumberStyle:k=>{const D=u(k);return{backgroundColor:"white",color:D,border:`2px solid ${D}`}},getStepPosition:k=>{const D=e.currentSteps.findIndex(N=>N.step_id===k);return D!==-1?D+1:"?"},getStepType:k=>{const D=e.currentSteps.find(N=>N.step_id===k);return(D==null?void 0:D.type)||"text"},capitalizeFirst:k=>k.charAt(0).toUpperCase()+k.slice(1),handleClose:k=>{e.loading||(typeof k=="function"&&k(),w("close"))},handleConfirm:()=>{w("confirm")},handleCancel:()=>{w("cancel")},__MACROS_defineComponent:_t,computed:j,get Edit(){return dt},get Plus(){return Pt},get Delete(){return It},get Sort(){return Ra},get Right(){return Na},get Check(){return Po},get Close(){return Vo},get InfoFilled(){return Aa}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),yn={class:"dialog-content"},bn={key:0,class:"no-changes"},kn={class:"changes-summary"},wn={key:0,class:"change-section"},Sn={class:"section-header"},Cn={class:"changes-list"},Tn={class:"change-label"},xn={class:"change-values"},Dn={class:"original-value"},Vn={class:"value"},In={class:"current-value"},Pn={class:"value"},Fn={key:1,class:"change-section"},qn={class:"section-header"},En={class:"changes-list"},On={class:"step-info"},An={class:"step-details"},Nn={class:"step-name"},Rn={class:"step-meta"},Ln={key:2,class:"change-section"},Un={class:"section-header"},Bn={class:"changes-list"},Mn={class:"step-info"},zn={class:"step-details"},jn={class:"step-name"},Wn={class:"step-changes"},Hn={class:"change-field"},Jn={class:"change-from"},Qn={class:"change-to"},Kn={key:3,class:"change-section"},Gn={class:"section-header"},Yn={class:"changes-list"},Xn={class:"step-info"},Zn={class:"step-details"},$n={class:"step-name deleted"},ei={class:"step-meta"},ti={key:4,class:"change-section"},oi={class:"section-header"},ai={class:"changes-list"},li={class:"step-info"},si={class:"step-details"},ni={class:"step-name"},ii={class:"step-position-change"},ri={class:"dialog-footer"};function di(B,t,r,e,w,y){const u=S("el-icon"),_=S("el-tag"),E=S("el-button"),z=S("el-dialog");return d(),M(z,{"model-value":r.visible,"onUpdate:modelValue":t[0]||(t[0]=v=>B.$emit("close")),title:"Confirm Changes",width:"40%","before-close":e.handleClose,class:"change-summary-dialog"},{footer:s(()=>[l("div",ri,[o(E,{onClick:e.handleCancel,disabled:r.loading},{default:s(()=>t[11]||(t[11]=[L(" Cancel ")])),_:1,__:[11]},8,["disabled"]),e.hasAnyChanges?(d(),M(E,{key:0,type:"primary",onClick:e.handleConfirm,loading:r.loading},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Check)]),_:1}),t[12]||(t[12]=L(" Save Changes "))]),_:1,__:[12]},8,["loading"])):m("v-if",!0)])]),default:s(()=>[l("div",yn,[m(" No Changes State "),e.hasAnyChanges?(d(),f(ee,{key:1},[m(" Changes Summary "),l("div",kn,[t[10]||(t[10]=l("div",{class:"summary-header"},[l("p",{style:{"font-size":"15px"}},"Review the following modifications before saving:")],-1)),m(" Metadata Changes "),r.changes.metadata.length>0?(d(),f("div",wn,[l("div",Sn,[o(u,{class:"section-icon"},{default:s(()=>[o(e.Edit)]),_:1}),t[3]||(t[3]=l("h4",null,"Template Information",-1)),o(_,{size:"default",type:"warning",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[L(T(r.changes.metadata.length)+" change(s)",1)]),_:1})]),l("div",Cn,[(d(!0),f(ee,null,ae(r.changes.metadata,v=>(d(),f("div",{key:v.field,class:"change-item metadata-change"},[l("div",Tn,T(v.label),1),l("div",xn,[l("div",Dn,[t[4]||(t[4]=l("span",{class:"value-label"},"From:",-1)),l("span",Vn,T(v.original),1)]),o(u,{class:"arrow-icon"},{default:s(()=>[o(e.Right)]),_:1}),l("div",In,[t[5]||(t[5]=l("span",{class:"value-label"},"To:",-1)),l("span",Pn,T(v.current),1)])])]))),128))])])):m("v-if",!0),m(" Steps Added "),r.changes.steps_added.length>0?(d(),f("div",Fn,[l("div",qn,[o(u,{class:"section-icon"},{default:s(()=>[o(e.Plus)]),_:1}),t[6]||(t[6]=l("h4",null,"Steps Added",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[L(T(r.changes.steps_added.length)+" step(s)",1)]),_:1})]),l("div",En,[(d(!0),f(ee,null,ae(r.changes.steps_added,v=>(d(),f("div",{key:v.step_id,class:"change-item step-added"},[l("div",On,[l("div",{class:"step-number",style:_e(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",An,[l("div",Nn,T(v.label),1),l("div",Rn,T(e.capitalizeFirst(v.type))+" step • Position "+T(v.position),1)])])]))),128))])])):m("v-if",!0),m(" Steps Modified "),r.changes.steps_modified.length>0?(d(),f("div",Ln,[l("div",Un,[o(u,{class:"section-icon"},{default:s(()=>[o(e.Edit)]),_:1}),t[7]||(t[7]=l("h4",null,"Steps Modified",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[L(T(r.changes.steps_modified.length)+" step(s)",1)]),_:1})]),l("div",Bn,[(d(!0),f(ee,null,ae(r.changes.steps_modified,v=>(d(),f("div",{key:v.step_id,class:"change-item step-modified"},[l("div",Mn,[l("div",{class:"step-number",style:_e(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",zn,[l("div",jn,T(v.label),1),l("div",Wn,[(d(!0),f(ee,null,ae(v.changes,W=>(d(),f("div",{key:W.field,class:"step-change-detail"},[l("span",Hn,T(W.label)+":",1),l("span",Jn,T(W.original),1),o(u,{class:"arrow-mini"},{default:s(()=>[o(e.Right)]),_:1}),l("span",Qn,T(W.current),1)]))),128))])])])]))),128))])])):m("v-if",!0),m(" Steps Deleted "),r.changes.steps_deleted.length>0?(d(),f("div",Kn,[l("div",Gn,[o(u,{class:"section-icon"},{default:s(()=>[o(e.Delete)]),_:1}),t[8]||(t[8]=l("h4",null,"Steps Deleted",-1)),o(_,{size:"default",type:"danger",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[L(T(r.changes.steps_deleted.length)+" step(s)",1)]),_:1})]),l("div",Yn,[(d(!0),f(ee,null,ae(r.changes.steps_deleted,v=>(d(),f("div",{key:v.step_id,class:"change-item step-deleted"},[l("div",Xn,[l("div",{class:"step-number deleted",style:_e(e.getStepNumberStyle(v.type))},T(e.getStepPosition(v.step_id)),5),l("div",Zn,[l("div",$n,T(v.label),1),l("div",ei,T(e.capitalizeFirst(v.type))+" step • Was at position "+T(v.position),1)])])]))),128))])])):m("v-if",!0),m(" Steps Reordered "),r.changes.steps_reordered.length>0?(d(),f("div",ti,[l("div",oi,[o(u,{class:"section-icon"},{default:s(()=>[o(e.Sort)]),_:1}),t[9]||(t[9]=l("h4",null,"Steps Reordered",-1)),o(_,{size:"default",effect:"plain",style:{"font-size":"14px"}},{default:s(()=>[L(T(r.changes.steps_reordered.length)+" step(s)",1)]),_:1})]),l("div",ai,[(d(!0),f(ee,null,ae(r.changes.steps_reordered,v=>(d(),f("div",{key:v.step_id,class:"change-item step-reordered"},[l("div",li,[l("div",{class:"step-number",style:_e(e.getStepNumberStyle(e.getStepType(v.step_id)))},T(e.getStepPosition(v.step_id)),5),l("div",si,[l("div",ni,T(v.label),1),l("div",ii,[l("span",null,"Position "+T(v.original_position),1),o(u,{class:"arrow-mini"},{default:s(()=>[o(e.Right)]),_:1}),l("span",null,"Position "+T(v.new_position),1)])])])]))),128))])])):m("v-if",!0)])],2112)):(d(),f("div",bn,[o(u,{class:"no-changes-icon"},{default:s(()=>[o(e.InfoFilled)]),_:1}),t[1]||(t[1]=l("h3",null,"No Changes Detected",-1)),t[2]||(t[2]=l("p",null,"No modifications were made to this task template.",-1))]))])]),_:1},8,["model-value"])}const ci=xe(hn,[["render",di],["__scopeId","data-v-17754755"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Designer/ChangeSummaryDialog.vue"]]);function ko(){const B=j(()=>({title:"Preview Procedure",width:"70%",fullscreen:!1,closeOnClickModal:!0,appendToBody:!0,customClass:"template-preview-dialog"})),t=j(()=>({showSubtitle:!0,showMeta:!0,metaFields:["category","estimated_minutes","applicable_assets"]})),r=j(()=>({showStepNumbersToggle:!0,showViewportSwitcher:!0,viewportOptions:["desktop","mobile"],interactionMode:"static"})),e=j(()=>({sectionCollapsible:!0,sectionsInitiallyExpanded:!0,showStepNumbers:!0,requiredMark:"*",density:"comfortable"})),w=j(()=>({grouping:"by_section_field",sectionTitleField:"section",unknownSectionTitle:"General",widgets:{inspection:{options:["pass","flag","fail"],buttonStyle:"pill"},checkbox:{stackDirection:"vertical"},number:{showUnits:!0,showLimits:!0,unitsField:"unit",limitsField:"limits"},text:{placeholderField:"placeholder",rows:3},files:{acceptImages:!0,acceptDocuments:!0}}})),y=j(()=>({showClose:!0,showPrint:!1}));return{previewDialogConfig:B,previewHeaderConfig:t,previewToolbarConfig:r,previewLayoutConfig:e,previewContentConfig:w,previewFooterConfig:y}}const ui=_t({name:"TemplateDesignerView"}),pi=Object.assign(ui,{setup(B,{expose:t}){t();const r=Gt(),e=Yt(),w=oo(),y=j(()=>r.query.fromWorkOrder==="true"),u=j(()=>(typeof r.query.returnRoute=="string"?r.query.returnRoute:null)||w.returnRoute||"/work-order/table"),_=j(()=>(typeof r.query.returnPanel=="string"?r.query.returnPanel:null)||w.returnPanel||null),E=j(()=>{const a=typeof r.query.returnWorkOrderId=="string"?r.query.returnWorkOrderId:null;return a||(w.returnWorkOrderId!=null?String(w.returnWorkOrderId):null)}),z=q(typeof r.query.taskId=="string"?r.query.taskId:null),{loadTemplates:v,createTemplate:W,updateTemplate:b,validateTemplate:U}=ao(),{isOpen:g,start:k,onFinish:D}=bo(),N=q({focused_step_id:null,dragging:{is_dragging:!1,source_step_id:null,target_step_id:null},floating_panel:{visible:!0,mode:"add_step"},dialogs:{number_limits:{visible:!1,for_step_id:null,loading:!1,form_data:{}},relevant_tools_picker:{visible:!1,for_step_id:null,selected_tools:[],loading:!1},resource_uploader:{visible:!1,for_step_id:null,upload_progress:0,uploading:!1,form_data:{}},change_summary:{visible:!1,loading:!1,changes:{metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]}}}}),K=a=>{N.value.focused_step_id=a},H=()=>{const a=N.value.floating_panel.mode;N.value.floating_panel.mode=a==="add_step"?"reorder_steps":"add_step"},oe=a=>{N.value.floating_panel.mode=a},V=a=>{if(!We.value){console.warn("stepsListRef not available for scrolling");return}const n=We.value.querySelector(`[data-step-id="${a}"]`);n?n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):(console.warn(`Step card with ID ${a} not found, scrolling to bottom`),We.value.scrollTo({top:We.value.scrollHeight,behavior:"smooth"}))},O=(a,n={})=>{N.value.dialogs.number_limits={visible:!0,for_step_id:a,loading:!1,form_data:n}},x=()=>{N.value.dialogs.number_limits.visible=!1},J=(a,n=[])=>{N.value.dialogs.relevant_tools_picker={visible:!0,for_step_id:a,selected_tools:n,loading:!1}},C=()=>{N.value.dialogs.relevant_tools_picker.visible=!1},ce=(a,n={})=>{N.value.dialogs.resource_uploader={visible:!0,for_step_id:a,upload_progress:0,uploading:!1,form_data:n}},Y=()=>{N.value.dialogs.resource_uploader.visible=!1},ie=a=>{N.value.dialogs.change_summary={visible:!0,loading:!1,changes:a}},De=()=>{N.value.dialogs.change_summary.visible=!1},Ve=a=>{N.value.dialogs.change_summary.loading=a},Me=(a,n)=>{Oe({title:"Save Confirmation",message:`Do you want to save this edit locally only for Work Order ${n||a||"Work Order"} or do you want to alter the template?`,showCancelButton:!0,showConfirmButton:!0,cancelButtonText:"Save Locally (Work Order Only)",confirmButtonText:"Alter Template",type:"question",distinguishCancelAndClose:!0,customClass:"work-order-save-confirmation"}).then(()=>Ue({mode:"template",fromWorkOrderContext:!0})).catch(async p=>{if(p==="cancel"){const c=Array.isArray(ge.value)?ge.value.find(A=>A.value===h.value.category):null,I=rt(h.value,c);w.appendTask(I),await Le("Task added to the work order.")}})},R=()=>{N.value={focused_step_id:null,dragging:{is_dragging:!1,source_step_id:null,target_step_id:null},floating_panel:{visible:!0,mode:"add_step"},dialogs:{number_limits:{visible:!1,for_step_id:null,loading:!1,form_data:{}},relevant_tools_picker:{visible:!1,for_step_id:null,selected_tools:[],loading:!1},resource_uploader:{visible:!1,for_step_id:null,upload_progress:0,uploading:!1,form_data:{}},change_summary:{visible:!1,loading:!1,changes:{metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]}}}}},G=no(),se=io(),me=ro(),{saveState:Ie,saveStateByKey:he,restoreState:Ft,restoreStateByKey:$e,restoreStateByTemplateId:qt,hasCachedState:Et,hasCachedStateByKey:Ot,clearState:At,clearStateByKey:Pe,getCacheStats:Nt}=co(),ze=q({path:r.path,params:{...r.params||{}}}),re=q(null),je=q(null),We=q(null),we=()=>({path:ze.value.path,params:{...ze.value.params||{}}}),vt=()=>Et(we()),Rt=()=>Ft(we()),qo=a=>Ie(we(),a),Eo=()=>At(we()),He=q(!1),h=q({name:"",description:"",category:"",estimated_minutes:30,applicable_assets:null,steps:[]}),ue=q(null),ne=q(null),le=q(!1),Je=q(!1),Re=q(!1),Se=q(null),et=q(null),Oo=q(!1),tt=q([]),Lt=q([]),ge=q([]),ot=q(!1),at=q(!1),ht=q(50),lt=q(34),Ao=j(()=>{const a=ht.value+lt.value;return`calc(100vh - ${a>0?a:84}px)`}),yt=q(!1),Fe=j(()=>!!r.params.id&&r.params.id!=="standalone"),qe=j(()=>r.params.id==="standalone"&&r.query.standalone==="true"),Ut=j(()=>U(h.value)),st=q(!1),de=q(!1),No=j(()=>st.value||ot.value||at.value||!de.value),Ro=j(()=>({inspection:"Perfect for equipment condition verification with pass/fail outcomes, commonly used in safety checks and quality control procedures.",checkbox:"Ideal for simple yes/no confirmations, compliance checklists, and ensuring critical steps are acknowledged before proceeding.",number:"Essential for recording measurements, sensor readings, and quantitative data with optional unit specifications and validation limits.",text:"Best for capturing detailed observations, technician notes, and contextual information that structured data cannot represent.",attachments:"Critical for visual documentation, before/after photos, and creating comprehensive maintenance records for compliance and audit trails.",service:"Designed for maintenance operations requiring specific device tag identification and service type specification, supporting Replace and Repair workflows with quantity tracking."})),Lo=j(()=>({inspection:"#67c23a",checkbox:"#409eff",number:"#e6a23c",text:"#909399",attachments:"#849aec"})),Uo=j(()=>{if(!N.value.focused_step_id)return null;const a=h.value.steps.find(n=>n.step_id===N.value.focused_step_id);return(a==null?void 0:a.type)||null}),Bo=j(()=>ge.value.sort((a,n)=>a.label.localeCompare(n.label))),nt=q(!0),ye=async()=>{if(je.value)try{await je.value.validate(),nt.value=!0}catch{nt.value=!1}};te([()=>h.value.name,()=>h.value.category,()=>h.value.estimated_minutes],()=>{fe(()=>{ye()})},{immediate:!1});const Mo=j(()=>{const a=h.value.name&&typeof h.value.name=="string"&&h.value.name.trim().length>0,n=h.value.category;let i=!1;if(typeof n=="number")i=n>0;else if(typeof n=="string")i=n.trim().length>0;else if(n&&typeof n=="object"){const A=n.id??n.value??null,Q=n.name??n.label??"";i=!!(A&&A>0||Q&&Q.trim().length>0)}const p=h.value.estimated_minutes>0,c=Ut.value.length===0,I=je.value?nt.value:!0;return a&&i&&p&&c&&I});te(()=>de.value,a=>{a&&fe(()=>ye())});const zo=j(()=>h.value.steps.map(n=>({id:n.step_id,order:n.order,type:n.type,title:n.label||`Untitled ${n.type} step`,required:n.required||!1}))),jo=j(()=>({showCheckboxes:!0,showDragHandles:!0,showStepNumbers:!0,showTypeIcons:!0,showBulkToolbarOnSelect:!0,rowDensity:"compact"})),Wo=j(()=>({allowMultiSelect:!0,allowGroupDrag:!0,allowInlineRename:!0,confirmOnDelete:!0})),Ho=j(()=>["duplicate","mark_required","mark_optional","delete"]),{previewDialogConfig:Jo,previewHeaderConfig:Qo,previewToolbarConfig:Ko,previewLayoutConfig:Go,previewContentConfig:Yo,previewFooterConfig:Xo}=ko(),Zo={name:[{required:!0,message:"Task name is required",trigger:"blur"},{min:3,max:200,message:"Name should be 3-200 characters",trigger:"blur"}],category:[{required:!0,message:"Category is required",trigger:"change"}],estimated_minutes:[{required:!0,message:"Estimated time is required",trigger:"change"},{type:"number",min:1,message:"Time must be at least 1 minute",trigger:"change"}]},$o=()=>{const a=()=>{et.value&&!G.sidebar.opened&&G.TOGGLE_SIDEBAR(),e.push({name:"TaskLibrary"})};le.value?(Se.value=a,Re.value=!0):a()},Le=async(a,n={})=>{const i=u.value||"/work-order/table",p=_.value,c=E.value,I=new URL(i,window.location.origin);let A=I.pathname||"/work-order/table";A==="/"&&I.hash&&I.hash.startsWith("#/")&&(A=I.hash.slice(1));const P={...Object.fromEntries(I.searchParams.entries()),...n},F=p==="edit"&&c,Z=p==="create"||!p&&w.shouldOpenCreatePanel;F&&!w.isEditMode?(console.warn("Context mismatch: Navigation indicates edit mode but draft store is not in edit mode"),w.setContext("edit")):Z&&!w.isCreateMode&&(console.warn("Context mismatch: Navigation indicates create mode but draft store is not in create mode"),w.setCreateMode());const X=Z;X?(P.panel="create","showCreate"in P||(P.showCreate="1")):F&&(P.panel="edit",c&&(P.workOrderId=c)),w.setShouldOpenCreatePanel(X),a&&$.success(a),se.tagsView&&await me.DEL_VIEW(r),await e.push({path:A,query:P})},Bt=async()=>{try{await Oe.confirm("Do you want to save this as a template or only for this work order?","Save Task",{confirmButtonText:"Save as Template",cancelButtonText:"Save Only for Work Order",distinguishCancelAndClose:!0,type:"info"}),await Ue({mode:"template",fromWorkOrderContext:!0})}catch(a){a==="cancel"&&await Ue({mode:"adhoc",fromWorkOrderContext:!0})}},ea=async()=>{try{if(await je.value.validate(),qe.value&&ue.value){const a={categories:ge.value,equipmentTree:tt.value},n=wt(ue.value,h.value,a);ie(n)}else if(Fe.value&&ue.value){const a={categories:ge.value,equipmentTree:tt.value},n=wt(ue.value,h.value,a);ie(n)}else y.value?await Bt():await Ue({mode:"template",fromWorkOrderContext:!1})}catch(a){console.error("Validation error:",a),a.fields?$.error("Please fix validation errors before saving"):$.error("Please check your data and try again")}},Ue=async({mode:a="template",fromWorkOrderContext:n=!1}={})=>{var i,p;try{if(Je.value=!0,Fe.value){const c=r.params.id;if(!c)throw new Error("Template ID is required for editing");const I=await b(c,h.value);if(le.value=!1,Pe(re.value),ue.value=JSON.parse(JSON.stringify(h.value)),n){const A=_.value,Q=E.value,P=A==="edit"&&Q,F=A==="create";P&&!w.isEditMode?(console.warn("Template update: Setting edit mode context for consistency"),w.setContext("edit")):F&&!w.isCreateMode&&(console.warn("Template update: Setting create mode context for consistency"),w.setCreateMode()),w.updateTasksWithTemplate(I),w.setShouldOpenCreatePanel(F),await Le("Task updated successfully");return}if(se.tagsView){const{visitedViews:A}=await me.DEL_VIEW(r);await v();const Q=A.slice(-1)[0];Q?e.push(Q.fullPath):e.push({name:"TaskLibrary"})}else e.push({name:"TaskLibrary",query:{focusTemplate:c,refresh:!0}})}else if(a==="template"){const c=await W(h.value);if(le.value=!1,Pe(re.value),n){w.appendTask(lo(c)),await Le("Template saved and added to the work order.");return}const I=c.id||c.template_id;se.tagsView?(await me.DEL_VIEW(r),await v(),e.push({name:"TaskLibrary",query:{focusTemplate:I,refresh:!0}})):e.push({name:"TaskLibrary",query:{focusTemplate:I,refresh:!0}})}else if(a==="adhoc"){const c=Array.isArray(ge.value)?ge.value.find(A=>A.value===h.value.category):null,I=rt(h.value,c);w.appendTask(I),le.value=!1,Pe(re.value),await Le("Task added to the work order.")}}catch(c){console.error("Save error:",c),c.fields?$.error("Please fix validation errors before saving"):(p=(i=c.response)==null?void 0:i.data)!=null&&p.message?$.error(`Save failed: ${c.response.data.message}`):c.message?$.error(`Save failed: ${c.message}`):$.error("Failed to save task. Please check your data and try again.")}finally{Je.value=!1}},Mt=async()=>{try{Je.value=!0;const a=z.value||r.query.taskId||r.params.id;if(!a)throw new Error("Original task ID not found");const n=Array.isArray(ge.value)?ge.value.find(I=>I.value===h.value.category):null,i=rt(h.value,n),p=String(a),c={id:p,name:i.name,description:i.description,category:i.category,category_name:i.category_name,estimated_minutes:i.estimated_minutes,steps:i.steps,source:"adhoc",payload:i.payload};c.task_id||(c.task_id=p),c.payload&&typeof c.payload=="object"&&(c.payload.id=p,c.payload.task_id=p),w.updateTask(p,c),le.value=!1,Pe(re.value),await Le("Standalone task updated successfully.",{taskData:JSON.stringify(c),taskId:p})}catch(a){console.error("Standalone save error:",a),a.message?$.error(`Update failed: ${a.message}`):$.error("Failed to update standalone task. Please try again.")}finally{Je.value=!1}},ta=()=>{yt.value=!0},oa=async()=>{try{if(await Oe.confirm("Are you sure you want to reset all changes? This action cannot be undone.","Reset Confirmation",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}),qe.value||Fe.value)if(ue.value){const a=JSON.parse(JSON.stringify(ue.value));h.value.name=a.name||"",h.value.description=a.description||"",h.value.category=a.category||"",h.value.estimated_minutes=a.estimated_minutes||30,h.value.applicable_assets=a.applicable_assets||null,h.value.steps=a.steps||[],R(),le.value=!1;const n=qe.value?"Standalone task restored to original state":"Template restored to original state";$.success(n),Pe(re.value)}else $.error("No original task data available");else h.value.name="",h.value.description="",h.value.category="",h.value.estimated_minutes=30,h.value.applicable_assets=null,h.value.steps=[],R(),le.value=!1,$.success("All inputs cleared"),Pe(re.value)}catch(a){a!=="cancel"&&($.error("Reset operation failed"),console.error("Reset error:",a))}},be=()=>{le.value=!0},aa=a=>{K(a)},la=async()=>{try{await Oe.confirm("This will remove all procedure steps. This action cannot be undone.","Clear All Steps",{confirmButtonText:"Continue",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--primary"}),h.value.steps=[],be(),$.success("All steps have been cleared")}catch{}},sa=a=>{const n={step_id:`step-${Date.now()}`,order:h.value.steps.length+1,type:a,label:`New ${a} step`,description:"",required:!1,required_image:!1,relevant_resources:[],relevant_tools:[],config:Tt(a)};h.value.steps.push(n),be(),K(n.step_id),fe(()=>{setTimeout(()=>{V(n.step_id)},100)})},it=(a,n)=>{const i=h.value.steps.findIndex(p=>p.step_id===a);i!==-1&&(Object.assign(h.value.steps[i],n),n.type&&(h.value.steps=[...h.value.steps]),be())},na=async a=>{try{await Oe.confirm("Are you sure you want to delete this step?","Delete Step",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),h.value.steps=h.value.steps.filter(n=>n.step_id!==a),h.value.steps.forEach((n,i)=>{n.order=i+1}),be(),N.value.focused_step_id===a&&K(null)}catch{}},ia=a=>{const n=h.value.steps.findIndex(c=>c.step_id===a);if(n===-1)return;const i=h.value.steps[n],p={...i,step_id:`step-${Date.now()}`,label:`${i.label} (Copy)`,config:i.config?JSON.parse(JSON.stringify(i.config)):{},relevant_tools:i.relevant_tools?[...i.relevant_tools]:[],relevant_resources:i.relevant_resources?[...i.relevant_resources]:[]};h.value.steps.splice(n+1,0,p),h.value.steps.forEach((c,I)=>{c.order=I+1}),be(),K(p.step_id),fe(()=>{setTimeout(()=>{V(p.step_id)},100)})},ra=(a,n)=>{const i=h.value.steps.find(p=>p.step_id===a);if(i)switch(n){case"limits":O(a,i.config.limits||{});break;case"tools":const p=Array.isArray(i.relevant_tools)&&i.relevant_tools.length>0&&typeof i.relevant_tools[0]=="object"?i.relevant_tools.map(c=>c.tool_id):i.relevant_tools||[];J(a,p);break;case"resources":ce(a,i.relevant_resources||[]);break}},da=a=>{},ca=a=>{bt(),be()},ua=a=>{bt()},bt=()=>{h.value.steps.forEach((a,n)=>{a.order=n+1})},pa=({stepId:a,sourceIndex:n,targetIndex:i})=>{if(n===i)return;const p=[...h.value.steps],c=p[n];p.splice(n,1),p.splice(i,0,c),p.forEach((I,A)=>{I.order=A+1}),h.value.steps=p,be()},ma=async({action:a,stepIds:n})=>{const i=n.map(p=>h.value.steps.findIndex(c=>c.step_id===p)).filter(p=>p!==-1);switch(a){case"duplicate":const p=i.map(c=>{const I=h.value.steps[c];return{...I,step_id:`step-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,label:`${I.label} (Copy)`,order:h.value.steps.length+1}});h.value.steps.push(...p);break;case"mark_required":i.forEach(c=>{h.value.steps[c].required=!0});break;case"mark_optional":i.forEach(c=>{h.value.steps[c].required=!1});break;case"delete":try{await Oe.confirm(`Are you sure you want to delete ${n.length} step(s)? This action cannot be undone.`,"Delete Steps",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),i.sort((I,A)=>A-I).forEach(I=>{h.value.steps.splice(I,1)})}catch{return}break}h.value.steps.forEach((p,c)=>{p.order=c+1}),be()},ga=a=>{K(a),setTimeout(()=>{const n=document.querySelector(`[data-step-id="${a}"] .step-label-input input`);n&&(n.focus(),n.select())},100)},fa=a=>{oe(a)},_a=(a,n)=>{var i;it(a,{config:{...(i=h.value.steps.find(p=>p.step_id===a))==null?void 0:i.config,limits:n}}),x()},va=(a,n)=>{it(a,{relevant_tools:n}),C()},ha=(a,n)=>{it(a,{relevant_resources:n}),Y()},ya=()=>{Re.value=!1,Se.value=null},ba=()=>{le.value=!1,Re.value=!1,Se.value&&(Se.value(),Se.value=null)},Qe=()=>{fe(()=>{const a=document.querySelector(".navbar");a&&a.offsetHeight>0&&(ht.value=a.offsetHeight);const n=document.querySelector("#tags-view-container");se.tagsView&&n&&n.offsetHeight>0?lt.value=n.offsetHeight:lt.value=0})},kt=()=>{Qe()},zt=(a,n)=>{var I,A,Q,P,F,Z;const i=[],p=a.config||{},c=n.config||{};if(n.type==="number"){const X=p.limits,ve=c.limits;if(JSON.stringify(X)!==JSON.stringify(ve)){const ke=Ze(X,p.unit),pe=Ze(ve,c.unit);i.push({field:"limits",label:"Range",original:ke,current:pe})}p.unit!==c.unit&&i.push({field:"unit",label:"Unit",original:p.unit||"None",current:c.unit||"None"}),p.decimal_places!==c.decimal_places&&i.push({field:"decimal_places",label:"Decimal Places",original:((I=p.decimal_places)==null?void 0:I.toString())||"0",current:((A=c.decimal_places)==null?void 0:A.toString())||"0"}),p.default_value!==c.default_value&&i.push({field:"default_value",label:"Default Value",original:((Q=p.default_value)==null?void 0:Q.toString())||"None",current:((P=c.default_value)==null?void 0:P.toString())||"None"})}else n.type==="checkbox"?p.default!==c.default&&i.push({field:"default",label:"Default Value",original:p.default?"Checked":"Unchecked",current:c.default?"Checked":"Unchecked"}):n.type==="text"?(p.default_value!==c.default_value&&i.push({field:"default_value",label:"Default Value",original:p.default_value||"None",current:c.default_value||"None"}),p.max_length!==c.max_length&&i.push({field:"max_length",label:"Max Length",original:((F=p.max_length)==null?void 0:F.toString())||"Unlimited",current:((Z=c.max_length)==null?void 0:Z.toString())||"Unlimited"})):n.type==="inspection"&&p.default!==c.default&&i.push({field:"default",label:"Default Value",original:p.default||"None",current:c.default||"None"});return i.length===0&&JSON.stringify(p)!==JSON.stringify(c)&&i.push({field:"config",label:"Configuration",original:"Modified",current:"Modified"}),i},wt=(a,n,i={})=>{const p={metadata:[],steps_added:[],steps_modified:[],steps_deleted:[],steps_reordered:[]};[{key:"name",label:"Task Name"},{key:"description",label:"Description"},{key:"category",label:"Category"},{key:"estimated_minutes",label:"Estimated Time"},{key:"applicable_assets",label:"Applicable Assets"}].forEach(F=>{const Z=a[F.key],X=n[F.key];JSON.stringify(Z)!==JSON.stringify(X)&&p.metadata.push({field:F.key,label:F.label,original:Ke(Z,F.key,i),current:Ke(X,F.key,i)})});const I=a.steps||[],A=n.steps||[],Q=new Map(I.map(F=>[F.step_id,F])),P=new Map(A.map(F=>[F.step_id,F]));if(A.forEach(F=>{Q.has(F.step_id)||p.steps_added.push({step_id:F.step_id,label:F.label,type:F.type,position:F.order})}),I.forEach(F=>{P.has(F.step_id)||p.steps_deleted.push({step_id:F.step_id,label:F.label,type:F.type,position:F.order})}),A.forEach(F=>{const Z=Q.get(F.step_id);if(Z){const X=[];[{key:"label",label:"Name"},{key:"description",label:"Description"},{key:"required",label:"Required"},{key:"required_image",label:"Image Required"},{key:"type",label:"Type"}].forEach(pe=>{Z[pe.key]!==F[pe.key]&&X.push({field:pe.key,label:pe.label,original:Ke(Z[pe.key],pe.key,i),current:Ke(F[pe.key],pe.key,i)})});const ke=zt(Z,F);ke.length>0&&X.push(...ke),JSON.stringify(Z.relevant_tools)!==JSON.stringify(F.relevant_tools)&&X.push({field:"relevant_tools",label:"Tools",original:`${(Z.relevant_tools||[]).length} tools`,current:`${(F.relevant_tools||[]).length} tools`}),X.length>0&&p.steps_modified.push({step_id:F.step_id,label:F.label,type:F.type,changes:X})}}),I.length===A.length){const F=I.map(X=>X.step_id),Z=A.map(X=>X.step_id);if(JSON.stringify(F)!==JSON.stringify(Z)){const X=[];A.forEach((ve,ke)=>{const pe=I.findIndex(xa=>xa.step_id===ve.step_id);pe!==-1&&pe!==ke&&X.push({step_id:ve.step_id,label:ve.label,original_position:pe+1,new_position:ke+1})}),p.steps_reordered=X}}return p},Ke=(a,n="",i={})=>{if(a==null)return"None";if(n==="category"){if(typeof a=="number"&&i.categories){const p=i.categories.find(c=>c.value===a||c.id===a);return p?p.label:`Category ID: ${a}`}return typeof a=="string"&&a.trim()===""?"None":a.toString()}if(n==="applicable_assets"){if(Array.isArray(a)){if(a.length===0)return"None";if(i.equipmentTree&&i.equipmentTree.length>0){const p=a.map(c=>{const I=Ge(i.equipmentTree,c);if(I)return I.label;const A=parseInt(c);if(!isNaN(A)){const Q=Ge(i.equipmentTree,A);return Q?Q.label:`Asset ID: ${c}`}return`Asset ID: ${c}`}).filter(Boolean);return p.length>0?p.join(", "):"None"}return`${a.length} asset(s)`}if(typeof a=="number"||typeof a=="string"&&a.trim()!==""){if(i.equipmentTree&&i.equipmentTree.length>0){const p=Ge(i.equipmentTree,a);return p?p.label:`Asset ID: ${a}`}return`Asset ID: ${a}`}return"None"}return Array.isArray(a)?a.length===0?"None":a.join(", "):typeof a=="boolean"?a?"Yes":"No":typeof a=="number"?n==="estimated_minutes"?`${a} minutes`:a.toString():typeof a=="string"&&a.trim()===""?"None":a.toString()},Ge=(a,n)=>{if(!Array.isArray(a))return null;for(const i of a){if(i.value===n||i.id===n||parseInt(i.value)===parseInt(n)||parseInt(i.id)===parseInt(n))return i;if(i.children&&i.children.length>0){const p=Ge(i.children,n);if(p)return p}}return null},jt=async()=>{var a;at.value=!0;try{const n=await fo(),i=c=>({value:c.id,label:c.name,children:c.children&&c.children.length>0?c.children.map(i):void 0});let p;(a=n.data)!=null&&a.data?p=n.data.data:Array.isArray(n.data)?p=n.data:n.data?p=[n.data]:p=[],tt.value=p.map(c=>i(c))}catch(n){console.error("Equipment tree load failed:",n),$.error("Failed to load asset data.")}finally{at.value=!1}},Wt=async()=>{ot.value=!0;try{const a=await _o();Lt.value=a.data||[],ge.value=a.data.map(n=>({label:n.name,value:n.id}))}catch(a){console.error("Categories load failed:",a),$.error("Failed to load category data."),ge.value=[{label:"Preventive Maintenance",value:1},{label:"Inspection",value:2},{label:"Repair",value:3},{label:"Calibration",value:4},{label:"Safety Check",value:5},{label:"Other",value:6}]}finally{ot.value=!1}},Ht=a=>{if(!a.category)return"";if(typeof a.category=="object"&&a.category.id)return a.category.id;if(typeof a.category=="string"){const n=ge.value.find(i=>i.label===a.category);if(n)return n.value}return typeof a.category=="number"?a.category:""},Jt=async a=>{var n;st.value=!0;try{const i=await so(a);return(n=i==null?void 0:i.data)!=null&&n.data?i.data.data:i==null?void 0:i.data}finally{st.value=!1}},Qt=(a,n)=>{var I;if(a.step_id&&a.type&&a.config)return a;if(a.value&&a.value.type)return Ct(a,n);const i=a.type||"text",c={template:"text",numeric:"number",boolean:"checkbox",file:"attachments",checkbox:"checkbox",text:"text",inspection:"inspection",number:"number",attachments:"attachments"}[i]||"text";return{step_id:a.id||a._id||`step-${Date.now()}-${n}`,order:n+1,type:c,label:a.name||`Step ${n+1}`,description:a.description||"",required:!!a.required,required_image:!!((I=a.value)!=null&&I.require_image),relevant_tools:a.tools||[],relevant_resources:a.relevant_resources||[],config:Tt(c)}},St=q(!1),Ee=async()=>{var a,n;if(St.value){console.log("TemplateDesignerView: initializeTemplate already in progress, skipping...");return}if(St.value=!0,console.log("TemplateDesignerView: initializeTemplate called with route:",{params:r.params,query:r.query,isStandaloneTask:qe.value,routeParamsId:r.params.id,routeQueryStandalone:r.query.standalone,routeQueryTaskData:r.query.taskData?"present":"missing",routeQueryTaskDataKey:r.query.taskDataKey?"present":"missing"}),qe.value)try{let i=r.query.taskData;const p=r.query.taskDataKey;if(console.log("TemplateDesignerView: taskDataString:",i?"present":"missing"),console.log("TemplateDesignerView: taskDataKey:",p?"present":"missing"),!i&&p&&(console.log("TemplateDesignerView: Retrieving task data from sessionStorage with key:",p),i=sessionStorage.getItem(p),i?console.log("TemplateDesignerView: Successfully retrieved task data from sessionStorage"):console.log("TemplateDesignerView: No data found in sessionStorage for key:",p)),!i){if(console.log("TemplateDesignerView: taskData missing, retrying after delay..."),await new Promise(P=>setTimeout(P,100)),i=r.query.taskData||(p?sessionStorage.getItem(p):null),!i){const P=sessionStorage.getItem("last-standalone-task-key");P&&(i=sessionStorage.getItem(P),!p&&i&&(console.log("TemplateDesignerView: Using fallback session key for standalone task data"),sessionStorage.removeItem("last-standalone-task-key")))}console.log("TemplateDesignerView: taskDataString after retry:",i?"present":"missing")}let c=null;i&&(c=JSON.parse(i));const I=r.query.shouldFetchEntry==="true",A=r.query.taskEntryId||r.query.taskId||(r.params.id!=="standalone"?r.params.id:null)||(c==null?void 0:c.entry_id),Q=A&&A!=="undefined"?A:null;if(I&&Q)try{console.log("TemplateDesignerView: Fetching standalone task entry via API for id:",Q);const P=await xt(Q),F=(P==null?void 0:P.data)||P||null;F&&(c={...F,...c})}catch(P){console.warn("TemplateDesignerView: Failed to fetch task entry via API:",P)}else if(!c&&Q){console.log("TemplateDesignerView: Attempting fallback task entry fetch for id:",Q);try{const P=await xt(Q);c=(P==null?void 0:P.data)||P||null}catch(P){console.warn("TemplateDesignerView: Fallback task entry fetch failed:",P)}}if(!c){const P=w.consumePendingStandaloneTask();if(P){const F=[P.id,P.task_id,P.taskId].filter(Boolean).map(X=>String(X)),Z=Q?String(Q):null;!Z||F.includes(Z)?(console.log("TemplateDesignerView: Using pending standalone task data from draft store"),c=P):w.setPendingStandaloneTask(P)}}if(!c){const F=(((a=w.draftForm)==null?void 0:a.tasks)||[]).find(Z=>{const X=[Z.id,Z.task_id,Z.taskId].filter(Boolean).map(ke=>String(ke)),ve=Q?String(Q):null;return ve?X.includes(ve):!1});F&&(console.log("TemplateDesignerView: Resolved standalone task data from draft store"),c=JSON.parse(JSON.stringify(F)))}if(!c)throw new Error("Task data not found in route query parameters or sessionStorage");if((c.id||c.task_id)&&(z.value=String(c.id||c.task_id)),!c.id&&c.task_id&&(c.id=c.task_id),h.value={name:c.name||"",description:c.description||"",category:c.category||"",estimated_minutes:c.estimated_minutes||30,applicable_assets:c.equipment_node_id||null,steps:Array.isArray(c.steps)?c.steps.map(Qt):[]},ne.value={id:c.id,name:c.name,description:c.description,steps:c.steps||[],isStandalone:!0},ue.value=JSON.parse(JSON.stringify(h.value)),le.value=!1,se.tagsView){const P=`Edit Standalone Task - ${c.name||c.id}`;me.UPDATE_VISITED_VIEW_TITLE(r.path,P)}if(p&&(console.log("TemplateDesignerView: Cleaning up sessionStorage for key:",p),sessionStorage.removeItem(p)),sessionStorage.removeItem("last-standalone-task-key"),p||r.query.shouldFetchEntry||r.query.taskData){const P={...r.query};delete P.taskDataKey,delete P.taskData,delete P.shouldFetchEntry,e.replace({query:P}).catch(()=>{})}fe(()=>{ye()})}catch(i){console.error("Standalone task load failed:",i),$.error("Failed to load standalone task data"),e.push({name:"TaskLibrary"})}else if(Fe.value)try{const i=await Jt(r.params.id);if(!i)throw new Error("Template not found");if(h.value={name:i.name||"",description:i.description||"",category:Ht(i),estimated_minutes:i.time_estimate_sec?Math.round(i.time_estimate_sec/60):i.estimated_minutes||30,applicable_assets:((n=i.equipment_node)==null?void 0:n.id)||i.equipment_node_id||null,steps:Array.isArray(i.steps)?i.steps.map(Ct):[]},ne.value=i,ue.value=JSON.parse(JSON.stringify(h.value)),le.value=!1,se.tagsView&&i.reference_id){const p=`Edit Task - ${i.reference_id}`;me.UPDATE_VISITED_VIEW_TITLE(r.path,p)}fe(()=>{ye()})}catch(i){console.error("Template load failed:",i),$.error("Failed to load task"),e.push({name:"TaskLibrary"})}else ne.value=null,h.value={name:"",description:"",category:"",estimated_minutes:30,applicable_assets:null,steps:[]},le.value=!1,fe(()=>{ye()})};Be(async()=>{var a;ze.value={path:r.path,params:{...r.params||{}}},typeof window<"u"&&(window.__designerCacheStats=Nt),de.value=!1,re.value=(a=r.params)!=null&&a.id?`designer-edit-${r.params.id}`:"designer-create",et.value=G.sidebar.opened,G.sidebar.opened&&window.innerWidth<1600&&G.CLOSE_SIDEBAR(!1),Qe(),window.addEventListener("resize",kt),await Promise.all([Wt(),jt()]),!(se.tagsView&&vt())&&(await Ee(),de.value=!0,await fe(()=>ye()))}),po(()=>{window.removeEventListener("resize",kt),et.value&&!G.sidebar.opened&&G.TOGGLE_SIDEBAR(),R()}),mo(async()=>{if(He.value=!0,ze.value={path:r.path,params:{...r.params||{}}},Qe(),de.value=!1,se.tagsView&&(Ot(re.value)||vt())){const n=$e(re.value)||Rt();if(n){(p=>{if(!p||typeof p!="object")return!0;const c=typeof p.name=="string"&&p.name.trim().length>0,I=Array.isArray(p.steps)&&p.steps.length>0,A=!!p.category;return!(c||I||A)})(n.templateForm)&&n.originalTemplate?(console.warn("[Designer] Cached templateForm empty; rebuilding from originalTemplate snapshot"),h.value=JSON.parse(JSON.stringify(n.originalTemplate))):h.value=n.templateForm,ue.value=n.originalTemplate,ne.value=n.currentTemplate,le.value=n.hasUnsavedChanges,n.designerState&&Object.assign(N.value,n.designerState),de.value=!0,await fe(()=>{ye()}),Fe.value&&ne.value&&(ne.value.id||ne.value.template_id)!==r.params.id&&(console.warn("[Designer] Cached template id mismatch; reloading by route id","cached:",ne.value.id||ne.value.template_id,"route:",r.params.id),await Ee(),de.value=!0);return}}if(se.tagsView&&Fe.value&&r.params.id){const n=qt(r.params.id,we());if(n){(p=>{if(!p||typeof p!="object")return!0;const c=typeof p.name=="string"&&p.name.trim().length>0,I=Array.isArray(p.steps)&&p.steps.length>0,A=!!p.category;return!(c||I||A)})(n.templateForm)&&n.originalTemplate?(console.warn("[Designer] Cached templateForm empty (templateId path); rebuilding from originalTemplate"),h.value=JSON.parse(JSON.stringify(n.originalTemplate))):h.value=n.templateForm,ue.value=n.originalTemplate,ne.value=n.currentTemplate,le.value=n.hasUnsavedChanges,n.designerState&&Object.assign(N.value,n.designerState),de.value=!0,await fe(()=>ye());return}}!h.value.name&&!h.value.description&&h.value.steps.length===0&&(await Ee(),de.value=!0)}),te(()=>[r.params.id,r.query.taskData,r.query.standalone],async([a,n,i],[p,c,I])=>{if((a!==p||n!==c||i!==I)&&(a||n)){de.value=!1;try{await Ee(),de.value=!0}catch(Q){console.error("TemplateDesignerView: Failed to reinitialize on route change:",Q),de.value=!0}}},{immediate:!1}),go(()=>{var a,n;if(He.value=!1,se.tagsView){const i=A=>{if(!A||typeof A!="object")return!0;const Q=typeof A.name=="string"&&A.name.trim().length>0,P=Array.isArray(A.steps)&&A.steps.length>0,F=!!A.category;return!(Q||P||F)};let p=h.value;const c=$e(re.value);i(p)&&(c!=null&&c.templateForm)&&(console.warn("[Designer] Avoiding empty-form save by using previous cached form for key:",re.value),p=c.templateForm);const I={templateForm:p,originalTemplate:ue.value,currentTemplate:ne.value,hasUnsavedChanges:le.value,designerState:N.value};he(re.value,I,we(),((a=ne.value)==null?void 0:a.id)||((n=ne.value)==null?void 0:n.template_id)||r.params.id||null)}});const ka=()=>{},wa=()=>{yt.value=!1},Sa=()=>{window.print()},Ca=async()=>{Ve(!0);const a=r.query.workOrderName,n=r.query.workOrderId;try{qe.value?(await Mt(),De()):y.value?(De(),Me(n,a)):(await Ue({mode:"template",fromWorkOrderContext:!1}),De())}catch{}finally{Ve(!1)}},Ta=()=>{De()};te(()=>r.params.id,(a,n)=>{var i,p;if(a!==n&&!(se.tagsView&&!He.value)){if(se.tagsView&&He.value){const c=P=>{if(!P||typeof P!="object")return!0;const F=typeof P.name=="string"&&P.name.trim().length>0,Z=Array.isArray(P.steps)&&P.steps.length>0,X=!!P.category;return!(F||Z||X)};let I=h.value;const A=$e(re.value);c(I)&&(A!=null&&A.templateForm)&&(console.warn("[Designer] Avoiding empty-form preemptive save by using previous cached form for key:",re.value),I=A.templateForm);const Q={templateForm:I,originalTemplate:ue.value,currentTemplate:ne.value,hasUnsavedChanges:le.value,designerState:N.value};he(re.value,Q,we(),((i=ne.value)==null?void 0:i.id)||((p=ne.value)==null?void 0:p.template_id)||n||null),de.value=!1}le.value&&!se.tagsView?(Se.value=()=>Ee(),Re.value=!0):(Ee(),de.value=!0)}}),te(()=>se.tagsView,()=>{Qe()},{immediate:!1}),Xt((a,n,i)=>{!se.tagsView&&le.value?(Se.value=()=>i(),Re.value=!0):i()});const Kt={route:r,router:e,workOrderDraftStore:w,fromWorkOrder:y,workOrderReturnRoute:u,workOrderReturnPanel:_,workOrderReturnWorkOrderId:E,standaloneTaskIdRef:z,loadTemplates:v,createTemplate:W,updateTemplate:b,validateTemplate:U,tourOpen:g,startTour:k,onTourFinish:D,designerState:N,setFocusedStep:K,toggleFloatingPanelMode:H,setFloatingPanelMode:oe,scrollToNewStep:V,openNumberLimitsDialog:O,closeNumberLimitsDialog:x,openToolsDialog:J,closeToolsDialog:C,openResourcesDialog:ce,closeResourcesDialog:Y,openChangeSummaryDialog:ie,closeChangeSummaryDialog:De,setChangeSummaryLoading:Ve,showWorkOrderSaveConfirmation:Me,resetDesignerState:R,appStore:G,settingsStore:se,tagsViewStore:me,saveState:Ie,saveStateByKey:he,restoreState:Ft,restoreStateByKey:$e,restoreStateByTemplateId:qt,hasCachedState:Et,hasCachedStateByKey:Ot,clearState:At,clearStateByKey:Pe,getCacheStats:Nt,routeSnapshot:ze,stableCacheKey:re,metadataFormRef:je,stepsListRef:We,snapshotRoute:we,hasCache:vt,restoreCache:Rt,saveCache:qo,clearCache:Eo,isComponentActive:He,templateForm:h,originalTemplate:ue,currentTemplate:ne,hasUnsavedChanges:le,saving:Je,showUnsavedDialog:Re,pendingNavigation:Se,originalSidebarState:et,showComponentTips:Oo,equipmentTreeData:tt,allCategories:Lt,categoriesForDropdown:ge,categoriesLoading:ot,equipmentTreeLoading:at,navbarHeight:ht,tagsViewHeight:lt,containerHeight:Ao,showPreviewDialog:yt,isEditing:Fe,isStandaloneTask:qe,validationErrors:Ut,detailLoading:st,renderReady:de,isDataLoading:No,componentUsageTips:Ro,stepTypeColors:Lo,focusedStepType:Uo,availableCategories:Bo,isElementFormValid:nt,validateElementForm:ye,isFormValid:Mo,stepsForPanel:zo,floatingPanelUiHints:jo,floatingPanelInteractions:Wo,enabledBulkActions:Ho,previewDialogConfig:Jo,previewHeaderConfig:Qo,previewToolbarConfig:Ko,previewLayoutConfig:Go,previewContentConfig:Yo,previewFooterConfig:Xo,metadataRules:Zo,handleBack:$o,navigateBackToWorkOrder:Le,promptWorkOrderSaveMode:Bt,handleSave:ea,performSave:Ue,performStandaloneSave:Mt,handlePreview:ta,handleReset:oa,markAsChanged:be,handleStepFocus:aa,handleResetSteps:la,handleAddStep:sa,handleStepUpdate:it,handleStepDelete:na,handleStepDuplicate:ia,handleStepConfigure:ra,handleVueDragStart:da,handleVueDragEnd:ca,handleVueDragChange:ua,updateStepOrders:bt,handleReorderSteps:pa,handleBulkAction:ma,handleInlineRename:ga,handleSetMode:fa,handleNumberLimitsSave:_a,handleToolsSave:va,handleResourcesSave:ha,handleUnsavedDialogClose:ya,discardChanges:ba,calculateDynamicHeights:Qe,handleResize:kt,getDetailedConfigChanges:zt,generateChangesSummary:wt,formatValue:Ke,findAssetInTree:Ge,fetchEquipmentTreeData:jt,fetchCategories:Wt,resolveCategoryFromApiTemplate:Ht,fetchTemplateByIdLocal:Jt,transformStandaloneStepToDesigner:Qt,initializationInProgress:St,initializeTemplate:Ee,handlePreviewOpen:ka,handlePreviewClose:wa,handlePreviewPrint:Sa,handleChangeSummaryConfirm:Ca,handleChangeSummaryCancel:Ta,__MACROS_defineComponent:_t,ref:q,computed:j,onMounted:Be,onBeforeUnmount:po,onActivated:mo,onDeactivated:go,watch:te,nextTick:fe,get useRoute(){return Gt},get useRouter(){return Yt},get onBeforeRouteLeave(){return Xt},get ArrowLeft(){return ja},get Check(){return Po},get View(){return So},get Warning(){return za},get DocumentAdd(){return Ma},get Plus(){return Pt},get Switch(){return Ba},get CircleCheck(){return Vt},get RefreshLeft(){return Ua},get QuestionFilled(){return La},get ElMessage(){return $},get ElMessageBox(){return Oe},get useTaskLibrary(){return ao},get getTaskTemplateById(){return so},get getTaskEntryById(){return xt},get useDesignerStateCache(){return co},get useDesignerTour(){return bo},get useAppStore(){return no},get useSettingsStore(){return io},get useTagsViewStore(){return ro},get useWorkOrderDraftStore(){return oo},get buildDisplayTaskFromTemplate(){return lo},get buildDisplayTaskFromDesigner(){return rt},get getEquipmentTree(){return fo},get getAllCategories(){return _o},get VueDraggable(){return Fo},BaseStepCard:yl,FloatingPanel:Kl,NumberLimitsPanel:as,ToolPickerPanel:ws,ResourceUploaderPanel:Qs,PreviewDialog:_n,ChangeSummaryDialog:ci,get usePreviewConfigs(){return ko},get getDefaultStepConfig(){return Tt},get transformApiStepToDesignerStep(){return Ct},get formatLimitsText(){return Ze}};return Object.defineProperty(Kt,"__isScriptSetup",{enumerable:!1,value:!0}),Kt}}),mi={class:"designer-header"},gi={class:"header-left"},fi={class:"header-title"},_i={class:"title-with-help"},vi={key:1,class:"template-status"},hi={key:0,class:"unsaved-indicator"},yi={class:"header-actions"},bi={class:"designer-content"},ki={class:"left-panel"},wi={key:0,class:"panel-loading"},Si={style:{padding:"14px"}},Ci={class:"card-header-with-toggle"},Ti={class:"card-title"},xi={key:0},Di={key:0,class:"validation-list"},Vi={key:1,class:"no-issues"},Ii={key:0,class:"tips-list"},Pi={class:"tip-description"},Fi={key:1,class:"no-tips"},qi={class:"center-panel"},Ei={class:"steps-header"},Oi={class:"steps-title"},Ai={key:0,class:"steps-count"},Ni={class:"steps-actions"},Ri={key:0,class:"center-panel-loading"},Li={style:{padding:"16px"}},Ui={style:{display:"flex","align-items":"center",padding:"16px",border:"1px solid #eee","border-radius":"4px",background:"white"}},Bi={style:{flex:"1"}},Mi={style:{display:"flex",gap:"8px"}},zi={key:0,class:"empty-steps"},ji={class:"empty-content"},Wi={ref:"stepsListRef",class:"steps-list"},Hi={class:"right-panel"},Ji={key:0,class:"panel-loading"},Qi={style:{padding:"16px",background:"white","border-radius":"4px"}},Ki={style:{display:"flex",gap:"8px","margin-bottom":"16px"}},Gi={style:{display:"flex","flex-direction":"column",gap:"8px"}},Yi={class:"dialog-footer"};function Xi(B,t,r,e,w,y){var x,J;const u=S("el-icon"),_=S("el-button"),E=S("el-tooltip"),z=S("el-tag"),v=S("el-skeleton-item"),W=S("el-card"),b=S("el-skeleton"),U=S("el-input"),g=S("el-form-item"),k=S("el-option"),D=S("el-select"),N=S("el-input-number"),K=S("el-tree-select"),H=S("el-form"),oe=S("el-dialog"),V=S("el-tour-step"),O=S("el-tour");return d(),f("div",{class:"template-designer-view",style:_e({height:e.containerHeight})},[m(" Designer Header "),l("div",mi,[l("div",gi,[e.settingsStore.tagsView?m("v-if",!0):(d(),M(_,{key:0,type:"text",onClick:e.handleBack,class:"back-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.ArrowLeft)]),_:1})]),_:1})),l("div",fi,[l("div",_i,[l("h1",null,T(e.isStandaloneTask?"Edit Standalone Task":e.isEditing?"Edit Task":"Create New Task"),1),o(E,{content:"Show guided tour",placement:"bottom",effect:"dark"},{default:s(()=>[o(_,{type:"text",size:"default",onClick:e.startTour,class:"help-button",icon:e.QuestionFilled},null,8,["onClick","icon"])]),_:1})]),e.isEditing&&((x=e.currentTemplate)!=null&&x.reference_id)?(d(),M(z,{key:0,type:"info",class:"template-id-header"},{default:s(()=>[L(" #"+T(e.currentTemplate.reference_id),1)]),_:1})):m("v-if",!0),e.currentTemplate?(d(),f("div",vi,[e.hasUnsavedChanges?(d(),f("span",hi,[o(u,null,{default:s(()=>[o(e.Warning)]),_:1}),t[11]||(t[11]=L(" Unsaved changes "))])):m("v-if",!0)])):m("v-if",!0)])]),l("div",yi,[o(_,{onClick:e.handleReset,plain:"",style:{"font-weight":"500"}},{default:s(()=>[o(u,null,{default:s(()=>[o(e.RefreshLeft)]),_:1}),t[12]||(t[12]=L(" Reset "))]),_:1,__:[12]}),o(_,{type:"primary",onClick:e.handlePreview,plain:"",style:{"font-weight":"500"}},{default:s(()=>[o(u,null,{default:s(()=>[o(e.View)]),_:1}),t[13]||(t[13]=L(" Preview "))]),_:1,__:[13]}),o(E,{content:e.isFormValid?"":"Please fix validation issues",disabled:e.isFormValid,placement:"bottom",effect:"dark"},{default:s(()=>[o(_,{type:"primary",size:"default",onClick:e.handleSave,loading:e.saving,disabled:!e.isFormValid,class:Te({"shake-on-hover":!e.isFormValid}),style:{"font-weight":"550"}},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Check)]),_:1}),L(" "+T(e.isStandaloneTask?"Update Task":e.isEditing?"Save Changes":"Save Task"),1)]),_:1},8,["loading","disabled","class"])]),_:1},8,["content","disabled"])])]),m(" Designer Content "),l("div",bi,[m(" Left Panel - Template Metadata "),l("div",ki,[e.isDataLoading?(d(),f("div",wi,[o(b,{animated:""},{template:s(()=>[o(W,{class:"metadata-card"},{header:s(()=>[o(v,{variant:"text",style:{width:"40%"}})]),default:s(()=>[l("div",Si,[o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"80px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"30%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"40%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px","margin-bottom":"18px"}}),o(v,{variant:"text",style:{width:"40%","margin-bottom":"8px"}}),o(v,{variant:"rect",style:{height:"32px"}})])]),_:1})]),_:1})])):(d(),M(W,{key:1,class:"metadata-card"},{header:s(()=>t[14]||(t[14]=[l("span",{class:"card-title"},"Task Information",-1)])),default:s(()=>[o(H,{ref:"metadataFormRef",model:e.templateForm,rules:e.metadataRules,"label-position":"top",class:"metadata-form"},{default:s(()=>[o(g,{label:"Task Name",prop:"name",required:""},{default:s(()=>[o(U,{modelValue:e.templateForm.name,"onUpdate:modelValue":t[0]||(t[0]=C=>e.templateForm.name=C),placeholder:"Enter task name",onInput:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(g,{label:"Description",prop:"description"},{default:s(()=>[o(U,{modelValue:e.templateForm.description,"onUpdate:modelValue":t[1]||(t[1]=C=>e.templateForm.description=C),type:"textarea",rows:4,placeholder:"Describe what this task is for",onInput:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(g,{label:"Category",prop:"category",required:""},{default:s(()=>[o(D,{modelValue:e.templateForm.category,"onUpdate:modelValue":t[2]||(t[2]=C=>e.templateForm.category=C),placeholder:"Select category",style:{width:"100%"},onChange:e.markAsChanged},{default:s(()=>[(d(!0),f(ee,null,ae(e.availableCategories,C=>(d(),M(k,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"Estimated Time (minutes)",prop:"estimated_minutes",required:""},{default:s(()=>[o(N,{modelValue:e.templateForm.estimated_minutes,"onUpdate:modelValue":t[3]||(t[3]=C=>e.templateForm.estimated_minutes=C),min:1,max:480,style:{width:"100%"},onChange:e.markAsChanged},null,8,["modelValue"])]),_:1}),o(g,{label:"Applicable Assets",prop:"applicable_assets"},{default:s(()=>[o(K,{modelValue:e.templateForm.applicable_assets,"onUpdate:modelValue":t[4]||(t[4]=C=>e.templateForm.applicable_assets=C),placeholder:"Select applicable assets",data:e.equipmentTreeData,filterable:"","check-strictly":"","node-key":"value",props:{children:"children",label:"label"},multiple:!1,style:{width:"100%"},onChange:e.markAsChanged},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1})),m(" Template Validation & Usage Tips "),e.validationErrors.length>0||e.templateForm.steps.length>0?(d(),M(W,{key:2,class:"validation-card"},{header:s(()=>[l("div",Ci,[l("span",Ti,T(e.showComponentTips?"Component Usage Tips":"Validation Issues"),1),o(E,{content:e.showComponentTips?"Switch to Validation Issues":"Switch to Component Usage Tips",placement:"top"},{default:s(()=>[o(_,{type:"text",size:"small",onClick:t[5]||(t[5]=C=>e.showComponentTips=!e.showComponentTips),class:"toggle-button"},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Switch)]),_:1})]),_:1})]),_:1},8,["content"])])]),default:s(()=>[e.showComponentTips?(d(),f(ee,{key:1},[m(" Component Usage Tips View "),l("div",null,[e.focusedStepType?(d(),f("div",Ii,[l("div",{class:"tip-item",style:_e({borderLeftColor:e.stepTypeColors[e.focusedStepType]})},[l("div",{class:"tip-type",style:_e({color:e.stepTypeColors[e.focusedStepType]})},T(e.focusedStepType.charAt(0).toUpperCase()+e.focusedStepType.slice(1))+" Step: ",5),l("div",Pi,T(e.componentUsageTips[e.focusedStepType]),1)],4)])):(d(),f("div",Fi,t[16]||(t[16]=[l("span",null,"Select a step to see its usage tip",-1)])))])],2112)):(d(),f("div",xi,[e.validationErrors.length>0?(d(),f("ul",Di,[(d(!0),f(ee,null,ae(e.validationErrors,C=>(d(),f("li",{key:C,class:"validation-error"},T(C),1))),128))])):(d(),f("div",Vi,[o(u,{class:"success-icon"},{default:s(()=>[o(e.CircleCheck)]),_:1}),t[15]||(t[15]=l("span",null,"No validation issues found",-1))]))]))]),_:1})):m("v-if",!0)]),m(" Center Panel - Steps Designer "),l("div",qi,[l("div",Ei,[l("div",Oi,[t[17]||(t[17]=l("h3",null,"Procedure Designer",-1)),e.isDataLoading?(d(),M(b,{key:1,style:{width:"60px",height:"18px"},animated:""})):(d(),f("span",Ai,T(e.templateForm.steps.length)+" steps",1))]),l("div",Ni,[o(E,{content:"Clear all steps",placement:"top"},{default:s(()=>[o(_,{type:"text",size:"small",onClick:e.handleResetSteps,disabled:e.templateForm.steps.length===0||e.isDataLoading,class:"reset-steps-btn"},{default:s(()=>[o(u,{style:{"font-size":"18px"}},{default:s(()=>[o(e.RefreshLeft)]),_:1})]),_:1},8,["disabled"])]),_:1})])]),e.isDataLoading?(d(),f("div",Ri,[o(b,{animated:""},{template:s(()=>[l("div",Li,[(d(),f(ee,null,ae(3,C=>l("div",{key:C,style:{"margin-bottom":"16px"}},[l("div",Ui,[o(v,{variant:"circle",style:{width:"24px",height:"24px","margin-right":"12px"}}),l("div",Bi,[o(v,{variant:"text",style:{width:"60%","margin-bottom":"8px"}}),o(v,{variant:"text",style:{width:"40%"}})]),l("div",Mi,[o(v,{variant:"button",style:{width:"24px",height:"24px"}}),o(v,{variant:"button",style:{width:"24px",height:"24px"}}),o(v,{variant:"button",style:{width:"24px",height:"24px"}})])])])),64))])]),_:1})])):(d(),f("div",{key:1,class:Te(["steps-container",{"no-steps":e.templateForm.steps.length===0}])},[m(" Empty State "),e.templateForm.steps.length===0?(d(),f("div",zi,[l("div",ji,[o(u,{class:"empty-icon"},{default:s(()=>[o(e.DocumentAdd)]),_:1}),t[19]||(t[19]=l("h4",null,"No Steps Added",-1)),t[20]||(t[20]=l("p",null,"Add your first step to start building the procedure",-1)),o(_,{type:"primary",onClick:t[6]||(t[6]=C=>e.handleAddStep("inspection"))},{default:s(()=>[o(u,null,{default:s(()=>[o(e.Plus)]),_:1}),t[18]||(t[18]=L(" Add First Step "))]),_:1,__:[18]})])])):(d(),f(ee,{key:1},[m(" Steps List "),l("div",Wi,[o(e.VueDraggable,{modelValue:e.templateForm.steps,"onUpdate:modelValue":t[7]||(t[7]=C=>e.templateForm.steps=C),class:"steps-container","component-data":{tag:"div",type:"transition-group",name:"step-card"},"item-key":"step_id",animation:200,delay:0,disabled:!1,handle:".drag-handle","ghost-class":"step-ghost","chosen-class":"step-chosen","drag-class":"step-drag",onStart:e.handleVueDragStart,onEnd:e.handleVueDragEnd,onChange:e.handleVueDragChange},{item:s(({element:C,index:ce})=>[o(e.BaseStepCard,{step:C,"step-index":ce,"is-focused":e.designerState.focused_step_id===C.step_id,onFocus:e.handleStepFocus,onUpdate:e.handleStepUpdate,onDelete:e.handleStepDelete,onConfigure:e.handleStepConfigure,onDuplicate:e.handleStepDuplicate},null,8,["step","step-index","is-focused"])]),_:1},8,["modelValue"])],512)],2112))],2))]),m(" Right Panel - Floating Actions "),l("div",Hi,[e.isDataLoading?(d(),f("div",Ji,[o(b,{animated:""},{template:s(()=>[l("div",Qi,[o(v,{variant:"text",style:{width:"50%","margin-bottom":"16px"}}),l("div",Ki,[o(v,{variant:"button",style:{width:"60px",height:"28px"}}),o(v,{variant:"button",style:{width:"60px",height:"28px"}}),o(v,{variant:"button",style:{width:"60px",height:"28px"}})]),l("div",Gi,[(d(),f(ee,null,ae(6,C=>l("div",{key:C,style:{display:"flex","align-items":"center",padding:"8px 0","border-bottom":"1px solid #f0f2f5"}},[o(v,{variant:"circle",style:{width:"20px",height:"20px","margin-right":"12px"}}),o(v,{variant:"text",style:{width:"70%"}})])),64))])])]),_:1})])):e.designerState.floating_panel.visible?(d(),f(ee,{key:1},[m(" Floating Panel for adding/managing steps "),o(e.FloatingPanel,{mode:e.designerState.floating_panel.mode,steps:e.stepsForPanel,"ui-hints":e.floatingPanelUiHints,interactions:e.floatingPanelInteractions,"enabled-bulk-actions":e.enabledBulkActions,onAddStep:e.handleAddStep,onToggleMode:e.toggleFloatingPanelMode,onSetMode:e.handleSetMode,onReorderSteps:e.handleReorderSteps,onBulkAction:e.handleBulkAction,onInlineRename:e.handleInlineRename},null,8,["mode","steps","ui-hints","interactions","enabled-bulk-actions"])],2112)):m("v-if",!0)])]),m(" Configuration Dialogs "),e.designerState.dialogs.number_limits.visible?(d(),M(e.NumberLimitsPanel,{key:0,visible:e.designerState.dialogs.number_limits.visible,"step-id":e.designerState.dialogs.number_limits.for_step_id,"initial-data":e.designerState.dialogs.number_limits.form_data,onSave:e.handleNumberLimitsSave,onClose:e.closeNumberLimitsDialog},null,8,["visible","step-id","initial-data"])):m("v-if",!0),e.designerState.dialogs.relevant_tools_picker.visible?(d(),M(e.ToolPickerPanel,{key:1,visible:e.designerState.dialogs.relevant_tools_picker.visible,"step-id":e.designerState.dialogs.relevant_tools_picker.for_step_id,"selected-tools":e.designerState.dialogs.relevant_tools_picker.selected_tools,onSave:e.handleToolsSave,onClose:e.closeToolsDialog},null,8,["visible","step-id","selected-tools"])):m("v-if",!0),e.designerState.dialogs.resource_uploader.visible?(d(),M(e.ResourceUploaderPanel,{key:2,visible:e.designerState.dialogs.resource_uploader.visible,"step-id":e.designerState.dialogs.resource_uploader.for_step_id,"existing-resources":((J=e.designerState.dialogs.resource_uploader.form_data)==null?void 0:J.existing_resources)||[],onSave:e.handleResourcesSave,onClose:e.closeResourcesDialog},null,8,["visible","step-id","existing-resources"])):m("v-if",!0),m(" Preview Dialog "),o(e.PreviewDialog,{visible:e.showPreviewDialog,"template-form":e.templateForm,"dialog-config":e.previewDialogConfig,"header-config":e.previewHeaderConfig,"toolbar-config":e.previewToolbarConfig,"layout-config":e.previewLayoutConfig,"content-config":e.previewContentConfig,"footer-config":e.previewFooterConfig,onOpen:e.handlePreviewOpen,onClose:e.handlePreviewClose,onPrint:e.handlePreviewPrint},null,8,["visible","template-form","dialog-config","header-config","toolbar-config","layout-config","content-config","footer-config"]),m(" Change Summary Dialog "),o(e.ChangeSummaryDialog,{visible:e.designerState.dialogs.change_summary.visible,changes:e.designerState.dialogs.change_summary.changes,loading:e.designerState.dialogs.change_summary.loading,"current-steps":e.templateForm.steps,onConfirm:e.handleChangeSummaryConfirm,onCancel:e.handleChangeSummaryCancel,onClose:e.handleChangeSummaryCancel},null,8,["visible","changes","loading","current-steps"]),m(" Unsaved Changes Dialog "),o(oe,{"model-value":e.showUnsavedDialog,"onUpdate:modelValue":t[9]||(t[9]=C=>e.showUnsavedDialog=C),title:"Unsaved Changes",width:"450px","before-close":e.handleUnsavedDialogClose},{footer:s(()=>[l("span",Yi,[o(_,{onClick:t[8]||(t[8]=C=>e.showUnsavedDialog=!1)},{default:s(()=>t[21]||(t[21]=[L("Cancel")])),_:1,__:[21]}),o(_,{type:"primary",onClick:e.discardChanges},{default:s(()=>t[22]||(t[22]=[L("Continue")])),_:1,__:[22]})])]),default:s(()=>[t[23]||(t[23]=l("p",null,"You have unsaved changes. What would you like to do?",-1))]),_:1,__:[23]},8,["model-value"]),m(" Tour Component "),o(O,{modelValue:e.tourOpen,"onUpdate:modelValue":t[10]||(t[10]=C=>e.tourOpen=C),type:"primary",mask:!0,onFinish:e.onTourFinish},{default:s(()=>[o(V,{target:".designer-header",title:"Designer Header",description:"This is the header of the designer with all the main actions."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button",title:"Reset",description:"This is where you can reset the entire task template to its original state."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button:nth-child(2)",title:"Preview",description:"You can preview your task on both mobile and desktop devices."}),o(V,{target:"div.designer-header > div.header-actions > button.el-button:nth-child(3)",title:"Save Task",description:"This will save the task template you created to the system, where it can be used for work orders."}),o(V,{target:".left-panel",title:"Task Information",description:"Edit the task name, description, and other required metadata fields here."}),o(V,{target:".center-panel",title:"Procedure Designer",description:"This is your main design area. Add and arrange procedure steps here. Start by adding your first step to build the task workflow."}),o(V,{target:".right-panel",title:"+ Add Panel",description:"Click any step type card here to append a new step to your procedure."}),o(V,{target:".mode-selector .el-button-group button.el-button:nth-of-type(2)",title:"Click the Config Tab",description:"Please click the Config tab now to switch to Configuration mode."}),o(V,{target:"div.panel-content > div.reorder-steps-mode > div.steps-list-container",title:"Configuration Panel",description:"Here you can duplicate multiple steps, mark them as required/optional, delete selected steps, and drag-drop to reorder positions."})]),_:1},8,["modelValue","onFinish"])],4)}const pr=xe(pi,[["render",Xi],["__scopeId","data-v-b86adab6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/views/TemplateDesignerView.vue"]]);export{pr as T};
