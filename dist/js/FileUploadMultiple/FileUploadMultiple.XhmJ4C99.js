import"../vue/vue.Dfo81L2Q.js";import{P as Y,U as $,u as ee,B as ie}from"../@element-plus/@element-plus.BNeHluFm.js";import{_ as te}from"../../assets/index-fCswSekQ.js";import{E as F}from"../element-plus/element-plus.CU5xiOkY.js";import{am as E,as as le,c as U,o as p,O as g,K as V,L as c,M as ae,S as u,R as b,a as _,Q as se,r as x,j as I,w as y,q as j}from"../@vue/@vue.CVGyaoMH.js";const ne={__name:"FileUploadMultiple",props:{existingImageList:{type:Array,default:()=>[]},existingFileList:{type:Array,default:()=>[]},imageLabel:{type:String,default:"Upload Images"},fileLabel:{type:String,default:"Upload Files"},uploadType:{type:String,default:"both"},maxImages:{type:Number,default:0},maxFiles:{type:Number,default:0},titleLabelPosition:{type:String,default:"right"}},emits:["update:imageList","update:filesList","update:removedExistingImages","update:removedExistingFiles"],setup(z,{expose:k,emit:o}){const e=x([]),D=x(!1),T=x(""),w=x(!1),n=x([]),m=x([]),r=x([]),l=z,v=o,f=I(()=>l.uploadType==="both"||l.uploadType==="images"),C=I(()=>l.uploadType==="both"||l.uploadType==="files"),O=I(()=>l.maxImages>0&&S.value.length>=l.maxImages),Z=I(()=>l.maxFiles>0&&M.value.length>=l.maxFiles),S=I(()=>[...l.existingImageList.filter(t=>!m.value.includes(t)).map((t,s)=>({uid:`existing-image-${s}`,name:`existing-image-${s}`,url:t,status:"success",isExisting:!0})),...e.value]),M=I(()=>[...l.existingFileList.filter(t=>!r.value.includes(t)).map((t,s)=>{const L=t.split("/").pop()||`existing-file-${s}`;return{uid:`existing-file-${s}`,name:L,url:t,status:"success",isExisting:!0}}),...n.value]),q=(i,t)=>{const L=t.filter(a=>!(!a.raw||a.isExisting||a.url&&r.value.includes(a.url))).map(a=>new Promise(h=>{a.uid||(a.uid=Date.now().toString());const d=new FileReader;d.onload=N=>{a.url=N.target.result,h(a)},d.readAsDataURL(a.raw)}));Promise.all(L).then(a=>{const h=a.filter(d=>!d.isExisting&&!r.value.includes(d.url));n.value=h})},K=i=>{if(i.isExisting)r.value.includes(i.url)||r.value.push(i.url);else{const t=n.value.findIndex(s=>s.uid===i.uid);t!==-1&&n.value.splice(t,1)}},Q=i=>{i.url&&(T.value=i.url,D.value=!0)},W=i=>{if(i.isExisting)m.value.includes(i.url)||m.value.push(i.url);else{const t=e.value.findIndex(s=>s.uid===i.uid);t!==-1&&e.value.splice(t,1)}},G=(i,t)=>{const L=t.filter(a=>!(!a.raw||a.isExisting||a.url&&m.value.includes(a.url))).map(a=>new Promise(h=>{a.uid||(a.uid=Date.now().toString());const d=new FileReader;d.onload=N=>{a.url=N.target.result,h(a)},d.readAsDataURL(a.raw)}));Promise.all(L).then(a=>{const h=a.filter(d=>!d.isExisting&&!m.value.includes(d.url));e.value=h})},H=i=>i.type.startsWith("image/")?l.maxImages>0&&S.value.length>=l.maxImages?(F.error(`Maximum ${l.maxImages} images allowed!`),!1):!0:(F.error("Only image files are allowed!"),!1),J=i=>{const t=[".pdf",".doc",".docx",".xls",".xlsx",".txt",".zip",".rar",".csv",".json",".xml",".ppt",".pptx"],s="."+i.name.split(".").pop().toLowerCase();return t.includes(s)?l.maxFiles>0&&M.value.length>=l.maxFiles?(F.error(`Maximum ${l.maxFiles} files allowed!`),!1):!0:(F.error("File type not allowed!"),!1)},X=i=>{if(i.url){const t=document.createElement("a");t.href=i.url,t.download=i.name||"downloaded_file.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}};y(e,i=>{const t=i.map(s=>s.raw).filter(s=>s instanceof File);v("update:imageList",t)},{deep:!0}),y(n,i=>{const t=i.map(s=>s.raw).filter(s=>s instanceof File);v("update:filesList",t)},{deep:!0}),y(m,i=>{console.log("Emitting removedExistingImages list:",i.slice()),v("update:removedExistingImages",i.slice())},{deep:!0}),y(r,i=>{console.log("Emitting removedExistingFiles list:",i.slice()),v("update:removedExistingFiles",i.slice())},{deep:!0});const P=()=>{m.value=[],r.value=[]},R=()=>{e.value=e.value.filter(i=>!i.isExisting),n.value=n.value.filter(i=>!i.isExisting)},A=()=>{e.value=[],n.value=[]};y(()=>[l.existingImageList,l.existingFileList],()=>{P(),R()},{deep:!0}),j(()=>{P(),R(),(l.existingImageList.length>0||l.existingFileList.length>0)&&console.log("Initialized with existing files:",{images:l.existingImageList,files:l.existingFileList})}),k({resetRemovedItems:P,clearExistingFromNewLists:R,resetNewFileLists:A});const B={imageList:e,dialogVisible:D,dialogImageUrl:T,uploading:w,fileList:n,removedExistingImages:m,removedExistingFiles:r,props:l,emit:v,showImages:f,showFiles:C,isImageLimitReached:O,isFileLimitReached:Z,combinedImageList:S,combinedFileList:M,handleFileChange:q,handleFileRemove:K,handlePictureCardPreview:Q,handleImageRemove:W,handleImageChange:G,beforeImageUpload:H,beforeFileUpload:J,handleDownload:X,resetRemovedItems:P,clearExistingFromNewLists:R,resetNewFileLists:A,ref:x,watch:y,computed:I,onMounted:j,get ElMessage(){return F},get Plus(){return ie},get ZoomIn(){return ee},get Download(){return $},get Delete(){return Y}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}},oe={class:"upload-editor"},re={key:1,class:"upload-limit-text"},de=["src"],ce={class:"el-upload-list__item-actions"},me=["onClick"],ue=["onClick"],ge=["onClick"],fe={key:0,class:"upload-count"},pe={class:"image-wrapper"},_e=["src"],xe={key:0,class:"upload-count"};function ve(z,k,o,e,D,T){const w=E("el-icon"),n=E("el-upload"),m=E("el-dialog"),r=E("el-form-item"),l=E("el-button"),v=le("loading");return p(),U("div",oe,[g(" Image Upload Field "),e.showImages?(p(),V(r,{key:0,label:o.imageLabel,"label-position":o.titleLabelPosition},{default:c(()=>[ae((p(),V(n,{class:"upload-demo",action:"#","list-type":"picture-card","auto-upload":!1,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleImageRemove,"file-list":e.combinedImageList,"on-change":e.handleImageChange,"before-upload":e.beforeImageUpload,accept:"image/*",disabled:e.isImageLimitReached},{file:c(({file:f})=>[_("div",null,[_("img",{class:"el-upload-list__item-thumbnail",src:f.url,alt:""},null,8,de),_("span",ce,[_("span",{class:"el-upload-list__item-preview",onClick:C=>e.handlePictureCardPreview(f)},[u(w,null,{default:c(()=>[u(e.ZoomIn)]),_:1})],8,me),_("span",{class:"el-upload-list__item-delete",onClick:C=>e.handleDownload(f)},[u(w,null,{default:c(()=>[u(e.Download)]),_:1})],8,ue),_("span",{class:"el-upload-list__item-delete",onClick:C=>e.handleImageRemove(f)},[u(w,null,{default:c(()=>[u(e.Delete)]),_:1})],8,ge)])])]),default:c(()=>[e.isImageLimitReached?(p(),U("div",re,"Limit reached ("+b(e.combinedImageList.length)+"/"+b(o.maxImages)+")",1)):(p(),V(w,{key:0},{default:c(()=>[u(e.Plus)]),_:1}))]),_:1},8,["file-list","disabled"])),[[v,e.uploading]]),g(" Image count display "),o.maxImages>0?(p(),U("div",fe,"Images: "+b(e.combinedImageList.length)+"/"+b(o.maxImages),1)):g("v-if",!0),u(m,{modelValue:e.dialogVisible,"onUpdate:modelValue":k[0]||(k[0]=f=>e.dialogVisible=f),width:"80%",top:"5vh","append-to-body":"","destroy-on-close":""},{default:c(()=>[_("div",pe,[_("img",{src:e.dialogImageUrl,alt:"Preview Image",class:"preview-image"},null,8,_e)])]),_:1},8,["modelValue"])]),_:1},8,["label","label-position"])):g("v-if",!0),g(" File Upload Field "),e.showFiles?(p(),V(r,{key:1,label:o.fileLabel,"label-position":"top"},{default:c(()=>[u(n,{class:"upload-demo",action:"#","list-type":"text","auto-upload":!1,"on-remove":e.handleFileRemove,"file-list":e.combinedFileList,"on-change":e.handleFileChange,"before-upload":e.beforeFileUpload,accept:".pdf,.doc,.docx,.xls,.xlsx,.txt,.zip,.rar,.csv,.json,.xml,.ppt,.pptx",disabled:e.isFileLimitReached},{default:c(()=>[u(l,{size:"small",type:"success",disabled:e.isFileLimitReached},{default:c(()=>[se(b(e.isFileLimitReached?`Limit Reached (${e.combinedFileList.length}/${o.maxFiles})`:"Click to Upload"),1)]),_:1},8,["disabled"])]),_:1},8,["file-list","disabled"]),g(" File count display "),o.maxFiles>0?(p(),U("div",xe,"Files: "+b(e.combinedFileList.length)+"/"+b(o.maxFiles),1)):g("v-if",!0)]),_:1},8,["label"])):g("v-if",!0),g('    <el-button type="primary" size="small" @click="logEmitInfo"> Log Emitted Info </el-button>')])}const ye=te(ne,[["render",ve],["__scopeId","data-v-1033f439"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/FileUpload/FileUploadMultiple.vue"]]);export{ye as F};
