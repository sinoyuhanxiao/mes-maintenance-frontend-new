import"../vue/vue.Dfo81L2Q.js";import{f as K,a as Z}from"../datetime/datetime.39-ZCqKU.js";import{M as re,y as ie}from"../@element-plus/@element-plus.BNeHluFm.js";import{u as I}from"../vue-i18n/vue-i18n.DjO1PVT4.js";import{_ as N}from"../../assets/index-CE-d1vf_.js";import{c as A,o as D,R as k,j as B,am as y,as as le,M as se,K as E,O as L,L as l,S as t,a as C,Q as F,F as Q,r as b,q as z,Z as J,w as H,a8 as de,J as G,_ as W,t as X}from"../@vue/@vue.CVGyaoMH.js";import{U as ce}from"../UserTag/UserTag.cokAVoqN.js";import{M as me}from"../index/index.6be3zOyE.js";import{b as Y}from"../user/user.DvQSuXH1.js";import{E as $,c as ee}from"../element-plus/element-plus.CU5xiOkY.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../vue-router/vue-router.30cuaQZO.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../mitt/mitt.DJ65BbbF.js";import"../lodash-es/lodash-es.BLHqGvLj.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";let ue=100;const M=[{id:2,name:"Night Shift",description:"",start_time:"03:00:00Z",end_time:"15:00:00Z",grace_minute:30,status:1,created_at:"2025-04-16T22:11:29.11095Z",created_by:12,updated_at:"2025-07-23T16:33:57.076142Z",updated_by:19},{id:1,name:"Day Shift",description:"",start_time:"15:00:00Z",end_time:"03:00:00Z",grace_minute:30,status:1,created_at:"2025-04-16T22:11:29.11095Z",created_by:12,updated_at:"2025-06-18T17:18:06.890345Z",updated_by:19}],te=()=>new Promise(c=>{setTimeout(()=>{c({data:{timestamp:Date.now(),status:"200",message:"success",data:M}})},200)}),ae=c=>new Promise(a=>{setTimeout(()=>{const s=new Date().toISOString(),e={...c,id:++ue,created_at:s,updated_at:s,created_by:c.created_by??0,updated_by:c.updated_by??0,status:c.status??1};M.push(e),a({data:{timestamp:Date.now(),status:"200",message:"success",data:e}})},300)}),ne=(c,a)=>new Promise((s,e)=>{setTimeout(()=>{const u=M.findIndex(m=>m.id===Number(c));if(u===-1)return e(new Error(`Shift with ID ${c} not found`));const _=new Date().toISOString(),r={...M[u],...a,id:Number(c),updated_at:_,updated_by:a.updated_by??0};M[u]=r,s({data:{timestamp:Date.now(),status:"200",message:"success",data:r}})},300)}),oe=c=>new Promise((a,s)=>{setTimeout(()=>{const e=M.findIndex(_=>_.id===Number(c));if(e===-1)return s(new Error(`Shift with ID ${c} not found`));const u=M.splice(e,1)[0];a({data:{timestamp:Date.now(),status:"200",message:"Shift deleted successfully",data:u}})},300)}),fe={__name:"TimeSlot",props:{value:{type:String,required:!1}},setup(c,{expose:a}){a();const s=c,e=B(()=>K(s.value)),u={props:s,formattedTime:e,get formatAsLocalDateTimeString(){return K},computed:B};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}};function _e(c,a,s,e,u,_){return D(),A("span",null,k(e.formattedTime),1)}const pe=N(fe,[["render",_e],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/shift/components/TimeSlot.vue"]]),he={__name:"shiftList",props:{shifts:Array,searchInput:String,userMap:Object,loading:Boolean},emits:["edit-shift","delete-shift"],setup(c,{expose:a,emit:s}){a();const e=c,u=s,{t:_}=I(),r=b([]),m=b([]),p=b(1),i=b(15),h=b({prop:"",order:""}),f=b(600),w=()=>{f.value=window.innerHeight-50-100-20-20-10};z(()=>{w(),window.addEventListener("resize",w)}),J(()=>{window.removeEventListener("resize",w)});const S=o=>{if(!o)return"-";try{return new Date(`1970-01-01T${o}`).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return"-"}};H(()=>e.shifts,o=>{r.value=[...o],n(e.searchInput),p.value=1},{immediate:!0,deep:!0}),H(()=>e.searchInput,o=>{n(o)},{immediate:!0});function n(o){const v=(o||"").toLowerCase();m.value=r.value.filter(g=>["id","name","description","created_at","created_by","start_time","end_time","grace_minute"].some(V=>{var T;return(T=g[V])==null?void 0:T.toString().toLowerCase().includes(v)}))}function x({prop:o,order:v}){h.value={prop:o,order:v}}function j(o){i.value=o,p.value=1}function q(o){p.value=o}const U=B(()=>{const o=[...m.value].sort((g,V)=>{const{prop:T,order:R}=h.value;let P,O;return!T||!R?(P=g.updated_at?new Date(g.updated_at):new Date(g.created_at),O=V.updated_at?new Date(V.updated_at):new Date(V.created_at)):(P=T.includes("_at")?new Date(g[T]||0):g[T]??0,O=T.includes("_at")?new Date(V[T]||0):V[T]??0),R==="ascending"?P>O?1:-1:R==="descending"?P<O?1:-1:new Date(g.created_at)-new Date(V.created_at)}),v=(p.value-1)*i.value;return o.slice(v,v+i.value)}),d={props:e,emit:u,t:_,originalList:r,filteredList:m,currentPage:p,pageSize:i,sortSettings:h,tableHeight:f,updateTableHeight:w,formatTime:S,filterTable:n,handleSortChange:x,handleSizeChange:j,handlePageChange:q,sortedAndPaginatedList:U,ref:b,computed:B,watch:H,onMounted:z,onBeforeUnmount:J,get useI18n(){return I},TimeSlot:pe,UserTag:ce};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}};function ge(c,a,s,e,u,_){const r=y("el-table-column"),m=y("el-button"),p=y("el-table"),i=y("el-pagination"),h=le("loading");return D(),A(Q,null,[se((D(),E(p,{data:e.sortedAndPaginatedList,onSortChange:e.handleSortChange,height:e.tableHeight,style:{width:"100%"},"empty-text":e.t("common.noData"),border:"",fit:""},{default:l(()=>[t(r,{prop:"id",label:"ID",width:"100",sortable:"",fixed:"left",align:"center"}),t(r,{prop:"name",label:e.t("common.name"),width:"180",sortable:"","show-overflow-tooltip":"",fixed:"left",align:"center"},null,8,["label"]),t(r,{prop:"description",label:e.t("common.description"),width:"180",sortable:"","show-overflow-tooltip":"",align:"center"},null,8,["label"]),t(r,{label:e.t("shift.startTime"),prop:"start_time",width:"180",sortable:"",align:"center"},{default:l(({row:f})=>[C("span",null,k(e.formatTime(f.start_time)),1)]),_:1},8,["label"]),t(r,{label:e.t("shift.endTime"),prop:"end_time",width:"180",sortable:"",align:"center"},{default:l(({row:f})=>[C("span",null,k(e.formatTime(f.end_time)),1)]),_:1},8,["label"]),t(r,{prop:"grace_minute",label:e.t("shift.graceTimeMinute"),width:"230",sortable:"",align:"center"},null,8,["label"]),t(r,{prop:"created_at",label:e.t("common.createdAt"),width:"180",sortable:"",align:"center"},{default:l(({row:f})=>[t(e.TimeSlot,{value:f.created_at},null,8,["value"])]),_:1},8,["label"]),t(r,{prop:"created_by",label:e.t("common.createdBy"),width:"180",sortable:"",align:"center"},{default:l(({row:f})=>[t(e.UserTag,{user:s.userMap[f.created_by]},null,8,["user"])]),_:1},8,["label"]),t(r,{label:e.t("common.actions"),align:"center","header-align":"center",fixed:"right"},{default:l(({row:f})=>[t(m,{size:"small",onClick:w=>e.emit("edit-shift",f)},{default:l(()=>[F(k(e.t("common.edit")),1)]),_:2},1032,["onClick"]),t(m,{type:"danger",size:"small",onClick:w=>e.emit("delete-shift",f.id)},{default:l(()=>[F(k(e.t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data","height","empty-text"])),[[h,s.loading]]),e.filteredList.length>15?(D(),E(i,{key:0,background:"",style:{"margin-top":"10px"},layout:"total, sizes, prev, pager, next",total:e.filteredList.length,"page-size":e.pageSize,"page-sizes":[15,30,45,60],"current-page":e.currentPage,onSizeChange:e.handleSizeChange,onCurrentChange:e.handlePageChange,"hide-on-single-page":!0},null,8,["total","page-size","current-page"])):L("v-if",!0)],64)}const be=N(he,[["render",ge],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/shift/components/shiftList.vue"]]),ve={__name:"shiftForm",props:{shift:{type:Object,required:!0},isEditMode:{type:Boolean,required:!0}},emits:["submit","cancel"],setup(c,{expose:a,emit:s}){const e=c,u=s,{t:_}=I(),r=b(null);a({shiftFormRef:r});const m=B(()=>G(e,"shift").value),p={name:[{required:!0,message:_("common.nameRequired"),trigger:"blur"}],start_time:[{required:!0,message:_("shift.startTimeRequired"),trigger:"change"}],end_time:[{required:!0,message:_("shift.endTimeRequired"),trigger:"change"}]},i=[{prop:"name",label:_("common.name"),placeholder:_("common.namePlaceholder"),type:"input",maxlength:255},{prop:"description",label:_("common.description"),placeholder:_("common.descriptionPlaceholder"),type:"textarea"}];function h(){var w;(w=r.value)==null||w.validate(S=>{if(!S)return console.error("Form validation failed!");const n={...m.value,status:1},x=new Date().toISOString();n.id==null?n.created_at=x:n.updated_at=x,u("submit",n)})}const f={props:e,emit:u,t:_,shiftFormRef:r,shift:m,validationRules:p,formItems:i,validateAndSubmit:h,ref:b,computed:B,toRef:G,get useI18n(){return I}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},ye={style:{display:"flex","justify-content":"end"}};function we(c,a,s,e,u,_){const r=y("el-input"),m=y("el-form-item"),p=y("el-time-picker"),i=y("el-col"),h=y("el-input-number"),f=y("el-row"),w=y("el-button"),S=y("el-form");return D(),E(S,{model:e.shift,ref:"shiftFormRef",rules:e.validationRules,"label-width":"170px"},{default:l(()=>[(D(),A(Q,null,de(e.formItems,n=>(D(),A(Q,{key:n.prop},[n.type==="input"?(D(),E(m,{key:0,label:n.label,prop:n.prop},{default:l(()=>[t(r,{modelValue:e.shift[n.prop],"onUpdate:modelValue":x=>e.shift[n.prop]=x,placeholder:n.placeholder,maxlength:n.maxlength},null,8,["modelValue","onUpdate:modelValue","placeholder","maxlength"])]),_:2},1032,["label","prop"])):n.type==="textarea"?(D(),E(m,{key:1,label:n.label,prop:n.prop},{default:l(()=>[t(r,{type:"textarea",modelValue:e.shift[n.prop],"onUpdate:modelValue":x=>e.shift[n.prop]=x,placeholder:n.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"])):L("v-if",!0)],64))),64)),t(f,null,{default:l(()=>[t(i,{span:7},{default:l(()=>[t(m,{label:e.t("shift.startTime"),prop:"start_time"},{default:l(()=>[t(p,{modelValue:e.shift.start_time,"onUpdate:modelValue":a[0]||(a[0]=n=>e.shift.start_time=n)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),t(i,{span:7},{default:l(()=>[t(m,{label:e.t("shift.endTime"),prop:"end_time"},{default:l(()=>[t(p,{modelValue:e.shift.end_time,"onUpdate:modelValue":a[1]||(a[1]=n=>e.shift.end_time=n)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),t(i,{span:10},{default:l(()=>[t(m,{label:e.t("shift.graceTimeMinute")},{default:l(()=>[t(h,{modelValue:e.shift.grace_minute,"onUpdate:modelValue":a[2]||(a[2]=n=>e.shift.grace_minute=n),min:0,max:120,style:{"margin-right":"10px"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),C("div",ye,[t(w,{onClick:a[3]||(a[3]=n=>e.emit("cancel"))},{default:l(()=>[F(k(e.t("common.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:e.validateAndSubmit},{default:l(()=>[F(k(e.t("common.confirm")),1)]),_:1})])]),_:1},8,["model"])}const Se=N(ve,[["render",we],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/shift/components/shiftForm.vue"]]),xe={__name:"index",setup(c,{expose:a}){a();const{t:s}=I(),e=b(!1),u=b([]),_=b(""),r=b(!1),m=b(!1),p=b(null),i=W({id:null,name:"",description:"",start_time:null,end_time:null,grace_minute:0}),h=b({});function f(d){if(!d)return null;const o=new Date(`1970-01-01T${d}`);return isNaN(o.getTime())?null:o}function w(d=null){m.value=!!d,d?(i.id=d.id??null,i.name=d.name??"",i.description=d.description??"",i.grace_minute=d.grace_minute??0,i.start_time=f(d.start_time),i.end_time=f(d.end_time)):(i.id=null,i.name="",i.description="",i.start_time=null,i.end_time=null,i.grace_minute=0),r.value=!0,X(()=>{var v,g;const o=(g=(v=p.value)==null?void 0:v.$refs)==null?void 0:g.shiftFormRef;o!=null&&o.clearValidate&&o.clearValidate()})}async function S(){try{e.value=!0;const d=await te();u.value.splice(0,u.value.length,...d.data.data)}catch(d){console.error("Failed to load shifts:",d),u.value=[]}finally{e.value=!1}}async function n(){try{const o=(await Y(1,1e3)).data.content,v={};o.forEach(g=>{v[g.id]=g}),h.value=v}catch{$.error(s("user.message.errorLoadingUsersData"))}}async function x(d){try{const o=Z(d.start_time),v=Z(d.end_time),g={...d,start_time:o,end_time:v};m.value?await ne(g.id,g):await ae(g),r.value=!1,await S()}catch(o){console.error("Error saving shift:",o)}}async function j(d){try{await ee.confirm(s("common.confirmMessage"),s("common.warning"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),type:"warning"}),await oe(d),await S()}catch(o){o!=="cancel"&&console.error("Error deleting shift:",o)}}async function q(){_.value="",await S()}z(()=>{S(),n()});const U={t:s,loading:e,shifts:u,searchQuery:_,dialogVisible:r,isEditMode:m,shiftFormComp:p,shiftForm:i,userMap:h,parseTimeToDateOrNull:f,openDialog:w,loadShifts:S,loadUserMap:n,submitForm:x,confirmDelete:j,handleRefreshButton:q,ref:b,reactive:W,onMounted:z,nextTick:X,get formatDateObjectToOffsetTime(){return Z},get ElMessage(){return $},get ElMessageBox(){return ee},get RefreshRight(){return ie},get Search(){return re},get createShift(){return ae},get deleteShift(){return oe},get getAllShifts(){return te},get updateShift(){return ne},ShiftList:be,ShiftForm:Se,get useI18n(){return I},MesLayout:me,get getAllUsers(){return Y}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}},Te={class:"toolbar"},De={class:"actions-row"},Ve={class:"actions-item"},Ce={class:"actions-item"},ke={style:{display:"flex","flex-direction":"column","max-width":"100%"}};function Le(c,a,s,e,u,_){const r=y("el-icon"),m=y("el-input"),p=y("el-button"),i=y("el-dialog");return D(),E(e.MesLayout,{title:e.t("router.shiftManagement"),"view-mode":"table"},{head:l(()=>[L(" Header tool bar "),C("div",Te,[C("div",De,[C("div",Ve,[L(" Search Box "),t(m,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=h=>e.searchQuery=h),placeholder:e.t("common.searchByKeyword"),clearable:"",style:{width:"280px"}},{prefix:l(()=>[t(r,null,{default:l(()=>[t(e.Search)]),_:1})]),_:1},8,["modelValue","placeholder"])]),L(" Refresh & Add Button "),C("div",Ce,[t(p,{class:"refresh-button",type:"primary",circle:"",onClick:e.handleRefreshButton},{default:l(()=>[t(r,{style:{color:"white"}},{default:l(()=>[t(e.RefreshRight)]),_:1})]),_:1}),t(p,{type:"primary",onClick:a[1]||(a[1]=h=>e.openDialog())},{default:l(()=>[F(k(e.t("shift.createShift")),1)]),_:1})])])])]),body:l(()=>[C("div",ke,[L(" Shift List "),t(e.ShiftList,{loading:e.loading,shifts:e.shifts,onEditShift:e.openDialog,onDeleteShift:e.confirmDelete,"search-input":e.searchQuery,"user-map":e.userMap},null,8,["loading","shifts","search-input","user-map"]),L(" Dialog for Create/Edit "),t(i,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=h=>e.dialogVisible=h),title:e.isEditMode?e.t("shift.editShift"):e.t("shift.createShift"),"close-on-click-modal":!1},{default:l(()=>[t(e.ShiftForm,{ref:"shiftFormComp",shift:e.shiftForm,"is-edit-mode":e.isEditMode,onSubmit:e.submitForm,onCancel:a[2]||(a[2]=h=>e.dialogVisible=!1)},null,8,["shift","is-edit-mode"])]),_:1},8,["modelValue","title"])])]),_:1},8,["title"])}const ut=N(xe,[["render",Le],["__scopeId","data-v-a8507067"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/shift/index.vue"]]);export{ut as default};
