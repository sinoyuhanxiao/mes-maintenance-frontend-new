import"../vue/vue.Dfo81L2Q.js";import{a as it,u as ht}from"../vue-router/vue-router.30cuaQZO.js";import{u as Be}from"../vue-i18n/vue-i18n.DjO1PVT4.js";import{S as jr,T as Na,U as ga,V as vo,W as ho,H as yo,B as Ca,v as Nt,X as wo,M as Ft,Y as ea,Z as Ha,_ as ko,P as Da,$ as Ya,E as Hr,a0 as Yr,a1 as bo,a2 as Jr,k as So,a3 as ar,a4 as rr,a5 as To,O as qt,a6 as Oo,a7 as Co,f as Bt,g as Ja,A as Do,a as Po,a8 as Qr,a9 as Qa,aa as Gr,x as Kr,n as Zr,z as Ao,u as Io,ab as Vo,b as or,d as nr,D as Fo}from"../@element-plus/@element-plus.BNeHluFm.js";import{L as xo}from"../index/index.BvuKEQ21.js";import{u as sr}from"../commonData/commonData.BC1BHJWB.js";import{_ as Re,h as Eo,b as lr}from"../../assets/index-fCswSekQ.js";import{E as U,c as $e,d as Wo}from"../element-plus/element-plus.CU5xiOkY.js";import{am as D,c as p,o as i,O as s,a,S as r,L as o,F as se,a8 as fe,G as Ae,a6 as Ro,K as N,Q as V,R as m,d as be,_ as et,r as O,j as L,q as Ue,W as pa,w as ge,t as Me,P as ta,E as Tt,as as aa,M as Ct,Z as Ot,U as Ga,Y as Xr,aL as Lo,a5 as ir,$ as Ma}from"../@vue/@vue.CVGyaoMH.js";import{c as lt}from"../datetime/datetime.39-ZCqKU.js";import{u as va}from"../useErrorHandler/useErrorHandler.DVUZjmHi.js";import{g as dr,d as cr,a as ur,b as ha,c as ya,e as wa,f as ka,h as ba,i as mr,u as _r,j as fr,k as qa}from"../work-order/work-order.CtSeOWtO.js";import{u as Vt,w as Mo}from"../xlsx/xlsx.mYVfmpqs.js";import{F as qo}from"../file-saver/file-saver.i2TUQTli.js";import{g as gr}from"../equipment/equipment.DNKw76bx.js";import{u as pr,S as vr,A as Ua,T as hr,N as yr,C as wr,I as kr,a as yt,b as Sa,c as St,d as Ba,e as Ut,D as Zt}from"../ServiceStepPreview/ServiceStepPreview.9cWJ2Utk.js";import{t as za,g as br,s as Sr,a as Tr,c as Or,u as Cr}from"../task-library/task-library.mnROmZvc.js";import{R as $r,u as Dr}from"../useWorkOrder/useWorkOrder.088XDSx4.js";import{C as eo,M as to,a as ao}from"../CardTable/CardTable.qteQPHi0.js";import{d as Ta}from"../lodash-es/lodash-es.BLHqGvLj.js";import{C as ro}from"../CreateStandardDialog/CreateStandardDialog.BThjHi_w.js";import{F as oo}from"../FileUploadMultiple/FileUploadMultiple.XhmJ4C99.js";import{u as Xt}from"../minio/minio.DwZpSMzM.js";import{l as Pr,a as Ar,i as Ir,b as Vr,c as Fr,d as xr,e as Er,F as Uo}from"../@fullcalendar/@fullcalendar.CwHAVqfm.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../index/index.CiC-hohW.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../common/common.CHi731XS.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../mitt/mitt.DJ65BbbF.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";import"../MaintenanceWorkOrderCard/MaintenanceWorkOrderCard.CBR2k6k0.js";import"../preact/preact.BuVfYH0o.js";const zo=be({name:"UnifiedWorkOrderFilters"}),No=Object.assign(zo,{props:{modelValue:{type:Object,default:()=>({})},exportLoading:{type:Boolean,default:!1},showTodoActions:{type:Boolean,default:!1},currentView:{type:String,default:"table"}},emits:["update:modelValue","filter-change","create","export","refresh"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,{t:h}=Be(),c=sr(),u=et({assignedTo:e.modelValue.assignedTo||null,dueDate:e.modelValue.dueDate||null,workType:e.modelValue.workType||null,priority:e.modelValue.priority||null,state:e.modelValue.state||null,category:e.modelValue.category||null,search:e.modelValue.search||"",customDateRange:e.modelValue.customDateRange||null,latest_per_recurrence:e.currentView!=="calendar",status:e.modelValue.status||null,equipment:e.modelValue.equipment||null,location:e.modelValue.location||null,recurrence:e.modelValue.recurrence||null}),g=O(!1),S=O(window.innerWidth),T=L(()=>S.value>1800?8:5),b=L(()=>Object.values(I).filter(K=>K.visible).length),w=L(()=>b.value>=T.value),F=()=>{S.value=window.innerWidth};Ue(()=>{window.addEventListener("resize",F)}),pa(()=>{window.removeEventListener("resize",F)}),ge(S,(K,X)=>{if(X>1800&&K<=1800&&b.value>5){const De=b.value-5,Ve=Object.keys(I).filter(Te=>I[Te].visible);for(let Te=Ve.length-1;Te>0;Te--){const Le=Math.floor(Math.random()*(Te+1));[Ve[Te],Ve[Le]]=[Ve[Le],Ve[Te]]}for(let Te=0;Te<De;Te++){const Le=Ve[Te];I[Le].visible=!1}U.info(h("workOrder.filters.autoDeselected",{count:De}))}});const P=et({assignedTo:!1,dueDate:!1,workType:!1,priority:!1,search:!1,state:!1,status:!1,category:!1,equipment:!1,location:!1,recurrence:!1}),I=et({assignedTo:{visible:!0,category:"basic"},dueDate:{visible:!0,category:"basic"},workType:{visible:!0,category:"basic"},priority:{visible:!0,category:"basic"},search:{visible:!0,category:"basic"},state:{visible:!1,category:"advanced"},status:{visible:!1,category:"advanced"},category:{visible:!1,category:"advanced"},equipment:{visible:!1,category:"advanced"},location:{visible:!1,category:"advanced"},recurrence:{visible:!1,category:"advanced"}}),J=L(()=>[{id:1,name:"Erik Yu"},{id:2,name:"Jane Smith"},{id:3,name:"Mike Johnson"}]),k=L(()=>c.workTypes||[]),Z=L(()=>c.priorities||[]),ie=L(()=>c.states||[]),G=L(()=>c.categories||[]),le=L(()=>[{id:"pending",name:h("workOrder.status.pending")},{id:"in_progress",name:h("workOrder.status.inProgress")},{id:"completed",name:h("workOrder.status.completed")},{id:"cancelled",name:h("workOrder.status.cancelled")}]),ue=L(()=>[{id:1,name:"Production Line A"},{id:2,name:"Production Line B"},{id:3,name:"Packaging Machine 1"},{id:4,name:"Packaging Machine 2"}]),$=L(()=>[{id:1,name:"Factory Floor 1"},{id:2,name:"Factory Floor 2"},{id:3,name:"Warehouse"},{id:4,name:"Office Building"}]),B=L(()=>[{id:1,name:h("workOrder.recurrence.none")},{id:2,name:h("workOrder.recurrence.daily")},{id:3,name:h("workOrder.recurrence.weekly")},{id:4,name:h("workOrder.recurrence.monthlyByDate")},{id:5,name:h("workOrder.recurrence.yearly")}]),me=L(()=>({assignedTo:{key:"assignedTo",label:h("workOrder.filters.assignedTo"),icon:"User",category:"basic"},dueDate:{key:"dueDate",label:h("workOrder.filters.dueDate"),icon:"Calendar",category:"basic"},workType:{key:"workType",label:h("workOrder.table.workType"),icon:"Tools",category:"basic"},priority:{key:"priority",label:h("workOrder.table.priority"),icon:"Flag",category:"basic"},search:{key:"search",label:h("workOrder.filters.search"),icon:"Search",category:"basic"},state:{key:"state",label:h("workOrder.filters.state"),icon:"CircleCheck",category:"advanced"},status:{key:"status",label:h("workOrder.filters.status"),icon:"CircleCheck",category:"advanced"},category:{key:"category",label:h("workOrder.filters.category"),icon:"Collection",category:"advanced"},equipment:{key:"equipment",label:h("workOrder.filters.equipment"),icon:"Setting",category:"advanced"},location:{key:"location",label:h("workOrder.filters.location"),icon:"Location",category:"advanced"},recurrence:{key:"recurrence",label:h("workOrder.filters.recurrence"),icon:"Refresh",category:"advanced"}})),ne=L(()=>Object.values(me.value).filter(K=>K.category==="basic")),ee=L(()=>Object.values(me.value).filter(K=>K.category==="advanced")),W=O(""),re=L(()=>{const K=W.value.trim().toLowerCase();return K?ne.value.filter(X=>(X.label||"").toLowerCase().includes(K)):ne.value}),Y=L(()=>{const K=W.value.trim().toLowerCase();return K?ee.value.filter(X=>(X.label||"").toLowerCase().includes(K)):ee.value});L(()=>{const K=[];if(u.assignedTo){const X=J.value.find(ke=>ke.id===u.assignedTo);K.push({key:"assignedTo",label:`${h("workOrder.filters.assignedTo")}: ${(X==null?void 0:X.name)||u.assignedTo}`})}if(u.dueDate){const X={overdue:h("workOrder.filters.overdue"),today:h("workOrder.filters.today"),thisWeek:h("workOrder.filters.thisWeek"),thisMonth:h("workOrder.filters.thisMonth"),custom:h("workOrder.filters.custom")};K.push({key:"dueDate",label:`${h("workOrder.filters.dueDate")}: ${X[u.dueDate]}`})}if(u.workType){const X=k.value.find(ke=>ke.id===u.workType);K.push({key:"workType",label:`${h("workOrder.table.workType")}: ${(X==null?void 0:X.name)||u.workType}`})}if(u.priority){const X=Z.value.find(ke=>ke.id===u.priority);K.push({key:"priority",label:`${h("workOrder.table.priority")}: ${(X==null?void 0:X.name)||u.priority}`})}if(u.state){const X=ie.value.find(ke=>ke.id===u.state);K.push({key:"state",label:`${h("workOrder.table.state")}: ${(X==null?void 0:X.name)||u.state}`})}if(u.category){const X=G.value.find(ke=>ke.id===u.category);K.push({key:"category",label:`${h("workOrder.table.category")}: ${(X==null?void 0:X.name)||u.category}`})}if(u.search&&K.push({key:"search",label:`${h("workOrder.placeholder.search")}: ${u.search}`}),u.status){const X=le.value.find(ke=>ke.id===u.status);K.push({key:"status",label:`${h("workOrder.filters.status")}: ${(X==null?void 0:X.name)||u.status}`})}if(u.category){const X=G.value.find(ke=>ke.id===u.category);K.push({key:"category",label:`${h("workOrder.filters.category")}: ${(X==null?void 0:X.name)||u.category}`})}if(u.equipment){const X=ue.value.find(ke=>ke.id===u.equipment);K.push({key:"equipment",label:`${h("workOrder.filters.equipment")}: ${(X==null?void 0:X.name)||u.equipment}`})}if(u.location){const X=$.value.find(ke=>ke.id===u.location);K.push({key:"location",label:`${h("workOrder.filters.location")}: ${(X==null?void 0:X.name)||u.location}`})}if(u.recurrence){const X=B.value.find(ke=>ke.id===u.recurrence);K.push({key:"recurrence",label:`${h("workOrder.filters.recurrence")}: ${(X==null?void 0:X.name)||u.recurrence}`})}return K});const _=async()=>{y("update:modelValue",{...u})},te=K=>{switch(K){case"addFilter":g.value=!0;break}},f=()=>{g.value=!1},A=K=>{w.value&&!oe(K)&&U.warning(h("workOrder.filters.noSpace"))},R=async K=>{const X=I[K].visible;if(!X&&w.value){U.warning(h("workOrder.filters.limitReached",{max:T.value}));return}I[K].visible=!X,await j(K)},j=async K=>{await Me(),I[K].visible&&(P[K]=!0,setTimeout(()=>{P[K]=!1},2e3))},oe=K=>{var X;return((X=I[K])==null?void 0:X.visible)||!1};ge(()=>e.modelValue,K=>{Object.assign(u,K)},{deep:!0});const ce={props:e,emit:y,t:h,commonDataStore:c,localFilters:u,drawerVisible:g,screenWidth:S,maxFilters:T,activeFilterCount:b,isFilterLimitReached:w,updateScreenWidth:F,animatingFilters:P,availableFilters:I,assignedToOptions:J,workTypeOptions:k,priorityOptions:Z,stateOptions:ie,categoryOptions:G,statusOptions:le,equipmentOptions:ue,locationOptions:$,recurrenceOptions:B,filterDefinitions:me,basicFilters:ne,advancedFilters:ee,filterSearchTerm:W,filteredBasicFilters:re,filteredAdvancedFilters:Y,handleFilterChange:_,handleCustomizationCommand:te,closeFilterDrawer:f,handleDisabledFilterClick:A,toggleFilterVisibility:R,triggerFilterHighlightAnimation:j,isFilterVisible:oe,__MACROS_defineComponent:be,reactive:et,computed:L,watch:ge,ref:O,nextTick:Me,onMounted:Ue,onUnmounted:pa,get useI18n(){return Be},get ElMessage(){return U},get Search(){return Ft},get Operation(){return wo},get View(){return Nt},get Plus(){return Ca},get Star(){return yo},get Setting(){return ho},get EditPen(){return vo},get Download(){return ga},get Refresh(){return Na},get Grid(){return jr},get useCommonDataStore(){return sr}};return Object.defineProperty(ce,"__isScriptSetup",{enumerable:!1,value:!0}),ce}}),Bo={class:"unified-work-order-filters"},jo={class:"filter-bar"},Ho={class:"filters-row"},Yo={key:0,class:"filter-item"},Jo={key:1,class:"filter-item"},Qo={key:2,class:"filter-item"},Go={key:3,class:"filter-item"},Ko={key:4,class:"filter-item"},Zo={key:5,class:"filter-item"},Xo={key:6,class:"filter-item"},$o={key:7,class:"filter-item"},en={key:8,class:"filter-item"},tn={key:9,class:"filter-item"},an={class:"right-group"},rn={key:0,class:"filter-item search-item"},on={class:"actions-row"},nn={class:"filter-item customization-item"},sn={key:0,class:"custom-date-range"},ln={class:"filter-drawer-content"},dn={class:"drawer-header"},cn={class:"filter-section"},un={class:"section-title"},mn={class:"filter-list"},_n=["onClick"],fn={class:"filter-info"},gn={class:"filter-label"},pn={class:"filter-section"},vn={class:"section-title"},hn={class:"filter-list"},yn=["onClick"],wn={class:"filter-info"},kn={class:"filter-label"};function bn(l,t,d,e,y,h){const c=D("el-option"),u=D("el-select"),g=D("el-icon"),S=D("el-input"),T=D("el-button"),b=D("el-dropdown-item"),w=D("el-dropdown-menu"),F=D("el-dropdown"),P=D("el-date-picker"),I=D("el-checkbox"),J=D("el-drawer");return i(),p("div",Bo,[s(" Filter Bar "),a("div",jo,[s(" Main Filters Row "),a("div",Ho,[s(" Assigned To Filter "),e.isFilterVisible("assignedTo")?(i(),p("div",Yo,[r(u,{modelValue:e.localFilters.assignedTo,"onUpdate:modelValue":t[0]||(t[0]=k=>e.localFilters.assignedTo=k),placeholder:l.$t("workOrder.filters.assignedTo"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.assignedTo}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.assignedToOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Due Date Filter "),e.isFilterVisible("dueDate")?(i(),p("div",Jo,[r(u,{modelValue:e.localFilters.dueDate,"onUpdate:modelValue":t[1]||(t[1]=k=>e.localFilters.dueDate=k),placeholder:l.$t("workOrder.filters.dueDate"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.dueDate}),onChange:e.handleFilterChange},{default:o(()=>[r(c,{label:l.$t("workOrder.filters.overdue"),value:"overdue"},null,8,["label"]),r(c,{label:l.$t("workOrder.filters.today"),value:"today"},null,8,["label"]),r(c,{label:l.$t("workOrder.filters.thisWeek"),value:"thisWeek"},null,8,["label"]),r(c,{label:l.$t("workOrder.filters.thisMonth"),value:"thisMonth"},null,8,["label"]),r(c,{label:l.$t("workOrder.filters.custom"),value:"custom"},null,8,["label"])]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Work Type Filter "),e.isFilterVisible("workType")?(i(),p("div",Qo,[r(u,{modelValue:e.localFilters.workType,"onUpdate:modelValue":t[2]||(t[2]=k=>e.localFilters.workType=k),placeholder:l.$t("workOrder.table.workType"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.workType}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.workTypeOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Priority Filter "),e.isFilterVisible("priority")?(i(),p("div",Go,[r(u,{modelValue:e.localFilters.priority,"onUpdate:modelValue":t[3]||(t[3]=k=>e.localFilters.priority=k),placeholder:l.$t("workOrder.table.priority"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.priority}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.priorityOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" State Filter "),e.isFilterVisible("state")?(i(),p("div",Ko,[r(u,{modelValue:e.localFilters.state,"onUpdate:modelValue":t[4]||(t[4]=k=>e.localFilters.state=k),placeholder:l.$t("workOrder.filters.state"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.status}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.stateOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Status Filter "),e.isFilterVisible("status")?(i(),p("div",Zo,[r(u,{modelValue:e.localFilters.status,"onUpdate:modelValue":t[5]||(t[5]=k=>e.localFilters.status=k),placeholder:l.$t("workOrder.filters.status"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.status}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.statusOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Category Filter "),e.isFilterVisible("category")?(i(),p("div",Xo,[r(u,{modelValue:e.localFilters.category,"onUpdate:modelValue":t[6]||(t[6]=k=>e.localFilters.category=k),placeholder:l.$t("workOrder.filters.category"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.category}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.categoryOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Equipment Filter "),e.isFilterVisible("equipment")?(i(),p("div",$o,[r(u,{modelValue:e.localFilters.equipment,"onUpdate:modelValue":t[7]||(t[7]=k=>e.localFilters.equipment=k),placeholder:l.$t("workOrder.filters.equipment"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.equipment}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.equipmentOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Location Filter "),e.isFilterVisible("location")?(i(),p("div",en,[r(u,{modelValue:e.localFilters.location,"onUpdate:modelValue":t[8]||(t[8]=k=>e.localFilters.location=k),placeholder:l.$t("workOrder.filters.location"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.location}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.locationOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Recurrence Filter "),e.isFilterVisible("recurrence")?(i(),p("div",tn,[r(u,{modelValue:e.localFilters.recurrence,"onUpdate:modelValue":t[9]||(t[9]=k=>e.localFilters.recurrence=k),placeholder:l.$t("workOrder.filters.recurrence"),clearable:"",size:"default",style:{width:"140px"},class:Ae({"highlight-animation":e.animatingFilters.recurrence}),onChange:e.handleFilterChange},{default:o(()=>[(i(!0),p(se,null,fe(e.recurrenceOptions,k=>(i(),N(c,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Right group: Search + Actions "),a("div",an,[s(" Search Input (optional) "),e.isFilterVisible("search")?(i(),p("div",rn,[r(S,{modelValue:e.localFilters.search,"onUpdate:modelValue":t[10]||(t[10]=k=>e.localFilters.search=k),placeholder:l.$t("workOrder.placeholder.search"),style:{width:"200px"},size:"default",clearable:"",class:Ae({"highlight-animation":e.animatingFilters.search}),onKeyup:Ro(e.handleFilterChange,["enter"]),onClear:e.handleFilterChange},{prefix:o(()=>[r(g,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue","placeholder","class"])])):s("v-if",!0),s(" Action Buttons Row "),a("div",on,[r(T,{size:"default",type:"primary",icon:e.EditPen,onClick:t[11]||(t[11]=k=>l.$emit("create"))},{default:o(()=>[V(m(l.$t("workOrder.actions.create")),1)]),_:1},8,["icon"]),r(T,{size:"default",loading:d.exportLoading,type:"success",icon:e.Download,onClick:t[12]||(t[12]=k=>l.$emit("export"))},{default:o(()=>[V(m(l.$t("workOrder.actions.export")),1)]),_:1},8,["loading","icon"]),d.showTodoActions?(i(),N(T,{key:0,size:"default",type:"default",icon:e.Refresh,onClick:t[13]||(t[13]=k=>l.$emit("refresh"))},{default:o(()=>[V(m(l.$t("workOrder.actions.refresh")),1)]),_:1},8,["icon"])):s("v-if",!0)])]),s(" Filter Customization Menu "),a("div",nn,[r(F,{trigger:"click",onCommand:e.handleCustomizationCommand},{dropdown:o(()=>[r(w,null,{default:o(()=>[r(b,{command:"addFilter"},{default:o(()=>[r(g,null,{default:o(()=>[r(e.Setting)]),_:1}),V(" "+m(l.$t("workOrder.filters.filterSetting")),1)]),_:1}),r(b,{divided:"",command:"savePreset"},{default:o(()=>[r(g,null,{default:o(()=>[r(e.Star)]),_:1}),V(" "+m(l.$t("workOrder.filters.savePreset")),1)]),_:1}),r(b,{command:"managePresets"},{default:o(()=>[r(g,null,{default:o(()=>[r(e.Setting)]),_:1}),V(" "+m(l.$t("workOrder.filters.managePresets")),1)]),_:1})]),_:1})]),default:o(()=>[r(T,{type:"text",class:"customization-button"},{default:o(()=>[r(g,null,{default:o(()=>[r(e.Operation)]),_:1})]),_:1})]),_:1})])])]),s(" Custom Date Range Picker (shown when due date filter is 'custom') "),e.localFilters.dueDate==="custom"?(i(),p("div",sn,[r(P,{modelValue:e.localFilters.customDateRange,"onUpdate:modelValue":t[14]||(t[14]=k=>e.localFilters.customDateRange=k),type:"daterange","range-separator":l.$t("common.to"),"start-placeholder":l.$t("common.startDate"),"end-placeholder":l.$t("common.endDate"),onChange:e.handleFilterChange,style:{width:"300px"}},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])])):s("v-if",!0),s(" Filter Drawer "),r(J,{modelValue:e.drawerVisible,"onUpdate:modelValue":t[16]||(t[16]=k=>e.drawerVisible=k),title:l.$t("workOrder.filters.filterDrawerTitle"),direction:"rtl",size:"400px","before-close":e.closeFilterDrawer},{default:o(()=>[a("div",ln,[s(" Drawer Header "),a("div",dn,[r(S,{modelValue:e.filterSearchTerm,"onUpdate:modelValue":t[15]||(t[15]=k=>e.filterSearchTerm=k),placeholder:l.$t("workOrder.filters.searchFiltersPlaceholder"),class:"drawer-search",size:"default",clearable:""},{prefix:o(()=>[r(g,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue","placeholder"])]),s(" Basic Filters Section "),a("div",cn,[a("h4",un,[r(g,null,{default:o(()=>[r(e.Grid)]),_:1}),V(" "+m(l.$t("workOrder.filters.basicFilters")),1)]),a("div",mn,[(i(!0),p(se,null,fe(e.filteredBasicFilters,k=>(i(),p("div",{key:k.key,class:Ae(["filter-item-row",{disabled:e.isFilterLimitReached&&!e.isFilterVisible(k.key)}]),onClick:Z=>e.handleDisabledFilterClick(k.key)},[r(I,{"model-value":e.isFilterVisible(k.key),disabled:e.isFilterLimitReached&&!e.isFilterVisible(k.key),onChange:Z=>e.toggleFilterVisibility(k.key),class:"filter-checkbox"},{default:o(()=>[a("div",fn,[r(g,{class:"filter-icon"},{default:o(()=>[(i(),N(ta(k.icon)))]),_:2},1024),a("span",gn,m(k.label),1)])]),_:2},1032,["model-value","disabled","onChange"])],10,_n))),128))])]),s(" Advanced Filters Section "),a("div",pn,[a("h4",vn,[r(g,null,{default:o(()=>[r(e.Setting)]),_:1}),V(" "+m(l.$t("workOrder.filters.workOrderFilters")),1)]),a("div",hn,[(i(!0),p(se,null,fe(e.filteredAdvancedFilters,k=>(i(),p("div",{key:k.key,class:Ae(["filter-item-row",{disabled:e.isFilterLimitReached&&!e.isFilterVisible(k.key)}]),onClick:Z=>e.handleDisabledFilterClick(k.key)},[r(I,{"model-value":e.isFilterVisible(k.key),disabled:e.isFilterLimitReached&&!e.isFilterVisible(k.key),onChange:Z=>e.toggleFilterVisibility(k.key),class:"filter-checkbox"},{default:o(()=>[a("div",wn,[r(g,{class:"filter-icon"},{default:o(()=>[(i(),N(ta(k.icon)))]),_:2},1024),a("span",kn,m(k.label),1)])]),_:2},1032,["model-value","disabled","onChange"])],10,yn))),128))])])])]),_:1},8,["modelValue","title"])])}const Sn=Re(No,[["render",bn],["__scopeId","data-v-c5c09dca"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/UnifiedWorkOrderFilters.vue"]]),Tn=be({name:"WorkOrderImage"}),On=Object.assign(Tn,{props:{imagePath:{type:Array,default:()=>[]}},setup(l,{expose:t}){t();const d=l,e=L(()=>d.imagePath&&d.imagePath.length>0),y={props:d,hasImage:e,__MACROS_defineComponent:be,computed:L,get IconPicture(){return ea}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),Cn={class:"work-order-image"},Dn={class:"image-slot"},Pn={class:"image-slot"};function An(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-image"),g=D("el-tooltip");return i(),p("div",Cn,[e.hasImage?(i(),N(u,{key:0,style:{width:"50px",height:"50px"},src:d.imagePath[0],"preview-src-list":[d.imagePath[0]],loading:"lazy",alt:l.$t("workOrder.table.preview")},{error:o(()=>[a("div",Dn,[r(c,null,{default:o(()=>[r(e.IconPicture)]),_:1})])]),_:1},8,["src","preview-src-list","alt"])):(i(),N(u,{key:1,style:{width:"50px",height:"50px"}},{error:o(()=>[r(g,null,{content:o(()=>[a("span",null,m(l.$t("workOrder.messages.noImagePlaceholder")),1)]),default:o(()=>[a("div",Pn,[r(c,null,{default:o(()=>[r(e.IconPicture)]),_:1})])]),_:1})]),_:1}))])}const In=Re(On,[["render",An],["__scopeId","data-v-8ceb353e"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkOrderImage.vue"]]);function ja(l){switch(l){case"Urgent":return"#F56C6C";case"High":return"#409EFF";case"Medium":return"#E6A23C";default:return"#909399"}}function Wr(l){switch(l){case"Reactive":return"danger";case"Preventative":return"success";case"Other":return"info";case"Follow up":return"warning";default:return"info"}}function Rr(l){switch(l){case"Inspection":return"primary";case"Mechanical":return"danger";case"Preventative":return"success";case"Safety":return"warning";case"SOP":return"info";case"Electrical":return"success";case"Follow up":return"warning";default:return"info"}}function Lr(l){return l===1?"info":"primary"}const Vn=be({name:"PriorityTag"}),Fn=Object.assign(Vn,{props:{priority:{type:Object,default:()=>({})}},setup(l,{expose:t}){t();const d=l,{t:e}=Be(),y=L(()=>{var S;return(S=d.priority)!=null&&S.name?{Urgent:e("workOrder.priority.urgent"),High:e("workOrder.priority.high"),Medium:e("workOrder.priority.medium"),Low:e("workOrder.priority.low")}[d.priority.name]||d.priority.name:"-"}),h=L(()=>{var g;return ja((g=d.priority)==null?void 0:g.name)}),c=L(()=>{var S,T;const g=(T=(S=d.priority)==null?void 0:S.name)==null?void 0:T.toLowerCase();return{"priority-urgent":g==="urgent","priority-high":g==="high","priority-medium":g==="medium","priority-low":g==="low"}}),u={props:d,t:e,priorityName:y,priorityColor:h,priorityClass:c,__MACROS_defineComponent:be,computed:L,get useI18n(){return Be},get Flag(){return Ha},get getPriorityColor(){return ja}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),xn=["title"];function En(l,t,d,e,y,h){var u;const c=D("el-icon");return i(),p("span",{title:(u=d.priority)==null?void 0:u.description,class:Ae(["priority-tag",e.priorityClass])},[r(c,{style:Tt({color:e.priorityColor,marginRight:"4px"})},{default:o(()=>[r(e.Flag)]),_:1},8,["style"]),V(" "+m(e.priorityName),1)],10,xn)}const Ka=Re(Fn,[["render",En],["__scopeId","data-v-054c2027"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/PriorityTag.vue"]]),Wn=be({name:"WorkTypeTag"}),Rn=Object.assign(Wn,{props:{workType:{type:Object,default:()=>({})}},setup(l,{expose:t}){t();const d=l,{t:e}=Be(),y=L(()=>{var g;return(g=d.workType)!=null&&g.name?{Reactive:e("workOrder.workType.reactive"),Preventative:e("workOrder.workType.preventative"),Other:e("workOrder.workType.other"),"Follow up":e("workOrder.workType.followUp")}[d.workType.name]||d.workType.name:"-"}),h=L(()=>{var u;return Wr((u=d.workType)==null?void 0:u.name)}),c={props:d,t:e,workTypeName:y,tagType:h,__MACROS_defineComponent:be,computed:L,get useI18n(){return Be},get getWorkTypeTagType(){return Wr}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function Ln(l,t,d,e,y,h){var u;const c=D("el-tag");return i(),N(c,{type:e.tagType,title:(u=d.workType)==null?void 0:u.description,effect:"light"},{default:o(()=>[V(m(e.workTypeName),1)]),_:1},8,["type","title"])}const no=Re(Rn,[["render",Ln],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkTypeTag.vue"]]),Mn=be({name:"CategoryTag"}),qn=Object.assign(Mn,{props:{category:{type:Object,default:()=>({})}},setup(l,{expose:t}){t();const d=l,e=L(()=>{var c;return((c=d.category)==null?void 0:c.name)||"-"}),y=L(()=>{var c;return Rr((c=d.category)==null?void 0:c.name)}),h={props:d,categoryName:e,tagType:y,__MACROS_defineComponent:be,computed:L,get getCategoryTagType(){return Rr}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}});function Un(l,t,d,e,y,h){var u;const c=D("el-tag");return i(),N(c,{type:e.tagType,title:((u=d.category)==null?void 0:u.description)||l.$t("workOrder.messages.noData"),effect:"plain"},{default:o(()=>[V(m(e.categoryName),1)]),_:1},8,["type","title"])}const Za=Re(qn,[["render",Un],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/CategoryTag.vue"]]),zn=be({name:"RecurrenceTag"}),Nn=Object.assign(zn,{props:{recurrenceType:{type:Object,default:()=>({})}},setup(l,{expose:t}){t();const d=l,{t:e}=Be(),y=L(()=>{var g;return(g=d.recurrenceType)!=null&&g.name?{"Does not repeat":e("workOrder.recurrence.none"),Daily:e("workOrder.recurrence.daily"),Weekly:e("workOrder.recurrence.weekly"),Monthly:e("workOrder.recurrence.monthlyByDate"),Yearly:e("workOrder.recurrence.yearly")}[d.recurrenceType.name]||d.recurrenceType.name:"-"}),h=L(()=>{var u;return Lr((u=d.recurrenceType)==null?void 0:u.id)}),c={props:d,t:e,recurrenceName:y,tagType:h,__MACROS_defineComponent:be,computed:L,get useI18n(){return Be},get getRecurrenceTagType(){return Lr}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function Bn(l,t,d,e,y,h){var u;const c=D("el-tag");return i(),N(c,{type:e.tagType,title:((u=d.recurrenceType)==null?void 0:u.description)||l.$t("workOrder.recurrence.none"),effect:"dark"},{default:o(()=>[V(m(e.recurrenceName),1)]),_:1},8,["type","title"])}const jn=Re(Nn,[["render",Bn],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/RecurrenceTag.vue"]]),Hn=be({name:"StatusTag"}),Yn=Object.assign(Hn,{props:{status:{type:Object,default:()=>({})}},setup(l,{expose:t}){t();const d=l,{t:e}=Be(),y=L(()=>{var g;return(g=d.status)!=null&&g.name?{Failed:e("workOrder.status.failed"),Completed:e("workOrder.status.completed"),"In Progress":e("workOrder.status.inProgress"),Pending:e("workOrder.status.pending")}[d.status.name]||d.status.name:"-"}),h=L(()=>{var g;switch((g=d.status)==null?void 0:g.name){case"Failed":return"danger";case"Completed":return"success";case"In Progress":return"warning";default:return"info"}}),c={props:d,t:e,statusName:y,tagType:h,__MACROS_defineComponent:be,computed:L,get useI18n(){return Be}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function Jn(l,t,d,e,y,h){const c=D("el-tag");return i(),N(c,{type:e.tagType,effect:"dark",round:""},{default:o(()=>[V(m(e.statusName),1)]),_:1},8,["type"])}const so=Re(Yn,[["render",Jn],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/StatusTag.vue"]]),Qn=be({name:"WorkOrderActions"}),Gn=Object.assign(Qn,{props:{row:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["view","edit","delete"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,{t:h}=Be(),{confirmAction:c}=va(),u=O(!1),S={props:e,emit:y,t:h,confirmAction:c,deleteLoading:u,handleDelete:async()=>{if(await c({title:h("common.confirm"),message:h("common.deleteConfirmMessage",{name:e.row.name}),confirmButtonText:h("workOrder.actions.delete"),cancelButtonText:h("workOrder.actions.cancel"),type:"warning"})){u.value=!0;try{y("delete")}finally{u.value=!1}}},__MACROS_defineComponent:be,ref:O,get useI18n(){return Be},get useErrorHandler(){return va}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),Kn={class:"work-order-actions"};function Zn(l,t,d,e,y,h){const c=D("el-button");return i(),p("div",Kn,[r(c,{type:"info",size:"small",onClick:t[0]||(t[0]=u=>l.$emit("view")),"aria-label":l.$t("workOrder.actions.view")},{default:o(()=>[V(m(l.$t("workOrder.actions.view")),1)]),_:1},8,["aria-label"]),r(c,{type:"primary",size:"small",onClick:t[1]||(t[1]=u=>l.$emit("edit")),"aria-label":l.$t("workOrder.actions.edit")},{default:o(()=>[V(m(l.$t("workOrder.actions.edit")),1)]),_:1},8,["aria-label"]),d.row.status!=="deleted"?(i(),N(c,{key:0,size:"small",type:"danger",onClick:e.handleDelete,"aria-label":l.$t("workOrder.actions.delete"),loading:e.deleteLoading},{default:o(()=>[V(m(l.$t("workOrder.actions.delete")),1)]),_:1},8,["aria-label","loading"])):s("v-if",!0)])}const Xn=Re(Gn,[["render",Zn],["__scopeId","data-v-398abfbc"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkOrderActions.vue"]]),$n=be({name:"WorkOrderTable"}),es=Object.assign($n,{props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},expandedRows:{type:Set,default:()=>new Set},loadChildren:{type:Function,required:!0},recurrenceViewMode:{type:Boolean,default:!1}},emits:["expand-change","view","edit","delete","view-recurrence"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=O(300),c=O(null),u=({row:G})=>e.expandedRows.has(G.id)?"expanded-highlight":"";let g=null,S=null,T=null,b=null;const w=G=>G&&G.offsetHeight||0,F=()=>{try{let G=window.innerHeight;const le=document.querySelector(".main-container .fixed-header .navbar"),ue=document.querySelector(".main-container .fixed-header .tags-view-wrapper .el-scrollbar__view"),$=c.value?c.value.closest(".mes-layout"):null,B=$?$.querySelector(":scope > .header"):null,me=$?$.querySelector(":scope > .footer"):null;G-=w(le),G-=w(ue),G-=w(B),G-=w(me),G-=20,h.value=Math.max(G,160)}catch{h.value=Math.max(window.innerHeight-320,160)}},P=()=>{F()},I=(G,le)=>{y("expand-change",G,le)},J=G=>G?lt(G):"-",k=G=>G&&new Date(G)<new Date,Z=G=>{var le;e.recurrenceViewMode||!G.recurrence_uuid||((le=G.recurrence_type)==null?void 0:le.id)===1||y("view-recurrence",G.recurrence_uuid)};Ue(async()=>{if(await Me(),F(),window.addEventListener("resize",P),"ResizeObserver"in window){const G=c.value?c.value.closest(".mes-layout"):null,le=document.querySelector(".main-container .fixed-header .navbar"),ue=document.querySelector(".main-container .fixed-header .tags-view-wrapper .el-scrollbar__view"),$=G?G.querySelector(":scope > .header"):null,B=G?G.querySelector(":scope > .footer"):null,me=()=>new ResizeObserver(()=>F());le&&(g=me(),g.observe(le)),ue&&(S=me(),S.observe(ue)),$&&(T=me(),T.observe($)),B&&(b=me(),b.observe(B))}}),Ot(()=>{window.removeEventListener("resize",P),g&&g.disconnect(),S&&S.disconnect(),T&&T.disconnect(),b&&b.disconnect()});const ie={props:e,emit:y,tableHeight:h,rootEl:c,getRowClass:u,get roNavbar(){return g},set roNavbar(G){g=G},get roTagsView(){return S},set roTagsView(G){S=G},get roHeader(){return T},set roHeader(G){T=G},get roFooter(){return b},set roFooter(G){b=G},safeOffsetHeight:w,calcTableHeight:F,updateTableHeight:P,onExpandChange:I,formatDateTime:J,isOverdue:k,handleRecurrenceClick:Z,__MACROS_defineComponent:be,ref:O,onMounted:Ue,onBeforeUnmount:Ot,nextTick:Me,get convertToLocalTime(){return lt},WorkOrderImage:In,PriorityTag:Ka,WorkTypeTag:no,CategoryTag:Za,RecurrenceTag:jn,StatusTag:so,WorkOrderActions:Xn};return Object.defineProperty(ie,"__isScriptSetup",{enumerable:!1,value:!0}),ie}}),ts={class:"work-order-table",ref:"rootEl"},as={style:{color:"black"}},rs={style:{color:"grey"}},os=["onClick"],ns=["title"];function ss(l,t,d,e,y,h){const c=D("el-table-column"),u=D("el-table"),g=aa("loading");return i(),p("div",ts,[Ct((i(),N(u,{data:d.data,border:"",fit:"","highlight-current-row":"",height:e.tableHeight,style:{width:"100%"},"row-key":"id","tree-props":{children:"children"},lazy:!0,load:d.loadChildren,onExpandChange:e.onExpandChange,"row-class-name":e.getRowClass},{default:o(()=>[s(" Work Order Name "),r(c,{label:l.$t("workOrder.table.name"),prop:"name",align:"left",width:"300",fixed:"left"},{default:o(({row:S})=>[a("span",as,m(S.name),1)]),_:1},8,["label"]),s(" ID Column "),r(c,{label:l.$t("workOrder.table.id"),prop:"id",align:"center",width:"120"},{default:o(({row:S})=>[a("span",rs,"#"+m(S.id),1)]),_:1},8,["label"]),s(" Work Order Code "),r(c,{label:l.$t("workOrder.table.code"),prop:"code",align:"center",width:"250"},null,8,["label"]),s(" Due Date (With Highlighting If Overdue) "),r(c,{label:l.$t("workOrder.table.dueDate"),prop:"due_date",align:"center",width:"180"},{default:o(({row:S})=>[a("span",{style:Tt({color:e.isOverdue(S.due_date)?"var(--el-color-danger)":""})},m(e.formatDateTime(S.due_date)),5)]),_:1},8,["label"]),s(" Work Order Image "),r(c,{label:l.$t("workOrder.table.preview"),align:"center",width:"150"},{default:o(({row:S})=>[r(e.WorkOrderImage,{"image-path":S.image_list},null,8,["image-path"])]),_:1},8,["label"]),s(" Priority "),r(c,{label:l.$t("workOrder.table.priority"),prop:"priority.name",align:"center",width:"120"},{default:o(({row:S})=>[r(e.PriorityTag,{priority:S.priority},null,8,["priority"])]),_:1},8,["label"]),s(" Maintenance Type "),r(c,{label:l.$t("workOrder.table.workType"),prop:"work_type.name",align:"center",width:"150"},{default:o(({row:S})=>[r(e.WorkTypeTag,{"work-type":S.work_type},null,8,["work-type"])]),_:1},8,["label"]),s(" Category "),r(c,{label:l.$t("workOrder.table.category"),prop:"category.name",align:"center",width:"150"},{default:o(({row:S})=>[r(e.CategoryTag,{category:S.category},null,8,["category"])]),_:1},8,["label"]),s(" Recurrence Type "),r(c,{label:l.$t("workOrder.table.recurrenceType"),prop:"recurrence_type.name",align:"center",width:"150"},{default:o(({row:S})=>{var T;return[a("div",{class:Ae({"recurrence-clickable":!d.recurrenceViewMode&&S.recurrence_uuid&&((T=S.recurrence_type)==null?void 0:T.id)!==1}),onClick:b=>e.handleRecurrenceClick(S)},[r(e.RecurrenceTag,{"recurrence-type":S.recurrence_type},null,8,["recurrence-type"])],10,os)]}),_:1},8,["label"]),s(" Estimated Time "),r(c,{label:l.$t("workOrder.table.estimatedTime"),prop:"estimated_minutes",align:"center",width:"150"},{default:o(({row:S})=>[V(m(S.estimated_minutes!=null?S.estimated_minutes:"-"),1)]),_:1},8,["label"]),s(" Start Date "),r(c,{label:l.$t("workOrder.table.startDate"),prop:"start_date",align:"center",width:"200"},{default:o(({row:S})=>[V(m(e.formatDateTime(S.start_date)),1)]),_:1},8,["label"]),s(" Finished Date "),r(c,{label:l.$t("workOrder.table.finishedDate"),prop:"finished_at",align:"center",width:"200"},{default:o(({row:S})=>[V(m(S.finished_at?e.formatDateTime(S.finished_at):"-"),1)]),_:1},8,["label"]),s(" Approved At "),r(c,{label:l.$t("workOrder.table.approvedDate"),prop:"approved_at",align:"center",width:"200"},{default:o(({row:S})=>[V(m(S.approved_at?e.formatDateTime(S.approved_at):"-"),1)]),_:1},8,["label"]),s(" State "),r(c,{label:l.$t("workOrder.table.state"),prop:"state.name",align:"center",width:"150"},{default:o(({row:S})=>[r(e.StatusTag,{status:S.state},null,8,["status"])]),_:1},8,["label"]),s(" Created By "),r(c,{label:l.$t("workOrder.table.createdBy"),prop:"created_by",align:"center",width:"150"},null,8,["label"]),s(" Approved By "),r(c,{label:l.$t("workOrder.table.approvedBy"),prop:"approved_by_id",align:"center",width:"150"},{default:o(({row:S})=>[V(m(S.approved_by_id!=null?S.approved_by_id:"-"),1)]),_:1},8,["label"]),s(" Description "),r(c,{label:l.$t("workOrder.table.description"),prop:"description",align:"left","min-width":"200"},{default:o(({row:S})=>[a("span",{title:S.description},m(S.description||"-"),9,ns)]),_:1},8,["label"]),s(" Actions "),r(c,{label:l.$t("workOrder.table.actions"),align:"center",width:"250","class-name":"small-padding fixed-width action-column",fixed:"right"},{default:o(({row:S,$index:T})=>[r(e.WorkOrderActions,{row:S,index:T,onView:b=>l.$emit("view",S),onEdit:b=>l.$emit("edit",S),onDelete:b=>l.$emit("delete",S,T)},null,8,["row","index","onView","onEdit","onDelete"])]),_:1},8,["label"])]),_:1},8,["data","height","load"])),[[g,d.loading]])],512)}const ls=Re(es,[["render",ss],["__scopeId","data-v-b5dc7ccb"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkOrderTable.vue"]]),is={__name:"StartWorkOrderAction",props:{workOrder:{type:Object,required:!0},disabled:{type:Boolean,default:!1},label:{type:String,default:"Start Work Order"}},emits:["start"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,c={props:e,emit:y,handleClick:()=>{e.disabled||y("start",e.workOrder)},get VideoPlay(){return ko}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}};function ds(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-dropdown-item");return i(),N(u,{disabled:d.disabled,class:"start-work-order-action",onClick:e.handleClick},{default:o(()=>[r(c,{class:"action-icon"},{default:o(()=>[r(e.VideoPlay)]),_:1}),a("span",null,m(d.label),1)]),_:1},8,["disabled"])}const lo=Re(is,[["render",ds],["__scopeId","data-v-8a3e47a8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/StartWorkOrderAction.vue"]]),cs=be({name:"WorkOrderCard"}),us=Object.assign(cs,{props:{workOrder:{type:Object,required:!0},isSelected:{type:Boolean,default:!1}},emits:["select","action"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,{t:h}=Be(),c=L(()=>e.workOrder.due_date&&new Date(e.workOrder.due_date)<new Date),u=L(()=>{var I,J;return((I=e.workOrder.priority)==null?void 0:I.name)==="High"||((J=e.workOrder.priority)==null?void 0:J.name)==="Urgent"}),P={props:e,emit:y,t:h,isOverdue:c,isHighPriority:u,formatDate:I=>lt(I),getStatusTagType:I=>{switch(I){case"Failed":return"danger";case"Completed":return"success";case"In Progress":return"warning";default:return"info"}},getStatusName:I=>({Failed:h("workOrder.status.failed"),Completed:h("workOrder.status.completed"),"In Progress":h("workOrder.status.inProgress"),Pending:h("workOrder.status.pending")})[I]||I,getPriorityTagType:I=>{switch(I){case"Urgent":return"danger";case"High":return"warning";case"Medium":return"primary";case"Low":return"info";default:return"info"}},getPriorityName:I=>({Urgent:h("workOrder.priority.urgent"),High:h("workOrder.priority.high"),Medium:h("workOrder.priority.medium"),Low:h("workOrder.priority.low")})[I]||I,handleAction:I=>{y("action",{action:I,workOrder:e.workOrder})},__MACROS_defineComponent:be,computed:L,get useI18n(){return Be},get MoreFilled(){return Hr},get Edit(){return Ya},get View(){return Nt},get Delete(){return Da},get Flag(){return Ha},get Picture(){return ea},StartWorkOrderAction:lo,get convertToLocalTime(){return lt}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),ms={class:"card-header"},_s={class:"card-id"},fs={class:"card-actions"},gs={class:"card-content"},ps={class:"content-main"},vs=["title"],hs={class:"card-meta"},ys={class:"meta-label"},ws={class:"meta-value"},ks={key:0,class:"card-meta"},bs={class:"meta-label"},Ss={class:"card-badges"},Ts={key:0,class:"card-thumbnail-circle"},Os={class:"image-slot-circle"};function Cs(l,t,d,e,y,h){var F,P;const c=D("el-icon"),u=D("el-button"),g=D("el-dropdown-item"),S=D("el-dropdown-menu"),T=D("el-dropdown"),b=D("el-tag"),w=D("el-image");return i(),p("div",{class:Ae(["work-order-card",{selected:d.isSelected,overdue:e.isOverdue,"high-priority":e.isHighPriority}]),onClick:t[1]||(t[1]=I=>l.$emit("select",d.workOrder))},[s(" Card Header "),a("div",ms,[a("div",_s,"#"+m(d.workOrder.id),1),a("div",fs,[r(T,{trigger:"click",onCommand:e.handleAction},{dropdown:o(()=>[r(S,null,{default:o(()=>[r(g,{command:"edit"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Edit)]),_:1}),V(" "+m(l.$t("workOrder.actions.edit")),1)]),_:1}),r(g,{command:"view"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.View)]),_:1}),V(" "+m(l.$t("workOrder.actions.view")),1)]),_:1}),r(e.StartWorkOrderAction,{"work-order":d.workOrder,onStart:t[0]||(t[0]=()=>e.emit("action",{action:"start",workOrder:d.workOrder}))},null,8,["work-order"]),r(g,{command:"delete",divided:""},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Delete)]),_:1}),V(" "+m(l.$t("workOrder.actions.delete")),1)]),_:1})]),_:1})]),default:o(()=>[r(u,{type:"text",size:"small",class:"action-button"},{default:o(()=>[r(c,{class:"rotated-icon"},{default:o(()=>[r(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),s(" Card Content "),a("div",gs,[s(" Main Content Area "),a("div",ps,[s(" Work Order Title "),a("h4",{class:"card-title",title:d.workOrder.name},m(d.workOrder.name),9,vs),s(" Requested By "),a("div",hs,[a("span",ys,m(l.$t("workOrder.form.createdBy"))+":",1),a("span",ws,m(d.workOrder.created_by||"N/A"),1)]),s(" Due Date "),d.workOrder.due_date?(i(),p("div",ks,[a("span",bs,m(l.$t("workOrder.table.dueDate"))+":",1),a("span",{class:Ae(["meta-value",{"overdue-text":e.isOverdue}])},m(e.formatDate(d.workOrder.due_date)),3)])):s("v-if",!0),s(" Status and Priority Badges "),a("div",Ss,[r(b,{type:e.getStatusTagType((F=d.workOrder.state)==null?void 0:F.name),size:"small",effect:"plain"},{default:o(()=>{var I;return[V(m(e.getStatusName((I=d.workOrder.state)==null?void 0:I.name)),1)]}),_:1},8,["type"]),r(b,{type:e.getPriorityTagType((P=d.workOrder.priority)==null?void 0:P.name),size:"small",effect:"plain"},{default:o(()=>{var I;return[r(c,{style:{"margin-right":"4px"}},{default:o(()=>[r(e.Flag)]),_:1}),V(" "+m(e.getPriorityName((I=d.workOrder.priority)==null?void 0:I.name)),1)]}),_:1},8,["type"]),e.isOverdue?(i(),N(b,{key:0,type:"danger",size:"small",effect:"dark"},{default:o(()=>[V(m(l.$t("workOrder.status.overdue")),1)]),_:1})):s("v-if",!0)])]),s(" Circular Thumbnail on Right "),d.workOrder.image_list&&d.workOrder.image_list.length?(i(),p("div",Ts,[r(w,{src:d.workOrder.image_list[0],fit:"cover","preview-src-list":d.workOrder.image_list,class:"circular-image","z-index":2e3,"preview-teleported":""},{error:o(()=>[a("div",Os,[r(c,null,{default:o(()=>[r(e.Picture)]),_:1})])]),_:1},8,["src","preview-src-list"])])):s("v-if",!0)])],2)}const Ds=Re(us,[["render",Cs],["__scopeId","data-v-d4cc0b50"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderCard.vue"]]);function io(l,t,d,e){const y=[l],h=new Blob(y,{type:d||"application/octet-stream"}),c=window.URL.createObjectURL(h),u=document.createElement("a");u.style.display="none",u.href=c,u.setAttribute("download",t),typeof u.download>"u"&&u.setAttribute("target","_blank"),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(c)}function co(l,t={}){const{includeHeaders:d=!0,dateFormat:e="YYYY-MM-DD HH:mm:ss"}=t;if(!Array.isArray(l)||l.length===0)return[];const y=["Work Order ID","Title","Description","Status","Priority","Category","Start Date/Time","Due Date","Task Count","Duration","Assignees","Is Overdue","Is Current"],h=[];return d&&h.push(y),l.forEach(c=>{var g,S;const u=[c.id||"-",c.title||"-",c.description||"-",c.status||"-",((g=c.priority)==null?void 0:g.name)||c.priority||"-",((S=c.category)==null?void 0:S.name)||c.category||"-",c.timestamp||"-",c.dueDate||"-",c.taskCount!==void 0?c.taskCount:"-",c.duration||"-",c.assignees?c.assignees.map(T=>T.name).join(", "):"-",c.isOverdue?"Yes":"No",c.isCurrent?"Yes":"No"];h.push(u)}),h}function Ps(l,t="timeline-export",d={}){try{const e=co(l,d);if(e.length===0)throw new Error("No data to export");const c="\uFEFF"+e.map(u=>u.map(g=>`"${String(g).replace(/"/g,'""')}"`).join(",")).join(`
`);return io(c,`${t}.csv`,"text/csv;charset=utf-8"),{success:!0,message:"Timeline exported to CSV successfully",recordCount:e.length-1}}catch(e){return console.error("CSV Export Error:",e),{success:!1,message:`Failed to export CSV: ${e.message}`,error:e}}}function As(l,t="timeline-export",d={}){try{const{sheetName:e="Timeline Data",includeMetadata:y=!0}=d,h=co(l,d);if(h.length===0)throw new Error("No data to export");const c=Vt.book_new(),u=Vt.aoa_to_sheet(h),g=[{wch:12},{wch:25},{wch:30},{wch:12},{wch:10},{wch:15},{wch:20},{wch:20},{wch:12},{wch:10},{wch:20},{wch:12},{wch:12}];u["!cols"]=g;const S=Vt.decode_range(u["!ref"]);for(let w=S.s.c;w<=S.e.c;w++){const F=Vt.encode_cell({r:0,c:w});u[F]&&(u[F].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{bgColor:{indexed:64},fgColor:{rgb:"366092"}},alignment:{horizontal:"center",vertical:"center"}})}if(Vt.book_append_sheet(c,u,e),y){const w=[["Export Information"],["Generated At",new Date().toLocaleString()],["Total Records",h.length-1],["File Format","Excel (.xlsx)"],[""],["Column Descriptions"],["Work Order ID","Unique identifier for the work order"],["Title","Work order title/name"],["Description","Work order description"],["Status","Current status of the work order"],["Priority","Priority level assigned to the work order"],["Category","Work order category/type"],["Start Date/Time","When the work order was started"],["Due Date","When the work order is due"],["Task Count","Number of tasks in the work order"],["Duration","Time taken to complete (if completed)"],["Assignees","Personnel assigned to the work order"],["Is Overdue","Whether the work order is overdue"],["Is Current","Whether this is the current work order being viewed"]],F=Vt.aoa_to_sheet(w);Vt.book_append_sheet(c,F,"Export Info")}const T=Mo(c,{bookType:"xlsx",type:"array"}),b=new Blob([T],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return qo.saveAs(b,`${t}.xlsx`),{success:!0,message:"Timeline exported to Excel successfully",recordCount:h.length-1}}catch(e){return console.error("Excel Export Error:",e),{success:!1,message:`Failed to export Excel: ${e.message}`,error:e}}}function Is(l,t="timeline-export",d={}){try{const{includeMetadata:e=!0,prettyPrint:y=!0}=d;if(!Array.isArray(l)||l.length===0)throw new Error("No data to export");const h={exportInfo:e?{generatedAt:new Date().toISOString(),totalRecords:l.length,fileFormat:"JSON"}:void 0,timelineEvents:l};e||delete h.exportInfo;const c=y?JSON.stringify(h,null,2):JSON.stringify(h);return io(c,`${t}.json`,"application/json;charset=utf-8"),{success:!0,message:"Timeline exported to JSON successfully",recordCount:l.length}}catch(e){return console.error("JSON Export Error:",e),{success:!1,message:`Failed to export JSON: ${e.message}`,error:e}}}function Mr(l,t="excel",d="timeline-export",e={}){switch(e.currentWorkOrderId&&(l=l.map(y=>({...y,isCurrent:String(y.id)===String(e.currentWorkOrderId)}))),t.toLowerCase()){case"csv":return Ps(l,d,e);case"excel":case"xlsx":return As(l,d,e);case"json":return Is(l,d,e);default:return{success:!1,message:`Unsupported export format: ${t}. Supported formats: csv, excel, json`}}}function qr(l="timeline-export",t="excel"){const d=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);return`${l}-${d}`}const Oa=l=>Eo.request({method:"get",url:`/task/entry/${l}`}),Vs=be({name:"Timeline"}),Fs=Object.assign(Vs,{props:{timelineEvents:{type:Array,default:()=>[]},currentWorkOrderId:{type:[String,Number],default:null}},setup(l,{expose:t}){t();const d=l,e=O({dateRange:null}),y=L(()=>{if(!e.value.dateRange)return d.timelineEvents;const[P,I]=e.value.dateRange;return d.timelineEvents.filter(J=>{const k=new Date(J.timestamp);return k>=P&&k<=I})}),h=L(()=>{const P=y.value.filter(ie=>ie.status==="Completed"&&ie.duration);if(P.length===0)return"0h 0m";const I=P.reduce((ie,G)=>{var B,me;const le=G.duration,ue=parseInt(((B=le.match(/(\d+)h/))==null?void 0:B[1])||"0"),$=parseInt(((me=le.match(/(\d+)m/))==null?void 0:me[1])||"0");return ie+ue*60+$},0),J=Math.round(I/P.length),k=Math.floor(J/60),Z=J%60;return`${k}h ${Z}m`}),F={props:d,timelineFilter:e,filteredTimelineEvents:y,averageTimeConsumed:h,getStatusTagType:P=>({Completed:"success","In Progress":"primary",Pending:"info"})[P]||"info",isEventOverdue:P=>!P.plannedEnd||!P.actualEnd?!1:new Date(P.actualEnd)>new Date(P.plannedEnd),formatDateTime:P=>P?lt(P):"-",getCategoryName:P=>P?typeof P=="string"?P:P.name?P.name:P.id?`Category ${P.id}`:"-":"-",getPriorityName:P=>P?typeof P=="string"?P:P.name?P.name:P.id?`Priority ${P.id}`:"-":"-",getPriorityClass:P=>{var J;const I=(J=P==null?void 0:P.name)==null?void 0:J.toLowerCase();return{"priority-urgent":I==="urgent","priority-high":I==="high","priority-medium":I==="medium","priority-low":I==="low"}},isCurrentWorkOrder:P=>d.currentWorkOrderId&&P.id&&String(P.id)===String(d.currentWorkOrderId),__MACROS_defineComponent:be,ref:O,computed:L,get ElMessage(){return U},get Flag(){return Ha},get convertToLocalTime(){return lt},get getPriorityColor(){return ja}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),xs={class:"timeline-content"},Es={class:"timeline-stats-bar"},Ws={class:"filter-controls"},Rs={class:"date-range-filter"},Ls={class:"filter-label"},Ms={class:"metrics-group"},qs={class:"metric-item"},Us={class:"metric-value"},zs={class:"metric-label"},Ns={class:"metric-item"},Bs={class:"metric-value"},js={class:"metric-label"},Hs={class:"timeline-body"},Ys={class:"event-header"},Js={class:"title-section"},Qs={class:"event-title"},Gs={class:"event-badges"},Ks={class:"event-description"},Zs={class:"event-details"},Xs={class:"detail-column"},$s={key:0,class:"detail-item"},el={class:"detail-label"},tl={key:1,class:"detail-item"},al={class:"detail-label"},rl={class:"detail-value"},ol={key:2,class:"detail-item"},nl={class:"detail-label"},sl={class:"assignees-list"},ll={key:0,class:"overflow-indicator"},il={class:"detail-column"},dl={key:0,class:"detail-item"},cl={class:"detail-label"},ul={key:1,class:"detail-item"},ml={class:"detail-label"},_l={class:"detail-value"};function fl(l,t,d,e,y,h){const c=D("el-date-picker"),u=D("el-tag"),g=D("el-avatar"),S=D("el-icon"),T=D("el-timeline-item"),b=D("el-timeline");return i(),p("div",xs,[s(" Stats Bar Header "),a("div",Es,[a("div",Ws,[a("div",Rs,[a("label",Ls,m(l.$t("workOrder.timeline.timeRange")),1),r(c,{modelValue:e.timelineFilter.dateRange,"onUpdate:modelValue":t[0]||(t[0]=w=>e.timelineFilter.dateRange=w),type:"daterange","range-separator":l.$t("workOrder.timeline.to"),"start-placeholder":l.$t("workOrder.timeline.startDate"),"end-placeholder":l.$t("workOrder.timeline.endDate"),size:"small",class:"date-range-picker"},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])])]),a("div",Ms,[a("div",qs,[a("span",Us,m(e.filteredTimelineEvents.length),1),a("span",zs,m(l.$t("workOrder.timeline.totalEvents")),1)]),a("div",Ns,[a("span",Bs,m(e.averageTimeConsumed),1),a("span",js,m(l.$t("workOrder.timeline.avgTimeConsumed")),1)])])]),s(" Timeline Body "),a("div",Hs,[r(b,{class:"work-order-timeline"},{default:o(()=>[(i(!0),p(se,null,fe(e.filteredTimelineEvents,w=>(i(),N(T,{key:w.id,timestamp:w.timestamp,type:e.isCurrentWorkOrder(w)?"success":w.type,color:e.isCurrentWorkOrder(w)?"var(--el-color-success)":w.color,icon:w.icon,placement:"top",hollow:w.hollow,size:"large",class:Ae({"current-work-order":e.isCurrentWorkOrder(w)})},{default:o(()=>{var F,P;return[a("div",{class:Ae(["event-card",{"current-work-order-card":e.isCurrentWorkOrder(w)}])},[a("div",Ys,[a("div",Js,[a("h5",Qs,m(w.title),1),e.isCurrentWorkOrder(w)?(i(),N(u,{key:0,type:"success",size:"small",class:"current-badge",plain:""},{default:o(()=>[V(m(l.$t("workOrder.timeline.current")),1)]),_:1})):s("v-if",!0)]),a("div",Gs,[r(u,{type:e.getStatusTagType(w.status),size:"small"},{default:o(()=>[V(m(w.status),1)]),_:2},1032,["type"]),w.taskCount!==void 0?(i(),N(u,{key:0,type:"success",size:"small"},{default:o(()=>[V(m(w.taskCount)+" "+m(l.$t("workOrder.timeline.tasks")),1)]),_:2},1024)):s("v-if",!0),e.isEventOverdue(w)?(i(),N(u,{key:1,type:"danger",size:"small",class:"overdue-badge"},{default:o(()=>[V(m(l.$t("workOrder.timeline.overdue")),1)]),_:1})):s("v-if",!0)])]),a("p",Ks,m(w.description),1),a("div",Zs,[a("div",Xs,[w.dueDate?(i(),p("div",$s,[a("span",el,m(l.$t("workOrder.table.dueDate"))+":",1),a("span",{class:Ae(["detail-value",{"overdue-text":w.isOverdue}])},m(e.formatDateTime(w.dueDate)),3)])):s("v-if",!0),w.category?(i(),p("div",tl,[a("span",al,m(l.$t("workOrder.table.category"))+":",1),a("span",rl,m(e.getCategoryName(w.category)),1)])):s("v-if",!0),w.assignees&&w.assignees.length>0?(i(),p("div",ol,[a("span",nl,m(l.$t("workOrder.timeline.assignees"))+":",1),a("div",sl,[(i(!0),p(se,null,fe(w.assignees.slice(0,2),I=>(i(),N(g,{key:I.id,size:24,src:I.avatar,class:"assignee-avatar"},{default:o(()=>[V(m(I.name?I.name.charAt(0).toUpperCase():"?"),1)]),_:2},1032,["src"]))),128)),w.assignees.length>2?(i(),p("span",ll," +"+m(w.assignees.length-2),1)):s("v-if",!0)])])):s("v-if",!0)]),a("div",il,[w.priority?(i(),p("div",dl,[a("span",cl,m(l.$t("workOrder.table.priority"))+":",1),a("span",{class:Ae(["detail-value priority-tag",e.getPriorityClass(w.priority)]),style:Tt({color:e.getPriorityColor((F=w.priority)==null?void 0:F.name)})},[r(S,{style:Tt({color:e.getPriorityColor((P=w.priority)==null?void 0:P.name),marginRight:"4px"})},{default:o(()=>[r(e.Flag)]),_:2},1032,["style"]),V(" "+m(e.getPriorityName(w.priority)),1)],6)])):s("v-if",!0),w.duration?(i(),p("div",ul,[a("span",ml,m(l.$t("workOrder.timeline.duration"))+":",1),a("span",_l,m(w.duration),1)])):s("v-if",!0)])])],2)]}),_:2},1032,["timestamp","type","color","icon","hollow","class"]))),128))]),_:1})])])}const gl=Re(Fs,[["render",fl],["__scopeId","data-v-1739646d"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Timeline/Timeline.vue"]]),pl=be({name:"WorkOrderTaskCard"}),vl=Object.assign(pl,{props:{task:{type:Object,required:!0}},emits:["preview"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=L(()=>{const w=e.task;if(w&&typeof w=="object"){if(typeof w.name=="string"&&w.name.trim())return w.name;if(typeof w.task_name=="string"&&w.task_name.trim())return w.task_name;if(typeof w.label=="string"&&w.label.trim())return w.label;if(typeof w.taskListText=="string"&&w.taskListText.trim())return w.taskListText;if(typeof w.task_list_text=="string"&&w.task_list_text.trim())return w.task_list_text;if(typeof w.id=="string"&&w.id.trim())return w.id;if(typeof w.id=="number")return String(w.id)}return typeof w=="string"||typeof w=="number"?String(w):"Task"}),c=L(()=>{var w;return((w=e.task)==null?void 0:w.total_steps)||0}),u=L(()=>{var F;const w=(F=e.task)==null?void 0:F.category;return w?typeof w=="object"?w.name:w:""}),g=L(()=>{var F;const w=(F=e.task)==null?void 0:F.equipment_node;return w?typeof w=="object"?w.name:w:""}),S=L(()=>{const w=e.task;return w!=null&&w.time_estimate_sec?`${Math.round(w.time_estimate_sec/60)} min`:w!=null&&w.estimated_minutes?`${w.estimated_minutes} min`:""}),b={props:e,emit:y,taskLabel:h,stepsCount:c,categoryLabel:u,equipmentLabel:g,timeEstimate:S,handleTaskClick:()=>{y("preview",e.task)},__MACROS_defineComponent:be,computed:L,get View(){return Nt}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),hl={class:"card-content"},yl={class:"row-1"},wl=["title"],kl={class:"steps-count"},bl={class:"row-2 card-tags"};function Sl(l,t,d,e,y,h){const c=D("el-tag");return i(),p("div",{class:"template-card",onClick:e.handleTaskClick},[s(" Card Content "),a("div",hl,[s(" Row 1: Title + Steps "),a("div",yl,[a("h4",{class:"card-title",title:e.taskLabel},m(e.taskLabel),9,wl),a("div",kl,m(e.stepsCount)+" steps",1)]),s(" Row 2: Tags "),a("div",bl,[e.categoryLabel?(i(),N(c,{key:0,size:"small",class:"tag-item"},{default:o(()=>[V(m(e.categoryLabel),1)]),_:1})):s("v-if",!0),s('        <el-tag v-if="equipmentLabel" size="small" type="info" class="tag-item">'),s("          {{ equipmentLabel }}"),s("        </el-tag>"),e.timeEstimate?(i(),N(c,{key:1,size:"small",type:"warning",class:"tag-item"},{default:o(()=>[V(m(e.timeEstimate),1)]),_:1})):s("v-if",!0)])])])}const Tl=Re(vl,[["render",Sl],["__scopeId","data-v-c5623433"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderTaskCard.vue"]]),Ol={__name:"StepsPreview",props:{templateId:{type:[String,Number],default:""},steps:{type:Array,default:()=>[]},interactive:{type:Boolean,default:!1},showModeSwitch:{type:Boolean,default:!0}},setup(l,{expose:t}){t();const d=l,{loadTemplate:e}=pr(),y=O(!1),h=O(!1),c=O(null),u=O(""),g=et({}),S=O(d.interactive);ge(()=>d.interactive,W=>{S.value=W});const T=W=>{const re=(W||"").toString().toLowerCase();return re.includes("numeric")||re==="number"?"number":re.includes("boolean")||re.includes("checkbox")?"checkbox":re.includes("inspection")?"inspection":re.includes("file")||re.includes("attachment")?"attachments":re.includes("service")?"service":re.includes("text")?"text":re||"text"},b=W=>{if(W.type)return T(W.type);if(W.value&&W.value.type)return T(W.value.type);if(W.config&&W.config.kind)return T(W.config.kind);if(W.value){if(typeof W.value.value=="number"||W.value.has_upper_limit||W.value.has_lower_limit)return"number";if(typeof W.value.value=="boolean")return"checkbox";if(W.value.files||W.value.file_attachments)return"attachments"}return"text"},w=L(()=>{if(Array.isArray(d.steps)&&d.steps.length>0)return d.steps;const W=c.value;return Array.isArray(W==null?void 0:W.steps)?W.steps:[]}),F=(W,re)=>{if(!W||typeof W!="object")return{step_id:`step-${re}`,order:re+1,type:"text",label:`Step ${re+1}`,description:"",required:!1,required_image:!1,relevant_tools:[],config:{}};const Y=W.value||{},_=T(Y.type),te=Array.isArray(W.tools)&&W.tools.length>0?W.tools:W.relevant_tools||[],f=Y.numeric_limit_bounds||Y.numericLimitBounds||{},A={step_id:W.id||W.step_id||`step-${re}`,order:re+1,type:_,label:W.name||W.label||`Step ${re+1}`,description:W.description||"",required:!!W.required,required_image:!!Y.require_image,relevant_tools:te.filter(R=>R&&(R.id||R.tool_id)).map(R=>({tool_id:R.id||R.tool_id,name:R.name||R.tool_name||"Unnamed Tool"})),config:{}};return _==="number"?A.config={default_value:typeof Y.value=="number"?Y.value:void 0,limits:za(f),required_image:A.required_image}:_==="checkbox"?A.config={default:!!Y.value,required_image:A.required_image}:_==="text"?A.config={default_value:Y.value??"",required_image:A.required_image}:_==="inspection"?A.config={default:"pass",required_image:A.required_image}:_==="attachments"&&(A.config={upload_style:{list_type:"picture-card"},required_image:A.required_image}),A},P=(W,re)=>{if(!W||typeof W!="object")return{step_id:`step-${re}`,order:re+1,type:"text",label:`Step ${re+1}`,description:"",required:!1,required_image:!1,relevant_tools:[],config:{}};const Y=b(W),_=W.value||W.config||{},te=Array.isArray(W.tools)&&W.tools.length>0?W.tools:W.relevant_tools||[],f=_.numeric_limit_bounds||_.numericLimitBounds||_.limits||{},A=!!(_.require_image||_.required_image||W.required_image),R={step_id:W.id||W.step_id||`step-${re}`,order:re+1,type:Y,label:W.name||W.label||`Step ${re+1}`,description:W.description||"",required:!!W.required,required_image:A,relevant_tools:te.filter(j=>j&&(j.id||j.tool_id)).map(j=>({tool_id:j.id||j.tool_id,name:j.name||j.tool_name||"Unnamed Tool"})),config:{}};if(Y==="number")R.config={default_value:typeof _.value=="number"?_.value:typeof _.default_value=="number"?_.default_value:void 0,limits:za(f),required_image:R.required_image};else if(Y==="checkbox"){const j=_.value!==void 0?!!_.value:_.default!==void 0?!!_.default:!1;R.config={default:j,required_image:R.required_image}}else if(Y==="text"){const j=_.value??_.default_value??"";R.config={default_value:j,required_image:R.required_image}}else if(Y==="inspection"){const j=_.value||_.default||"pass";R.config={default:j,required_image:R.required_image}}else Y==="attachments"&&(R.config={upload_style:{list_type:"picture-card"},required_image:R.required_image});return R},I=L(()=>w.value.map((W,re)=>W&&W.value&&W.value.type?F(W,re):P(W,re))),J=L(()=>{if(!u.value)return I.value;const W=u.value.toLowerCase();return I.value.filter(re=>re.label.toLowerCase().includes(W))}),k=W=>({inspection:kr,checkbox:wr,number:yr,text:hr,files:Ua,attachments:Ua,service:vr})[W]||"div",Z=(W,re)=>!W||typeof W!="object"?{step_id:`step-${re}`,type:"text",label:`${re+1}. Step`,description:"",required:!1,config:{}}:{...W,label:`${re+1}. ${W.label||"Step"}`},ie=W=>{W&&(g[W]=!g[W])},G=W=>W?!!g[W]:!1,le=()=>{},ue=W=>{S.value=W},$=L(()=>Array.isArray(d.steps)&&d.steps.length>0),B=()=>{Object.keys(g).forEach(W=>{delete g[W]})},me=async()=>{if(!(!d.templateId||$.value)){B(),y.value=!0,h.value=!1;try{const W=await e(d.templateId);c.value=W}catch(W){console.error("Failed to load template for preview:",W),h.value=!0,U.error("Failed to load template steps")}finally{y.value=!1}}},ne=()=>{if(B(),$.value){y.value=!1,h.value=!1,c.value=null;return}d.templateId?me():(c.value=null,y.value=!1,h.value=!1)};ge(()=>d.templateId,W=>{$.value||(W?me():(c.value=null,y.value=!1,h.value=!1))},{immediate:!0}),ge(()=>d.steps,()=>{ne()},{deep:!0,immediate:!0});const ee={props:d,loadTemplate:e,loading:y,error:h,template:c,stepSearchQuery:u,stepToolsVisible:g,isInteractive:S,mapValueTypeToPreviewType:T,detectStepType:b,sourceSteps:w,processTemplateStep:F,processStandaloneStep:P,previewSteps:I,filteredPreviewSteps:J,getStepComponent:k,getStepWithNumber:Z,toggleStepTools:ie,getStepToolsVisible:G,handleStepSearch:le,handleModeChange:ue,hasExternalSteps:$,resetStepToolsVisibility:B,fetchTemplate:me,refreshPreviewSource:ne,ref:O,computed:L,reactive:et,watch:ge,get Search(){return Ft},get Upload(){return bo},get Tools(){return Yr},get ElMessage(){return U},get useTaskLibrary(){return pr},get transformLimitsFromBackend(){return za},InspectionStepPreview:kr,CheckboxStepPreview:wr,NumberStepPreview:yr,TextStepPreview:hr,AttachmentStepPreview:Ua,ServiceStepPreview:vr};return Object.defineProperty(ee,"__isScriptSetup",{enumerable:!1,value:!0}),ee}},Cl={class:"steps-preview-container"},Dl={key:0,class:"loading-container"},Pl={class:"error-container"},Al={class:"step-search-bar"},Il={key:0,class:"procedure-preview"},Vl={class:"preview-main viewport-desktop density-comfortable"},Fl={class:"section-content"},xl={class:"step-config-preview"},El={key:0,class:"preview-bottom-section"},Wl={class:"desktop-upload-button"},Rl={key:1,class:"desktop-tools-list"},Ll={class:"tools-list-content"},Ml={class:"tool-name"},ql={key:1,class:"empty-steps"};function Ul(l,t,d,e,y,h){const c=D("el-skeleton"),u=D("el-empty"),g=D("el-icon"),S=D("el-input"),T=D("el-button");return i(),p("div",Cl,[s(" Loading State "),e.loading?(i(),p("div",Dl,[r(c,{rows:3,animated:""})])):e.error?(i(),p(se,{key:1},[s(" Error State "),a("div",Pl,[r(u,{description:"Failed to load template steps","image-size":60})])],2112)):(i(),p(se,{key:2},[s(" Content "),a("div",null,[s(" Step Search Bar "),a("div",Al,[r(S,{modelValue:e.stepSearchQuery,"onUpdate:modelValue":t[0]||(t[0]=b=>e.stepSearchQuery=b),placeholder:"Search steps by name...",clearable:"",onInput:e.handleStepSearch},{prefix:o(()=>[r(g,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),s(" Desktop-style Procedure Preview (read-only) "),e.filteredPreviewSteps&&e.filteredPreviewSteps.length>0?(i(),p("div",Il,[a("div",Vl,[a("div",Fl,[(i(!0),p(se,null,fe(e.filteredPreviewSteps,(b,w)=>(i(),p("div",{key:b.step_id||w,class:"preview-step-simple"},[a("div",xl,[(i(),N(ta(e.getStepComponent(b.type)),{step:e.getStepWithNumber(b,w),"preview-mode":!0,interactive:e.isInteractive},null,8,["step","interactive"])),s(" Bottom section for required image OR tools (desktop style) "),b.required_image||b.relevant_tools&&b.relevant_tools.length>0?(i(),p("div",El,[a("div",Wl,[b.required_image?(i(),N(T,{key:0,type:"info",size:"small",disabled:!e.isInteractive},{default:o(()=>[t[1]||(t[1]=a("span",{class:"required-asterisk"},"*",-1)),r(g,null,{default:o(()=>[r(e.Upload)]),_:1}),t[2]||(t[2]=V(" Upload Image "))]),_:1,__:[1,2]},8,["disabled"])):s("v-if",!0),s(" Show Tools Button "),b.relevant_tools&&b.relevant_tools.length>0?(i(),N(T,{key:1,disabled:!e.isInteractive,size:"small",plain:"",onClick:F=>e.toggleStepTools(b.step_id),class:"tools-toggle-btn",style:Tt(b.required_image?"margin-left: 8px;":"")},{default:o(()=>[r(g,null,{default:o(()=>[r(e.Tools)]),_:1}),V(" "+m(e.getStepToolsVisible(b.step_id)?"Hide Tools":"Show Tools")+" ("+m(b.relevant_tools.length)+") ",1)]),_:2},1032,["disabled","onClick","style"])):s("v-if",!0)])])):s("v-if",!0),s(" Tools List (toggleable) "),e.getStepToolsVisible(b.step_id)&&b.relevant_tools&&b.relevant_tools.length>0?(i(),p("div",Rl,[t[3]||(t[3]=a("div",{class:"tools-list-header"},[a("h4",null,"Required Tools")],-1)),a("div",Ll,[(i(!0),p(se,null,fe(b.relevant_tools,F=>(i(),p("div",{key:F.tool_id||F.id,class:"tool-item"},[r(g,null,{default:o(()=>[r(e.Tools)]),_:1}),a("span",Ml,m(F.name||"Unnamed Tool"),1)]))),128))])])):s("v-if",!0)])]))),128))])])])):(i(),p("div",ql,[r(u,{description:e.stepSearchQuery?"No steps match your search":"No steps defined yet","image-size":60},null,8,["description"])]))])],2112))])}const ra=Re(Ol,[["render",Ul],["__scopeId","data-v-63ee4a26"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/StepsPreview.vue"]]),zl=be({name:"StandardsPreview"}),Nl=Object.assign(zl,{props:{standardId:{type:[String,Number],required:!0}},setup(l,{expose:t}){t();const d=l,e=O(!1),y=O(null),h=O(null),c=O("general"),u=async()=>{var S,T,b;if(!d.standardId){y.value="No standard ID provided";return}e.value=!0,y.value=null;try{console.log(`Loading standard: ${d.standardId}`);const w=await br(d.standardId);if(w&&w.data)h.value=((S=w.data)==null?void 0:S.data)||w.data,console.log("Standard loaded:",h.value);else throw new Error("No standard data received")}catch(w){console.error("Failed to load standard for preview:",w),y.value=((b=(T=w.response)==null?void 0:T.data)==null?void 0:b.message)||w.message||"Failed to load standard details",U.error("Failed to load standard details")}finally{e.value=!1}};ge(()=>d.standardId,S=>{S&&u()},{immediate:!0}),Ue(()=>{d.standardId&&u()});const g={props:d,loading:e,error:y,standard:h,activeTab:c,fetchStandard:u,__MACROS_defineComponent:be,ref:O,onMounted:Ue,watch:ge,get ElMessage(){return U},get getStandard(){return br}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),Bl={class:"standards-preview"},jl={key:0,class:"loading-container"},Hl={class:"error-container"},Yl={class:"standard-details"},Jl={class:"fixed-header-section"},Ql={class:"standard-tabs-header"},Gl={class:"scrollable-content"},Kl={class:"tab-content-wrapper"},Zl={key:0,class:"tab-pane-content"},Xl={class:"overview-card"},$l={class:"card-content"},ei={class:"info-value highlight"},ti={class:"standard-id"},ai={key:0,class:"description-card"},ri={class:"card-content"},oi={class:"description-text"},ni={key:1,class:"tab-pane-content"},si={key:0,class:"rules-list"},li={class:"card-header"},ii={class:"rules-container"},di={class:"rule-number"},ci={class:"rule-content"},ui={class:"rule-text"},mi={key:1,class:"empty-rules"},_i={class:"empty-standard"};function fi(l,t,d,e,y,h){const c=D("el-skeleton"),u=D("el-alert"),g=D("el-tab-pane"),S=D("el-tabs"),T=D("el-descriptions-item"),b=D("el-descriptions"),w=D("el-tag"),F=D("el-empty");return i(),p("div",Bl,[s(" Loading State "),e.loading?(i(),p("div",jl,[r(c,{rows:4,animated:""}),t[1]||(t[1]=a("div",{class:"loading-text"},"Loading standard details...",-1))])):e.error?(i(),p(se,{key:1},[s(" Error State "),a("div",Hl,[r(u,{title:"Failed to load standard",description:e.error,type:"error",closable:!1,"show-icon":""},null,8,["description"])])],2112)):e.standard?(i(),p(se,{key:2},[s(" Standard Details (matching exactly StandardsLibraryView structure) "),a("div",Yl,[s(" Fixed Header Section "),a("div",Jl,[s(" Tab Navigation "),a("div",Ql,[r(S,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=P=>e.activeTab=P),class:"details-tabs"},{default:o(()=>[r(g,{label:"General",name:"general"}),r(g,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),s(" Scrollable Content Area "),a("div",Gl,[a("div",Kl,[s(" General Tab Content "),e.activeTab==="general"?(i(),p("div",Zl,[s(" Standard Overview Card "),a("div",Xl,[a("div",$l,[r(b,{column:2,direction:"vertical"},{default:o(()=>[r(T,{width:"50%",label:"Category"},{default:o(()=>[V(m(e.standard.category||"Uncategorized"),1)]),_:1}),r(T,{width:"50%",label:"Total Rules"},{default:o(()=>{var P;return[a("span",ei,m(((P=e.standard.items)==null?void 0:P.length)||0)+" rules",1)]}),_:1}),r(T,{width:"50%",label:"Standard Code"},{default:o(()=>[a("span",ti,m(e.standard.code||"N/A"),1)]),_:1})]),_:1})])]),s(" Description Section "),e.standard.description?(i(),p("div",ai,[t[2]||(t[2]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",ri,[a("div",oi,m(e.standard.description),1)])])):s("v-if",!0)])):s("v-if",!0),s(" Standard Rules Tab Content "),e.activeTab==="rules"?(i(),p("div",ni,[s(" Standard Rules List "),e.standard.items&&e.standard.items.length>0?(i(),p("div",si,[a("div",li,[t[4]||(t[4]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(w,{type:"warning",size:"small"},{default:o(()=>t[3]||(t[3]=[V("Read Only")])),_:1,__:[3]})]),a("div",ii,[(i(!0),p(se,null,fe(e.standard.items,(P,I)=>(i(),p("div",{key:I,class:"rule-item"},[a("div",di,m(I+1),1),a("div",ci,[a("div",ui,m(P),1)])]))),128))])])):(i(),p("div",mi,[r(F,{description:"No standard rules defined yet","image-size":60})]))])):s("v-if",!0)])])])],2112)):(i(),p(se,{key:3},[s(" No Standard State "),a("div",_i,[r(F,{description:"No standard data available","image-size":60})])],2112))])}const Pa=Re(Nl,[["render",fi],["__scopeId","data-v-c25e20fa"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/StandardsPreview.vue"]]),gi=be({name:"WorkOrderDetail"}),pi=Object.assign(gi,{props:{workOrder:{type:Object,default:null}},emits:["edit","share","export","status-change","add-parts","add-time","add-costs","view-procedure","add-comment","delete","start-work-order"],setup(l,{expose:t,emit:d}){t();const e=it(),y=l,h=d,c=O(""),u=O("tasks"),g=O(!1),S=O(null),T=O(!1),b=O([]),w=O(!1),F=O(!1),P=O(!1),I=O(null),J=O([]),k=O(!1),Z=O(""),ie=O([]),G=O(!1),le=O(!1),ue=O(null),$=O("general"),B=O([]),me=L(()=>{var v;return((v=y.workOrder)==null?void 0:v.due_date)&&new Date(y.workOrder.due_date)<new Date}),ne=L(()=>{var v;return((v=y.workOrder)==null?void 0:v.image_list)&&y.workOrder.image_list.length>0}),ee=L(()=>{const v=y.workOrder;return v?Array.isArray(v.categories)&&v.categories.length?v.categories:Array.isArray(v.category_list)&&v.category_list.length?v.category_list:v.category?[v.category]:[]:[]}),W=v=>v&&typeof v=="object"?v.id??v.name??JSON.stringify(v):v,re=L(()=>{var M;const v=(M=y.workOrder)==null?void 0:M.recurrence_type;return v?(console.log("IsRecurring check:",v),v.id?v.id!==1:typeof v=="string"?v.toLowerCase()!=="does not repeat"&&v.toLowerCase()!=="none":v.name?v.name.toLowerCase()!=="does not repeat"&&v.name.toLowerCase()!=="none":!1):!1}),Y=L(()=>{var Ce;const v=(Ce=y.workOrder)==null?void 0:Ce.work_order_progress;if(!v)return null;const M=v.total_task_amount||0,z=v.completed_task_amount||0,pe=v.failed_task_amount||0,we=M>0?Math.round(z/M*100):0;return{total:M,completed:z,failed:pe,percentage:we,remaining:M-z-pe}}),_=L(()=>{var v;return((v=y.workOrder)==null?void 0:v.file_list)&&y.workOrder.file_list.length>0}),te=L(()=>!b.value||!Array.isArray(b.value)?[]:b.value.filter(v=>v&&v.id&&v.name)),f=L(()=>te.value.length>0),A=L(()=>{var v;return!((v=y.workOrder)!=null&&v.file_list)||!Array.isArray(y.workOrder.file_list)?[]:y.workOrder.file_list.map((M,z)=>{const pe=M.split("/"),Ce=(pe[pe.length-1]||`file_${z+1}`).replace(/\d{17}/,"");return{id:z,name:decodeURIComponent(Ce),url:M,type:je(Ce)}})}),R=v=>{if(!Array.isArray(v)){J.value=[];return}const M=new Map(Array.isArray(J.value)?J.value.map(z=>[z.id,z]):[]);J.value=v.map((z,pe)=>{if(typeof z=="string"||typeof z=="number"){const we=String(z).trim(),Ce=String(z),Se=we||`task-${pe}`,He=M.get(Se);return He?{...He,id:Se,label:Ce,taskListText:Ce,hasValidId:!!we,index:pe}:{id:Se,label:Ce,taskListText:Ce,hasValidId:!!we,index:pe}}if(z&&typeof z=="object"&&!Array.isArray(z)){const we=z.id||z._id||z.task_id||z.taskId||z.reference_id||"",Ce=String(we).trim(),He=z.task_list_text||z.taskListText||z.task_name||z.name||Ce||""||`Task ${pe+1}`,st=Ce||`task-${pe}`,gt=M.get(st);return gt?{...gt,...z,id:st,label:He,taskListText:He,hasValidId:!!Ce,index:pe}:{...z,id:st,label:He,taskListText:He,hasValidId:!!Ce,index:pe}}return{id:`task-${pe}`,label:`Task ${pe+1}`,taskListText:`Task ${pe+1}`,hasValidId:!1,index:pe}})},j=()=>{J.value=[],Z.value="",S.value=null,ie.value=[],k.value=!1,g.value=!1,ie.value=[]},oe=v=>!v||typeof v!="object"?"":v.template_id||v.templateId||v.templateID||"",ce=async()=>{var v,M;if(!((M=(v=y.workOrder)==null?void 0:v.equipment_node_ids)!=null&&M.length)){b.value=[];return}try{w.value=!0;const z=y.workOrder.equipment_node_ids.map(we=>gr(we).catch(Ce=>(console.warn(`Failed to load equipment ${we}:`,Ce),null))),pe=await Promise.all(z);b.value=pe.filter(we=>(we==null?void 0:we.data)&&we.data.id).map(we=>({...we.data,id:we.data.id,name:we.data.name||`Equipment ${we.data.id}`,manufacturer:we.data.manufacturer||null,location:we.data.location||null,person_in_charge:we.data.person_in_charge||null,image_list:we.data.image_list||[],type:we.data.type||we.data.equipment_type||"Equipment"}))}catch(z){console.error("Failed to load equipment details:",z),b.value=[]}finally{w.value=!1}};ge(()=>y.workOrder,v=>{var M;v?(c.value=((M=v.state)==null?void 0:M.name)||"Ready",ce(),j(),R(v.task_list)):j()},{immediate:!0}),ge(()=>{var v;return(v=y.workOrder)==null?void 0:v.task_list},v=>{y.workOrder?(Z.value="",S.value=null,g.value=!1,ie.value=[],R(v)):j()});const K=(v,M=!1)=>{if(!v)return"-";if(M){const z=new Date(v),pe=z.getFullYear(),we=String(z.getMonth()+1).padStart(2,"0"),Ce=String(z.getDate()).padStart(2,"0");let Se=z.getHours();const He=String(z.getMinutes()).padStart(2,"0");Se===0&&z.getDate()!==new Date(v).getDate()&&(Se=24);const st=String(Se).padStart(2,"0");return`${pe}-${we}-${Ce} ${st}:${He}`}return lt(v)},X=v=>{h("status-change",{workOrder:y.workOrder,status:v})},ke=()=>{h("start-work-order",y.workOrder)},De=v=>{switch(v){case"start":ke();break;case"edit":h("edit",y.workOrder);break;case"share":h("share",y.workOrder);break;case"export":h("export",y.workOrder);break;case"delete":Ve();break;default:console.warn(`Unhandled header action: ${v}`)}},Ve=()=>{re.value?F.value=!0:$e.confirm("This action will permanently delete this work order. This cannot be undone.","Delete Work Order",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{await Te()}).catch(()=>{})},Te=async()=>{try{P.value=!0,await ur(y.workOrder.id),U.success("Work order deleted successfully"),h("delete",{workOrder:y.workOrder,type:"individual"})}catch(v){console.error("Failed to delete work order:",v),U.error("Failed to delete work order")}finally{P.value=!1}},Le=async()=>{try{P.value=!0,await cr(y.workOrder.recurrence_uuid),U.success("All recurring work orders deleted successfully"),h("delete",{workOrder:y.workOrder,type:"recurrence"}),F.value=!1}catch(v){console.error("Failed to delete recurring work orders:",v),U.error("Failed to delete recurring work orders")}finally{P.value=!1}},he=async v=>{v==="individual"?(await Te(),F.value=!1):v==="recurrence"&&await Le()},Pe=async()=>{var v;if(T.value=!0,!re.value||!((v=y.workOrder)!=null&&v.recurrence_uuid)){B.value=[];return}try{G.value=!0;const z=(await dr(y.workOrder.recurrence_uuid,1,50)).data.content||[];B.value=ot(z)}catch(M){console.error("Failed to load recurring work orders for timeline:",M),U.error("Failed to load timeline data"),B.value=[]}finally{G.value=!1}},tt=()=>{T.value=!1},Je=async v=>{try{if(!B.value||B.value.length===0){U.warning("No timeline data available to export");return}const M=qr(`work-order-${y.workOrder.id}-timeline`),z=Mr(B.value,v,M,{currentWorkOrderId:y.workOrder.id,sheetName:`Work Order ${y.workOrder.id} Timeline`,includeMetadata:!0});z.success?(U.success(`${z.message} (${z.recordCount} records)`),T.value=!1):U.error(z.message)}catch(M){console.error("Timeline export failed:",M),U.error("Failed to export timeline data")}},ot=v=>Array.isArray(v)?v.sort((M,z)=>new Date(M.start_date||M.created_at)-new Date(z.start_date||z.created_at)).map((M,z)=>{var He,st,gt,xt,Et;const pe=((st=(He=M.state)==null?void 0:He.name)==null?void 0:st.toLowerCase())==="completed",we=((xt=(gt=M.state)==null?void 0:gt.name)==null?void 0:xt.toLowerCase())==="in progress",Ce=M.due_date&&new Date(M.due_date)<new Date&&!pe,Se=Array.isArray(M.task_list)?M.task_list.length:0;return{id:M.id,title:M.name||`Work Order #${M.id}`,description:M.description||"No description provided",timestamp:K(M.start_date||M.created_at,!0),type:Ce?"danger":pe?"success":we?"primary":"info",color:Ce?"#f56c6c":pe?"#67c23a":we?"#409eff":"#909399",icon:"DocumentChecked",hollow:!pe,status:((Et=M.state)==null?void 0:Et.name)||"Pending",isOverdue:Ce,dueDate:M.due_date,category:M.category||M.categories,priority:M.priority,taskCount:Se,duration:M.estimated_minutes?`${M.estimated_minutes}m`:null,plannedEnd:M.due_date,actualEnd:M.finished_at,assignees:M.created_by?[{id:1,name:String(M.created_by).trim()||"Unknown",avatar:""}]:[]}}):[],dt=async v=>{if(!v||!v.id||v.hasValidId===!1){U.warning("Task preview is unavailable for this entry.");return}const M=(z,pe="",we=[])=>{const Ce=pe||"",Se=Array.isArray(we)?we:[];return!Ce&&Se.length===0?(U.warning("Task preview is unavailable for this entry."),!1):(S.value=z,Z.value=Ce,ie.value=Se.map(He=>({...He})),g.value=!0,!0)};if(v.cachedTask){const z=v.cachedTemplateId||oe(v.cachedTask)||"",pe=Array.isArray(v.cachedTask.steps)?v.cachedTask.steps:[];if(M(v.cachedTask,z,pe))return}if(!k.value){Z.value="",S.value=null,ie.value=[];try{k.value=!0;const z=await Oa(v.id),pe=z==null?void 0:z.data;if(!pe){U.error("Failed to load task details.");return}(v.taskListText||v.label)&&(pe.taskListText=v.taskListText||v.label);const we=oe(pe)||"",Ce=Array.isArray(pe.steps)?pe.steps:[];if(!M(pe,we,Ce))return;const Se=J.value.findIndex(He=>He.id===v.id);if(Se!==-1){const He={...J.value[Se],cachedTask:pe,cachedTemplateId:we,hasValidId:!0};J.value.splice(Se,1,He)}}catch(z){console.error("Failed to load task preview:",z),U.error("Failed to load task preview.")}finally{k.value=!1}}},nt=()=>{g.value=!1,S.value=null,Z.value="",k.value=!1,ie.value=[]},at=v=>{ue.value=v,le.value=!0},ct=v=>v?v.split(/[-_]/).map(M=>M.charAt(0).toUpperCase()+M.slice(1).toLowerCase()).join(" "):"",ut=()=>{U.info("Navigation to linked work order will be implemented by Yellow Guy")},mt=v=>{switch(v==null?void 0:v.toLowerCase()){case"image":case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return ea;case"video":case"mp4":case"avi":case"mov":case"wmv":case"flv":return rr;case"audio":case"mp3":case"wav":case"flac":case"aac":return ar;case"pdf":case"document":case"doc":case"docx":case"txt":case"rtf":return qt;case"download":case"zip":case"rar":case"7z":return ga;default:return qt}},je=v=>{var Se;if(!v)return"document";const M=(Se=v.split(".").pop())==null?void 0:Se.toLowerCase(),z=["jpg","jpeg","png","gif","bmp","webp","svg"],pe=["mp4","avi","mov","wmv","flv","mkv"],we=["mp3","wav","flac","aac","ogg"],Ce=["zip","rar","7z","tar","gz"];return z.includes(M)?"image":pe.includes(M)?"video":we.includes(M)?"audio":Ce.includes(M)?"download":"document"},Ke={router:e,props:y,emit:h,localStatus:c,activeTrackingTab:u,showTaskPreviewDialog:g,selectedTaskForPreview:S,timelineModalVisible:T,equipmentDetails:b,loadingEquipment:w,deleteDialogVisible:F,deleting:P,scheduleSection:I,taskEntries:J,taskPreviewLoading:k,selectedTaskTemplateId:Z,selectedTaskSteps:ie,timelineLoading:G,showStandardPreviewDialog:le,previewStandardData:ue,standalonePreviewTab:$,timelineEvents:B,isOverdue:me,hasAttachments:ne,categoryTags:ee,categoryKey:W,isRecurring:re,workOrderProgress:Y,hasFileAttachments:_,validEquipmentList:te,hasValidEquipment:f,processedFileList:A,normalizeTaskList:R,resetTaskState:j,resolveTaskTemplateId:oe,loadEquipmentDetails:ce,formatDate:K,handleStatusChange:X,handleStartWorkOrder:ke,handleHeaderAction:De,handleDeleteWorkOrder:Ve,performDeleteIndividual:Te,performDeleteRecurrence:Le,handleDeleteConfirmation:he,openTimelineModal:Pe,handleTimelineModalClose:tt,handleExportFormat:Je,transformWorkOrdersToTimeline:ot,handleTaskPreview:dt,handleTaskPreviewClose:nt,handleStandardPreview:at,formatCategoryName:ct,navigateToLinkedOrder:ut,getFileIcon:mt,getFileTypeFromName:je,viewRequest:v=>{U.info(`Navigation to request ${v.name} will be implemented`)},getRecurrenceTypeLabel:()=>{var M;if(!((M=y.workOrder)!=null&&M.recurrence_type))return"Does not repeat";const v=y.workOrder.recurrence_type;return console.log("Recurrence Type Data:",v),typeof v=="object"&&v.name?v.name:typeof v=="string"?v:v.id&&v.id!==1?v.label||v.name||"Recurring":"Does not repeat"},scrollToScheduleSection:()=>{if(I.value)I.value.scrollIntoView({behavior:"smooth",block:"start"});else{const v=document.querySelector(".schedule-conditions-section .schedule-header");v?v.scrollIntoView({behavior:"smooth",block:"start"}):console.warn("Schedule section not found for scrolling")}},handleEquipmentClick:v=>{if(!(v!=null&&v.id)){U.warning("Equipment information is not available");return}e.push({path:"/maintenance/equipment",query:{equipmentId:v.id}})},__MACROS_defineComponent:be,ref:O,computed:L,watch:ge,get useRouter(){return it},get Edit(){return Ya},get Share(){return Co},get Picture(){return ea},get Download(){return ga},get View(){return Nt},get MoreFilled(){return Hr},get Tools(){return Yr},get Delete(){return Da},get Warning(){return Oo},get Document(){return qt},get DocumentDelete(){return To},get VideoCamera(){return rr},get Microphone(){return ar},get ArrowDown(){return So},get DocumentCopy(){return Jr},get convertToLocalTime(){return lt},get exportTimelineData(){return Mr},get generateTimestampedFilename(){return qr},get getEquipmentById(){return gr},get deleteIndividualWorkOrder(){return ur},get deleteRecurrenceWorkOrders(){return cr},get getWorkOrdersByRecurrence(){return dr},get getTaskEntryById(){return Oa},PriorityTag:Ka,WorkTypeTag:no,CategoryTag:Za,Timeline:gl,WorkOrderTaskCard:Tl,StepsPreview:ra,StandardsPreview:Pa,StartWorkOrderAction:lo,get ElMessage(){return U},get ElMessageBox(){return $e}};return Object.defineProperty(Ke,"__isScriptSetup",{enumerable:!1,value:!0}),Ke}}),vi={key:0,class:"work-order-detail"},hi={class:"detail-header"},yi={class:"header-main"},wi={class:"title-row"},ki={class:"detail-title"},bi={class:"work-order-id"},Si={class:"meta-info"},Ti={class:"created-date"},Oi={key:0,class:"updated-date"},Ci={class:"header-actions"},Di={class:"detail-section"},Pi={class:"detail-value work-order-code"},Ai={class:"field-value"},Ii={class:"field-value"},Vi={key:0,class:"category-tag-list"},Fi={key:1},xi={class:"detail-value"},Ei={class:"detail-value"},Wi={class:"detail-section dates-section"},Ri={class:"detail-value"},Li={class:"detail-value"},Mi={class:"recurrence-value-container"},qi={class:"recurrence-value-container"},Ui={key:0,class:"detail-section"},zi={class:"description-content"},Ni={key:1,class:"detail-section"},Bi={key:0,class:"loading-container"},ji={key:1,class:"equipment-grid"},Hi={class:"equipment-tooltip"},Yi={key:0},Ji={key:1},Qi={key:2},Gi={key:3},Ki=["onClick"],Zi={class:"equipment-image"},Xi={class:"equipment-icon"},$i={key:1,class:"equipment-icon"},ed={class:"equipment-info"},td={class:"equipment-name"},ad={class:"equipment-type"},rd={key:2,class:"no-equipment"},od={key:2,class:"detail-section"},nd={class:"progress-header"},sd={class:"progress-stats"},ld={class:"stat-item"},id={class:"stat-value"},dd={class:"stat-item"},cd={class:"stat-value completed"},ud={class:"stat-item"},md={class:"stat-value failed"},_d={class:"stat-item"},fd={class:"stat-value"},gd={class:"progress-section"},pd={class:"progress-bar-container"},vd={class:"progress-text"},hd={key:3,class:"detail-section"},yd={key:0,class:"images-section"},wd={class:"image-gallery"},kd={class:"image-slot"},bd={key:1,class:"files-section"},Sd={class:"file-list"},Td={key:4,class:"detail-section schedule-conditions-section"},Od={class:"schedule-header",ref:"scheduleSection"},Cd={class:"section-title"},Dd={class:"detail-value"},Pd={class:"detail-value"},Ad={class:"detail-section time-cost-tracking-card"},Id={class:"tab-content"},Vd={key:0,class:"tasks-list"},Fd={key:1,class:"no-data-placeholder"},xd={class:"tab-content"},Ed={key:0,class:"standards-list"},Wd=["onClick"],Rd={class:"standard-header"},Ld={class:"standard-name"},Md={class:"standard-code"},qd={class:"standard-tags"},Ud={key:1,class:"no-data-placeholder"},zd={class:"tab-content"},Nd={class:"no-data-placeholder"},Bd={key:0,class:"timeline-loading"},jd={key:1,class:"timeline-empty"},Hd={key:2,class:"timeline-empty"},Yd={class:"dialog-footer"},Jd={class:"delete-dialog-content"},Qd={class:"delete-dialog-footer"},Gd={class:"preview-dialog-footer"},Kd={class:"standalone-standard-preview"},Zd={class:"standard-details"},Xd={class:"fixed-header-section"},$d={class:"standard-tabs-header"},ec={class:"scrollable-content"},tc={class:"tab-content-wrapper"},ac={key:0,class:"tab-pane-content"},rc={class:"overview-card"},oc={class:"card-content"},nc={class:"info-value highlight"},sc={key:0,class:"description-card"},lc={class:"card-content"},ic={class:"description-text"},dc={key:1,class:"tab-pane-content"},cc={key:0,class:"rules-list"},uc={class:"card-header"},mc={class:"rules-container"},_c={class:"rule-number"},fc={class:"rule-content"},gc={class:"rule-text"},pc={key:1,class:"empty-rules"},vc={key:1,class:"empty-detail"};function hc(l,t,d,e,y,h){var W,re,Y,_,te;const c=D("el-col"),u=D("el-icon"),g=D("el-button"),S=D("el-dropdown-item"),T=D("el-dropdown-menu"),b=D("el-dropdown"),w=D("el-row"),F=D("el-option"),P=D("el-select"),I=D("el-descriptions-item"),J=D("el-descriptions"),k=D("el-tooltip"),Z=D("el-divider"),ie=D("el-skeleton"),G=D("el-image"),le=D("el-empty"),ue=D("el-progress"),$=D("el-link"),B=D("el-tab-pane"),me=D("el-tag"),ne=D("el-tabs"),ee=D("el-dialog");return i(),p(se,null,[d.workOrder?(i(),p("div",vi,[s(" Detail Header "),a("div",hi,[r(w,{justify:"space-between",align:"top",gutter:16},{default:o(()=>[r(c,{span:18},{default:o(()=>[a("div",yi,[a("div",wi,[a("h2",ki,m(d.workOrder.name),1),a("span",bi,"#"+m(d.workOrder.id),1)]),a("div",Si,[a("span",Ti,m(l.$t("workOrder.form.createdOn"))+": "+m(e.formatDate(d.workOrder.created_at)),1),d.workOrder.updated_at?(i(),p("span",Oi," Updated: "+m(e.formatDate(d.workOrder.updated_at)),1)):s("v-if",!0)])])]),_:1}),r(c,{span:4},{default:o(()=>[a("div",Ci,[r(g,{class:"edit-button",type:"primary",plain:"",size:"default",onClick:t[0]||(t[0]=f=>e.emit("edit",d.workOrder)),"aria-label":l.$t("workOrder.actions.edit")},{default:o(()=>[r(u,{style:{"margin-right":"4px"}},{default:o(()=>[r(e.Edit)]),_:1}),V(" "+m(l.$t("workOrder.actions.edit")),1)]),_:1},8,["aria-label"]),r(b,{trigger:"click",onCommand:e.handleHeaderAction},{dropdown:o(()=>[r(T,null,{default:o(()=>[r(S,{command:"share"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.Share)]),_:1}),V(" "+m(l.$t("workOrder.actions.share")),1)]),_:1}),r(S,{command:"export"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.Download)]),_:1}),V(" "+m(l.$t("workOrder.actions.export")),1)]),_:1}),r(e.StartWorkOrderAction,{"work-order":d.workOrder,onStart:e.handleStartWorkOrder},null,8,["work-order"]),r(S,{command:"delete",divided:"",class:"delete-item"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.Delete)]),_:1}),V(" "+m(l.$t("workOrder.actions.delete")),1)]),_:1})]),_:1})]),default:o(()=>[r(g,{type:"text",size:"default",class:"action-button"},{default:o(()=>[r(u,{class:"rotated-icon"},{default:o(()=>[r(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),s(" General Detail Section "),a("div",Di,[r(J,{column:4,class:"general-details-descriptions"},{default:o(()=>{var f;return[r(I,{label:l.$t("workOrder.table.state")},{default:o(()=>[r(P,{modelValue:e.localStatus,"onUpdate:modelValue":t[1]||(t[1]=A=>e.localStatus=A),onChange:e.handleStatusChange,size:"small",style:{width:"150px"}},{default:o(()=>[r(F,{label:"Ready",value:"Ready"}),r(F,{label:"On Hold",value:"On Hold"}),r(F,{label:"In Progress",value:"In Progress"}),r(F,{label:"Completed",value:"Completed"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),d.workOrder.code?(i(),N(I,{key:0,label:"Work Order Code"},{default:o(()=>[a("span",Pi,m(d.workOrder.code),1)]),_:1})):s("v-if",!0),r(I,{label:l.$t("workOrder.table.priority")},{default:o(()=>[r(e.PriorityTag,{priority:d.workOrder.priority},null,8,["priority"])]),_:1},8,["label"]),r(I,{label:l.$t("workOrder.table.assignedTo")},{default:o(()=>[a("span",Ai,m(d.workOrder.created_by||"Unassigned"),1)]),_:1},8,["label"]),r(I,{label:"Updated By"},{default:o(()=>[a("span",Ii,m(d.workOrder.updated_by||"-"),1)]),_:1}),r(I,{label:l.$t("workOrder.table.workType")},{default:o(()=>[r(e.WorkTypeTag,{"work-type":d.workOrder.work_type},null,8,["work-type"])]),_:1},8,["label"]),r(I,{label:l.$t("workOrder.table.category")},{default:o(()=>[e.categoryTags.length?(i(),p("div",Vi,[(i(!0),p(se,null,fe(e.categoryTags,A=>(i(),N(e.CategoryTag,{key:e.categoryKey(A),category:A},null,8,["category"]))),128))])):(i(),p("span",Fi,"-"))]),_:1},8,["label"]),r(I,{label:l.$t("workOrder.table.estimatedTime")},{default:o(()=>[a("span",xi,m(d.workOrder.estimated_minutes?`${d.workOrder.estimated_minutes} min`:"-"),1)]),_:1},8,["label"]),(f=d.workOrder.vendor_ids)!=null&&f.length?(i(),N(I,{key:1,label:"Vendors"},{default:o(()=>[a("span",Ei,m(d.workOrder.vendor_ids.join(", ")),1)]),_:1})):s("v-if",!0),d.workOrder.request?(i(),N(I,{key:2,label:"Related Request"},{default:o(()=>[a("span",{class:"detail-value linked-value",onClick:t[2]||(t[2]=A=>e.viewRequest(d.workOrder.request))},m(d.workOrder.request.name),1)]),_:1})):s("v-if",!0)]}),_:1})]),s(" Dates Section "),a("div",Wi,[r(J,{column:4,class:"dates-descriptions"},{default:o(()=>[r(I,{label:"Start Date"},{default:o(()=>[a("span",Ri,m(d.workOrder.start_date?e.formatDate(d.workOrder.start_date):"-"),1)]),_:1}),r(I,{label:"End Date"},{default:o(()=>[a("span",Li,m(d.workOrder.end_date?e.formatDate(d.workOrder.end_date):"-"),1)]),_:1}),r(I,{label:l.$t("workOrder.table.dueDate")},{default:o(()=>[a("span",{class:Ae(["detail-value",{overdue:e.isOverdue}])},m(d.workOrder.due_date?e.formatDate(d.workOrder.due_date):"-"),3)]),_:1},8,["label"]),r(I,{label:"Recurrence Type"},{default:o(()=>[a("div",Mi,[e.isRecurring?(i(),N(k,{key:0,content:"View Work Order Timeline",placement:"top","show-after":500},{default:o(()=>[a("div",qi,[a("span",{class:Ae(["detail-value",{"recurrence-clickable":e.isRecurring}]),onClick:e.openTimelineModal,style:Tt({cursor:e.isRecurring?"pointer":"default"})},m(e.getRecurrenceTypeLabel()),7),r(u,{class:"timeline-icon",onClick:e.openTimelineModal},{default:o(()=>[r(e.View)]),_:1})])]),_:1})):s("v-if",!0)])]),_:1})]),_:1})]),s(" Description Section "),d.workOrder.description?(i(),p("div",Ui,[r(J,{column:1,class:"general-details-descriptions"},{default:o(()=>[r(I,{label:l.$t("workOrder.table.description")},{default:o(()=>[a("div",zi,[a("p",null,m(d.workOrder.description),1)])]),_:1},8,["label"])]),_:1})])):s("v-if",!0),s(" Related Equipment Section "),(W=d.workOrder.equipment_node_ids)!=null&&W.length?(i(),p("div",Ni,[r(Z),t[16]||(t[16]=a("h3",{class:"section-title"},"Related Equipment",-1)),e.loadingEquipment?(i(),p("div",Bi,[r(ie,{rows:2,animated:""})])):e.hasValidEquipment?(i(),p("div",ji,[(i(!0),p(se,null,fe(e.validEquipmentList,f=>(i(),N(k,{key:`equipment-${f.id}-${f.name}`,effect:"light",placement:"top","popper-class":"equipment-tooltip-popper"},{content:o(()=>{var A,R;return[a("div",Hi,[f.manufacturer?(i(),p("div",Yi,[t[13]||(t[13]=a("strong",null,"Manufacturer:",-1)),V(" "+m(f.manufacturer.name),1)])):s("v-if",!0),(A=f.location)!=null&&A.name?(i(),p("div",Ji,[t[14]||(t[14]=a("strong",null,"Location:",-1)),V(" "+m(f.location.name),1)])):s("v-if",!0),f.person_in_charge?(i(),p("div",Qi,[t[15]||(t[15]=a("strong",null,"Person in Charge:",-1)),V(" "+m(f.person_in_charge),1)])):s("v-if",!0),!f.manufacturer&&!((R=f.location)!=null&&R.name)&&!f.person_in_charge?(i(),p("div",Gi," No additional details available ")):s("v-if",!0)])]}),default:o(()=>{var A;return[a("div",{class:"equipment-card",onClick:R=>e.handleEquipmentClick(f)},[a("div",Zi,[(A=f.image_list)!=null&&A.length?(i(),N(G,{key:0,src:f.image_list[0],fit:"cover",class:"equipment-thumbnail"},{error:o(()=>[a("div",Xi,[r(u,null,{default:o(()=>[r(e.Tools)]),_:1})])]),_:2},1032,["src"])):(i(),p("div",$i,[r(u,null,{default:o(()=>[r(e.Tools)]),_:1})]))]),a("div",ed,[a("div",td,m(f.name||`Equipment ${f.id}`),1),a("div",ad,m(f.type||f.equipment_type||"Equipment"),1)])],8,Ki)]}),_:2},1024))),128))])):(i(),p("div",rd,[r(le,{description:"No equipment details available","image-size":60})]))])):s("v-if",!0),s(" Work Order Progress Section "),e.workOrderProgress?(i(),p("div",od,[r(Z),a("div",nd,[t[21]||(t[21]=a("h3",{class:"section-title"},"Task Progress",-1)),a("div",sd,[a("div",ld,[t[17]||(t[17]=a("span",{class:"stat-label"},"Total Tasks:",-1)),a("span",id,m(e.workOrderProgress.total),1)]),a("div",dd,[t[18]||(t[18]=a("span",{class:"stat-label"},"Completed:",-1)),a("span",cd,m(e.workOrderProgress.completed),1)]),a("div",ud,[t[19]||(t[19]=a("span",{class:"stat-label"},"Failed:",-1)),a("span",md,m(e.workOrderProgress.failed),1)]),a("div",_d,[t[20]||(t[20]=a("span",{class:"stat-label"},"Remaining:",-1)),a("span",fd,m(e.workOrderProgress.remaining),1)])])]),a("div",gd,[a("div",pd,[r(ue,{percentage:e.workOrderProgress.percentage,"stroke-width":12,status:e.workOrderProgress.percentage===100?"success":"primary"},null,8,["percentage","status"]),a("div",vd,m(e.workOrderProgress.completed)+" of "+m(e.workOrderProgress.total)+" tasks completed ",1)])])])):s("v-if",!0),s(" Attachments Section - Following equipment details pattern "),e.hasAttachments||e.hasFileAttachments?(i(),p("div",hd,[r(Z),s(" Images Section "),e.hasAttachments?(i(),p("div",yd,[r(J,{column:1},{default:o(()=>[r(I,{label:"Images"},{default:o(()=>[a("div",wd,[(i(!0),p(se,null,fe(d.workOrder.image_list,(f,A)=>(i(),N(G,{key:A,src:f,"preview-src-list":d.workOrder.image_list,fit:"cover",class:"workorder-image"},{error:o(()=>[a("div",kd,[r(u,null,{default:o(()=>[r(e.Picture)]),_:1})])]),_:2},1032,["src","preview-src-list"]))),128))])]),_:1})]),_:1})])):s("v-if",!0),s(" Files Section "),e.hasFileAttachments?(i(),p("div",bd,[r(J,{column:1,direction:"vertical"},{default:o(()=>[r(I,{label:"Files"},{default:o(()=>[a("div",Sd,[(i(!0),p(se,null,fe(e.processedFileList,f=>(i(),p("div",{key:f.id||f.name,class:"file-item"},[r($,{href:f.url,target:"_blank",icon:e.getFileIcon(f.type),class:"file-link"},{default:o(()=>[V(m(f.name),1)]),_:2},1032,["href","icon"])]))),128))])]),_:1})]),_:1})])):s("v-if",!0)])):s("v-if",!0),s(" Schedule Conditions Section "),e.isRecurring?Ct((i(),p("div",Td,[r(Z),a("div",Od,[a("h3",Cd,m(l.$t("workOrder.schedule.title")),1),r(g,{type:"default",size:"small",onClick:e.openTimelineModal,title:l.$t("workOrder.schedule.viewTimeline"),class:"timeline-button"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.View)]),_:1}),V(" "+m(l.$t("workOrder.schedule.viewTimeline")),1)]),_:1},8,["title"])],512),s(" Schedule Details "),r(J,{column:4,class:"general-details-descriptions",style:{"margin-left":"4px !important"}},{default:o(()=>[r(I,{label:l.$t("workOrder.schedule.repeatTypeLabel")},{default:o(()=>[a("span",Dd,m(l.$t("workOrder.schedule.timeBased")),1)]),_:1},8,["label"]),r(I,{label:l.$t("workOrder.schedule.frequencyLabel")},{default:o(()=>[a("span",Pd,m(l.$t("workOrder.schedule.weeklyPattern")),1)]),_:1},8,["label"]),r(I,{label:l.$t("workOrder.schedule.continuedFromLabel")},{default:o(()=>[a("span",{class:"detail-value linked-value",onClick:e.navigateToLinkedOrder},"Daily Wash - Washin Washer")]),_:1},8,["label"])]),_:1})],512)),[[Ga,!1]]):s("v-if",!0),s(" Time & Cost Tracking Card "),a("div",Ad,[r(Z),t[23]||(t[23]=a("h3",{class:"section-title"},"Tracking",-1)),s(" Tracking Tabs "),r(ne,{modelValue:e.activeTrackingTab,"onUpdate:modelValue":t[3]||(t[3]=f=>e.activeTrackingTab=f),class:"tracking-tabs"},{default:o(()=>[s(" Tasks Tab "),r(B,{label:"Tasks",name:"tasks"},{default:o(()=>[a("div",Id,[a("div",{class:Ae(["tasks-container",{"no-tasks":!e.taskEntries.length}])},[e.taskEntries.length?(i(),p("div",Vd,[(i(!0),p(se,null,fe(e.taskEntries,(f,A)=>(i(),N(e.WorkOrderTaskCard,{key:f.id||A,task:f,onPreview:e.handleTaskPreview,class:"task-card"},null,8,["task"]))),128))])):(i(),p("div",Fd,[r(le,{description:"No Tasks","image-size":120})]))],2)])]),_:1}),s(" Standards Tab "),r(B,{label:"Standards",name:"standards"},{default:o(()=>{var f,A;return[a("div",xd,[a("div",{class:Ae(["standards-container",{"no-standards":!((f=d.workOrder.standards)!=null&&f.length)}])},[(A=d.workOrder.standards)!=null&&A.length?(i(),p("div",Ed,[(i(!0),p(se,null,fe(d.workOrder.standards,R=>(i(),p("div",{key:R.id,class:"standard-item standard-card",onClick:j=>e.handleStandardPreview(R)},[a("div",Rd,[a("span",Ld,m(R.name),1),a("span",Md,m(R.code),1)]),s('                  <div v-if="standard.description" class="standard-description">{{ standard.description }}</div>'),a("div",qd,[R.category?(i(),N(me,{key:0,size:"small",class:"tag-item"},{default:o(()=>[V(m(e.formatCategoryName(R.category)),1)]),_:2},1024)):s("v-if",!0),R.library_instance==!1?(i(),N(me,{key:1,size:"small",type:"success",class:"tag-item"},{default:o(()=>[...t[22]||(t[22]=[V(" Work Order Only ")])]),_:1,__:[22]})):s("v-if",!0)])],8,Wd))),128))])):(i(),p("div",Ud,[r(le,{description:"No Standards","image-size":120})]))],2)])]}),_:1}),s(" Costs Tab "),r(B,{label:"Costs",name:"costs"},{default:o(()=>[a("div",zd,[a("div",Nd,[r(le,{description:"No Cost Data","image-size":120})])])]),_:1})]),_:1},8,["modelValue"])]),s(" Work Order Timeline Modal "),r(ee,{modelValue:e.timelineModalVisible,"onUpdate:modelValue":t[5]||(t[5]=f=>e.timelineModalVisible=f),title:l.$t("workOrder.timeline.title"),width:"850px","before-close":e.handleTimelineModalClose,top:"10vh",class:"timeline-modal"},{footer:o(()=>[a("span",Yd,[r(g,{onClick:t[4]||(t[4]=f=>e.timelineModalVisible=!1),style:{"margin-right":"12px"}},{default:o(()=>[V(m(l.$t("workOrder.actions.cancel")),1)]),_:1}),r(b,{onCommand:e.handleExportFormat,disabled:e.timelineEvents.length===0},{dropdown:o(()=>[r(T,null,{default:o(()=>[r(S,{command:"csv"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.DocumentCopy)]),_:1}),t[24]||(t[24]=V(" Export as CSV "))]),_:1,__:[24]})]),_:1})]),default:o(()=>[r(g,{type:"primary",disabled:e.timelineEvents.length===0},{default:o(()=>[r(u,{style:{"margin-right":"8px"}},{default:o(()=>[r(e.Download)]),_:1}),V(" "+m(l.$t("workOrder.timeline.export"))+" ",1),r(u,{class:"el-icon--right"},{default:o(()=>[r(e.ArrowDown)]),_:1})]),_:1},8,["disabled"])]),_:1},8,["disabled"])])]),default:o(()=>[e.timelineLoading?(i(),p("div",Bd,[r(ie,{rows:3,animated:""})])):e.isRecurring?e.timelineEvents.length===0?(i(),p("div",Hd,[r(le,{description:"No recurring work orders found","image-size":80})])):(i(),N(e.Timeline,{key:3,"timeline-events":e.timelineEvents,"current-work-order-id":d.workOrder.id},null,8,["timeline-events","current-work-order-id"])):(i(),p("div",jd,[r(le,{description:"This work order does not have recurring instances","image-size":80})]))]),_:1},8,["modelValue","title"]),s(" Delete Confirmation Modal for Recurring Work Orders "),r(ee,{modelValue:e.deleteDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=f=>e.deleteDialogVisible=f),title:"Delete Work Order",width:"480px","before-close":()=>e.deleteDialogVisible=!1,class:"delete-dialog"},{footer:o(()=>[a("div",Qd,[r(g,{onClick:t[6]||(t[6]=f=>e.deleteDialogVisible=!1),disabled:e.deleting},{default:o(()=>t[26]||(t[26]=[V(" Cancel ")])),_:1,__:[26]},8,["disabled"]),r(g,{type:"warning",onClick:t[7]||(t[7]=f=>e.handleDeleteConfirmation("individual")),loading:e.deleting},{default:o(()=>[r(u,null,{default:o(()=>[r(e.DocumentDelete)]),_:1}),t[27]||(t[27]=V(" Individual "))]),_:1,__:[27]},8,["loading"]),r(g,{type:"danger",onClick:t[8]||(t[8]=f=>e.handleDeleteConfirmation("recurrence")),loading:e.deleting},{default:o(()=>[r(u,null,{default:o(()=>[r(e.DocumentDelete)]),_:1}),t[28]||(t[28]=V(" Recurrence "))]),_:1,__:[28]},8,["loading"])])]),default:o(()=>[a("div",Jd,[r(u,{class:"warning-icon"},{default:o(()=>[r(e.Warning)]),_:1}),t[25]||(t[25]=a("div",{class:"delete-message"},[a("h4",null,"This is a recurring work order"),a("p",null,"Choose which work orders you want to delete:")],-1))])]),_:1},8,["modelValue","before-close"])])):s("v-if",!0),s(" Task Preview Dialog "),r(ee,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[10]||(t[10]=f=>e.showTaskPreviewDialog=f),title:`Task Preview: ${((re=e.selectedTaskForPreview)==null?void 0:re.task_name)||((Y=e.selectedTaskForPreview)==null?void 0:Y.name)||((_=e.selectedTaskForPreview)==null?void 0:_.taskListText)||"Task Details"}`,width:"700px","before-close":e.handleTaskPreviewClose,class:"task-preview-modal",top:"4vh"},{footer:o(()=>[a("div",Gd,[r(g,{onClick:e.handleTaskPreviewClose},{default:o(()=>t[29]||(t[29]=[V("Close")])),_:1,__:[29]})])]),default:o(()=>{var f;return[e.showTaskPreviewDialog?(i(),N(e.StepsPreview,{key:e.selectedTaskTemplateId||((f=e.selectedTaskForPreview)==null?void 0:f.id)||"task-preview","template-id":e.selectedTaskTemplateId,steps:e.selectedTaskSteps,interactive:!1,"show-mode-switch":!1},null,8,["template-id","steps"])):s("v-if",!0)]}),_:1},8,["modelValue","title"]),s(" Standard Preview Dialog "),r(ee,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[12]||(t[12]=f=>e.showStandardPreviewDialog=f),title:`Preview: ${((te=e.previewStandardData)==null?void 0:te.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:o(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(i(),N(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(i(),p(se,{key:1},[s(" Standalone Standard Preview "),a("div",Kd,[a("div",Zd,[s(" Fixed Header Section "),a("div",Xd,[a("div",$d,[r(ne,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[11]||(t[11]=f=>e.standalonePreviewTab=f),class:"details-tabs"},{default:o(()=>[r(B,{label:"General",name:"general"}),r(B,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),s(" Scrollable Content Area "),a("div",ec,[a("div",tc,[s(" General Tab Content "),e.standalonePreviewTab==="general"?(i(),p("div",ac,[a("div",rc,[a("div",oc,[r(J,{column:2,direction:"vertical"},{default:o(()=>[r(I,{width:"50%",label:"Category"},{default:o(()=>[V(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r(I,{width:"50%",label:"Total Rules"},{default:o(()=>{var f;return[a("span",nc,m(((f=e.previewStandardData.items)==null?void 0:f.length)||0)+" rules",1)]}),_:1}),r(I,{width:"50%",label:"Type"},{default:o(()=>[r(me,{type:"primary",size:"small"},{default:o(()=>t[30]||(t[30]=[V("Work Order Only")])),_:1,__:[30]})]),_:1})]),_:1})])]),e.previewStandardData.description?(i(),p("div",sc,[t[31]||(t[31]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",lc,[a("div",ic,m(e.previewStandardData.description),1)])])):s("v-if",!0)])):s("v-if",!0),s(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(i(),p("div",dc,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(i(),p("div",cc,[a("div",uc,[t[33]||(t[33]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(me,{type:"warning",size:"small"},{default:o(()=>t[32]||(t[32]=[V("Read Only")])),_:1,__:[32]})]),a("div",mc,[(i(!0),p(se,null,fe(e.previewStandardData.items,(f,A)=>(i(),p("div",{key:A,class:"rule-item"},[a("div",_c,m(A+1),1),a("div",fc,[a("div",gc,m(f),1)])]))),128))])])):(i(),p("div",pc,[r(le,{description:"No standard rules defined yet","image-size":60})]))])):s("v-if",!0)])])])])],2112)):s("v-if",!0)]),_:1},8,["modelValue","title"]),s(" Empty State "),d.workOrder?s("v-if",!0):(i(),p("div",vc,[r(le,{description:l.$t("workOrder.selectWorkOrder"),"image-size":120},null,8,["description"])]))],64)}const yc=Re(pi,[["render",hc],["__scopeId","data-v-54c8f79c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderDetail.vue"]]),wc=be({name:"AddTask"}),kc=Object.assign(wc,{props:{originPanel:{type:String,default:"create"},originWorkOrderId:{type:[Number,String],default:null}},emits:["close","addTemplates"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=it(),c=ht(),u=yt(),g=O([]),S=O(!1),T=O(""),b=O(0),w=O(1),F=O(20),P=O(new Set),I=O(null),J=O(!1),k=O(null),Z=O(!1),ie=L(()=>g.value.filter(A=>P.value.has(A.id||A._id))),G=L(()=>{const A=b.value===0?0:(w.value-1)*F.value+1,R=Math.min(w.value*F.value,b.value);return{start:A,end:R,total:b.value}}),le=async(A=!1)=>{var R,j,oe,ce;A&&(w.value=1),S.value=!0;try{const K={};(R=T.value)!=null&&R.trim()&&(K.keyword=T.value.trim());const X=await Sr(w.value,F.value,"createdAt","DESC",K),ke=((j=X.data)==null?void 0:j.content)||X.data||[];g.value=Array.isArray(ke)?ke:[],b.value=((oe=X.data)==null?void 0:oe.totalElements)||((ce=X.data)==null?void 0:ce.total)||X.totalElements||X.total||g.value.length}catch(K){console.error("Error fetching task templates:",K),U.error("Failed to load task templates"),g.value=[],b.value=0}finally{S.value=!1}},ue=A=>{w.value=A,le()},$=A=>{F.value=A,w.value=1,le()},B=A=>{const{id:R,action:j}=A;j==="check"?P.value.add(R):j==="uncheck"?P.value.delete(R):j==="focus"&&(I.value=R)},me=()=>{P.value.size>0&&(y("addTemplates",ie.value),P.value.clear(),y("close"))},ne=()=>{if(!I.value){U.warning("Please select a task template to preview");return}k.value=I.value,J.value=!0},ee=()=>{J.value=!1,k.value=null},W=()=>{ee()},re=()=>{if(!k.value)return"Template";const A=g.value.find(R=>(R.id||R._id||R.template_id)===k.value);return(A==null?void 0:A.name)||"Template"},Y=()=>{const A=c.fullPath||"/work-order/table";u.setReturnRoute(A);const R=e.originPanel==="edit"?"edit":"create";u.setReturnPanel(R),R==="edit"?(u.setReturnWorkOrderId(e.originWorkOrderId??null),u.setShouldOpenCreatePanel(!1)):(u.setReturnWorkOrderId(null),u.setShouldOpenCreatePanel(!0));const j={fromWorkOrder:"true",returnRoute:A,returnPanel:R};R==="edit"&&e.originWorkOrderId&&(j.returnWorkOrderId=String(e.originWorkOrderId)),h.push({name:"TaskDesigner",query:j}),y("close")},_=Ta(()=>{le(!0)},300),te=()=>{P.value.clear(),I.value=null,_()};ge(T,()=>{var A;(A=T.value)!=null&&A.trim()||(P.value.clear(),I.value=null,le(!0))}),Ue(()=>{le()});const f={props:e,emit:y,router:h,route:c,workOrderDraftStore:u,taskTemplates:g,loading:S,searchQuery:T,totalItems:b,currentPage:w,pageSize:F,selectedTemplates:P,focusedCardId:I,showPreviewDialog:J,previewTemplateId:k,isInteractive:Z,selectedTemplatesList:ie,paginationInfo:G,fetchTaskTemplates:le,handlePageChange:ue,handlePageSizeChange:$,handleTaskAction:B,handleAddTemplates:me,handlePreview:ne,handleBackToAddTask:ee,handleClosePreview:W,getPreviewTemplateTitle:re,handleNewTask:Y,debouncedSearch:_,handleSearch:te,__MACROS_defineComponent:be,ref:O,computed:L,onMounted:Ue,watch:ge,get Search(){return Ft},get ArrowLeft(){return Bt},get ElMessage(){return U},CardTable:eo,StepsPreview:ra,get searchTaskTemplates(){return Sr},get debounce(){return Ta},get useRouter(){return it},get useRoute(){return ht},get useWorkOrderDraftStore(){return yt}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),bc={class:"task-dialog-container"},Sc={key:0,class:"task-dialog-content"},Tc={class:"search-container"},Oc={class:"content-area"},Cc={key:0,class:"loading-container"},Dc={key:1,class:"empty-container"},Pc={key:2},Ac={class:"pagination-info"},Ic={class:"info-text"},Vc={class:"task-dialog-footer"},Fc={class:"footer-actions"},xc={class:"preview-dialog-header"},Ec=["id"];function Wc(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-input"),g=D("el-link"),S=D("el-skeleton"),T=D("el-empty"),b=D("el-option"),w=D("el-select"),F=D("el-button"),P=D("el-switch"),I=D("el-tooltip"),J=D("el-dialog");return i(),p("div",bc,[s(" Main Add Task Content "),e.showPreviewDialog?s("v-if",!0):(i(),p("div",Sc,[s(" Search Container (always visible) "),a("div",Tc,[r(u,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=k=>e.searchQuery=k),placeholder:"Search task templates...",size:"default",clearable:"",class:"search-input",onInput:e.handleSearch,onClear:e.handleSearch},{prefix:o(()=>[r(c,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"]),r(g,{type:"primary",onClick:e.handleNewTask,class:"new-task-link"},{default:o(()=>t[4]||(t[4]=[V(" + New Task ")])),_:1,__:[4]})]),s(" Content Area "),a("div",Oc,[e.loading?(i(),p("div",Cc,[r(S,{rows:4,animated:""})])):e.taskTemplates.length===0?(i(),p("div",Dc,[r(T,{description:"No task templates found","image-size":80})])):(i(),p("div",Pc,[s(" Pagination Info "),a("div",Ac,[a("div",Ic," Showing "+m(e.paginationInfo.start)+"-"+m(e.paginationInfo.end)+" of "+m(e.paginationInfo.total)+" templates ",1),r(w,{modelValue:e.pageSize,"onUpdate:modelValue":t[1]||(t[1]=k=>e.pageSize=k),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:o(()=>[r(b,{label:"10",value:10}),r(b,{label:"20",value:20}),r(b,{label:"50",value:50})]),_:1},8,["modelValue"])]),r(e.CardTable,{module:5,data:e.taskTemplates,maxHeight:"60vh",totalItems:e.totalItems,currentPage:e.currentPage,pageSize:e.pageSize,showBorder:!0,showPagination:!0,showSearch:!1,loading:e.loading,focusedCardId:e.focusedCardId,selectedItems:e.selectedTemplates,onSelection:e.handleTaskAction,onPageChange:e.handlePageChange},null,8,["data","totalItems","currentPage","pageSize","loading","focusedCardId","selectedItems"])]))])])),s(" Footer Actions "),a("div",Vc,[a("div",Fc,[r(F,{type:e.focusedCardId?"success":"",disabled:!e.focusedCardId,onClick:e.handlePreview},{default:o(()=>t[5]||(t[5]=[V(" Preview ")])),_:1,__:[5]},8,["type","disabled"]),r(F,{type:"primary",disabled:e.selectedTemplates.size===0,onClick:e.handleAddTemplates},{default:o(()=>[V(" Add Templates ("+m(e.selectedTemplates.size)+") ",1)]),_:1},8,["disabled"])])]),s(" Preview Dialog "),r(J,{modelValue:e.showPreviewDialog,"onUpdate:modelValue":t[3]||(t[3]=k=>e.showPreviewDialog=k),width:"700px",top:"5vh","before-close":e.handleClosePreview,class:"preview-dialog"},{header:o(({titleId:k})=>[a("div",xc,[r(F,{type:"text",onClick:e.handleBackToAddTask,class:"back-button"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:k,class:"dialog-title"}," Preview: "+m(e.getPreviewTemplateTitle()),9,Ec),r(I,{content:"Interactive Mode",placement:"top"},{default:o(()=>[r(P,{modelValue:e.isInteractive,"onUpdate:modelValue":t[2]||(t[2]=Z=>e.isInteractive=Z)},null,8,["modelValue"])]),_:1})])]),default:o(()=>[e.previewTemplateId?(i(),N(e.StepsPreview,{key:0,"template-id":e.previewTemplateId,interactive:e.isInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):s("v-if",!0)]),_:1},8,["modelValue"])])}const uo=Re(kc,[["render",Wc],["__scopeId","data-v-b224efd8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Task/AddTask.vue"]]),Rc=be({name:"AddStandard"}),Lc=Object.assign(Rc,{emits:["close","addStandards"],setup(l,{expose:t,emit:d}){t();const e=d,y=O([]),h=O(!1),c=O(""),u=O(0),g=O(1),S=O(20),T=O(new Set),b=O(null),w=O(!1),F=O(null),P=O(!1),I=O({name:"",description:"",category:"",items:[]}),J=O(!1),k=L(()=>y.value.filter(oe=>T.value.has(oe.id||oe._id))),Z=L(()=>{const oe=u.value===0?0:(g.value-1)*S.value+1,ce=Math.min(g.value*S.value,u.value);return{start:oe,end:ce,total:u.value}}),ie=async(oe=!1)=>{var ce,K,X,ke;oe&&(g.value=1),h.value=!0;try{const De={};(ce=c.value)!=null&&ce.trim()&&(De.keyword=c.value.trim());const Ve={page:g.value,size:S.value,sortField:"createdAt",direction:"DESC"},Te=await Tr(De,Ve),Le=((K=Te.data)==null?void 0:K.content)||Te.data||[];y.value=Array.isArray(Le)?Le:[],u.value=((X=Te.data)==null?void 0:X.totalElements)||((ke=Te.data)==null?void 0:ke.total)||Te.totalElements||Te.total||y.value.length}catch(De){console.error("Error fetching standards:",De),U.error("Failed to load standards"),y.value=[],u.value=0}finally{h.value=!1}},G=oe=>{g.value=oe,ie()},le=oe=>{S.value=oe,g.value=1,ie()},ue=oe=>{const{id:ce,action:K}=oe;K==="check"?T.value.add(ce):K==="uncheck"?T.value.delete(ce):K==="focus"&&(b.value=ce)},$=()=>{T.value.size>0&&(e("addStandards",k.value),T.value.clear(),e("close"))},B=()=>{if(!b.value){U.warning("Please select a standard to preview");return}F.value=b.value,w.value=!0},me=()=>{w.value=!1,F.value=null},ne=()=>{me()},ee=()=>{if(!F.value)return"Standard";const oe=y.value.find(ce=>(ce.id||ce._id||ce.standard_id)===F.value);return(oe==null?void 0:oe.name)||"Standard"},W=Ta(()=>{ie(!0)},300),re=()=>{T.value.clear(),b.value=null,W()},Y=()=>{I.value={name:"",description:"",category:"",items:[]},P.value=!0},_=()=>{P.value=!1,I.value={name:"",description:"",category:"",items:[]}},te=async oe=>{console.log("AddStandard received formData:",oe),P.value=!1,await f(oe)},f=async oe=>{try{await $e.confirm("Do you want to save this as a standard template or only for this work order?","Save Standard",{confirmButtonText:"Save as Template",cancelButtonText:"Save Only for Work Order",distinguishCancelAndClose:!0,type:"info"}),await A(oe)}catch(ce){ce==="cancel"&&R(oe)}},A=async oe=>{var ce,K;try{J.value=!0;const X={...oe,module:200},ke=await Or(X);U.success("Standard created successfully"),await ie(!0);const De=((ce=ke.data)==null?void 0:ce.id)||((K=ke.data)==null?void 0:K._id);De&&(T.value.add(De),b.value=De)}catch(X){console.error("Failed to create standard:",X),U.error("Failed to create standard")}finally{J.value=!1}},R=oe=>{console.log("createStandardForm.value:",oe);const ce={id:`work-order-standard-${Date.now()}`,name:oe.name,description:oe.description,category:oe.category,items:oe.items,estimated_minutes:15,isStandalone:!0};console.log("standaloneStandard:",ce),e("addStandards",[ce]),U.success("Standard added to work order"),e("close")};ge(c,()=>{var oe;(oe=c.value)!=null&&oe.trim()||(T.value.clear(),b.value=null,ie(!0))}),Ue(()=>{ie()});const j={emit:e,standardTemplates:y,loading:h,searchQuery:c,totalItems:u,currentPage:g,pageSize:S,selectedStandards:T,focusedCardId:b,showPreviewDialog:w,previewStandardId:F,showCreateStandardDialog:P,createStandardForm:I,createStandardLoading:J,selectedStandardsList:k,paginationInfo:Z,fetchStandards:ie,handlePageChange:G,handlePageSizeChange:le,handleStandardAction:ue,handleAddStandards:$,handlePreview:B,handleBackToAddStandard:me,handleClosePreview:ne,getPreviewStandardTitle:ee,debouncedSearch:W,handleSearch:re,handleCreateNewStandard:Y,handleCreateStandardCancel:_,handleCreateStandardSubmit:te,promptStandardSaveMode:f,handleSaveAsTemplate:A,handleSaveForWorkOrderOnly:R,__MACROS_defineComponent:be,ref:O,computed:L,onMounted:Ue,watch:ge,get Search(){return Ft},get ArrowLeft(){return Bt},get ElMessage(){return U},get ElMessageBox(){return $e},CardTable:eo,StandardsPreview:Pa,CreateStandardDialog:ro,get searchStandards(){return Tr},get createStandard(){return Or},get debounce(){return Ta}};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),Mc={class:"standard-dialog-container"},qc={key:0,class:"standard-dialog-content"},Uc={class:"search-container"},zc={class:"content-area"},Nc={key:0,class:"loading-container"},Bc={key:1,class:"empty-container"},jc={key:2},Hc={class:"pagination-info"},Yc={class:"info-text"},Jc={class:"standard-dialog-footer"},Qc={class:"footer-actions"},Gc={class:"preview-dialog-header"},Kc=["id"];function Zc(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-input"),g=D("el-link"),S=D("el-skeleton"),T=D("el-empty"),b=D("el-option"),w=D("el-select"),F=D("el-button"),P=D("el-dialog");return i(),p("div",Mc,[s(" Main Add Standard Content "),e.showPreviewDialog?s("v-if",!0):(i(),p("div",qc,[s(" Search Container (always visible) "),a("div",Uc,[r(u,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=I=>e.searchQuery=I),placeholder:"Search standards...",size:"default",clearable:"",class:"search-input",onInput:e.handleSearch,onClear:e.handleSearch},{prefix:o(()=>[r(c,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"]),r(g,{type:"primary",onClick:e.handleCreateNewStandard,class:"new-standard-link"},{default:o(()=>t[3]||(t[3]=[V(" + New Standard ")])),_:1,__:[3]})]),s(" Content Area "),a("div",zc,[e.loading?(i(),p("div",Nc,[r(S,{rows:4,animated:""})])):e.standardTemplates.length===0?(i(),p("div",Bc,[r(T,{description:"No standards found","image-size":80})])):(i(),p("div",jc,[s(" Pagination Info "),a("div",Hc,[a("div",Yc," Showing "+m(e.paginationInfo.start)+"-"+m(e.paginationInfo.end)+" of "+m(e.paginationInfo.total)+" standards ",1),r(w,{modelValue:e.pageSize,"onUpdate:modelValue":t[1]||(t[1]=I=>e.pageSize=I),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:o(()=>[r(b,{label:"10",value:10}),r(b,{label:"20",value:20}),r(b,{label:"50",value:50})]),_:1},8,["modelValue"])]),r(e.CardTable,{module:7,data:e.standardTemplates,maxHeight:"60vh",totalItems:e.totalItems,currentPage:e.currentPage,pageSize:e.pageSize,showBorder:!0,showPagination:!0,showSearch:!1,loading:e.loading,focusedCardId:e.focusedCardId,selectedItems:e.selectedStandards,onSelection:e.handleStandardAction,onPageChange:e.handlePageChange},null,8,["data","totalItems","currentPage","pageSize","loading","focusedCardId","selectedItems"])]))])])),s(" Footer Actions "),a("div",Jc,[a("div",Qc,[r(F,{type:e.focusedCardId?"success":"",disabled:!e.focusedCardId,onClick:e.handlePreview},{default:o(()=>t[4]||(t[4]=[V(" Preview ")])),_:1,__:[4]},8,["type","disabled"]),r(F,{type:"primary",disabled:e.selectedStandards.size===0,onClick:e.handleAddStandards},{default:o(()=>[V(" Add Standards ("+m(e.selectedStandards.size)+") ",1)]),_:1},8,["disabled"])])]),s(" Preview Dialog "),r(P,{modelValue:e.showPreviewDialog,"onUpdate:modelValue":t[2]||(t[2]=I=>e.showPreviewDialog=I),width:"700px",top:"5vh","before-close":e.handleClosePreview,class:"preview-dialog"},{header:o(({titleId:I})=>[a("div",Gc,[r(F,{type:"text",onClick:e.handleBackToAddStandard,class:"back-button"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:I,class:"dialog-title"}," Preview: "+m(e.getPreviewStandardTitle()),9,Kc)])]),default:o(()=>[e.previewStandardId?(i(),N(e.StandardsPreview,{key:0,"standard-id":e.previewStandardId},null,8,["standard-id"])):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Create Standard Dialog "),r(e.CreateStandardDialog,{visible:e.showCreateStandardDialog,"is-edit-mode":!1,"initial-data":e.createStandardForm,loading:e.createStandardLoading,onClose:e.handleCreateStandardCancel,onSubmit:e.handleCreateStandardSubmit},null,8,["visible","initial-data","loading"])])}const mo=Re(Lc,[["render",Zc],["__scopeId","data-v-2d1f5292"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Standard/AddStandard.vue"]]),Xc=be({name:"JsonTreeItem"}),$c=Object.assign(Xc,{props:{nodeKey:{type:[String,Number],required:!0},value:{required:!0},level:{type:Number,default:0},searchTerm:{type:String,default:""},forceExpand:{type:Boolean,default:!1},forceCollapse:{type:Boolean,default:!1}},emits:["reset-force-states"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=O(!1),c=L(()=>e.value!==null&&typeof e.value=="object"&&!Array.isArray(e.value)),u=L(()=>Array.isArray(e.value)),g=L(()=>!c.value&&!u.value),S=L(()=>e.value===null?"null":u.value?`array[${e.value.length}]`:c.value?`object{${Object.keys(e.value).length}}`:typeof e.value),T=L(()=>e.value===null?"null":typeof e.value=="string"?`"${e.value}"`:typeof e.value=="boolean"?e.value.toString():e.value),b=L(()=>{if(!e.searchTerm)return!0;const k=e.searchTerm.toLowerCase(),Z=String(e.nodeKey).toLowerCase().includes(k);if(g.value){const ie=String(e.value).toLowerCase();return Z||ie.includes(k)}return Z}),w=L(()=>{if(!e.searchTerm||g.value)return!1;const k=(Z,ie)=>{if(typeof Z=="object"&&Z!==null){for(const[G,le]of Object.entries(Z))if(String(G).toLowerCase().includes(ie)||String(le).toLowerCase().includes(ie)||typeof le=="object"&&k(le,ie))return!0}return!1};return k(e.value,e.searchTerm.toLowerCase())}),F=L(()=>!e.searchTerm||b.value||w.value),P=L(()=>e.searchTerm&&w.value);ge(()=>e.forceExpand,k=>{k&&!g.value&&(h.value=!0,y("reset-force-states"))}),ge(()=>e.forceCollapse,k=>{k&&!g.value&&(h.value=!1,y("reset-force-states"))}),ge(P,k=>{k&&!g.value&&(h.value=!0)});const J={props:e,emit:y,expanded:h,isObject:c,isArray:u,isLeaf:g,nodeType:S,displayValue:T,matchesSearch:b,hasMatchingChildren:w,isVisible:F,shouldAutoExpand:P,toggleExpanded:()=>{g.value||(h.value=!h.value)},__MACROS_defineComponent:be,ref:O,computed:L,watch:ge,get ArrowRight(){return Ja}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),eu={class:"item-key"},tu={key:1,class:"item-value"},au={key:0,class:"item-children"};function ru(l,t,d,e,y,h){const c=D("el-icon"),u=D("JsonTreeItem",!0);return Ct((i(),p("div",{class:Ae(["json-tree-item",{"search-highlight":e.matchesSearch&&d.searchTerm}]),style:Tt({paddingLeft:d.level*16+"px"})},[a("div",{class:Ae(["item-header",{"is-leaf":e.isLeaf,clickable:!e.isLeaf}]),onClick:e.toggleExpanded},[e.isLeaf?s("v-if",!0):(i(),N(c,{key:0,class:Ae(["expand-icon",{expanded:e.expanded}])},{default:o(()=>[r(e.ArrowRight)]),_:1},8,["class"])),a("span",eu,m(d.nodeKey)+":",1),a("span",{class:Ae(["item-type",e.nodeType])},m(e.nodeType),3),e.isLeaf?(i(),p("span",tu,m(e.displayValue),1)):s("v-if",!0)],2),e.expanded&&!e.isLeaf?(i(),p("div",au,[(i(!0),p(se,null,fe(d.value,(g,S)=>(i(),N(u,{key:S,"node-key":S,value:g,level:d.level+1,"search-term":d.searchTerm,"force-expand":d.forceExpand,"force-collapse":d.forceCollapse,onResetForceStates:t[0]||(t[0]=T=>e.emit("reset-force-states"))},null,8,["node-key","value","level","search-term","force-expand","force-collapse"]))),128))])):s("v-if",!0)],6)),[[Ga,e.isVisible]])}const ou=Re($c,[["render",ru],["__scopeId","data-v-ee860f8f"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/utils/logs/components/JsonTreeItem.vue"]]),nu=be({name:"JsonDebugDrawer"}),su=Object.assign(nu,{props:{modelValue:{type:Boolean,default:!1},payloadData:{type:Object,default:null},title:{type:String,default:"Request Payload"},subtitle:{type:String,default:"Click refresh to update"}},emits:["update:modelValue"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=L({get:()=>e.modelValue,set:ue=>y("update:modelValue",ue)}),c=O(""),u=O(!1),g=O(!1),S=O(!1),T=O(500),b=O(500),w=L(()=>`${b.value}px`),F=(ue,$)=>{let B;return function(...ne){const ee=()=>{clearTimeout(B),ue(...ne)};clearTimeout(B),B=setTimeout(ee,$)}},P=F(ue=>{let $=ue;$<300&&($=300),$>1200&&($=1200),b.value=$,$!==ue&&(T.value=$)},300);ge(T,ue=>{ue&&typeof ue=="number"&&P(ue)});const I=()=>{P(T.value)},J=()=>{h.value=!1},k=O(!0);ge(h,(ue,$)=>{ue!==$&&(k.value=!1,setTimeout(()=>{k.value=!0},150))});const le={props:e,emit:y,visible:h,searchTerm:c,forceExpandAll:u,forceCollapseAll:g,isAllExpanded:S,drawerWidth:T,actualDrawerWidth:b,drawerSize:w,debounce:F,debouncedWidthUpdate:P,updateDrawerWidth:I,closeDrawer:J,isDrawerStable:k,copyToClipboard:async()=>{try{const ue=JSON.stringify(e.payloadData,null,2);await navigator.clipboard.writeText(ue),U.success("Payload copied to clipboard!")}catch(ue){console.error("Failed to copy to clipboard:",ue),U.error("Failed to copy to clipboard")}},toggleExpandCollapse:()=>{S.value?(u.value=!1,g.value=!0,S.value=!1):(g.value=!1,u.value=!0,S.value=!0),setTimeout(()=>{u.value=!1,g.value=!1},100)},resetForceStates:()=>{u.value=!1,g.value=!1},__MACROS_defineComponent:be,ref:O,computed:L,watch:ge,get ElMessage(){return U},get Close(){return Po},get DocumentCopy(){return Jr},get Search(){return Ft},get Plus(){return Ca},get Minus(){return Do},JsonTreeItem:ou};return Object.defineProperty(le,"__isScriptSetup",{enumerable:!1,value:!0}),le}}),lu={class:"drawer-header"},iu={class:"drawer-actions"},du={class:"width-control"},cu={class:"drawer-content"},uu={class:"payload-info"},mu={key:0,class:"controls-bar"},_u={class:"search-container"},fu={class:"control-buttons"},gu={class:"json-tree-container"},pu={key:0,class:"json-tree"},vu={key:1,class:"loading-tree"},hu={key:2,class:"no-payload"};function yu(l,t,d,e,y,h){const c=D("el-text"),u=D("el-input"),g=D("el-button"),S=D("el-drawer");return i(),p("div",null,[s(" JSON Payload Drawer "),r(S,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=T=>e.visible=T),direction:"ltr",modal:!1,"show-close":!1,"lock-scroll":!1,"close-on-click-modal":!1,"append-to-body":!0,size:e.drawerSize,class:"json-payload-drawer","z-index":99999},{header:o(()=>[a("div",lu,[a("h3",null,m(d.title),1),a("div",iu,[a("div",du,[r(c,{size:"small"},{default:o(()=>t[3]||(t[3]=[V("Width:")])),_:1,__:[3]}),r(u,{modelValue:e.drawerWidth,"onUpdate:modelValue":t[0]||(t[0]=T=>e.drawerWidth=T),modelModifiers:{number:!0},size:"small",type:"number",min:300,max:1200,style:{width:"80px"},onChange:e.updateDrawerWidth},null,8,["modelValue"]),r(c,{size:"small"},{default:o(()=>t[4]||(t[4]=[V("px")])),_:1,__:[4]})]),r(g,{size:"small",onClick:e.copyToClipboard,icon:e.DocumentCopy},{default:o(()=>t[5]||(t[5]=[V(" Copy ")])),_:1,__:[5]},8,["icon"]),r(g,{size:"small",onClick:e.closeDrawer,icon:e.Close},{default:o(()=>t[6]||(t[6]=[V(" Close ")])),_:1,__:[6]},8,["icon"])])])]),default:o(()=>[a("div",cu,[a("div",uu,[r(c,{type:"info",size:"small"},{default:o(()=>[V(" Fields: "+m(d.payloadData?Object.keys(d.payloadData).length:0)+" | "+m(d.subtitle),1)]),_:1})]),s(" Search and Controls Bar "),d.payloadData?(i(),p("div",mu,[a("div",_u,[r(u,{modelValue:e.searchTerm,"onUpdate:modelValue":t[1]||(t[1]=T=>e.searchTerm=T),placeholder:"Search keys and values...",size:"small",clearable:"","prefix-icon":e.Search,class:"search-input"},null,8,["modelValue","prefix-icon"])]),a("div",fu,[r(g,{size:"small",onClick:e.toggleExpandCollapse,icon:e.isAllExpanded?e.Minus:e.Plus,type:e.isAllExpanded?"warning":"primary"},{default:o(()=>[V(m(e.isAllExpanded?"Collapse All":"Expand All"),1)]),_:1},8,["icon","type"])])])):s("v-if",!0),a("div",gu,[d.payloadData&&e.isDrawerStable?(i(),p("div",pu,[(i(!0),p(se,null,fe(d.payloadData,(T,b)=>(i(),N(e.JsonTreeItem,{key:b,"node-key":b,value:T,level:0,"search-term":e.searchTerm,"force-expand":e.forceExpandAll,"force-collapse":e.forceCollapseAll,onResetForceStates:e.resetForceStates},null,8,["node-key","value","search-term","force-expand","force-collapse"]))),128))])):d.payloadData&&!e.isDrawerStable?(i(),p("div",vu,[r(c,{type:"info",size:"small"},{default:o(()=>t[7]||(t[7]=[V("Loading...")])),_:1,__:[7]})])):(i(),p("div",hu,[r(c,{type:"placeholder"},{default:o(()=>t[8]||(t[8]=[V('Click "Logs" to view payload')])),_:1,__:[8]})]))])])]),_:1},8,["modelValue","size"])])}const Xa=Re(su,[["render",yu],["__scopeId","data-v-678a2ab6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/utils/logs/components/JsonDebugDrawer.vue"]]),zt=()=>{const l=O(null),t=O(!1);return{currentPayload:l,showJsonDisplayer:t,logPayload:(y,h="default",c={})=>{const u=Qe(y);l.value=u,t.value=!0;const g={timestamp:new Date().toISOString(),context:h,metadata:c,data:u};console.log(`[${h}] Payload Debug:`,g)},closeDebugDrawer:()=>{t.value=!1}}},Qe=l=>{if(l==null||typeof l!="object")return l;if(l instanceof Date)return new Date(l.getTime());if(Array.isArray(l))return l.map(d=>Qe(d));const t={};for(const d in l)l.hasOwnProperty(d)&&(t[d]=Qe(l[d]));return t},$t=(l,t="default")=>{const d=Qe(l);switch(d._transform={context:t,timestamp:new Date().toISOString(),version:"1.0.0"},t){case"workOrderCreate":d._context="Work Order Creation";break;case"workOrderUpdate":d._context="Work Order Update";break;case"workOrderEdit":d._context="Work Order Edit";break;default:d._context="Generic"}return d},wu={__name:"EditStandardDialog",props:{visible:{type:Boolean,default:!1},standard:{type:Object,default:()=>({})}},emits:["update:visible","update:standard"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=O(!1),c=()=>{y("update:visible",!1)},g={props:e,emit:y,loading:h,handleClose:c,handleSubmit:async S=>{h.value=!0;try{e.standard.isStandalone?(y("update:standard",{...e.standard,...S,isStandalone:!0}),U.success("Standard updated for this work order.")):(await Cr(e.standard.standardId,S),U.success("Standard template updated successfully."),y("update:standard",{...e.standard,...S})),c()}catch(T){console.error("Failed to update standard:",T),U.error("Failed to update standard.")}finally{h.value=!1}},ref:O,get ElMessage(){return U},CreateStandardDialog:ro,get updateStandard(){return Cr}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}};function ku(l,t,d,e,y,h){return i(),N(e.CreateStandardDialog,{visible:d.visible,"is-edit-mode":!0,"initial-data":d.standard,loading:e.loading,onClose:e.handleClose,onSubmit:e.handleSubmit},null,8,["visible","initial-data","loading"])}const _o=Re(wu,[["render",ku],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/EditStandardDialog.vue"]]),bu=be({name:"WorkOrderCreate"}),Su=Object.assign(bu,{emits:["back-to-detail","work-order-created"],setup(l,{expose:t,emit:d}){const e=O(!1),y=O(!1),h=O(!1),c=O(null),u=O(!1),g=O(null),S=O(""),T=O([]),b=O(!1),w=O(!1),F=O(null),P=O(null),I=O(null),J=O(!1),k=O("general"),{currentPayload:Z,showJsonDisplayer:ie,logPayload:G,closeDebugDrawer:le}=zt(),ue=()=>{y.value=!0},$=()=>{y.value=!1},B=()=>{e.value=!0},me=()=>{e.value=!1},ne=({id:C,action:H,data:q})=>{H==="edit"?dt(q):H==="preview"?he(q):H==="delete"&&(x.tasks=x.tasks.filter(ae=>ae.id!==C),Ge(),U.success(`Task "${q.name}" removed`))},ee=({taskId:C,assigneeIds:H,taskData:q})=>{const ae=x.tasks.findIndex(Ee=>Ee.id===C);if(ae===-1){U.error("Task not found");return}x.tasks[ae].assignee_ids=H,x.tasks[ae].payload&&(x.tasks[ae].payload.assignee_ids=H),Ge();const Oe=Dt.value.filter(Ee=>H.includes(Ee.id)).map(Ee=>Ee.name).join(", ");H.length===0?U.success(`Removed all assignees from "${q.name}"`):U.success(`Updated assignees for "${q.name}": ${Oe}`)},W=({taskId:C,taskData:H,currentAssigneeIds:q})=>{var Oe;g.value=H,S.value="";const ae=((Oe=H.payload)==null?void 0:Oe.assignee_ids)||H.assignee_ids||[];T.value=[...ae],u.value=!0},re=L(()=>{if(!S.value)return Dt.value;const C=S.value.toLowerCase();return Dt.value.filter(H=>H.name.toLowerCase().includes(C)||H.email&&H.email.toLowerCase().includes(C))}),Y=C=>T.value.includes(C),_=C=>{Y(C.id)?f(C.id):te(C.id)},te=C=>{T.value.includes(C)||T.value.push(C)},f=C=>{T.value=T.value.filter(H=>H!==C)},A=()=>{T.value=[]},R=()=>T.value.map(C=>Dt.value.find(q=>q.id===C)||{id:C,name:`User #${C}`,email:""}),j=()=>{g.value&&(ee({taskId:g.value.id,assigneeIds:[...T.value],taskData:g.value}),oe())},oe=()=>{u.value=!1,g.value=null,T.value=[],S.value=""},ce=({id:C,action:H,data:q})=>{H==="edit"?(c.value=q,h.value=!0):H==="preview"?Pe(q):H==="delete"&&(x.standards=x.standards.filter(ae=>ae.id!==C),Ke(),U.success(`Standard "${q.name}" removed`))},K=C=>{const H=x.standards.findIndex(q=>q.id===C.id);H!==-1&&(x.standards.splice(H,1,C),Ke())},X=C=>{C()},ke=C=>{if(!C||C.length===0)return;const H=C.map(q=>Ut(q));x.tasks.push(...H),z(H),Ge(),U.success(`${C.length} task template${C.length>1?"s":""} added successfully`),me()},De=()=>{if(x.tasks.length===0){U.warning("No tasks selected to delete");return}$e.confirm(`Are you sure you want to clear all ${x.tasks.length} task${x.tasks.length>1?"s":""}?`,"Confirm Clear All Tasks",{confirmButtonText:"Clear All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{x.tasks=[],Ge(),U.success("All task selections cleared")}).catch(()=>{})},Ve=C=>{if(!C||C.length===0)return;const H=x.standards.length>0?Math.max(...x.standards.map(ae=>typeof ae.id=="number"?ae.id:0)):0,q=C.map((ae,Oe)=>{const Ee=H+Oe+1;return{...ae,id:Ee,name:ae.name||ae.title,items:ae.items||[],standardId:ae.id||ae._id}});x.standards.push(...q),Ke(),U.success(`${C.length} standard${C.length>1?"s":""} added successfully`),$()},Te=()=>{if(x.standards.length===0){U.warning("No standards selected to delete");return}$e.confirm(`Are you sure you want to clear all ${x.standards.length} standard${x.standards.length>1?"s":""}?`,"Confirm Clear All Standards",{confirmButtonText:"Clear All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{x.standards=[],Ke(),U.success("All standard selections cleared")}).catch(()=>{})},Le=C=>{C()},he=C=>{if(C.source==="adhoc"&&C.steps){P.value=C,F.value=null,b.value=!0;return}const H=C.templateId||C.template_id||C.id;if(!H){U.warning("Cannot preview this task - no template ID found");return}F.value=H,P.value=null,b.value=!0},Pe=C=>{I.value=C,w.value=!0},tt=()=>{b.value=!1,F.value=null,P.value=null},Je=()=>{tt()},ot=()=>{if(P.value)return P.value.name||"Task";if(!F.value)return"Task";const C=x.tasks.find(H=>(H.templateId||H.template_id||H.id)===F.value);return(C==null?void 0:C.name)||"Task"},dt=async C=>{var H,q;try{_t.value=!0;const ae=C.templateId||C.template_id,Oe=C.source==="adhoc"&&!ae;if(!ae&&!Oe){U.warning("This task was created specifically for this work order and cannot be edited as a template.");return}U.info("Opening template editor..."),je.setReturnRoute(ut.fullPath),je.setReturnPanel("create"),je.setReturnWorkOrderId(null),je.setShouldOpenCreatePanel(!0),Oe?await ct.push({name:"TaskDesignerEdit",params:{id:"standalone"},query:{fromWorkOrder:"true",workOrderId:x.name||"New Work Order",workOrderName:x.name||"New Work Order",taskId:C.id,standalone:"true",taskData:JSON.stringify(C),returnPanel:"create"}}):await ct.push({name:"TaskDesignerEdit",params:{id:ae},query:{fromWorkOrder:"true",workOrderId:x.name||"New Work Order",workOrderName:x.name||"New Work Order",taskId:C.id,originalTemplateId:ae,returnPanel:"create"}})}catch(ae){console.error("Failed to open template editor:",ae);const Oe=((q=(H=ae.response)==null?void 0:H.data)==null?void 0:q.message)||ae.message||"Failed to open task editor";U.error(Oe)}finally{_t.value=!1}},nt=d,{t:at}=Be(),ct=it(),ut=ht(),mt=Sa(),je=yt(),ft=C=>{const H=C.template_id||C.id;x.tasks.forEach((q,ae)=>{if(q.source==="template"&&(q.templateId===H||q.template_id===H)){const Oe=Ut(C);x.tasks[ae]={...q,...Oe,id:q.id,payload:{...q.payload||{},...Oe.payload}},M(x.tasks[ae])}}),Ge(),x.tasks.some(q=>q.templateId===H||q.template_id===H)&&U.success(`Tasks updated with latest template changes: ${C.name}`)};Ue(()=>{je.setCreateMode(),pe(),Yt(),mt.addTemplateUpdateListener(ft)}),Ot(()=>{mt.removeTemplateUpdateListener(ft)});const x=et(St());let ze=!1;const Ge=()=>{x.task_list=x.tasks.map(C=>Qe(C.payload)).filter(C=>C&&Array.isArray(C.steps)&&C.steps.length>0)},Ke=()=>{x.standard_list=x.standards.map(C=>{const{id:H,standardId:q,...ae}=C;return C.isStandalone?{...ae,module:200}:{...ae,standard_id:q,module:200}})},v=C=>{if(C&&typeof C=="object"){if(Object.prototype.hasOwnProperty.call(C,"name"))return{id:C.id??C.value??null,name:C.name??C.label??""};if(Object.prototype.hasOwnProperty.call(C,"label"))return{id:C.value??null,name:C.label??""}}const H=typeof C=="number"?C:Number.parseInt(C,10);if(Number.isNaN(H))return null;const q=Ht.value.find(ae=>ae.id===H);return q?{id:q.id,name:q.name}:null},M=C=>{var Oe,Ee;if(!C)return!1;const H=((Oe=C.payload)==null?void 0:Oe.category_id)??((Ee=C.payload)==null?void 0:Ee.categoryId)??null,q=v(C.category??H);let ae=!1;if(q?((!C.category||C.category.id!==q.id||C.category.name!==q.name)&&(C.category={id:q.id,name:q.name},ae=!0),C.category_name!==q.name&&(C.category_name=q.name,ae=!0),C.payload&&C.payload.category_id!==q.id&&(C.payload.category_id=q.id??null,ae=!0)):typeof C.category=="string"&&C.category_name!==C.category&&(C.category_name=C.category,ae=!0),C.category&&!C.category_name){const Xe=C.category.name??C.category.label??"";C.category_name!==Xe&&(C.category_name=Xe,ae=!0)}return ae},z=C=>{if(!Array.isArray(C))return!1;let H=!1;return C.forEach(q=>{H=M(q)||H}),H},pe=()=>{ze=!0;const C=je.hasDraft?Ba(je.draftForm):St();Object.assign(x,C),z(x.tasks),Ge(),Ke(),Me(()=>{ze=!1,je.saveContextAwareDraft(x,"create")})};ge(()=>x.tasks,()=>{ze||(z(x.tasks),Ge())},{deep:!0}),ge(()=>x.standards,()=>{ze||Ke()},{deep:!0}),ge(x,()=>{ze||je.saveContextAwareDraft(x,"create")},{deep:!0});const we=(C,H,q)=>{if(!H){q(new Error("Start date is required"));return}const ae=new Date,Oe=new Date(H),Ee=new Date(ae.getTime()-30*24*60*60*1e3);if(Oe<Ee){q(new Error("Start date is more than 30 days in the past. Please verify this is correct."));return}q()},Ce=(C,H,q)=>{if(!H){q(new Error("Due date is required"));return}const ae=new Date(H),Oe=x.start_date?new Date(x.start_date):null;if(Oe&&ae<=Oe){q(new Error("Due date must be after start date"));return}const Ee=new Date,Xe=new Date(Ee.getTime()+2*365*24*60*60*1e3);if(ae>Xe){q(new Error("Due date cannot be more than 2 years in the future"));return}q()},Se=(C,H,q)=>{if(!H){q();return}const ae=x.recurrence_setting;if(!ae||!ae.start_date_time){q();return}if(x.start_date){const Oe=new Date(x.start_date);if(new Date(ae.start_date_time)<Oe){q(new Error("Recurrence start time cannot be before work order start date"));return}}q()},He=(C,H,q)=>{if(!H){q();return}const ae=x.recurrence_setting;if(!ae||!ae.start_date_time){q();return}const Oe=new Date(ae.start_date_time);if(new Date(ae.end_date_time)<=Oe){q(new Error("Recurrence end time must be after recurrence start time"));return}q()},st=(C,H,q)=>{if(!H){q(new Error("Start time is required for recurring work orders"));return}q()},gt=(C,H,q)=>{if(!H){q(new Error("End time is required for recurring work orders"));return}const ae=x.recurrence_setting;if(!ae||!ae.start_time){q();return}const Oe=ae.start_time,Ee=H;if(!Oe||!Ee){q();return}const Xe=Mt=>{const[Kt,It]=Mt.split(":").map(Number);return Kt*60+It},Lt=Xe(Oe);if(Xe(Ee)<=Lt){q(new Error("End time must be after start time"));return}q()},xt=et({name:[{required:!0,message:at("workOrder.validation.taskTitleRequired"),trigger:"blur"}],category_ids:[{required:!0,message:"At least one category is required",trigger:"change"}],equipment_node_ids:[{required:!0,message:"At least one equipment is required",trigger:"change"}],work_type_id:[{required:!0,message:at("workOrder.validation.workTypeRequired"),trigger:"change"}],priority_id:[{required:!0,message:at("workOrder.validation.priorityRequired"),trigger:"change"}],start_date:[{required:!0,message:"Start date is required",trigger:"change"},{validator:we,trigger:"change"}],due_date:[{required:!0,message:"Due date is required",trigger:"change"},{validator:Ce,trigger:"change"}],"recurrence_setting.start_date_time":[{validator:Se,trigger:"change"}],"recurrence_setting.end_date_time":[{validator:He,trigger:"change"}],"recurrence_setting.start_time":[{validator:st,trigger:"change"}],"recurrence_setting.end_time":[{validator:gt,trigger:"change"}]}),Et={children:"children",label:"name",value:"id"},pt=O([]),jt=O([]),Ht=O([]),Wt=O([]),oa=O([]),_t=O(!1),Dt=O([{id:84,name:"System"},{id:37,name:"Erik Yu"},{id:43,name:"Chang Shi"},{id:45,name:"Maxwell Wang"},{id:46,name:"Justin Li"},{id:47,name:"Justin Tung"},{id:48,name:"Eric Huang"}]),na=O([{id:36,name:"Yao Li"},{id:41,name:"John Li"}]),Ye=O(null),Yt=async()=>{var C,H;try{_t.value=!0;const[q,ae,Oe,Ee,Xe]=await Promise.all([ha(),ya(),wa(),ka(),ba()]);q.data&&(jt.value=q.data),ae.data&&(pt.value=ae.data),Oe.data&&(Ht.value=Oe.data),Ee.data&&(Wt.value=Ee.data),Xe.data&&(oa.value=Xe.data),z(x.tasks)}catch(q){console.error("WorkOrderCreate: Failed to load form data:",q);const ae=((H=(C=q.response)==null?void 0:C.data)==null?void 0:H.message)||q.message||at("workOrder.messages.loadDataFailed");U.error(ae),(!jt.value.length||!pt.value.length)&&U.warning(at("workOrder.messages.criticalDataMissing"))}finally{_t.value=!1}},Pt=C=>{if(!C)return null;const H=C.replace(" ","T"),q=new Date(H);return isNaN(q.getTime())?null:q.toISOString()},sa=C=>{x.image_list=C},Ia=C=>{x.file_list=C},la=async()=>{try{let C=[],H=[];return x.image_list.length>0&&(C=(await Xt(x.image_list)).data.uploadedFiles||[],x.image_list=C.map(ae=>ae.url)),x.file_list.length>0&&(H=(await Xt(x.file_list)).data.uploadedFiles||[],x.file_list=H.map(ae=>ae.url)),{uploadedImages:C,uploadedFiles:H}}catch(C){throw console.error("File upload failed:",C),new Error("File upload failed")}},Rt=()=>x.name&&x.name.trim()!==""||x.description&&x.description.trim()!==""||x.tasks.length>0||x.standards.length>0||x.category_ids&&x.category_ids.length>0||x.equipment_node_ids&&x.equipment_node_ids.length>0||x.approved_by_id&&x.approved_by_id!==null||x.work_type_id&&x.work_type_id!==null||x.priority_id&&x.priority_id!==null||x.state_id&&x.state_id!==1||x.start_date&&x.start_date!==null||x.due_date&&x.due_date!==null||x.vendor_ids&&x.vendor_ids.length>0||x.image_list&&x.image_list.length>0||x.file_list&&x.file_list.length>0,Jt=()=>{if(!Rt()){nt("back-to-detail");return}$e.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Ye.value&&Ye.value.resetFields(),ze=!0,Object.assign(x,St()),Ge(),Ke(),je.clearDraft(),Me(()=>{ze=!1}),nt("back-to-detail")}).catch(()=>{})},Va=()=>{if(!Rt()){nt("back-to-detail");return}$e.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Ye.value&&Ye.value.resetFields(),ze=!0,Object.assign(x,St()),Ge(),Ke(),je.clearDraft(),Me(()=>{ze=!1}),nt("back-to-detail")}).catch(()=>{})},Qt=()=>{Ye.value&&Ye.value.resetFields(),ze=!0,Object.assign(x,St()),Ge(),Ke(),je.clearDraft(),Me(()=>{ze=!1})},Fa=()=>{$e.confirm("Are you sure you want to reset the form? All unsaved changes will be lost.","Confirm Reset",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Qt(),U.success(at("workOrder.messages.formReset"))}).catch(()=>{})};let bt=null;const At=O(!1),ia=()=>{if(At.value)return;At.value=!0,bt&&clearTimeout(bt),bt=setTimeout(()=>{At.value=!1},500);const C=Gt();G(C,"workOrder",{delay:50,showMessage:!0})},Gt=()=>{const C=Pt(x.due_date),H=Pt(x.start_date),q={name:x.name,category_ids:x.category_ids,priority_id:x.priority_id,state_id:x.state_id,work_type_id:x.work_type_id,start_date:H,due_date:C,recurrence_setting_request:x.recurrence_setting_request,task_list:x.task_list,time_zone:x.time_zone,equipment_node_ids:x.equipment_node_ids,description:x.description,location_id:x.location_id,recurrence_uuid:x.recurrence_uuid,halt_type:x.halt_type,recurrence_type_id:x.recurrence_type||x.recurrence_type_id||1,approved_by_id:x.approved_by_id,image_list:x.image_list,file_list:x.file_list,standard_list:x.standard_list||[],request_id:x.request_id,parent_work_order_id:x.parent_work_order_id,vendor_ids:x.vendor_ids};return $t(q,"workOrderCreate")},xa=C=>{const H=new Date;H.setDate(H.getDate()-30);const q=new Date;return q.setFullYear(q.getFullYear()+2),C<H||C>q},Ea=C=>{const H=new Date;return H.setFullYear(H.getFullYear()+2),C>H},Wa=L(()=>x.start_date&&x.due_date),da=()=>{if(!x.start_date||!x.due_date)return"";const C=new Date(x.start_date),q=new Date(x.due_date)-C;if(q<=0)return"Invalid duration";const ae=Math.floor(q/(1e3*60*60*24)),Oe=Math.floor(q%(1e3*60*60*24)/(1e3*60*60)),Ee=Math.floor(q%(1e3*60*60)/(1e3*60));return ae>0?`${ae} day${ae!==1?"s":""} ${Oe}h ${Ee}m`:Oe>0?`${Oe}h ${Ee}m`:`${Ee} minute${Ee!==1?"s":""}`};ge(()=>x.recurrence_setting,C=>{C&&typeof C=="object"&&(x.recurrence_type=C.recurrence_type,x.recurrence_type_id=C.recurrence_type,x.recurrence_setting_request={start_date_time:C.start_date_time||x.start_date,end_date_time:C.end_date_time,month_of_year:C.month_of_year,day_of_month:C.day_of_month,days_of_week:C.days_of_week,interval:C.interval,duration_minutes:C.duration_minutes})},{deep:!0}),ge(()=>x.start_date,()=>{Me(()=>{Ye.value&&x.due_date&&Ye.value.validateField("due_date"),Ye.value&&x.recurrence_setting&&x.recurrence_setting.start_date_time&&Ye.value.validateField("recurrence_setting.start_date_time")})}),ge(()=>x.due_date,()=>{Me(()=>{Ye.value&&x.start_date&&Ye.value.validateField("start_date"),Ye.value&&x.recurrence_setting&&x.recurrence_setting.end_date_time&&Ye.value.validateField("recurrence_setting.end_date_time")})}),ge(()=>x.recurrence_setting,C=>{C&&(C.start_date_time||C.end_date_time)&&Me(()=>{Ye.value&&(C.start_date_time&&Ye.value.validateField("recurrence_setting.start_date_time"),C.end_date_time&&Ye.value.validateField("recurrence_setting.end_date_time"))})},{deep:!0});const Ra=async()=>{var C,H;if(Ye.value)try{if(!await Ye.value.validate()){U.error(at("workOrder.messages.validationFailed"));return}_t.value=!0,(x.image_list.length>0||x.file_list.length>0)&&await la();const ae=Pt(x.due_date),Oe=Pt(x.start_date);!x.recurrence_setting_request.start_date_time&&Oe&&(x.recurrence_setting_request.start_date_time=Oe);const Ee=x.recurrence_type||x.recurrence_type_id||1;Ge(),Ke();const Xe=Array.isArray(x.task_list)?x.task_list:[];if(Xe.length===0){U.error("Please add at least one task before creating the work order."),_t.value=!1;return}const Lt=Xe.map(wt=>{const Ze=Qe(wt);return Ze.work_order_id=Ze.work_order_id??0,Ze.state=Ze.state??Zt,Ze.time_estimate_sec=Ze.time_estimate_sec&&Ze.time_estimate_sec>0?Ze.time_estimate_sec:1800,Ze.steps=Array.isArray(Ze.steps)?Ze.steps:[],Ze.assignee_ids=Array.isArray(Ze.assignee_ids)?Ze.assignee_ids:[],Ze});if(Lt.some(wt=>!Array.isArray(wt.steps)||wt.steps.length===0)){U.error("Each task must include at least one step."),_t.value=!1;return}const Mt={...Gt(),task_list:Lt,recurrence_type:Ee,recurrence_type_id:Ee},Kt=$t(Mt,"workOrderCreate"),It=await mr(Kt);U.success("Work order created successfully!"),(Array.isArray(It.data)?It.data:[It.data]).forEach((wt,Ze)=>{nt("work-order-created",wt)}),Qt()}catch(q){console.error("Failed to create work order:",q);const ae=((H=(C=q.response)==null?void 0:C.data)==null?void 0:H.message)||q.message||at("workOrder.messages.createFailed");U.error(ae)}finally{_t.value=!1}};t({hasFormChanges:Rt});const ca={showAddTaskDialog:e,showAddStandardDialog:y,showEditStandardDialog:h,editingStandard:c,showTaskAssigneeDialog:u,currentEditingTask:g,userSearchQuery:S,localSelectedTaskAssignees:T,showTaskPreviewDialog:b,showStandardPreviewDialog:w,previewTaskTemplateId:F,previewTaskData:P,previewStandardData:I,isTaskInteractive:J,standalonePreviewTab:k,currentPayload:Z,showJsonDisplayer:ie,logPayload:G,closeDebugDrawer:le,handleAddStandard:ue,closeAddStandardDialog:$,handleAddTask:B,closeAddTaskDialog:me,handleTaskAction:ne,handleTaskAssigneeUpdate:ee,handleOpenAssigneeDialog:W,filteredAssigneeOptions:re,isUserSelected:Y,toggleUser:_,addSelectedUser:te,removeSelectedUser:f,clearAllAssignees:A,getSelectedUserObjects:R,saveTaskAssignees:j,resetTaskAssigneeDialog:oe,handleStandardAction:ce,onStandardUpdate:K,handleCloseAddTaskDialog:X,onAddTaskTemplates:ke,handleDeleteAllTasks:De,onAddStandards:Ve,handleDeleteAllStandards:Te,handleCloseAddStandardDialog:Le,handlePreviewTask:he,handlePreviewStandard:Pe,handleBackToTaskList:tt,handleCloseTaskPreview:Je,getPreviewTaskTitle:ot,handleEditTask:dt,emit:nt,t:at,router:ct,currentRoute:ut,taskLibraryStore:mt,workOrderDraftStore:je,handleTemplateUpdate:ft,form:x,get isHydratingForm(){return ze},set isHydratingForm(C){ze=C},syncTaskPayloads:Ge,syncStandards:Ke,resolveCategoryMeta:v,decorateTaskCategory:M,decorateTasksCategories:z,hydrateFormFromDraft:pe,validateStartDate:we,validateDueDate:Ce,validateRecurrenceStartTime:Se,validateRecurrenceEndTime:He,validateRecurrenceStartTimeOnly:st,validateRecurrenceEndTimeOnly:gt,rules:xt,treeProps:Et,priorityOptions:pt,workTypeOptions:jt,categoryOptions:Ht,stateOptions:Wt,assetTreeData:oa,loading:_t,assigneeOptions:Dt,supervisorOptions:na,formRef:Ye,loadFormData:Yt,toUtcIso:Pt,handleImageListUpdate:sa,handleFilesListUpdate:Ia,uploadFilesToServer:la,hasFormChanges:Rt,handleBackToDetail:Jt,handleCancel:Va,resetFormSilent:Qt,resetForm:Fa,get logButtonTimeout(){return bt},set logButtonTimeout(C){bt=C},isLoggingInProgress:At,logCurrentPayload:ia,createWorkOrderPayload:Gt,disabledStartDates:xa,disabledDueDates:Ea,showWorkOrderDuration:Wa,formatWorkOrderDuration:da,submitForm:Ra,__MACROS_defineComponent:be,ref:O,reactive:et,onMounted:Ue,onBeforeUnmount:Ot,watch:ge,nextTick:Me,computed:L,get ElMessage(){return U},get ElMessageBox(){return $e},get ArrowLeft(){return Bt},get RefreshLeft(){return Kr},get Plus(){return Ca},get Delete(){return Da},get DocumentAdd(){return Gr},get Document(){return qt},get List(){return Qa},get DocumentChecked(){return Qr},get Search(){return Ft},get useI18n(){return Be},RecurrenceEditor:$r,MaintenanceSelectedTaskCard:ao,MaintenanceSelectedStandardsCard:to,AddTask:uo,AddStandard:mo,FileUploadMultiple:oo,get JsonDebugDrawer(){return Xa},get usePayloadLogger(){return zt},get clonePayload(){return Qe},get transformPayload(){return $t},EditStandardDialog:_o,StepsPreview:ra,StandardsPreview:Pa,get uploadMultipleToMinio(){return Xt},get getAllWorkTypes(){return ha},get getAllPriorities(){return ya},get getAllCategories(){return wa},get getAllStates(){return ka},get getEquipmentNodeTrees(){return ba},get createWorkOrder(){return mr},get useRouter(){return it},get useRoute(){return ht},get useTaskLibraryStore(){return Sa},get useWorkOrderDraftStore(){return yt},get createEmptyWorkOrderForm(){return St},get cloneWorkOrderForm(){return Ba},get DEFAULT_TASK_STATE(){return Zt},get buildDisplayTaskFromTemplate(){return Ut}};return Object.defineProperty(ca,"__isScriptSetup",{enumerable:!1,value:!0}),ca}}),Tu={class:"work-order-create-enhanced"},Ou={class:"create-header"},Cu={class:"header-main"},Du={class:"create-title"},Pu={class:"header-actions"},Au={class:"form-section"},Iu={class:"form-section"},Vu={class:"form-section"},Fu={class:"form-section"},xu={class:"form-section tasks-section"},Eu={class:"section-header"},Wu={class:"section-title"},Ru={key:0,class:"task-actions"},Lu={key:0,class:"empty-tasks"},Mu={class:"empty-content"},qu={class:"tasks-list"},Uu={class:"form-section standards-section"},zu={class:"section-header"},Nu={class:"section-title"},Bu={key:0,class:"standards-actions"},ju={key:0,class:"empty-standards"},Hu={class:"empty-content"},Yu={class:"standards-list"},Ju={class:"form-section"},Qu={key:0,class:"work-order-duration"},Gu={class:"form-section"},Ku={class:"form-section"},Zu={class:"form-section"},Xu={class:"form-section"},$u={class:"form-section"},em={class:"upload-section"},tm={class:"preview-dialog-header"},am=["id"],rm={class:"standalone-standard-preview"},om={class:"standard-details"},nm={class:"fixed-header-section"},sm={class:"standard-tabs-header"},lm={class:"scrollable-content"},im={class:"tab-content-wrapper"},dm={key:0,class:"tab-pane-content"},cm={class:"overview-card"},um={class:"card-content"},mm={class:"info-value highlight"},_m={key:0,class:"description-card"},fm={class:"card-content"},gm={class:"description-text"},pm={key:1,class:"tab-pane-content"},vm={key:0,class:"rules-list"},hm={class:"card-header"},ym={class:"rules-container"},wm={class:"rule-number"},km={class:"rule-content"},bm={class:"rule-text"},Sm={key:1,class:"empty-rules"},Tm={class:"form-actions-fixed"},Om={class:"form-actions-content"},Cm={class:"assignee-picker"},Dm={class:"search-section"},Pm={class:"available-section"},Am={key:0,class:"empty-users"},Im={key:1,class:"users-list"},Vm=["onClick"],Fm={class:"user-info"},xm={class:"user-name"},Em={key:0,class:"user-email"},Wm={class:"user-actions"},Rm={key:0,class:"selected-section"},Lm={class:"selected-section-header"},Mm={class:"selected-users"},qm={class:"dialog-footer"};function Um(l,t,d,e,y,h){const c=D("el-col"),u=D("el-icon"),g=D("el-button"),S=D("el-row"),T=D("el-input"),b=D("el-form-item"),w=D("el-tree-select"),F=D("el-option"),P=D("el-select"),I=D("el-divider"),J=D("el-date-picker"),k=D("el-text"),Z=D("el-dialog"),ie=D("el-switch"),G=D("el-tooltip"),le=D("el-tab-pane"),ue=D("el-tabs"),$=D("el-descriptions-item"),B=D("el-tag"),me=D("el-descriptions"),ne=D("el-empty"),ee=D("el-form"),W=D("el-checkbox"),re=aa("loading");return i(),p("div",Tu,[s(" Create Header "),a("div",Ou,[r(S,{justify:"space-between",align:"top",gutter:16},{default:o(()=>[r(c,{span:18},{default:o(()=>[a("div",Cu,[a("h2",Du,m(l.$t("workOrder.newWorkOrder")),1)])]),_:1}),r(c,{span:6},{default:o(()=>[a("div",Pu,[r(g,{type:"default",onClick:e.handleBackToDetail},{default:o(()=>[r(u,null,{default:o(()=>[r(e.ArrowLeft)]),_:1}),V(" "+m(l.$t("workOrder.actions.backToDetail")),1)]),_:1}),r(g,{type:"warning",onClick:e.resetForm,plain:""},{default:o(()=>[r(u,null,{default:o(()=>[r(e.RefreshLeft)]),_:1}),V(" "+m(l.$t("workOrder.actions.reset")),1)]),_:1})])]),_:1})]),_:1})]),s(" Form Container "),Ct((i(),N(ee,{ref:"formRef",model:e.form,rules:e.rules,"label-position":"top",class:"create-form"},{default:o(()=>{var Y;return[s(" Task Title "),a("div",Au,[r(b,{prop:"name"},{default:o(()=>[r(T,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.form.name=_),placeholder:l.$t("workOrder.create.taskTitlePlaceholder"),size:"large",class:"task-title-input"},null,8,["modelValue","placeholder"])]),_:1})]),s(" Description "),a("div",Iu,[r(b,{label:l.$t("workOrder.form.description"),prop:"description"},{default:o(()=>[r(T,{modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=_=>e.form.description=_),type:"textarea",placeholder:l.$t("workOrder.create.descriptionPlaceholder"),rows:3,resize:"vertical"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Asset Tree Select "),a("div",Vu,[r(b,{label:l.$t("workOrder.create.asset"),prop:"equipment_node_ids"},{default:o(()=>[r(w,{modelValue:e.form.equipment_node_ids,"onUpdate:modelValue":t[2]||(t[2]=_=>e.form.equipment_node_ids=_),data:e.assetTreeData,props:e.treeProps,placeholder:l.$t("workOrder.create.assetPlaceholder"),"check-strictly":"","render-after-expand":!1,multiple:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])]),s(" Supervisor "),a("div",Fu,[r(b,{label:"Supervisor",prop:"approved_by_id"},{default:o(()=>[r(P,{modelValue:e.form.approved_by_id,"onUpdate:modelValue":t[3]||(t[3]=_=>e.form.approved_by_id=_),placeholder:"Select Supervisor",filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.supervisorOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),s(" Tasks "),r(I),a("div",xu,[r(b,null,{label:o(()=>[a("div",Eu,[a("span",Wu,[r(u,{class:"section-icon tasks-icon"},{default:o(()=>[r(e.List)]),_:1}),t[22]||(t[22]=V(" Tasks "))]),e.form.tasks.length>0?(i(),p("div",Ru,[r(g,{size:"default",onClick:e.handleAddTask,icon:e.Plus},{default:o(()=>t[23]||(t[23]=[V(" Add Task ")])),_:1,__:[23]},8,["icon"]),r(g,{size:"default",onClick:e.handleDeleteAllTasks,icon:e.Delete},{default:o(()=>[V(" Clear All ("+m(e.form.tasks.length)+") ",1)]),_:1},8,["icon"])])):s("v-if",!0)])]),default:o(()=>[a("div",{class:Ae(["tasks-container",{"no-tasks":e.form.tasks.length===0}])},[s(" Empty State "),e.form.tasks.length===0?(i(),p("div",Lu,[a("div",Mu,[r(u,{class:"empty-icon"},{default:o(()=>[r(e.DocumentAdd)]),_:1}),t[25]||(t[25]=a("h4",null,"No Tasks Added",-1)),t[26]||(t[26]=a("p",null,"Add your first task to start building the work order",-1)),r(g,{type:"primary",onClick:e.handleAddTask},{default:o(()=>[r(u,null,{default:o(()=>[r(e.Plus)]),_:1}),t[24]||(t[24]=V(" Add Task "))]),_:1,__:[24]})])])):(i(),p(se,{key:1},[s(" Tasks List "),a("div",qu,[(i(!0),p(se,null,fe(e.form.tasks,_=>(i(),N(e.MaintenanceSelectedTaskCard,{key:_.id,template:_,"assignee-options":e.assigneeOptions,onSelection:e.handleTaskAction,onAssigneeUpdate:e.handleTaskAssigneeUpdate,onOpenAssigneeDialog:e.handleOpenAssigneeDialog,class:"task-card"},null,8,["template","assignee-options"]))),128))])],2112))],2)]),_:1})]),s(" Standards "),r(I),a("div",Uu,[r(b,null,{label:o(()=>[a("div",zu,[a("span",Nu,[r(u,{class:"section-icon standards-icon"},{default:o(()=>[r(e.DocumentChecked)]),_:1}),t[27]||(t[27]=V(" Standards "))]),e.form.standards.length>0?(i(),p("div",Bu,[r(g,{size:"default",onClick:e.handleAddStandard,icon:e.Plus},{default:o(()=>t[28]||(t[28]=[V(" Add Standard ")])),_:1,__:[28]},8,["icon"]),r(g,{size:"default",onClick:e.handleDeleteAllStandards,icon:e.Delete},{default:o(()=>[V(" Clear All ("+m(e.form.standards.length)+") ",1)]),_:1},8,["icon"])])):s("v-if",!0)])]),default:o(()=>[a("div",{class:Ae(["standards-container",{"no-standards":e.form.standards.length===0}])},[s(" Empty State "),e.form.standards.length===0?(i(),p("div",ju,[a("div",Hu,[r(u,{class:"empty-icon"},{default:o(()=>[r(e.Document)]),_:1}),t[30]||(t[30]=a("h4",null,"No Standards Added",-1)),t[31]||(t[31]=a("p",null,"Add your first standard to ensure work order compliance",-1)),r(g,{type:"primary",onClick:e.handleAddStandard},{default:o(()=>[r(u,null,{default:o(()=>[r(e.Plus)]),_:1}),t[29]||(t[29]=V(" Add Standard "))]),_:1,__:[29]})])])):(i(),p(se,{key:1},[s(" Standards List "),a("div",Yu,[(i(!0),p(se,null,fe(e.form.standards,_=>(i(),N(e.MaintenanceSelectedStandardsCard,{key:_.id,template:_,onSelection:e.handleStandardAction,class:"standard-card"},null,8,["template"]))),128))])],2112))],2)]),_:1})]),s(" Due Date "),a("div",Ju,[r(b,{label:l.$t("workOrder.create.dueDate"),prop:"due_date"},{default:o(()=>[r(J,{modelValue:e.form.due_date,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.due_date=_),type:"datetime",placeholder:l.$t("workOrder.create.dueDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledDueDates},null,8,["modelValue","placeholder"]),e.showWorkOrderDuration?(i(),p("div",Qu,[r(k,{type:"info",size:"small"},{default:o(()=>[V(" Work order duration: "+m(e.formatWorkOrderDuration()),1)]),_:1})])):s("v-if",!0)]),_:1},8,["label"])]),s(" Start Date "),a("div",Gu,[r(b,{label:l.$t("workOrder.create.startDate"),prop:"start_date"},{default:o(()=>[r(J,{modelValue:e.form.start_date,"onUpdate:modelValue":t[5]||(t[5]=_=>e.form.start_date=_),type:"datetime",placeholder:l.$t("workOrder.create.startDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledStartDates},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Work Type, Priority, and State "),a("div",Ku,[r(S,{gutter:16},{default:o(()=>[r(c,{span:8},{default:o(()=>[r(b,{label:l.$t("workOrder.create.workType"),prop:"work_type_id"},{default:o(()=>[r(P,{modelValue:e.form.work_type_id,"onUpdate:modelValue":t[6]||(t[6]=_=>e.form.work_type_id=_),placeholder:l.$t("workOrder.create.workTypePlaceholder"),style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.workTypeOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(c,{span:8},{default:o(()=>[r(b,{label:l.$t("workOrder.create.priority"),prop:"priority_id"},{default:o(()=>[r(P,{modelValue:e.form.priority_id,"onUpdate:modelValue":t[7]||(t[7]=_=>e.form.priority_id=_),placeholder:l.$t("workOrder.create.priorityPlaceholder"),style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.priorityOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(c,{span:8},{default:o(()=>[r(b,{label:"State",prop:"state_id"},{default:o(()=>[r(P,{modelValue:e.form.state_id,"onUpdate:modelValue":t[8]||(t[8]=_=>e.form.state_id=_),placeholder:"Select state...",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.stateOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),s(" Recurrence Settings "),a("div",Zu,[r(e.RecurrenceEditor,{"recurrence-setting":e.form.recurrence_setting,"onUpdate:recurrenceSetting":t[9]||(t[9]=_=>e.form.recurrence_setting=_),"work-order-start-date":e.form.start_date,"work-order-due-date":e.form.due_date},null,8,["recurrence-setting","work-order-start-date","work-order-due-date"])]),s(" Categories "),a("div",Xu,[r(b,{label:l.$t("workOrder.create.categories"),prop:"category_ids"},{default:o(()=>[r(P,{modelValue:e.form.category_ids,"onUpdate:modelValue":t[10]||(t[10]=_=>e.form.category_ids=_),placeholder:l.$t("workOrder.create.categoriesPlaceholder"),multiple:"",filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.categoryOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Image and File Upload Section "),a("div",$u,[r(I),a("div",em,[r(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"image-label":l.$t("workOrder.create.imageUpload"),"file-label":l.$t("workOrder.create.fileUpload"),"upload-type":"both","max-images":5,"max-files":10},null,8,["image-label","file-label"])])]),s(" Add Task Dialog "),r(Z,{modelValue:e.showAddTaskDialog,"onUpdate:modelValue":t[11]||(t[11]=_=>e.showAddTaskDialog=_),title:"Add New Task",width:"700px","before-close":e.handleCloseAddTaskDialog,top:"5vh"},{default:o(()=>[e.showAddTaskDialog?(i(),N(e.AddTask,{key:0,onClose:e.closeAddTaskDialog,onAddTemplates:e.onAddTaskTemplates})):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Add Standard Dialog "),r(Z,{modelValue:e.showAddStandardDialog,"onUpdate:modelValue":t[12]||(t[12]=_=>e.showAddStandardDialog=_),title:"Add New Standard",width:"700px",top:"5vh","before-close":e.handleCloseAddStandardDialog},{default:o(()=>[e.showAddStandardDialog?(i(),N(e.AddStandard,{key:0,onClose:e.closeAddStandardDialog,onAddStandards:e.onAddStandards})):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Edit Standard Dialog "),e.editingStandard?(i(),N(e.EditStandardDialog,{key:0,visible:e.showEditStandardDialog,standard:e.editingStandard,"onUpdate:visible":t[13]||(t[13]=_=>e.showEditStandardDialog=!1),"onUpdate:standard":e.onStandardUpdate},null,8,["visible","standard"])):s("v-if",!0),s(" Task Preview Dialog "),r(Z,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[15]||(t[15]=_=>e.showTaskPreviewDialog=_),width:"700px",top:"5vh","before-close":e.handleCloseTaskPreview,class:"preview-dialog"},{header:o(({titleId:_})=>[a("div",tm,[r(g,{type:"text",onClick:e.handleBackToTaskList,class:"back-button"},{default:o(()=>[r(u,null,{default:o(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:_,class:"dialog-title"}," Preview: "+m(e.getPreviewTaskTitle()),9,am),r(G,{content:"Interactive Mode",placement:"top"},{default:o(()=>[r(ie,{modelValue:e.isTaskInteractive,"onUpdate:modelValue":t[14]||(t[14]=te=>e.isTaskInteractive=te)},null,8,["modelValue"])]),_:1})])]),default:o(()=>[e.previewTaskTemplateId?(i(),N(e.StepsPreview,{key:0,"template-id":e.previewTaskTemplateId,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):e.previewTaskData&&e.previewTaskData.steps?(i(),N(e.StepsPreview,{key:1,steps:e.previewTaskData.steps,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["steps","interactive"])):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Standard Preview Dialog "),r(Z,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[17]||(t[17]=_=>e.showStandardPreviewDialog=_),title:`Preview: ${((Y=e.previewStandardData)==null?void 0:Y.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:o(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(i(),N(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(i(),p(se,{key:1},[s(" Standalone Standard Preview "),a("div",rm,[a("div",om,[s(" Fixed Header Section "),a("div",nm,[a("div",sm,[r(ue,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[16]||(t[16]=_=>e.standalonePreviewTab=_),class:"details-tabs"},{default:o(()=>[r(le,{label:"General",name:"general"}),r(le,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),s(" Scrollable Content Area "),a("div",lm,[a("div",im,[s(" General Tab Content "),e.standalonePreviewTab==="general"?(i(),p("div",dm,[a("div",cm,[a("div",um,[r(me,{column:2,direction:"vertical"},{default:o(()=>[r($,{width:"50%",label:"Category"},{default:o(()=>[V(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r($,{width:"50%",label:"Total Rules"},{default:o(()=>{var _;return[a("span",mm,m(((_=e.previewStandardData.items)==null?void 0:_.length)||0)+" rules",1)]}),_:1}),r($,{width:"50%",label:"Type"},{default:o(()=>[r(B,{type:"primary",size:"small"},{default:o(()=>t[32]||(t[32]=[V("Work Order Only")])),_:1,__:[32]})]),_:1})]),_:1})])]),e.previewStandardData.description?(i(),p("div",_m,[t[33]||(t[33]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",fm,[a("div",gm,m(e.previewStandardData.description),1)])])):s("v-if",!0)])):s("v-if",!0),s(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(i(),p("div",pm,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(i(),p("div",vm,[a("div",hm,[t[35]||(t[35]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(B,{type:"warning",size:"small"},{default:o(()=>t[34]||(t[34]=[V("Read Only")])),_:1,__:[34]})]),a("div",ym,[(i(!0),p(se,null,fe(e.previewStandardData.items,(_,te)=>(i(),p("div",{key:te,class:"rule-item"},[a("div",wm,m(te+1),1),a("div",km,[a("div",bm,m(_),1)])]))),128))])])):(i(),p("div",Sm,[r(ne,{description:"No standard rules defined yet","image-size":60})]))])):s("v-if",!0)])])])])],2112)):s("v-if",!0),s("        <template #footer>"),s('          <div class="standard-dialog-footer">'),s('            <div class="footer-actions">'),s('              <el-button @click="showStandardPreviewDialog = false">Close</el-button>'),s("            </div>"),s("          </div>"),s("        </template>")]),_:1},8,["modelValue","title"]),s(" Submit Button - Fixed at bottom "),a("div",Tm,[a("div",Om,[r(g,{type:"default",onClick:e.handleCancel,class:"cancel-button"},{default:o(()=>[V(m(l.$t("workOrder.actions.cancel")),1)]),_:1}),r(g,{type:"info",onClick:e.logCurrentPayload,class:"logs-button",loading:e.isLoggingInProgress,disabled:e.isLoggingInProgress},{default:o(()=>[V(m(e.isLoggingInProgress?"Loading...":"Logs"),1)]),_:1},8,["loading","disabled"]),r(g,{type:"primary",onClick:e.submitForm,loading:e.loading,class:"create-button"},{default:o(()=>[V(m(l.$t("workOrder.actions.create")),1)]),_:1},8,["loading"])])])]}),_:1},8,["model","rules"])),[[re,e.loading]]),s(" Task Assignee Management Dialog "),r(Z,{modelValue:e.showTaskAssigneeDialog,"onUpdate:modelValue":t[20]||(t[20]=Y=>e.showTaskAssigneeDialog=Y),title:"Select Workers",width:"600px",onClose:e.resetTaskAssigneeDialog,top:"8vh"},{footer:o(()=>[a("span",qm,[r(g,{onClick:e.resetTaskAssigneeDialog},{default:o(()=>t[38]||(t[38]=[V("Cancel")])),_:1,__:[38]}),r(g,{type:"primary",onClick:e.saveTaskAssignees},{default:o(()=>[V(" Save Selection ("+m(e.localSelectedTaskAssignees.length)+") ",1)]),_:1})])]),default:o(()=>[a("div",Cm,[s(" Search "),a("div",Dm,[r(T,{modelValue:e.userSearchQuery,"onUpdate:modelValue":t[18]||(t[18]=Y=>e.userSearchQuery=Y),placeholder:"Search users...",clearable:""},{prefix:o(()=>[r(u,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),s(" Available Workers "),a("div",Pm,[t[36]||(t[36]=a("h4",null,"Available Workers",-1)),e.filteredAssigneeOptions.length===0?(i(),p("div",Am,[r(ne,{description:"No users found","image-size":60})])):(i(),p("div",Im,[(i(!0),p(se,null,fe(e.filteredAssigneeOptions,Y=>(i(),p("div",{key:Y.id,class:Ae(["user-item",{selected:e.isUserSelected(Y.id)}]),onClick:_=>e.toggleUser(Y)},[a("div",Fm,[a("div",xm,m(Y.name),1),Y.email?(i(),p("div",Em,m(Y.email),1)):s("v-if",!0)]),a("div",Wm,[r(W,{"model-value":e.isUserSelected(Y.id),onClick:t[19]||(t[19]=Xr(()=>{},["stop"])),onChange:_=>e.toggleUser(Y)},null,8,["model-value","onChange"])])],10,Vm))),128))]))]),s(" Selected Workers "),e.localSelectedTaskAssignees.length>0?(i(),p("div",Rm,[a("div",Lm,[a("h4",null,"Selected Workers ("+m(e.localSelectedTaskAssignees.length)+")",1),r(g,{type:"text",size:"small",onClick:e.clearAllAssignees,class:"clear-all-btn"},{default:o(()=>t[37]||(t[37]=[V(" Clear All ")])),_:1,__:[37]})]),a("div",Mm,[(i(!0),p(se,null,fe(e.getSelectedUserObjects(),Y=>(i(),N(B,{key:Y.id,closable:"",onClose:_=>e.removeSelectedUser(Y.id),class:"selected-user-tag"},{default:o(()=>[V(m(Y.name),1)]),_:2},1032,["onClose"]))),128))])])):s("v-if",!0)])]),_:1},8,["modelValue"]),s(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[21]||(t[21]=Y=>e.showJsonDisplayer=Y),"payload-data":e.currentPayload,title:"Work Order Payload",subtitle:"Click 'Logs' to refresh"},null,8,["modelValue","payload-data"])])}const zm=Re(Su,[["render",Um],["__scopeId","data-v-5399a868"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderCreate.vue"]]),Nm={__name:"WorkOrderEdit",props:{workOrder:{type:Object,required:!0}},emits:["back-to-detail","work-order-updated","work-order-not-found"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=O(!1),c=O(!1),u=O(!1),g=O(null),S=O(!1),T=O(!1),b=O(null),w=O(null),F=O(null),P=O(!1),I=O(!1),J=O(null),k=O(""),Z=O([]),ie=O("general"),{t:G}=Be(),le=it(),ue=ht(),$=Sa(),B=yt(),{currentPayload:me,showJsonDisplayer:ne,logPayload:ee,closeDebugDrawer:W}=zt(),re=O(null),Y=O(!1),_=O(!1);let te=null;const f=et(St());f.workOrderId=null;let A=!1;const R=O(!1),j=O([]),oe=O([]),ce=et({added:[],updated:[],deleted:[]}),K=et({added:[],updated:[],deleted:[]}),X=L(()=>{var Q;const n=G("workOrder.editWorkOrder"),E=f.name||((Q=e.workOrder)==null?void 0:Q.name);return E?`${n} - ${E}`:n}),ke=()=>({name:"Checklist",description:"Auto-generated step",type:"template",required:!1,remarks:"",value:{type:"checkbox",value:!1,require_image:!1,image:[]},tools:[]}),De=n=>Array.isArray(n)?Qe(n):[],Ve=n=>{if(!n)return null;const E=new Date(n);if(Number.isNaN(E.getTime()))return null;const Q=Ie=>String(Ie).padStart(2,"0"),de=E.getFullYear(),Fe=Q(E.getMonth()+1),xe=Q(E.getDate()),We=Q(E.getHours()),ye=Q(E.getMinutes()),ve=Q(E.getSeconds());return`${de}-${Fe}-${xe}T${We}:${ye}:${ve}`},Te=n=>{if(!Array.isArray(n)||n.length===0)return null;const E=n[Math.floor(Math.random()*n.length)];return(E==null?void 0:E.id)??(E==null?void 0:E.value)??null},Le=n=>n.id||n.task_id||n.template_id||n.templateId||`temp-${Math.random()}`,he=n=>j.value.find(E=>Le(E)===n),Pe=(n,E)=>E?["name","description","estimated_minutes","category_id"].some(de=>n[de]!==E[de])||JSON.stringify(n.steps||[])!==JSON.stringify(E.steps||[]):!1,tt=()=>{ce.added.length=0,ce.updated.length=0,ce.deleted.length=0,f.tasks.forEach(n=>{const E=Le(n),Q=he(E);if(!Q)ce.added.push(n.payload||n);else if(Pe(n,Q)){const de={...n.payload||n,id:Q.id||Q.task_id};ce.updated.push(de)}}),j.value.forEach(n=>{const E=Le(n);f.tasks.find(de=>Le(de)===E)||ce.deleted.push({id:n.id||n.task_id||n.template_id||n.templateId})})},Je=n=>n.id||n.standard_id||n.standardId||`temp-${Math.random()}`,ot=n=>oe.value.find(E=>Je(E)===n),dt=(n,E)=>E?["name","description","category"].some(de=>n[de]!==E[de])||JSON.stringify(n.items||[])!==JSON.stringify(E.items||[]):!1,nt=()=>{K.added.length=0,K.updated.length=0,K.deleted.length=0,f.standards.forEach(n=>{const E=Je(n),Q=ot(E);Q?dt(n,Q)&&K.updated.push({...n,id:Q.id||Q.standard_id,module:200}):K.added.push({...n,module:200})}),oe.value.forEach(n=>{const E=Je(n);f.standards.find(de=>Je(de)===E)||K.deleted.push({id:n.id||n.standard_id||n.standardId})})},at=(n,E)=>{const de=[n.id,n.local_id,n.task_id,n.taskId,n.reference_id,n.template_task_id,n.template_id,n.templateId].find(xe=>xe==null?!1:String(xe).trim().length>0);if(!de)return`existing-task-${E}`;const Fe=String(de).trim();return Fe.length>0?Fe:`existing-task-${E}`},ct=n=>{if(!n||typeof n!="object")return!1;let E=!1;if(n.category&&typeof n.category=="object"){const Q=n.category.name??n.category.label??n.category_name??"";n.category_name!==Q&&(n.category_name=Q,E=!0)}else typeof n.category=="string"&&n.category_name!==n.category&&(n.category_name=n.category,E=!0);if(n.category&&!n.category_name){const Q=n.category.name??n.category.label??"";n.category_name!==Q&&(n.category_name=Q,E=!0)}return E},ut=n=>{if(!Array.isArray(n))return!1;let E=!1;return n.forEach(Q=>{E=ct(Q)||E}),E},mt=(n,E)=>{var xe,We,ye,ve,Ie;if(n&&typeof n=="object"&&n.payload&&typeof n.payload=="object"){const _e=Qe(n.payload);if(_e.work_order_id=_e.work_order_id??n.work_order_id??E??0,_e.state=_e.state??n.state??Zt,(!Array.isArray(_e.steps)||_e.steps.length===0)&&(_e.steps=[ke()]),!_e.time_estimate_sec||_e.time_estimate_sec<=0){const qe=n.estimated_minutes??n.estimatedMinutes??0;_e.time_estimate_sec=n.time_estimate_sec??n.timeEstimateSec??qe*60}return _e.template_id==null&&(_e.template_id=n.template_id??n.templateId??null),_e.category_id==null&&(_e.category_id=n.category_id??((xe=n.category)==null?void 0:xe.id)??null),_e.category_name==null&&(_e.category_name=((We=n.category)==null?void 0:We.name)??n.category_name??""),_e.attachments=De(_e.attachments||n.attachments||n.file_list),_e}const Q=Array.isArray(n==null?void 0:n.steps)?De(n.steps):[];Q.length===0&&Q.push(ke());const de=(n==null?void 0:n.estimated_minutes)||(n==null?void 0:n.estimatedMinutes)||0,Fe=(n==null?void 0:n.time_estimate_sec)||(n==null?void 0:n.timeEstimateSec)||de*60;return{name:(n==null?void 0:n.name)||(n==null?void 0:n.task_name)||(n==null?void 0:n.task_list_text)||"Task",description:(n==null?void 0:n.description)||"",time_estimate_sec:Fe,steps:Q,attachments:De((n==null?void 0:n.attachments)||(n==null?void 0:n.file_list)),assignee_ids:De(n==null?void 0:n.assignee_ids),equipment_node_id:(n==null?void 0:n.equipment_node_id)||((ye=n==null?void 0:n.equipment_node)==null?void 0:ye.id)||null,location_id:(n==null?void 0:n.location_id)??null,category_id:(n==null?void 0:n.category_id)??((ve=n==null?void 0:n.category)==null?void 0:ve.id)??null,category_name:((Ie=n==null?void 0:n.category)==null?void 0:Ie.name)??(n==null?void 0:n.category_name)??"",work_order_id:(n==null?void 0:n.work_order_id)??E??0,state:(n==null?void 0:n.state)??Zt,template_id:(n==null?void 0:n.template_id)??(n==null?void 0:n.templateId)??null}},je=(n,E)=>Array.isArray(n)?n.map((Q,de)=>{var We;if(Q&&typeof Q=="object"){const ye=Qe(Q),ve=mt(ye,E),Ie=ye.category?Qe(ye.category):ve.category_name?{id:ve.category_id??null,name:ve.category_name}:null,_e=(ye.estimated_minutes??ye.estimatedMinutes??Math.round((ve.time_estimate_sec||0)/60))||0,qe={id:at(ye,de),name:ve.name||`Task ${de+1}`,description:ve.description||"",category:Ie,category_name:(Ie==null?void 0:Ie.name)||ye.category_name||ve.category_name||"",estimated_minutes:_e,templateId:ve.template_id,template_id:ve.template_id,steps:Array.isArray(ve.steps)?ve.steps:[],source:ye.source||(ve.template_id?"template":"adhoc"),payload:ve,rawTemplate:ye.rawTemplate||ye.template||null,total_steps:ye.total_steps??((We=ve.steps)==null?void 0:We.length)??0,applicable_assets:Array.isArray(ye.applicable_assets)?De(ye.applicable_assets):ye.applicable_assets?[String(ye.applicable_assets)]:[]};return ct(qe),qe}const Fe=typeof Q=="string"?Q:`Task ${de+1}`,xe=mt({name:Fe},E);return{id:`existing-task-${de}`,name:Fe,description:"",category:null,category_name:"",estimated_minutes:Math.round((xe.time_estimate_sec||0)/60)||0,templateId:null,template_id:null,steps:xe.steps,source:"adhoc",payload:xe,rawTemplate:null,total_steps:xe.steps.length,applicable_assets:[]}}):[],ft=O([]),x=O([]),ze=O([{id:84,name:"System"},{id:37,name:"Erik Yu"},{id:43,name:"Chang Shi"},{id:45,name:"Maxwell Wang"},{id:46,name:"Justin Li"},{id:47,name:"Justin Tung"},{id:48,name:"Eric Huang"}]),Ge=O([{id:36,name:"Yao Li"},{id:41,name:"John Li"}]),Ke=O([]),v=O([]),M=O([]),z=O([]),pe=O([]),we={children:"children",label:"name",value:"id"},Ce=n=>{const E=f.tasks.findIndex(Q=>Q.id===n.id);if(E!==-1){const Q=f.tasks[E].payload,de=Ut(n);de.payload={...Q,...de.payload},f.tasks.splice(E,1,de)}};Ue(()=>{$.addTemplateUpdateListener(Ce)}),Ot(()=>{$.removeTemplateUpdateListener(Ce)});const Se=()=>{A||Me(()=>{A=!1,B.saveContextAwareDraft(f,"edit")})};ge(()=>f.tasks,()=>{A||(ut(f.tasks),Se())},{deep:!0}),ge(()=>f.standards,()=>{A||Se()},{deep:!0}),ge(f,()=>{A||B.saveContextAwareDraft(f,"edit")},{deep:!0});const He=n=>f.start_date?n.getTime()<new Date(f.start_date).getTime():!1,st=n=>{const E=new Date;return E.setHours(0,0,0,0),n.getTime()<E.getTime()},gt=L(()=>f.start_date&&f.due_date),xt=()=>{if(!f.start_date||!f.due_date)return"";const n=new Date(f.start_date),Q=new Date(f.due_date).getTime()-n.getTime(),de=Math.ceil(Q/(1e3*60*60*24));return de===1?"1 day":de>1?`${de} days`:"Less than 1 day"},Et=n=>{if(!n)return"N/A";try{return new Date(n).toLocaleDateString()}catch{return"Invalid Date"}},pt=n=>{if(!n)return null;try{return new Date(n).toISOString()}catch{return console.warn("Invalid date for UTC conversion:",n),null}},jt={name:[{required:!0,message:"Work order name is required",trigger:"blur"},{min:3,max:200,message:"Name must be between 3 and 200 characters",trigger:"blur"}],equipment_node_ids:[{required:!0,message:"Please select at least one asset",trigger:"change"}],assignee_ids:[{required:!0,message:"Please assign at least one person",trigger:"change"}],due_date:[{required:!0,message:"Due date is required",trigger:"change"}],start_date:[{required:!0,message:"Start date is required",trigger:"change"}],end_date:[{required:!1,validator:(n,E,Q)=>{E&&f.start_date&&new Date(E)<new Date(f.start_date)?Q(new Error("End date must be after start date")):Q()},trigger:"change"}]},Ht=()=>{B.saveContextAwareDraft(f,"edit"),h.value=!0},Wt=()=>{h.value=!1},oa=()=>{Wt()},_t=n=>{Array.isArray(n)&&(A=!0,n.forEach(E=>{const Q=Ut(E);f.tasks.push(Q)}),Se(),Wt())},Dt=({action:n,data:E})=>{switch(n){case"preview":Ye(E);break;case"edit":Yt(E);break;case"delete":na(E)&&U.success(`Task "${(E==null?void 0:E.name)||"Task"}" removed`);break;default:console.warn("Unknown task action:",n)}},na=n=>{const E=f.tasks.findIndex(Q=>Q.id===n.id);return E!==-1?(f.tasks.splice(E,1),Se(),!0):!1},Ye=n=>{var de,Fe,xe,We;if(!n){U.warning("Unable to preview this task.");return}const E=n.templateId||n.template_id||((de=n.payload)==null?void 0:de.template_id)||((Fe=n.rawTemplate)==null?void 0:Fe.template_id)||((xe=n.rawTemplate)==null?void 0:xe.id)||null;if(n.source==="adhoc"||!E){const ye=Array.isArray(n.steps)&&n.steps.length>0?n.steps:Array.isArray((We=n.payload)==null?void 0:We.steps)?n.payload.steps:[];w.value={...n,steps:ye},b.value=null,S.value=!0;return}b.value=E,w.value=null,S.value=!0},Yt=async n=>{var E,Q,de,Fe,xe,We,ye,ve,Ie;if(!n){U.warning("Unable to edit this task.");return}try{Y.value=!0;const _e=n.templateId||n.template_id||((E=n.payload)==null?void 0:E.template_id)||((Q=n.rawTemplate)==null?void 0:Q.template_id)||((de=n.rawTemplate)==null?void 0:de.id)||null,qe=n.source==="adhoc"||!_e;if(!_e&&!qe){U.warning("This task does not have an associated template to edit.");return}const rt=f.name||((Fe=e.workOrder)==null?void 0:Fe.name)||"Work Order",kt=((xe=e.workOrder)==null?void 0:xe.id)??rt;B.saveContextAwareDraft(f,"edit"),B.setReturnRoute(ue.fullPath),B.setReturnPanel("edit"),B.setReturnWorkOrderId(((We=e.workOrder)==null?void 0:We.id)??null),B.setShouldOpenCreatePanel(!1);const Ne={fromWorkOrder:"true",workOrderId:String(kt),workOrderName:rt,taskId:n.id,returnPanel:"edit"};(ye=e.workOrder)!=null&&ye.id&&(Ne.returnWorkOrderId=String(e.workOrder.id)),qe?await le.push({name:"TaskDesignerEdit",params:{id:"standalone"},query:{...Ne,standalone:"true",taskData:JSON.stringify(n)}}):await le.push({name:"TaskDesignerEdit",params:{id:_e},query:{...Ne,originalTemplateId:_e}})}catch(_e){console.error("Failed to open task editor:",_e);const qe=((Ie=(ve=_e.response)==null?void 0:ve.data)==null?void 0:Ie.message)||_e.message||"Failed to open task editor";U.error(qe)}finally{Y.value=!1}},Pt=()=>{$e.confirm("Are you sure you want to remove all tasks?","Confirm Remove All Tasks",{confirmButtonText:"Remove All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{f.tasks.splice(0),Se(),U.success("All tasks removed successfully")}).catch(()=>{})},sa=()=>{S.value=!1,b.value=null,w.value=null},Ia=()=>{sa()},la=()=>{if(w.value)return w.value.name||"Unnamed Task";if(b.value){const n=b.value,E=f.tasks.find(Q=>{var de;return Q.templateId===n||Q.template_id===n||((de=Q.payload)==null?void 0:de.template_id)===n||Q.id===n});return(E==null?void 0:E.name)||"Task Preview"}return"Task Preview"},Rt=()=>{c.value=!0},Jt=()=>{c.value=!1},Va=()=>{Jt()},Qt=n=>{Array.isArray(n)&&(A=!0,n.forEach(E=>{f.standards.push(E)}),Se(),Jt())},Fa=({action:n,data:E})=>{switch(n){case"preview":At(E);break;case"edit":ia(E);break;case"delete":bt(E)&&U.success(`Standard "${(E==null?void 0:E.name)||"Standard"}" removed`);break;default:console.warn("Unknown standard action:",n)}},bt=n=>{const E=f.standards.findIndex(Q=>Q.id===n.id);return E!==-1?(f.standards.splice(E,1),Se(),!0):!1},At=n=>{F.value=n,T.value=!0},ia=n=>{g.value=n,u.value=!0},Gt=n=>{const E=f.standards.findIndex(Q=>Q.id===n.id);E!==-1&&(f.standards.splice(E,1,n),Se()),u.value=!1,g.value=null},xa=()=>{$e.confirm("Are you sure you want to remove all standards?","Confirm Remove All Standards",{confirmButtonText:"Remove All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{f.standards.splice(0),Se(),U.success("All standards removed successfully")}).catch(()=>{})},Ea=n=>{f.image_list=n},Wa=n=>{f.file_list=n},da=async()=>{try{const n=[...f.image_list,...f.file_list];if(n.length===0)return;const E=await Xt(n);f.image_list=E.images||[],f.file_list=E.files||[]}catch(n){throw console.error("File upload failed:",n),new Error("File upload failed. Please try again.")}},Ra=()=>{if(!H()){y("back-to-detail");return}$e.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{y("back-to-detail")}).catch(()=>{})},ca=()=>{$e.confirm("Are you sure you want to reset the form? All unsaved changes will be lost.","Confirm Reset",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}).then(()=>{C()}).catch(()=>{})},C=()=>{q(e.workOrder)},H=()=>{var n,E;return f.name!==(((n=e.workOrder)==null?void 0:n.name)||"")||f.description!==(((E=e.workOrder)==null?void 0:E.description)||"")},q=n=>{var E,Q,de,Fe,xe,We;if(n){A=!0,console.log("WorkOrderEdit: populateFormFromWorkOrder called",{workOrderId:n.id,hasTaskList:Array.isArray(n.task_list)&&n.task_list.length>0,currentFormTasksCount:f.tasks.length});try{f.name=n.name||"",f.description=n.description||"";const ye=n.start_date||n.start_date_time||n.expected_start_date,ve=n.due_date||n.due_date_time||n.expected_due_date,Ie=n.end_date||n.end_date_time||n.expected_end_date||ve;if(f.start_date=Ve(ye),f.due_date=Ve(ve),f.end_date=Ve(Ie),Array.isArray(n.categories)&&n.categories.length)f.category_ids=n.categories.map(Ne=>Ne.id),console.log(" WorkOrderEdit: Using workOrder.categories",n.categories,"",f.category_ids);else if(Array.isArray(n.category_list)&&n.category_list.length)f.category_ids=n.category_list.map(Ne=>Ne.id),console.log(" WorkOrderEdit: Using workOrder.category_list",n.category_list,"",f.category_ids);else if(n.category){const Ne=typeof n.category=="object"?n.category.id:n.category;f.category_ids=Ne?[Ne]:[],console.log(" WorkOrderEdit: Using workOrder.category",n.category,"",f.category_ids)}else f.category_ids=De(n.category_ids)||[],console.log(" WorkOrderEdit: Using workOrder.category_ids fallback",n.category_ids,"",f.category_ids);if(f.equipment_node_ids=Array.isArray(n.equipment_nodes)?n.equipment_nodes.map(Ne=>Ne.id):De(n.equipment_node_ids),f.assignee_ids=Array.isArray(n.assignees)?n.assignees.map(Ne=>Ne.id):De(n.assignee_ids),f.vendor_ids=De(n.vendor_ids),f.priority_id=((E=n.priority)==null?void 0:E.id)||n.priority_id||null,f.state_id=((Q=n.state)==null?void 0:Q.id)||n.state_id||1,f.work_type_id=((de=n.work_type)==null?void 0:de.id)||n.work_type_id||null,f.approved_by_id=((Fe=n.approved_by)==null?void 0:Fe.id)||n.approved_by_id||null,(!Array.isArray(f.assignee_ids)||f.assignee_ids.length===0)&&ze.value.length>0){const Ne=Te(ze.value);f.assignee_ids=Ne?[Ne]:[]}if((f.approved_by_id==null||f.approved_by_id==="")&&Ge.value.length>0){const Ne=Te(Ge.value);Ne!=null&&(f.approved_by_id=Ne)}if((!Array.isArray(f.category_ids)||f.category_ids.length===0)&&M.value.length>0){const Ne=Te(M.value);f.category_ids=Ne!=null?[Ne]:[]}const _e=Array.isArray(n.tasks)&&n.tasks.length>0?n.tasks:Array.isArray(n.task_list)?n.task_list:[];console.log("WorkOrderEdit: Populating tasks",{hasWorkOrderTasks:Array.isArray(n.tasks)&&n.tasks.length>0,hasTaskList:Array.isArray(n.task_list)&&n.task_list.length>0,sourceTasksCount:_e.length,workOrderId:n.id}),f.tasks=je(_e,n.id),console.log("WorkOrderEdit: Tasks normalized",{normalizedTasksCount:f.tasks.length,firstTaskName:(xe=f.tasks[0])==null?void 0:xe.name,isHydratingForm:A});const qe=Array.isArray(n.standards)&&n.standards.length>0?n.standards:Array.isArray(n.standard_list)?n.standard_list:[],rt=Qe(qe);f.standards=Array.isArray(rt)?rt:[],j.value=Qe(f.tasks),oe.value=Qe(f.standards),B.originalTasks=Qe(f.tasks),B.originalStandards=Qe(f.standards),f.image_list=De(n.image_list),f.file_list=De(n.file_list),ft.value=De(n.image_list),x.value=De(n.file_list);const kt={};n.recurrence_type&&(kt.recurrence_type=n.recurrence_type.id),((We=n.recurrence_type)==null?void 0:We.id)===1&&(ye&&(kt.start_date_time=Ve(ye)),Ie&&(kt.end_date_time=Ve(Ie))),f.recurrence_setting=kt,n.recurrence_type&&(f.recurrence_type=n.recurrence_type.id,f.recurrence_type_id=n.recurrence_type.id),f.recurrence_setting_request=Qe(n.recurrence_setting_request||{start_date_time:ye?Ve(ye):null,end_date_time:Ie?Ve(Ie):null}),!f.recurrence_setting_request.start_date_time&&ye&&(f.recurrence_setting_request.start_date_time=Ve(ye)),!f.recurrence_setting_request.end_date_time&&Ie&&(f.recurrence_setting_request.end_date_time=Ve(Ie)),ut(f.tasks)}finally{A=!1}Se()}},ae=({taskId:n,assigneeIds:E,taskData:Q})=>{const de=f.tasks.findIndex(xe=>xe.id===n);if(de===-1)return;f.tasks[de].payload?f.tasks[de].payload.assignee_ids=E:f.tasks[de].assignee_ids=E,Se();const Fe=ze.value.filter(xe=>E.includes(xe.id)).map(xe=>xe.name).join(", ");E.length===0?U.success(`Removed all assignees from "${Q.name}"`):U.success(`Updated assignees for "${Q.name}": ${Fe}`)},Oe=({taskId:n,taskData:E,currentAssigneeIds:Q})=>{var Fe;J.value=E,k.value="";const de=((Fe=E.payload)==null?void 0:Fe.assignee_ids)||E.assignee_ids||[];Z.value=[...de],I.value=!0},Ee=L(()=>{if(!k.value)return ze.value;const n=k.value.toLowerCase();return ze.value.filter(E=>E.name.toLowerCase().includes(n)||E.email&&E.email.toLowerCase().includes(n))}),Xe=n=>Z.value.includes(n),Lt=n=>{Xe(n.id)?Mt(n.id):ua(n.id)},ua=n=>{Z.value.includes(n)||Z.value.push(n)},Mt=n=>{Z.value=Z.value.filter(E=>E!==n)},Kt=()=>{Z.value=[]},It=()=>Z.value.map(n=>ze.value.find(Q=>Q.id===n)||{id:n,name:`User #${n}`,email:""}),$a=()=>{J.value&&(ae({taskId:J.value.id,assigneeIds:[...Z.value],taskData:J.value}),wt())},wt=()=>{I.value=!1,J.value=null,Z.value=[],k.value=""},Ze=async()=>{try{Y.value=!0;const[n,E,Q,de,Fe]=await Promise.all([ha(),ya(),wa(),ka(),ba()]);Ke.value=n.data||[],v.value=E.data||[],M.value=Q.data||[],z.value=de.data||[],pe.value=Fe.data||[],q(e.workOrder)}catch(n){console.error("Failed to load form data:",n),U.error("Failed to load form data. Please refresh and try again.")}finally{Y.value=!1}},La=()=>{var Fe;const n=pt(f.due_date),E=pt(f.start_date),Q=pt(f.end_date);tt(),nt();const de={name:f.name,description:f.description||"",category_ids:f.category_ids||[],priority_id:f.priority_id,state_id:f.state_id,work_type_id:f.work_type_id,start_date:E,due_date:n,end_date:Q,assignee_ids:f.assignee_ids||[],approved_by_id:f.approved_by_id,equipment_node_ids:f.equipment_node_ids||[],vendor_ids:f.vendor_ids||[],task_add_list:ce.added,task_update_list:ce.updated,task_delete_list:ce.deleted,standard_add_list:K.added,standard_update_list:K.updated,standard_delete_list:K.deleted,image_list:f.image_list||[],file_list:f.file_list||[],recurrence_setting_request:f.recurrence_setting_request||{},recurrence_type:f.recurrence_type||f.recurrence_type_id||1,recurrence_type_id:f.recurrence_type||f.recurrence_type_id||1,time_zone:f.time_zone||Intl.DateTimeFormat().resolvedOptions().timeZone};return(Fe=e.workOrder)!=null&&Fe.recurrence_uuid&&(de.recurrence_uuid=e.workOrder.recurrence_uuid),de},fo=()=>{if(_.value)return;_.value=!0,te&&clearTimeout(te),te=setTimeout(()=>{_.value=!1},500);const n=La();ee(n,"workOrderEdit",{delay:50,showMessage:!0})},go=async()=>{var n,E,Q,de,Fe,xe;if(re.value)try{if(!await re.value.validate()){U.error(G("workOrder.messages.validationFailed"));return}Y.value=!0,(f.image_list.length>0||f.file_list.length>0)&&await da();const ye=pt(f.start_date),ve=pt(f.end_date);f.recurrence_setting_request&&(!f.recurrence_setting_request.start_date_time&&ye&&(f.recurrence_setting_request.start_date_time=ye),!f.recurrence_setting_request.end_date_time&&ve&&(f.recurrence_setting_request.end_date_time=ve));const Ie=La(),_e=$t(Ie,"workOrderUpdate");let qe;const rt=((n=e.workOrder)==null?void 0:n.recurrence_uuid)&&e.workOrder.recurrence_uuid.trim()!=="",kt=((Q=(E=e.workOrder)==null?void 0:E.recurrence_type)==null?void 0:Q.id)===1;rt&&!kt?(console.log("Updating recurrence work orders with UUID:",e.workOrder.recurrence_uuid),qe=await _r(_e)):(console.log("Updating individual work order ID:",e.workOrder.id,kt?"(Does not repeat)":"(No recurrence)"),qe=await fr(e.workOrder.id,_e)),U.success("Work order updated successfully!");const po=Array.isArray(qe.data)?qe.data[0]:qe.data;y("work-order-updated",po),y("back-to-detail")}catch(We){console.error("Failed to update work order:",We);let ye="Failed to update work order. Please try again.",ve="general";if(We.response){const Ie=We.response.status,_e=We.response.data;switch(Ie){case 400:ve="validation",ye=(_e==null?void 0:_e.message)||"Invalid work order data. Please check your inputs.";break;case 401:ve="auth",ye="Authentication failed. Please log in again.";break;case 403:ve="permission",ye="You do not have permission to edit this work order.";break;case 404:ve="notFound",ye="Work order not found. It may have been deleted.";break;case 409:ve="conflict",ye="Work order was modified by another user. Please refresh and try again.";break;case 422:ve="validation",_e!=null&&_e.errors?ye=`Validation failed: ${Object.values(_e.errors).flat().join(", ")}`:ye=(_e==null?void 0:_e.message)||"Invalid data provided.";break;case 500:ve="server",ye="Server error occurred. Please try again later.";break;default:ye=(_e==null?void 0:_e.message)||`Update failed with status ${Ie}.`}}else We.request?(ve="network",ye="Network error. Please check your connection and try again."):We.message&&(ye=We.message);console.error(`Work order update failed [${ve}]:`,{workOrderId:(de=e.workOrder)==null?void 0:de.id,recurrenceUuid:(Fe=e.workOrder)==null?void 0:Fe.recurrence_uuid,error:((xe=We.response)==null?void 0:xe.data)||We.message,stackTrace:We.stack}),U.error({message:ye,duration:ve==="validation"?8e3:5e3}),ve==="auth"?console.warn("Authentication failed, user may need to log in again"):ve==="notFound"&&y("work-order-not-found")}finally{Y.value=!1}},er=()=>{var Fe,xe,We,ye;if(console.log("WorkOrderEdit: Attempting to hydrate from draft",{hasDraft:B.hasDraft,isEditMode:B.isEditMode,currentContext:B.currentContext,draftTasks:((xe=(Fe=B.draftForm)==null?void 0:Fe.tasks)==null?void 0:xe.length)||0,currentFormTasks:f.tasks.length}),!B.hasDraft){console.log("WorkOrderEdit: No draft available, skipping hydration");return}!B.isEditMode&&B.currentContext!==null&&(console.warn("WorkOrderEdit: Draft store is not in edit mode but has context, attempting to set edit mode"),B.setContext("edit")),A=!0;const n=((We=B.draftForm)==null?void 0:We.tasks)||[],E=((ye=B.draftForm)==null?void 0:ye.standards)||[];let Q=0,de=0;if(n.length>0){const ve=[];f.tasks.forEach(Ie=>{const _e=Le(Ie),qe=n.find(rt=>Le(rt)===_e);qe?(ve.push({...qe,isFromEdit:!0}),de++):ve.push(Ie)}),n.forEach(Ie=>{const _e=Le(Ie);f.tasks.some(rt=>Le(rt)===_e)||(ve.push({...Ie,isFromEdit:!0}),Q++)}),f.tasks.splice(0,f.tasks.length,...ve),Q>0&&de>0?U.success(`${Q} task(s) added and ${de} task(s) updated`):Q>0?U.success(`${Q} task(s) added successfully`):de>0&&U.success(`${de} task(s) updated successfully`)}if(E.length>0){const ve=[];f.standards.forEach(Ie=>{const _e=Je(Ie),qe=E.find(rt=>Je(rt)===_e);qe?ve.push(qe):ve.push(Ie)}),E.forEach(Ie=>{const _e=Je(Ie);f.standards.some(rt=>Je(rt)===_e)||ve.push(Ie)}),f.standards.splice(0,f.standards.length,...ve)}ut(f.tasks),Se(),Me(()=>{if(f.tasks.length>0){const ve=[...f.tasks];f.tasks.splice(0,f.tasks.length,...ve)}if(f.standards.length>0){const ve=[...f.standards];f.standards.splice(0,f.standards.length,...ve)}console.log("WorkOrderEdit: Hydration completed",{addedTasks:Q,updatedTasks:de,totalTasks:f.tasks.length,hasStandards:E.length>0}),Se(),R.value=!0}),B.originalTasks&&B.originalTasks.length>0&&(j.value=Qe(B.originalTasks)),B.originalStandards&&B.originalStandards.length>0&&(oe.value=Qe(B.originalStandards)),Me(()=>{A=!1,setTimeout(()=>{B.clearDraft(),B.clearReturnContext(),R.value=!1},100)})};Ue(async()=>{B.setEditModeData(e.workOrder),await Ze(),Me(()=>{setTimeout(()=>{er()},150)})}),ge(()=>e.workOrder,n=>{if(n){const E=n.id!==f.workOrderId,Q=B.hasDraft,de=R.value;console.log("WorkOrderEdit: workOrder watch triggered",{hasRecentlyHydrated:de,workOrderChanged:E,hasDraftData:Q,newWorkOrderId:n.id,currentFormWorkOrderId:f.workOrderId,currentTasksCount:f.tasks.length}),E||!de&&!Q?(f.workOrderId=n.id,q(n)):console.log("WorkOrderEdit: Skipping populateFormFromWorkOrder - preserving hydrated/draft state")}},{immediate:!0});const tr={props:e,emit:y,showAddTaskDialog:h,showAddStandardDialog:c,showEditStandardDialog:u,editingStandard:g,showTaskPreviewDialog:S,showStandardPreviewDialog:T,previewTaskTemplateId:b,previewTaskData:w,previewStandardData:F,isTaskInteractive:P,showTaskAssigneeDialog:I,currentEditingTask:J,userSearchQuery:k,localSelectedTaskAssignees:Z,standalonePreviewTab:ie,t:G,router:le,route:ue,taskLibraryStore:$,workOrderDraftStore:B,currentPayload:me,showJsonDisplayer:ne,logPayload:ee,closeDebugDrawer:W,formRef:re,loading:Y,isLoggingInProgress:_,get logButtonTimeout(){return te},set logButtonTimeout(n){te=n},form:f,get isHydratingForm(){return A},set isHydratingForm(n){A=n},hasHydratedFromDraft:R,originalTasks:j,originalStandards:oe,taskChanges:ce,standardChanges:K,editHeaderTitle:X,createFallbackStep:ke,cloneArray:De,formatDateTimeForPicker:Ve,pickRandomOptionId:Te,getTaskIdentifier:Le,findOriginalTask:he,isTaskModified:Pe,calculateTaskChanges:tt,getStandardIdentifier:Je,findOriginalStandard:ot,isStandardModified:dt,calculateStandardChanges:nt,buildExistingTaskId:at,decorateTaskCategory:ct,decorateTasksCategories:ut,buildPayloadFromExistingTask:mt,normalizeExistingTasks:je,existingImages:ft,existingFiles:x,assigneeOptions:ze,supervisorOptions:Ge,workTypeOptions:Ke,priorityOptions:v,categoryOptions:M,stateOptions:z,assetTreeData:pe,treeProps:we,handleTemplateUpdate:Ce,syncFormData:Se,disabledDueDates:He,disabledStartDates:st,showWorkOrderDuration:gt,formatWorkOrderDuration:xt,formatDate:Et,toUtcIso:pt,rules:jt,handleAddTask:Ht,closeAddTaskDialog:Wt,handleCloseAddTaskDialog:oa,onAddTaskTemplates:_t,handleTaskAction:Dt,handleRemoveTask:na,handlePreviewTask:Ye,handleEditTask:Yt,handleDeleteAllTasks:Pt,handleCloseTaskPreview:sa,handleBackToTaskList:Ia,getPreviewTaskTitle:la,handleAddStandard:Rt,closeAddStandardDialog:Jt,handleCloseAddStandardDialog:Va,onAddStandards:Qt,handleStandardAction:Fa,handleRemoveStandard:bt,handlePreviewStandard:At,handleEditStandard:ia,onStandardUpdate:Gt,handleDeleteAllStandards:xa,handleImageListUpdate:Ea,handleFilesListUpdate:Wa,uploadFilesToServer:da,handleBackToDetail:Ra,resetForm:ca,resetFormSilent:C,checkForUnsavedChanges:H,populateFormFromWorkOrder:q,handleTaskAssigneeUpdate:ae,handleOpenAssigneeDialog:Oe,filteredAssigneeOptions:Ee,isUserSelected:Xe,toggleUser:Lt,addSelectedUser:ua,removeSelectedUser:Mt,clearAllAssignees:Kt,getSelectedUserObjects:It,saveTaskAssignees:$a,resetTaskAssigneeDialog:wt,loadFormData:Ze,createWorkOrderPayload:La,logCurrentPayload:fo,submitForm:go,hydrateFormFromDraft:er,ref:O,reactive:et,onMounted:Ue,onBeforeUnmount:Ot,watch:ge,nextTick:Me,computed:L,get ElMessage(){return U},get ElMessageBox(){return $e},get ArrowLeft(){return Bt},get RefreshLeft(){return Kr},get Plus(){return Ca},get Delete(){return Da},get DocumentAdd(){return Gr},get Document(){return qt},get List(){return Qa},get DocumentChecked(){return Qr},get Edit(){return Ya},get Calendar(){return Zr},get Search(){return Ft},get useI18n(){return Be},RecurrenceEditor:$r,MaintenanceSelectedTaskCard:ao,MaintenanceSelectedStandardsCard:to,AddTask:uo,AddStandard:mo,FileUploadMultiple:oo,get JsonDebugDrawer(){return Xa},get usePayloadLogger(){return zt},get clonePayload(){return Qe},get transformPayload(){return $t},EditStandardDialog:_o,StepsPreview:ra,StandardsPreview:Pa,get uploadMultipleToMinio(){return Xt},get getAllWorkTypes(){return ha},get getAllPriorities(){return ya},get getAllCategories(){return wa},get getAllStates(){return ka},get getEquipmentNodeTrees(){return ba},get updateWorkOrder(){return fr},get updateRecurrenceWorkOrders(){return _r},get useRouter(){return it},get useRoute(){return ht},get useTaskLibraryStore(){return Sa},get useWorkOrderDraftStore(){return yt},get createEmptyWorkOrderForm(){return St},get cloneWorkOrderForm(){return Ba},get DEFAULT_TASK_STATE(){return Zt},get buildDisplayTaskFromTemplate(){return Ut}};return Object.defineProperty(tr,"__isScriptSetup",{enumerable:!1,value:!0}),tr}},Bm={class:"work-order-edit-enhanced"},jm={class:"edit-header"},Hm={class:"header-main"},Ym={class:"edit-title"},Jm={key:0,class:"header-meta"},Qm={class:"edit-info"},Gm={class:"edit-info"},Km={class:"header-actions"},Zm={class:"form-section"},Xm={class:"form-section"},$m={class:"form-section"},e_={class:"form-section"},t_={class:"form-section"},a_={class:"form-section tasks-section"},r_={class:"section-header"},o_={class:"section-title"},n_={key:0,class:"task-actions"},s_={key:0,class:"empty-tasks"},l_={class:"empty-content"},i_={class:"tasks-list"},d_={class:"form-section standards-section"},c_={class:"section-header"},u_={class:"section-title"},m_={key:0,class:"standards-actions"},__={key:0,class:"empty-standards"},f_={class:"empty-content"},g_={class:"standards-list"},p_={class:"form-section"},v_={key:0,class:"work-order-duration"},h_={class:"form-section"},y_={class:"form-section"},w_={class:"form-section"},k_={class:"form-section"},b_={class:"form-section"},S_={class:"form-section"},T_={class:"upload-section"},O_={class:"form-actions"},C_={class:"left-actions"},D_={class:"preview-dialog-header"},P_=["id"],A_={class:"standalone-standard-preview"},I_={class:"standard-details"},V_={class:"fixed-header-section"},F_={class:"standard-tabs-header"},x_={class:"scrollable-content"},E_={class:"tab-content-wrapper"},W_={key:0,class:"tab-pane-content"},R_={class:"overview-card"},L_={class:"card-content"},M_={class:"info-value highlight"},q_={key:0,class:"description-card"},U_={class:"card-content"},z_={class:"description-text"},N_={key:1,class:"tab-pane-content"},B_={key:0,class:"rules-list"},j_={class:"card-header"},H_={class:"rules-container"},Y_={class:"rule-number"},J_={class:"rule-content"},Q_={class:"rule-text"},G_={key:1,class:"empty-rules"},K_={class:"assignee-picker"},Z_={class:"search-section"},X_={class:"available-section"},$_={key:0,class:"empty-users"},ef={key:1,class:"users-list"},tf=["onClick"],af={class:"user-info"},rf={class:"user-name"},of={key:0,class:"user-email"},nf={class:"user-actions"},sf={key:0,class:"selected-section"},lf={class:"selected-section-header"},df={class:"selected-users"},cf={class:"dialog-footer"};function uf(l,t,d,e,y,h){var Y;const c=D("el-icon"),u=D("el-col"),g=D("el-button"),S=D("el-row"),T=D("el-input"),b=D("el-form-item"),w=D("el-tree-select"),F=D("el-option"),P=D("el-select"),I=D("el-divider"),J=D("el-date-picker"),k=D("el-text"),Z=D("el-form"),ie=D("el-dialog"),G=D("el-switch"),le=D("el-tooltip"),ue=D("el-tab-pane"),$=D("el-tabs"),B=D("el-descriptions-item"),me=D("el-tag"),ne=D("el-descriptions"),ee=D("el-empty"),W=D("el-checkbox"),re=aa("loading");return i(),p("div",Bm,[s(" Edit Header "),a("div",jm,[r(S,{justify:"space-between",align:"top",gutter:16},{default:o(()=>[r(u,{span:18},{default:o(()=>[a("div",Hm,[a("h2",Ym,m(e.editHeaderTitle),1),d.workOrder?(i(),p("div",Jm,[a("div",Qm,[r(c,null,{default:o(()=>[r(e.Edit)]),_:1}),a("span",null,"ID: #"+m(d.workOrder.id),1)]),a("div",Gm,[r(c,null,{default:o(()=>[r(e.Calendar)]),_:1}),a("span",null,"Created On: "+m(e.formatDate(d.workOrder.created_at)),1)])])):s("v-if",!0)])]),_:1}),r(u,{span:6},{default:o(()=>[a("div",Km,[r(g,{type:"default",onClick:e.handleBackToDetail},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ArrowLeft)]),_:1}),V(" "+m(l.$t("workOrder.actions.backToDetail")),1)]),_:1}),r(g,{type:"warning",onClick:e.resetForm,plain:""},{default:o(()=>[r(c,null,{default:o(()=>[r(e.RefreshLeft)]),_:1}),V(" "+m(l.$t("workOrder.actions.reset")),1)]),_:1})])]),_:1})]),_:1})]),s(" Form Container "),Ct((i(),N(Z,{ref:"formRef",model:e.form,rules:e.rules,"label-position":"top",class:"edit-form"},{default:o(()=>[s(" Task Title "),a("div",Zm,[r(b,{prop:"name"},{default:o(()=>[r(T,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.form.name=_),placeholder:l.$t("workOrder.create.taskTitlePlaceholder"),size:"large",class:"task-title-input"},null,8,["modelValue","placeholder"])]),_:1})]),s(" Description "),a("div",Xm,[r(b,{label:l.$t("workOrder.form.description"),prop:"description"},{default:o(()=>[r(T,{modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=_=>e.form.description=_),type:"textarea",placeholder:l.$t("workOrder.create.descriptionPlaceholder"),rows:3,resize:"vertical"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Asset Tree Select "),a("div",$m,[r(b,{label:l.$t("workOrder.create.asset"),prop:"equipment_node_ids"},{default:o(()=>[r(w,{modelValue:e.form.equipment_node_ids,"onUpdate:modelValue":t[2]||(t[2]=_=>e.form.equipment_node_ids=_),data:e.assetTreeData,props:e.treeProps,placeholder:l.$t("workOrder.create.assetPlaceholder"),"check-strictly":"","render-after-expand":!1,multiple:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])]),s(" Assigned To "),a("div",e_,[r(b,{label:l.$t("workOrder.create.assignTo"),prop:"assignee_ids"},{default:o(()=>[r(P,{modelValue:e.form.assignee_ids,"onUpdate:modelValue":t[3]||(t[3]=_=>e.form.assignee_ids=_),placeholder:l.$t("workOrder.create.assigneePlaceholder"),filterable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.assigneeOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Supervisor "),a("div",t_,[r(b,{label:"Supervisor",prop:"approved_by_id"},{default:o(()=>[r(P,{modelValue:e.form.approved_by_id,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.approved_by_id=_),placeholder:"Select Supervisor",filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.supervisorOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),s(" Tasks "),r(I),a("div",a_,[r(b,null,{label:o(()=>[a("div",r_,[a("span",o_,[r(c,{class:"section-icon tasks-icon"},{default:o(()=>[r(e.List)]),_:1}),t[24]||(t[24]=V(" Tasks "))]),e.form.tasks.length>0?(i(),p("div",n_,[r(g,{size:"default",onClick:e.handleAddTask,icon:e.Plus},{default:o(()=>t[25]||(t[25]=[V(" Add Task ")])),_:1,__:[25]},8,["icon"]),r(g,{size:"default",onClick:e.handleDeleteAllTasks,icon:e.Delete},{default:o(()=>[V(" Clear All ("+m(e.form.tasks.length)+") ",1)]),_:1},8,["icon"])])):s("v-if",!0)])]),default:o(()=>[a("div",{class:Ae(["tasks-container",{"no-tasks":e.form.tasks.length===0}])},[s(" Empty State "),e.form.tasks.length===0?(i(),p("div",s_,[a("div",l_,[r(c,{class:"empty-icon"},{default:o(()=>[r(e.DocumentAdd)]),_:1}),t[27]||(t[27]=a("h4",null,"No Tasks Added",-1)),t[28]||(t[28]=a("p",null,"Add the task to start building the work order",-1)),r(g,{type:"primary",onClick:e.handleAddTask},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Plus)]),_:1}),t[26]||(t[26]=V(" Add Task "))]),_:1,__:[26]})])])):(i(),p(se,{key:1},[s(" Tasks List "),a("div",i_,[(i(!0),p(se,null,fe(e.form.tasks,_=>(i(),N(e.MaintenanceSelectedTaskCard,{key:_.id,template:_,"assignee-options":e.assigneeOptions,onSelection:e.handleTaskAction,onAssigneeUpdate:e.handleTaskAssigneeUpdate,onOpenAssigneeDialog:e.handleOpenAssigneeDialog,class:"task-card"},null,8,["template","assignee-options"]))),128))])],2112))],2)]),_:1})]),s(" Standards "),r(I),a("div",d_,[r(b,null,{label:o(()=>[a("div",c_,[a("span",u_,[r(c,{class:"section-icon standards-icon"},{default:o(()=>[r(e.DocumentChecked)]),_:1}),t[29]||(t[29]=V(" Standards "))]),e.form.standards.length>0?(i(),p("div",m_,[r(g,{size:"default",onClick:e.handleAddStandard,icon:e.Plus},{default:o(()=>t[30]||(t[30]=[V(" Add Standard ")])),_:1,__:[30]},8,["icon"]),r(g,{size:"default",onClick:e.handleDeleteAllStandards,icon:e.Delete},{default:o(()=>[V(" Clear All ("+m(e.form.standards.length)+") ",1)]),_:1},8,["icon"])])):s("v-if",!0)])]),default:o(()=>[a("div",{class:Ae(["standards-container",{"no-standards":e.form.standards.length===0}])},[s(" Empty State "),e.form.standards.length===0?(i(),p("div",__,[a("div",f_,[r(c,{class:"empty-icon"},{default:o(()=>[r(e.Document)]),_:1}),t[32]||(t[32]=a("h4",null,"No Standards Added",-1)),t[33]||(t[33]=a("p",null,"Add the standard to ensure work order compliance",-1)),r(g,{type:"primary",onClick:e.handleAddStandard},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Plus)]),_:1}),t[31]||(t[31]=V(" Add Standard "))]),_:1,__:[31]})])])):(i(),p(se,{key:1},[s(" Standards List "),a("div",g_,[(i(!0),p(se,null,fe(e.form.standards,_=>(i(),N(e.MaintenanceSelectedStandardsCard,{key:_.id,template:_,onSelection:e.handleStandardAction,class:"standard-card"},null,8,["template"]))),128))])],2112))],2)]),_:1})]),s(" Due Date "),a("div",p_,[r(b,{label:l.$t("workOrder.create.dueDate"),prop:"due_date"},{default:o(()=>[r(J,{modelValue:e.form.due_date,"onUpdate:modelValue":t[5]||(t[5]=_=>e.form.due_date=_),type:"datetime",placeholder:l.$t("workOrder.create.dueDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledDueDates},null,8,["modelValue","placeholder"]),e.showWorkOrderDuration?(i(),p("div",v_,[r(k,{type:"info",size:"small"},{default:o(()=>[V(" Work order duration: "+m(e.formatWorkOrderDuration()),1)]),_:1})])):s("v-if",!0)]),_:1},8,["label"])]),s(" Start Date "),a("div",h_,[r(b,{label:l.$t("workOrder.create.startDate"),prop:"start_date"},{default:o(()=>[r(J,{modelValue:e.form.start_date,"onUpdate:modelValue":t[6]||(t[6]=_=>e.form.start_date=_),type:"datetime",placeholder:l.$t("workOrder.create.startDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledStartDates},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" End Date "),a("div",y_,[r(b,{label:"End Date",prop:"end_date"},{default:o(()=>[r(J,{modelValue:e.form.end_date,"onUpdate:modelValue":t[7]||(t[7]=_=>e.form.end_date=_),type:"datetime",placeholder:"Select end date",style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledDueDates},null,8,["modelValue"])]),_:1})]),s(" Work Type, Priority, and State "),a("div",w_,[r(S,{gutter:16},{default:o(()=>[r(u,{span:8},{default:o(()=>[r(b,{label:l.$t("workOrder.create.workType"),prop:"work_type_id"},{default:o(()=>[r(P,{modelValue:e.form.work_type_id,"onUpdate:modelValue":t[8]||(t[8]=_=>e.form.work_type_id=_),placeholder:l.$t("workOrder.create.workTypePlaceholder"),style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.workTypeOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(u,{span:8},{default:o(()=>[r(b,{label:l.$t("workOrder.create.priority"),prop:"priority_id"},{default:o(()=>[r(P,{modelValue:e.form.priority_id,"onUpdate:modelValue":t[9]||(t[9]=_=>e.form.priority_id=_),placeholder:l.$t("workOrder.create.priorityPlaceholder"),style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.priorityOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(u,{span:8},{default:o(()=>[r(b,{label:"State",prop:"state_id"},{default:o(()=>[r(P,{modelValue:e.form.state_id,"onUpdate:modelValue":t[10]||(t[10]=_=>e.form.state_id=_),placeholder:"Select state...",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.stateOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),s(" Recurrence Settings "),a("div",k_,[r(e.RecurrenceEditor,{"recurrence-setting":e.form.recurrence_setting,"onUpdate:recurrenceSetting":t[11]||(t[11]=_=>e.form.recurrence_setting=_),"work-order-start-date":e.form.start_date,"work-order-due-date":e.form.due_date},null,8,["recurrence-setting","work-order-start-date","work-order-due-date"])]),s(" Categories "),a("div",b_,[r(b,{label:l.$t("workOrder.create.categories"),prop:"category_ids"},{default:o(()=>[r(P,{modelValue:e.form.category_ids,"onUpdate:modelValue":t[12]||(t[12]=_=>e.form.category_ids=_),placeholder:l.$t("workOrder.create.categoriesPlaceholder"),multiple:"",filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),p(se,null,fe(e.categoryOptions,_=>(i(),N(F,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),s(" Image and File Upload Section "),a("div",S_,[r(I),a("div",T_,[r(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"image-label":l.$t("workOrder.create.imageUpload"),"file-label":l.$t("workOrder.create.fileUpload"),"upload-type":"both","max-images":5,"max-files":10,"existing-images":e.existingImages,"existing-files":e.existingFiles},null,8,["image-label","file-label","existing-images","existing-files"])])]),s(" Footer Actions "),a("div",O_,[a("div",C_,[r(g,{onClick:e.logCurrentPayload,size:"default",plain:"",loading:e.isLoggingInProgress,disabled:e.isLoggingInProgress},{default:o(()=>[V(m(e.isLoggingInProgress?"Loading...":"Logs"),1)]),_:1},8,["loading","disabled"]),r(g,{type:"primary",onClick:e.submitForm,loading:e.loading,class:"update-button"},{default:o(()=>[V(m(l.$t("workOrder.actions.update")),1)]),_:1},8,["loading"])])])]),_:1},8,["model"])),[[re,e.loading]]),s(" Add Task Dialog "),r(ie,{modelValue:e.showAddTaskDialog,"onUpdate:modelValue":t[13]||(t[13]=_=>e.showAddTaskDialog=_),title:"Add New Task",width:"700px","before-close":e.handleCloseAddTaskDialog,top:"5vh"},{default:o(()=>{var _;return[e.showAddTaskDialog?(i(),N(e.AddTask,{key:0,"origin-panel":"edit","origin-work-order-id":(_=d.workOrder)==null?void 0:_.id,onClose:e.closeAddTaskDialog,onAddTemplates:e.onAddTaskTemplates},null,8,["origin-work-order-id"])):s("v-if",!0)]}),_:1},8,["modelValue"]),s(" Add Standard Dialog "),r(ie,{modelValue:e.showAddStandardDialog,"onUpdate:modelValue":t[14]||(t[14]=_=>e.showAddStandardDialog=_),title:"Add New Standard",width:"700px",top:"5vh","before-close":e.handleCloseAddStandardDialog},{default:o(()=>[e.showAddStandardDialog?(i(),N(e.AddStandard,{key:0,onClose:e.closeAddStandardDialog,onAddStandards:e.onAddStandards})):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Edit Standard Dialog "),e.editingStandard?(i(),N(e.EditStandardDialog,{key:0,visible:e.showEditStandardDialog,standard:e.editingStandard,"onUpdate:visible":t[15]||(t[15]=_=>e.showEditStandardDialog=!1),"onUpdate:standard":e.onStandardUpdate},null,8,["visible","standard"])):s("v-if",!0),s(" Task Preview Dialog "),r(ie,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[17]||(t[17]=_=>e.showTaskPreviewDialog=_),width:"700px",top:"5vh","before-close":e.handleCloseTaskPreview,class:"preview-dialog"},{header:o(({titleId:_})=>[a("div",D_,[r(g,{type:"text",onClick:e.handleBackToTaskList,class:"back-button"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:_,class:"dialog-title"}," Preview: "+m(e.getPreviewTaskTitle()),9,P_),r(le,{content:"Interactive Mode",placement:"top"},{default:o(()=>[r(G,{modelValue:e.isTaskInteractive,"onUpdate:modelValue":t[16]||(t[16]=te=>e.isTaskInteractive=te)},null,8,["modelValue"])]),_:1})])]),default:o(()=>[e.previewTaskTemplateId?(i(),N(e.StepsPreview,{key:0,"template-id":e.previewTaskTemplateId,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):e.previewTaskData&&e.previewTaskData.steps?(i(),N(e.StepsPreview,{key:1,steps:e.previewTaskData.steps,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["steps","interactive"])):s("v-if",!0)]),_:1},8,["modelValue"]),s(" Standard Preview Dialog "),r(ie,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[19]||(t[19]=_=>e.showStandardPreviewDialog=_),title:`Preview: ${((Y=e.previewStandardData)==null?void 0:Y.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:o(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(i(),N(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(i(),p(se,{key:1},[s(" Standalone Standard Preview "),a("div",A_,[a("div",I_,[s(" Fixed Header Section "),a("div",V_,[a("div",F_,[r($,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[18]||(t[18]=_=>e.standalonePreviewTab=_),class:"details-tabs"},{default:o(()=>[r(ue,{label:"General",name:"general"}),r(ue,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),s(" Scrollable Content Area "),a("div",x_,[a("div",E_,[s(" General Tab Content "),e.standalonePreviewTab==="general"?(i(),p("div",W_,[a("div",R_,[a("div",L_,[r(ne,{column:2,direction:"vertical"},{default:o(()=>[r(B,{width:"50%",label:"Category"},{default:o(()=>[V(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r(B,{width:"50%",label:"Total Rules"},{default:o(()=>{var _;return[a("span",M_,m(((_=e.previewStandardData.items)==null?void 0:_.length)||0)+" rules",1)]}),_:1}),r(B,{width:"50%",label:"Type"},{default:o(()=>[r(me,{type:"primary",size:"small"},{default:o(()=>t[34]||(t[34]=[V("Work Order Only")])),_:1,__:[34]})]),_:1})]),_:1})])]),e.previewStandardData.description?(i(),p("div",q_,[t[35]||(t[35]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",U_,[a("div",z_,m(e.previewStandardData.description),1)])])):s("v-if",!0)])):s("v-if",!0),s(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(i(),p("div",N_,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(i(),p("div",B_,[a("div",j_,[t[37]||(t[37]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(me,{type:"warning",size:"small"},{default:o(()=>t[36]||(t[36]=[V("Read Only")])),_:1,__:[36]})]),a("div",H_,[(i(!0),p(se,null,fe(e.previewStandardData.items,(_,te)=>(i(),p("div",{key:te,class:"rule-item"},[a("div",Y_,m(te+1),1),a("div",J_,[a("div",Q_,m(_),1)])]))),128))])])):(i(),p("div",G_,[r(ee,{description:"No rules defined for this standard","image-size":80})]))])):s("v-if",!0)])])])])],2112)):s("v-if",!0)]),_:1},8,["modelValue","title"]),s(" Task Assignee Management Dialog "),r(ie,{modelValue:e.showTaskAssigneeDialog,"onUpdate:modelValue":t[22]||(t[22]=_=>e.showTaskAssigneeDialog=_),title:"Select Workers",width:"600px",onClose:e.resetTaskAssigneeDialog,top:"8vh"},{footer:o(()=>[a("span",cf,[r(g,{onClick:e.resetTaskAssigneeDialog},{default:o(()=>t[40]||(t[40]=[V("Cancel")])),_:1,__:[40]}),r(g,{type:"primary",onClick:e.saveTaskAssignees},{default:o(()=>[V(" Save Selection ("+m(e.localSelectedTaskAssignees.length)+") ",1)]),_:1})])]),default:o(()=>[a("div",K_,[s(" Search "),a("div",Z_,[r(T,{modelValue:e.userSearchQuery,"onUpdate:modelValue":t[20]||(t[20]=_=>e.userSearchQuery=_),placeholder:"Search users...",clearable:""},{prefix:o(()=>[r(c,null,{default:o(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),s(" Available Workers "),a("div",X_,[t[38]||(t[38]=a("h4",null,"Available Workers",-1)),e.filteredAssigneeOptions.length===0?(i(),p("div",$_,[r(ee,{description:"No users found","image-size":60})])):(i(),p("div",ef,[(i(!0),p(se,null,fe(e.filteredAssigneeOptions,_=>(i(),p("div",{key:_.id,class:Ae(["user-item",{selected:e.isUserSelected(_.id)}]),onClick:te=>e.toggleUser(_)},[a("div",af,[a("div",rf,m(_.name),1),_.email?(i(),p("div",of,m(_.email),1)):s("v-if",!0)]),a("div",nf,[r(W,{"model-value":e.isUserSelected(_.id),onClick:t[21]||(t[21]=Xr(()=>{},["stop"])),onChange:te=>e.toggleUser(_)},null,8,["model-value","onChange"])])],10,tf))),128))]))]),s(" Selected Workers "),e.localSelectedTaskAssignees.length>0?(i(),p("div",sf,[a("div",lf,[a("h4",null,"Selected Workers ("+m(e.localSelectedTaskAssignees.length)+")",1),r(g,{type:"text",size:"small",onClick:e.clearAllAssignees,class:"clear-all-btn"},{default:o(()=>t[39]||(t[39]=[V(" Clear All ")])),_:1,__:[39]})]),a("div",df,[(i(!0),p(se,null,fe(e.getSelectedUserObjects(),_=>(i(),N(me,{key:_.id,closable:"",onClose:te=>e.removeSelectedUser(_.id),class:"selected-user-tag"},{default:o(()=>[V(m(_.name),1)]),_:2},1032,["onClose"]))),128))])])):s("v-if",!0)])]),_:1},8,["modelValue"]),s(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[23]||(t[23]=_=>e.showJsonDisplayer=_),"payload-data":e.currentPayload,title:"Work Order Edit Payload",subtitle:"Click 'Debug' to refresh"},null,8,["modelValue","payload-data"])])}const mf=Re(Nm,[["render",uf],["__scopeId","data-v-6c96f50a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderEdit.vue"]]),_f={__name:"WorkOrderPdf",props:{workOrder:{type:Object,required:!0}},setup(l,{expose:t}){const d=l,e=O(null),y=L(()=>[{title:"VISUAL INSPECTION AND CHECK FOR VISIBLE SIGNS OF WEAR OR DAMAGE",assignee:"Inspection (0.5 hr)",duration:"30 min",requirements:["Visual inspection","Documentation"]},{title:"COMPRESSOR REPLACEMENT",assignee:"Removal and Installation (3hrs)",duration:"3 hrs",requirements:["Mounting Hardware - 1 set","Electrical Connectors - 2 pcs"]},{title:"REFRIGERANT REFILL AND SYSTEM TESTING",assignee:"Refilling and leak test (1 hr)",duration:"1 hr",requirements:["Leak Detection Dye - 1pc","Pressure Gauge - 1pc"]}]),h=L(()=>({id:"CONV-001",name:"Main Production Conveyor",serialNumber:"CB-2023-4567",location:"Plant A > Production Floor > Line 1",manufacturer:"Industrial Conveyor Corp",model:"IC-2000X"})),c=L(()=>[{partNumber:"LUB-001",description:"High-temp bearing grease",quantity:2,unitCost:25.5,totalCost:51,vendor:"Industrial Supply Co"},{partNumber:"BELT-TENS-001",description:"Belt tension adjustment kit",quantity:1,unitCost:85,totalCost:85,vendor:"Conveyor Parts Inc"},{partNumber:"COMP-REP-001",description:"Compressor replacement unit",quantity:1,unitCost:450,totalCost:450,vendor:"HVAC Solutions Ltd"}]),u=L(()=>[{id:1,technicianName:"Mike Johnson",startTime:"2024-08-10T08:00:00Z",stopTime:"2024-08-10T12:00:00Z",hoursWorked:4,hourlyRate:45,totalCost:180},{id:2,technicianName:"Sarah Davis",startTime:"2024-08-10T10:00:00Z",stopTime:"2024-08-10T12:00:00Z",hoursWorked:2,hourlyRate:42,totalCost:84}]),g=L(()=>[{requirement:"LOTO procedures completed",compliance:!0,notes:"All energy sources isolated and tagged"},{requirement:"PPE requirements met",compliance:!0,notes:"Hard hat, safety glasses, steel-toed boots worn"},{requirement:"Confined space permit",compliance:!1,notes:"Not required for this work"},{requirement:"Hot work permit",compliance:!1,notes:"No welding or cutting required"}]),S=L(()=>[{timestamp:"2024-08-08T14:30:00Z",action:"Work Order Created",performedBy:"Erik Yu",details:"Scheduled preventive maintenance"},{timestamp:"2024-08-09T09:15:00Z",action:"Assigned to Technician",performedBy:"Maintenance Supervisor",details:"Assigned to Mike Johnson"},{timestamp:"2024-08-10T08:00:00Z",action:"Work Started",performedBy:"Mike Johnson",details:"Began on-site inspection"},{timestamp:"2024-08-10T12:00:00Z",action:"Work Completed",performedBy:"Mike Johnson",details:"All maintenance tasks completed successfully"}]),T=k=>k?lt(k):"N/A",b=k=>k?lt(k):"N/A",w=()=>c.value.reduce((k,Z)=>k+Z.totalCost,0).toFixed(2),F=()=>u.value.reduce((k,Z)=>k+Z.totalCost,0).toFixed(2),P=()=>((parseFloat(w())+parseFloat(F()))*.1).toFixed(2),I=()=>{const k=parseFloat(w())+parseFloat(F()),Z=parseFloat(P());return(k+Z).toFixed(2)};t({pdfContainer:e,print:()=>window.print()});const J={props:d,pdfContainer:e,workInstructions:y,assetInfo:h,partsUsed:c,laborLog:u,safetyRequirements:g,activityTimeline:S,formatDate:T,formatDateTime:b,calculatePartsCost:w,calculateLaborCost:F,calculateTax:P,calculateTotal:I,computed:L,ref:O,get convertToLocalTime(){return lt}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}},ff={class:"work-order-pdf",ref:"pdfContainer"},gf={class:"pdf-page"},pf={class:"pdf-header"},vf={class:"title-block"},hf={class:"title-left"},yf={class:"work-order-id"},wf={class:"title-right"},kf={class:"date-badge"},bf={class:"pdf-section overview-section"},Sf={class:"section-grid"},Tf={class:"overview-left"},Of={class:"field-group"},Cf={class:"field-value"},Df={class:"field-subvalue"},Pf={class:"field-contact"},Af={class:"overview-right"},If={class:"field-group"},Vf={class:"field-value"},Ff={class:"field-description"},xf={class:"pdf-section instructions-section"},Ef={class:"instruction-steps"},Wf={class:"step-number"},Rf={class:"step-content"},Lf={class:"step-title"},Mf={class:"step-details"},qf={class:"step-info"},Uf={class:"info-item"},zf={class:"info-item"},Nf={class:"step-requirements"},Bf={class:"pdf-section technician-section"},jf={class:"section-grid"},Hf={class:"tech-left"},Yf={class:"tech-info"},Jf={class:"tech-name"},Qf={class:"tech-right"},Gf={class:"service-date"},Kf={class:"pdf-section approval-section"},Zf={class:"section-grid"},Xf={class:"approval-left"},$f={class:"approval-fields"},eg={class:"approval-field"},tg={class:"date-line"},ag={class:"approval-right"},rg={class:"price-details"},og={class:"price-row"},ng={class:"price-row"},sg={class:"price-row"},lg={class:"price-row total-row"},ig={class:"pdf-footer"},dg={class:"footer-branding"},cg={class:"footer-budget"},ug={class:"budget-amount"},mg={class:"footer-copyright"},_g={class:"pdf-page page-break",style:{"page-break-before":"always"}},fg={class:"pdf-section asset-section"},gg={class:"asset-grid"},pg={class:"asset-field"},vg={class:"field-value"},hg={class:"asset-field"},yg={class:"field-value"},wg={class:"asset-field"},kg={class:"field-value"},bg={class:"asset-field"},Sg={class:"field-value"},Tg={class:"asset-field"},Og={class:"field-value"},Cg={class:"asset-field"},Dg={class:"field-value"},Pg={class:"pdf-section parts-section"},Ag={class:"data-table"},Ig={class:"total-row"},Vg={class:"pdf-section time-section"},Fg={class:"data-table"},xg={class:"total-row"},Eg={class:"pdf-section safety-section"},Wg={class:"safety-checklist"},Rg={key:0},Lg={class:"safety-text"},Mg={class:"safety-requirement"},qg={key:0,class:"safety-notes"},Ug={class:"pdf-section timeline-section"},zg={class:"timeline"},Ng={class:"timeline-date"},Bg={class:"timeline-content"},jg={class:"timeline-action"},Hg={class:"timeline-performer"},Yg={key:0,class:"timeline-details"};function Jg(l,t,d,e,y,h){return i(),p("div",ff,[s(" Page 1: Header and Overview "),a("div",gf,[s(" Header "),a("header",pf,[t[1]||(t[1]=Lo('<div class="header-top" data-v-77193872><div class="logo-section" data-v-77193872><div class="logo-placeholder" data-v-77193872><span class="logo-text" data-v-77193872>FPS</span></div></div><div class="company-info" data-v-77193872><div class="company-line" data-v-77193872>FPS CMMS Solutions</div><div class="company-line" data-v-77193872>1234 Maintenance Way, Suite 100</div><div class="company-line" data-v-77193872>Victoria, BC V8W 2C5, Canada</div><div class="company-line" data-v-77193872>E: support@fpscmms.com | T: +1 250 555 0198</div></div></div>',1)),a("div",vf,[a("div",hf,[t[0]||(t[0]=a("h1",{class:"work-order-title"},"WORK ORDER",-1)),a("div",yf,"#"+m(d.workOrder.id),1)]),a("div",wf,[a("div",kf,m(e.formatDate(d.workOrder.created_at)),1)])])]),s(" Work Order Overview "),a("section",bf,[a("div",Sf,[a("div",Tf,[a("div",Of,[t[2]||(t[2]=a("label",{class:"field-label"},"CUSTOMER",-1)),a("div",Cf,m(d.workOrder.customer||"Internal Maintenance"),1),a("div",Df,m(d.workOrder.customerAddress||"Internal Department"),1),a("div",Pf,m(d.workOrder.customerContact||"maintenance@company.com"),1)])]),a("div",Af,[a("div",If,[t[3]||(t[3]=a("label",{class:"field-label"},"SERVICE REQUEST",-1)),a("div",Vf,m(d.workOrder.name),1),a("div",Ff,m(d.workOrder.description),1)])])])]),s(" Detailed Order Instructions "),a("section",xf,[t[7]||(t[7]=a("h2",{class:"section-title"},"DETAILED ORDER INSTRUCTIONS",-1)),a("div",Ef,[(i(!0),p(se,null,fe(e.workInstructions,(c,u)=>(i(),p("div",{key:u,class:"instruction-step"},[a("div",Wf,m(String(u+1).padStart(2,"0")),1),a("div",Rf,[a("h3",Lf,m(c.title),1),a("div",Mf,[a("div",qf,[a("div",Uf,[t[4]||(t[4]=a("i",{class:"icon-user"},null,-1)),a("span",null,m(c.assignee||"Technician"),1)]),a("div",zf,[t[5]||(t[5]=a("i",{class:"icon-clock"},null,-1)),a("span",null,m(c.duration||"30 min"),1)])]),a("div",Nf,[(i(!0),p(se,null,fe(c.requirements,g=>(i(),p("div",{class:"requirement-item",key:g},[t[6]||(t[6]=a("i",{class:"icon-check"},null,-1)),a("span",null,m(g),1)]))),128))])])])]))),128))])]),s(" Technician Information "),a("section",Bf,[a("div",jf,[a("div",Hf,[t[9]||(t[9]=a("h3",{class:"subsection-title"},"TECHNICIAN INFORMATION",-1)),a("div",Yf,[a("div",Jf,m(d.workOrder.assigned_to||"Mark Smith (Senior Technician)"),1),t[8]||(t[8]=a("div",{class:"tech-contact"},"(555) 234 567",-1))])]),a("div",Qf,[t[10]||(t[10]=a("h3",{class:"subsection-title"},"SCHEDULED SERVICE DATE",-1)),a("div",Gf,m(e.formatDate(d.workOrder.due_date)),1)])])]),s(" Approval Section "),a("section",Kf,[a("div",Zf,[a("div",Xf,[t[14]||(t[14]=a("h3",{class:"subsection-title"},"APPROVAL",-1)),a("div",$f,[t[12]||(t[12]=a("div",{class:"approval-field"},[a("label",null,"CUSTOMER"),a("div",{class:"signature-line"})],-1)),t[13]||(t[13]=a("div",{class:"approval-field"},[a("label",null,"TECHNICIAN"),a("div",{class:"signature-line"})],-1)),a("div",eg,[t[11]||(t[11]=a("label",null,"DATE",-1)),a("div",tg,m(e.formatDate(new Date)),1)])])]),a("div",ag,[t[19]||(t[19]=a("h3",{class:"subsection-title"},"PRICE DETAILS",-1)),a("div",rg,[a("div",og,[t[15]||(t[15]=a("span",null,"LABOR",-1)),a("span",null,"$"+m(e.calculateLaborCost()),1)]),a("div",ng,[t[16]||(t[16]=a("span",null,"PARTS",-1)),a("span",null,"$"+m(e.calculatePartsCost()),1)]),a("div",sg,[t[17]||(t[17]=a("span",null,"TAX (10%)",-1)),a("span",null,"$"+m(e.calculateTax()),1)]),a("div",lg,[t[18]||(t[18]=a("span",null,"TOTAL",-1)),a("span",null,"$"+m(e.calculateTotal()),1)])])])])]),s(" Footer "),a("footer",ig,[t[22]||(t[22]=a("div",{class:"footer-note"}," *Please review and approve the work order to authorize the maintenance and repair tasks. ",-1)),a("div",dg,[t[21]||(t[21]=a("div",{class:"social-icons"},[a("span",{class:"social-icon"},"f"),a("span",{class:"social-icon"},"P"),a("span",{class:"social-icon"},"t")],-1)),a("div",cg,[t[20]||(t[20]=a("span",{class:"budget-label"},"BUDGET",-1)),a("span",ug,"$"+m(e.calculateTotal()),1)])]),a("div",mg," "+m(new Date().getFullYear())+" FPS CMMS Solutions  All rights reserved.",1)])]),s(" Page 2: Detailed Information "),a("div",_g,[s(" Asset Information "),a("section",fg,[t[29]||(t[29]=a("h2",{class:"section-title"},"ASSET INFORMATION",-1)),a("div",gg,[a("div",pg,[t[23]||(t[23]=a("label",null,"Asset ID",-1)),a("div",vg,m(e.assetInfo.id),1)]),a("div",hg,[t[24]||(t[24]=a("label",null,"Asset Name",-1)),a("div",yg,m(e.assetInfo.name),1)]),a("div",wg,[t[25]||(t[25]=a("label",null,"Serial Number",-1)),a("div",kg,m(e.assetInfo.serialNumber),1)]),a("div",bg,[t[26]||(t[26]=a("label",null,"Location",-1)),a("div",Sg,m(e.assetInfo.location),1)]),a("div",Tg,[t[27]||(t[27]=a("label",null,"Manufacturer",-1)),a("div",Og,m(e.assetInfo.manufacturer),1)]),a("div",Cg,[t[28]||(t[28]=a("label",null,"Model",-1)),a("div",Dg,m(e.assetInfo.model),1)])])]),s(" Parts and Materials "),a("section",Pg,[t[33]||(t[33]=a("h2",{class:"section-title"},"PARTS AND MATERIALS",-1)),a("table",Ag,[t[32]||(t[32]=a("thead",null,[a("tr",null,[a("th",null,"Part Number"),a("th",null,"Description"),a("th",null,"Qty"),a("th",null,"Unit Cost"),a("th",null,"Total Cost"),a("th",null,"Vendor")])],-1)),a("tbody",null,[(i(!0),p(se,null,fe(e.partsUsed,c=>(i(),p("tr",{key:c.partNumber},[a("td",null,m(c.partNumber),1),a("td",null,m(c.description),1),a("td",null,m(c.quantity),1),a("td",null,"$"+m(c.unitCost.toFixed(2)),1),a("td",null,"$"+m(c.totalCost.toFixed(2)),1),a("td",null,m(c.vendor),1)]))),128))]),a("tfoot",null,[a("tr",Ig,[t[30]||(t[30]=a("td",{colspan:"4"},"TOTAL PARTS COST",-1)),a("td",null,"$"+m(e.calculatePartsCost()),1),t[31]||(t[31]=a("td",null,null,-1))])])])]),s(" Time Tracking "),a("section",Vg,[t[36]||(t[36]=a("h2",{class:"section-title"},"TIME TRACKING",-1)),a("table",Fg,[t[35]||(t[35]=a("thead",null,[a("tr",null,[a("th",null,"Technician"),a("th",null,"Start Time"),a("th",null,"End Time"),a("th",null,"Hours"),a("th",null,"Rate"),a("th",null,"Cost")])],-1)),a("tbody",null,[(i(!0),p(se,null,fe(e.laborLog,c=>(i(),p("tr",{key:c.id},[a("td",null,m(c.technicianName),1),a("td",null,m(e.formatDateTime(c.startTime)),1),a("td",null,m(e.formatDateTime(c.stopTime)),1),a("td",null,m(c.hoursWorked.toFixed(2))+"h",1),a("td",null,"$"+m(c.hourlyRate.toFixed(2)),1),a("td",null,"$"+m(c.totalCost.toFixed(2)),1)]))),128))]),a("tfoot",null,[a("tr",xg,[t[34]||(t[34]=a("td",{colspan:"5"},"TOTAL LABOR COST",-1)),a("td",null,"$"+m(e.calculateLaborCost()),1)])])])]),s(" Safety Requirements "),a("section",Eg,[t[37]||(t[37]=a("h2",{class:"section-title"},"SAFETY REQUIREMENTS",-1)),a("div",Wg,[(i(!0),p(se,null,fe(e.safetyRequirements,c=>(i(),p("div",{key:c.requirement,class:"safety-item"},[a("div",{class:Ae(["safety-checkbox",{checked:c.compliance}])},[c.compliance?(i(),p("span",Rg,"")):s("v-if",!0)],2),a("div",Lg,[a("div",Mg,m(c.requirement),1),c.notes?(i(),p("div",qg,m(c.notes),1)):s("v-if",!0)])]))),128))])]),s(" Activity Timeline "),a("section",Ug,[t[38]||(t[38]=a("h2",{class:"section-title"},"ACTIVITY TIMELINE",-1)),a("div",zg,[(i(!0),p(se,null,fe(e.activityTimeline,c=>(i(),p("div",{key:c.timestamp,class:"timeline-item"},[a("div",Ng,m(e.formatDateTime(c.timestamp)),1),a("div",Bg,[a("div",jg,m(c.action),1),a("div",Hg,m(c.performedBy),1),c.details?(i(),p("div",Yg,m(c.details),1)):s("v-if",!0)])]))),128))])])])],512)}const Qg=Re(_f,[["render",Jg],["__scopeId","data-v-77193872"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkOrderPdf.vue"]]),Gg=be({name:"PdfPreviewModal"}),Kg=Object.assign(Gg,{props:{visible:{type:Boolean,default:!1},workOrder:{type:Object,default:null}},emits:["update:visible","close"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=O(1),c=O(2),u=O(1),g=O(null),S=L({get:()=>e.visible,set:ne=>y("update:visible",ne)}),T=()=>{h.value=1,u.value=1,y("close")},b=()=>{const ne=document.querySelector(".pdf-preview-content .work-order-pdf");ne&&(ne.offsetHeight,ne.classList.add("pdf-ready-for-export"),w())},w=()=>{const ne=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ne)return;const ee=document.createElement("iframe");ee.style.position="absolute",ee.style.top="-9999px",ee.style.left="-9999px",ee.style.width="210mm",ee.style.height="297mm",ee.style.border="none",document.body.appendChild(ee);const W=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white; }
          @page { size: A4; margin: 0; }
          ${k()}
          .pdf-page {
            width: 210mm;
            min-height: 257mm; /* A4 height minus padding */
            padding: 20mm;
            box-sizing: border-box;
            page-break-after: always;
            position: relative;
          }
          .page-break { page-break-before: always; }
        </style>
      </head>
      <body>
        ${ne.outerHTML}
      </body>
    </html>
  `;ee.contentDocument.open(),ee.contentDocument.write(W),ee.contentDocument.close(),setTimeout(()=>{try{const _=(ee.contentDocument||ee.contentWindow.document).querySelectorAll(".pdf-page").length;_!==c.value&&_>0&&(c.value=_)}catch(re){console.warn("Could not calculate page count:",re);const Y=ne.querySelectorAll(".pdf-page");c.value=Y.length}document.body.removeChild(ee)},1e3)},F=()=>{if(!g.value)return;const ne=g.value,ee=()=>{const re=ne.querySelectorAll(".pdf-page");if(!re.length)return;const Y=ne.scrollTop,_=ne.clientHeight,te=Y+_/2;let f=1,A=1/0;re.forEach((R,j)=>{const oe=R.offsetTop,ce=R.offsetHeight,K=oe+ce/2,X=Math.abs(te-K);X<A&&(A=X,f=j+1)}),f!==h.value&&(h.value=f)};ne.addEventListener("scroll",ee);const W=()=>{ne.removeEventListener("scroll",ee)};ne._scrollCleanup=W},P=async()=>{var Y;const ne=window.open("","_blank");if(!ne){U.error("Unable to open print window. Please check popup blockers.");return}const ee=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ee){U.error("PDF content not found");return}ee.classList.contains("pdf-ready-for-export")||(await new Promise(_=>setTimeout(_,1e3)),b());const W=ee.outerHTML,re=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <title>Work Order ${((Y=e.workOrder)==null?void 0:Y.id)||"Export"}</title>
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white; }
          @page {
            size: A4;
            margin: 0;
          }
          ${k()}
          /* Ensure consistent page layout */
          .pdf-page {
            width: 210mm;
            min-height: 257mm; /* A4 height minus padding */
            padding: 20mm;
            box-sizing: border-box;
            page-break-after: always;
            position: relative;
          }
          .pdf-page:last-child {
            page-break-after: avoid;
          }
          .page-break {
            page-break-before: always;
            break-before: page;
          }
          @media print {
            .work-order-pdf { margin: 0; padding: 0; }
            .pdf-page {
              margin: 0;
              page-break-after: always;
            }
            .pdf-page:last-child {
              page-break-after: avoid;
            }
          }
        </style>
      </head>
      <body>
        ${W}
      </body>
    </html>
  `;ne.document.write(re),ne.document.close(),ne.onload=()=>{setTimeout(()=>{ne.print(),ne.close()},500)}},I=async()=>{var ne;try{if(typeof window.html2pdf>"u"){U.error("PDF download requires html2pdf library. Using print instead."),P();return}const ee=document.createElement("div");ee.style.position="absolute",ee.style.top="-9999px",ee.style.left="-9999px",ee.style.width="210mm",ee.style.height="auto";const W=document.querySelector(".pdf-preview-content .work-order-pdf");if(!W){U.error("PDF content not found");return}W.classList.contains("pdf-ready-for-export")||(await new Promise(te=>setTimeout(te,1e3)),b());const re=`
      <div style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white;">
        <style>
          ${k()}
        </style>
        ${W.outerHTML}
      </div>
    `;ee.innerHTML=re,document.body.appendChild(ee);const Y=`WorkOrder_${((ne=e.workOrder)==null?void 0:ne.id)||"Export"}_${new Date().toISOString().split("T")[0]}.pdf`,_={margin:0,filename:Y,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,allowTaint:!0,foreignObjectRendering:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().set(_).from(ee.firstChild).save(),document.body.removeChild(ee),U.success(`PDF downloaded: ${Y}`)}catch(ee){console.error("Download error:",ee),U.error("Failed to download PDF. Please try print instead.")}},J=()=>{var Y;const ne=window.open("","_blank","width=900,height=1200");if(!ne){U.error("Unable to open new window. Please check popup blockers.");return}const ee=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ee){U.error("PDF content not found");return}const W=ee.outerHTML,re=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <title>Work Order ${((Y=e.workOrder)==null?void 0:Y.id)||"Preview"}</title>
        <style>
          body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
          }
          ${k()}
        </style>
      </head>
      <body>
        ${W}
      </body>
    </html>
  `;ne.document.write(re),ne.document.close()},k=()=>`
    /* PDF Layout Styles */
    .work-order-pdf {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      color: #333333;
      line-height: 1.4;
      background: white;
    }

    /* Page Setup */
    .pdf-page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      padding: 20mm;
      box-sizing: border-box;
      background: white;
      position: relative;
    }

    .page-break {
      page-break-before: always;
    }

    /* Header Styles */
    .pdf-header {
      margin-bottom: 15mm;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 5mm;
      border-bottom: 2px solid #0085a4;
      margin-bottom: 10mm;
    }

    .logo-section {
      display: flex;
      align-items: center;
    }

    .logo-placeholder {
      width: 40px;
      height: 40px;
      background: #0085a4;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }

    .logo-text {
      color: white;
      font-weight: bold;
      font-size: 16px;
    }

    .company-info {
      text-align: right;
    }

    .company-line {
      font-size: 9px;
      color: #555555;
      line-height: 1.2;
      margin-bottom: 2px;
    }

    .title-block {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .work-order-title {
      font-size: 24px;
      font-weight: bold;
      color: #0085a4;
      letter-spacing: 1px;
      margin: 0;
    }

    .work-order-id {
      font-size: 14px;
      color: #0085a4;
      margin-top: 4px;
    }

    .date-badge {
      background: #0085a4;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: bold;
    }

    /* Section Styles */
    .pdf-section {
      margin-bottom: 15mm;
    }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #0085a4;
      margin: 0 0 8mm 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .subsection-title {
      font-size: 10px;
      font-weight: bold;
      color: #0085a4;
      margin: 0 0 5mm 0;
      text-transform: uppercase;
    }

    .section-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20mm;
    }

    /* Overview Section */
    .overview-section {
      padding: 10mm 0;
      border-bottom: 1px solid #cccccc;
    }

    .field-group {
      margin-bottom: 8mm;
    }

    .field-label {
      font-size: 9px;
      font-weight: bold;
      color: #0085a4;
      text-transform: uppercase;
      display: block;
      margin-bottom: 3mm;
    }

    .field-value {
      font-size: 11px;
      font-weight: bold;
      color: #333;
      margin-bottom: 2mm;
    }

    .field-subvalue {
      font-size: 9px;
      color: #666;
      margin-bottom: 1mm;
    }

    .field-contact {
      font-size: 9px;
      color: #666;
    }

    .field-description {
      font-size: 9px;
      color: #666;
      margin-top: 2mm;
    }

    /* Print Styles */
    @media print {
      .work-order-pdf {
        margin: 0;
        padding: 0;
      }

      .pdf-page {
        margin: 0;
        padding: 20mm;
        page-break-after: always;
      }

      .pdf-page:last-child {
        page-break-after: avoid;
      }

      .page-break {
        page-break-before: always;
      }

      @page {
        size: A4;
        margin: 0;
      }
    }
  `,Z=()=>{h.value>1&&(h.value--,le(h.value))},ie=()=>{h.value<c.value&&(h.value++,le(h.value))},G=ne=>{h.value=ne,le(ne)},le=ne=>{if(!g.value)return;const ee=g.value.querySelectorAll(".pdf-page");ee&&ee[ne-1]&&ee[ne-1].scrollIntoView({behavior:"smooth",block:"start"})},ue=()=>{u.value<2&&(u.value=Math.min(2,u.value+.25))},$=()=>{u.value>.5&&(u.value=Math.max(.5,u.value-.25))},B=()=>{u.value=1};ge(()=>e.visible,ne=>{ne&&e.workOrder&&(h.value=1,u.value=1,Me(()=>{setTimeout(()=>{F(),b()},500)}))}),ge(()=>e.workOrder,ne=>{ne&&e.visible&&(h.value=1,setTimeout(()=>{w()},1500))});const me={props:e,emit:y,currentPage:h,totalPages:c,zoomLevel:u,pdfPreviewContent:g,isVisible:S,handleClose:T,ensurePdfComponentRendered:b,calculateActualPageCount:w,setupScrollListener:F,printPdf:P,downloadPdf:I,openInNewWindow:J,getPdfStyles:k,previousPage:Z,nextPage:ie,goToPage:G,scrollToPage:le,zoomIn:ue,zoomOut:$,resetZoom:B,__MACROS_defineComponent:be,ref:O,computed:L,watch:ge,nextTick:Me,get ElMessage(){return U},WorkOrderPdf:Qg,get Printer(){return Vo},get Download(){return ga},get View(){return Nt},get ArrowLeft(){return Bt},get ArrowRight(){return Ja},get ZoomIn(){return Io},get ZoomOut(){return Ao}};return Object.defineProperty(me,"__isScriptSetup",{enumerable:!1,value:!0}),me}}),Zg={class:"pdf-preview-container"},Xg={class:"pdf-preview-toolbar"},$g={class:"toolbar-left"},ep={class:"toolbar-center"},tp={class:"page-navigation"},ap={class:"page-info"},rp={class:"toolbar-right"},op={class:"zoom-controls"},np={class:"zoom-info"},sp={class:"pdf-preview-content print-simulation",ref:"pdfPreviewContent"},lp={class:"page-indicators"},ip=["onClick"];function dp(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-button"),g=D("el-button-group"),S=D("el-dialog");return i(),N(S,{modelValue:e.isVisible,"onUpdate:modelValue":t[0]||(t[0]=T=>e.isVisible=T),title:"Work Order PDF Preview",width:"95%","before-close":e.handleClose,class:"pdf-preview-dialog",top:"2vh"},{default:o(()=>[a("div",Zg,[s(" Toolbar for pdf preview "),a("div",Xg,[a("div",$g,[r(g,null,{default:o(()=>[r(u,{type:"primary",onClick:e.printPdf},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Printer)]),_:1}),t[1]||(t[1]=V(" Print PDF "))]),_:1,__:[1]}),r(u,{onClick:e.downloadPdf},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Download)]),_:1}),t[2]||(t[2]=V(" Download PDF "))]),_:1,__:[2]}),r(u,{onClick:e.openInNewWindow},{default:o(()=>[r(c,null,{default:o(()=>[r(e.View)]),_:1}),t[3]||(t[3]=V(" Open in New Window "))]),_:1,__:[3]})]),_:1})]),a("div",ep,[s(" Page Navigation "),a("div",tp,[r(u,{size:"small",disabled:e.currentPage<=1,onClick:e.previousPage},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ArrowLeft)]),_:1}),t[4]||(t[4]=V(" Previous "))]),_:1,__:[4]},8,["disabled"]),a("span",ap," Page "+m(e.currentPage)+" of "+m(e.totalPages),1),r(u,{size:"small",disabled:e.currentPage>=e.totalPages,onClick:e.nextPage},{default:o(()=>[t[5]||(t[5]=V(" Next ")),r(c,null,{default:o(()=>[r(e.ArrowRight)]),_:1})]),_:1,__:[5]},8,["disabled"])])]),a("div",rp,[s(" Zoom Controls "),a("div",op,[r(u,{size:"small",disabled:e.zoomLevel<=.5,onClick:e.zoomOut},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ZoomOut)]),_:1})]),_:1},8,["disabled"]),a("span",np,m(Math.round(e.zoomLevel*100))+"%",1),r(u,{size:"small",disabled:e.zoomLevel>=2,onClick:e.zoomIn},{default:o(()=>[r(c,null,{default:o(()=>[r(e.ZoomIn)]),_:1})]),_:1},8,["disabled"]),r(u,{size:"small",onClick:e.resetZoom},{default:o(()=>t[6]||(t[6]=[V(" Reset ")])),_:1,__:[6]})])])]),s(" PDF Content with Scrolling "),a("div",sp,[a("div",{class:"pdf-content-wrapper",style:Tt({transform:`scale(${e.zoomLevel})`,transformOrigin:"top center"})},[d.workOrder?(i(),N(e.WorkOrderPdf,{key:0,"work-order":d.workOrder,ref:"pdfComponent",class:"preview-print-mode"},null,8,["work-order"])):s("v-if",!0)],4)],512),s(" Page Indicators "),a("div",lp,[(i(!0),p(se,null,fe(e.totalPages,T=>(i(),p("div",{key:T,class:Ae(["page-indicator",{active:T===e.currentPage}]),onClick:b=>e.goToPage(T)},m(T),11,ip))),128))])])]),_:1},8,["modelValue"])}const cp=Re(Kg,[["render",dp],["__scopeId","data-v-99545c2b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/PdfPreview/PdfPreviewModal.vue"]]),up="StartWorkOrderDB",vt="drafts",mp=1;let ma=null;const _a=()=>ma||(ma=new Promise((l,t)=>{const d=indexedDB.open(up,mp);d.onupgradeneeded=()=>{const e=d.result;e.objectStoreNames.contains(vt)||e.createObjectStore(vt,{keyPath:"key"})},d.onsuccess=()=>{l(d.result)},d.onerror=()=>{t(d.error)}}),ma),Ur=(l,t)=>`${l}::${t}`,fa=()=>typeof indexedDB<"u",Aa=l=>`start-work-order-${l}`,_p=async l=>{const t=Aa(l.workOrderId),e=JSON.parse(localStorage.getItem(t)||"[]").filter(y=>y.taskId!==l.taskId);localStorage.setItem(t,JSON.stringify([...e,l]))},fp=async l=>{const t=Aa(l);return JSON.parse(localStorage.getItem(t)||"[]")},gp=async(l,t)=>{const d=Aa(l),y=JSON.parse(localStorage.getItem(d)||"[]").filter(h=>h.taskId!==t);localStorage.setItem(d,JSON.stringify(y))},pp=async l=>{const t=Aa(l);localStorage.removeItem(t)},zr={async saveDraft(l){if(fa())try{const d=(await _a()).transaction(vt,"readwrite");d.objectStore(vt).put({...l,key:Ur(l.workOrderId,l.taskId)}),await new Promise((y,h)=>{d.oncomplete=()=>y(),d.onerror=()=>h(d.error),d.onabort=()=>h(d.error)});return}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}await _p(l)},async getDrafts(l){if(fa())try{const d=(await _a()).transaction(vt,"readonly"),y=d.objectStore(vt).getAll(),h=await new Promise((u,g)=>{y.onsuccess=()=>u(y.result),y.onerror=()=>g(y.error)});await new Promise((u,g)=>{d.oncomplete=()=>u(),d.onerror=()=>g(d.error),d.onabort=()=>g(d.error)});const c=String(l);return h.filter(u=>String(u.workOrderId)===c).map(u=>({workOrderId:u.workOrderId,taskId:u.taskId,status:u.status,time_spent:u.time_spent,step_progress:u.step_progress,updated_at:u.updated_at}))}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}return fp(l)},async removeDraft(l,t){if(fa())try{const e=(await _a()).transaction(vt,"readwrite");e.objectStore(vt).delete(Ur(l,t)),await new Promise((h,c)=>{e.oncomplete=()=>h(),e.onerror=()=>c(e.error),e.onabort=()=>c(e.error)});return}catch(d){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",d)}await gp(l,t)},async clearWorkOrder(l){if(fa())try{const d=(await _a()).transaction(vt,"readwrite"),e=d.objectStore(vt),y=e.getAllKeys();(await new Promise((c,u)=>{y.onsuccess=()=>c(y.result),y.onerror=()=>u(y.error)})).filter(c=>typeof c=="string"&&c.startsWith(`${l}::`)).forEach(c=>e.delete(c)),await new Promise((c,u)=>{d.oncomplete=()=>c(),d.onerror=()=>u(d.error),d.onabort=()=>u(d.error)});return}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}await pp(l)}},vp={__name:"StatusBadge",props:{status:{type:String,default:"draft"}},setup(l,{expose:t}){t();const d=l,e={draft:"info",completed:"success",in_progress:"warning",not_started:"info"},y={draft:"Draft",completed:"Completed",in_progress:"In Progress",not_started:"Not Started"},h=L(()=>{var S,T;return((T=(S=d.status)==null?void 0:S.toLowerCase)==null?void 0:T.call(S))||"draft"}),c=L(()=>e[h.value]||"info"),u=L(()=>y[h.value]||"Draft"),g={props:d,tagTypeMap:e,labelMap:y,normalized:h,tagType:c,label:u,computed:L};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}};function hp(l,t,d,e,y,h){const c=D("el-tag");return i(),N(c,{type:e.tagType,size:"small",effect:"dark",class:"status-badge"},{default:o(()=>[V(m(e.label),1)]),_:1},8,["type"])}const yp=Re(vp,[["render",hp],["__scopeId","data-v-b05e6bff"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/StatusBadge.vue"]]),wp={__name:"TaskExecutionSummary",props:{task:{type:Object,required:!0},progress:{type:Object,default:()=>({status:"draft",time_spent:{value:0,unit:"minutes"}})},index:{type:Number,default:0}},setup(l,{expose:t}){t();const d=l,e=L(()=>d.index+1),y=L(()=>{var T,b,w,F,P;return Array.isArray((T=d.task)==null?void 0:T.steps)&&d.task.steps.length?d.task.steps.length:Array.isArray((w=(b=d.task)==null?void 0:b.payload)==null?void 0:w.steps)&&d.task.payload.steps.length?d.task.payload.steps.length:Array.isArray((F=d.task)==null?void 0:F.task_steps)&&d.task.task_steps.length?d.task.task_steps.length:Array.isArray((P=d.task)==null?void 0:P.entries)&&d.task.entries.length?d.task.entries.length:0}),h=L(()=>`summary-${c.value}`),c=L(()=>{var b;const T=(b=d.progress)==null?void 0:b.status;return T==="draft"?"in_progress":T==="completed"?"completed":T||"not_started"}),u=L(()=>{var w,F,P,I;const T=(F=(w=d.progress)==null?void 0:w.time_spent)==null?void 0:F.value,b=(I=(P=d.progress)==null?void 0:P.time_spent)==null?void 0:I.unit;return T&&b?`${T} ${b}`:"No time recorded"}),g=L(()=>{var b,w;if((b=d.task)!=null&&b.assignees&&d.task.assignees.length)return d.task.assignees.map(F=>F.name||F).join(", ");if((w=d.task)!=null&&w.assignee_ids&&d.task.assignee_ids.length)return`Assignee #${d.task.assignee_ids[0]}`;const T=["Alex Martinez","Priya Desai","Morgan Chen","Isabella Fernandez","Liam OConnor","Harper Singh"];return T[Math.floor(Math.random()*T.length)]}),S={props:d,indexLabel:e,stepCount:y,statusClass:h,currentStatus:c,formattedTime:u,assignee:g,computed:L,get ArrowRight(){return Ja},StatusBadge:yp};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},kp={class:"summary-header"},bp={class:"summary-title"},Sp={class:"summary-meta"},Tp={class:"summary-meta-row"},Op={class:"meta-value"},Cp={key:0,class:"summary-description"},Dp={class:"summary-footer"},Pp={class:"footer-time"};function Ap(l,t,d,e,y,h){const c=D("el-icon");return i(),p("div",{class:Ae(["task-summary-card",e.statusClass]),onClick:t[0]||(t[0]=u=>l.$emit("select"))},[a("div",kp,[a("div",bp,[a("h4",null,m(d.task.name||`Task ${e.indexLabel}`),1),r(e.StatusBadge,{status:e.currentStatus},null,8,["status"])]),a("span",Sp,"Steps: "+m(e.stepCount),1)]),a("div",Tp,[t[1]||(t[1]=a("span",{class:"meta-label"},"Assigned To:",-1)),a("span",Op,m(e.assignee),1)]),d.task.description?(i(),p("p",Cp,m(d.task.description),1)):s("v-if",!0),a("div",Dp,[a("span",Pp,m(e.formattedTime),1),r(c,{class:"footer-icon"},{default:o(()=>[r(e.ArrowRight)]),_:1})])],2)}const Ip=Re(wp,[["render",Ap],["__scopeId","data-v-874abd99"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TaskExecutionSummary.vue"]]),Vp={__name:"WorkOrderExecution",props:{workOrder:{type:Object,required:!0}},emits:["close","update:progress","back-to-detail"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=()=>{console.log(" WorkOrderExecution: Back to Detail button clicked"),console.log(" WorkOrderExecution: Emitting back-to-detail event"),y("back-to-detail"),console.log(" WorkOrderExecution: back-to-detail event emitted")},{t:c}=Be(),{currentPayload:u,showJsonDisplayer:g,logPayload:S,closeDebugDrawer:T}=zt(),b=O(!1),w=et([]),F=O(!1),P=O(null),I=O(!1),J=()=>{var te,f;w.splice(0,w.length),(Array.isArray((te=e.workOrder)==null?void 0:te.tasks)&&e.workOrder.tasks.length?e.workOrder.tasks:Array.isArray((f=e.workOrder)==null?void 0:f.task_list)?e.workOrder.task_list:[]).forEach(A=>{const R=A.id||A.task_id||A.template_id||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`task-${Date.now()}-${Math.random()}`);w.push({id:R,task:A,progress:{status:"not_started",time_spent:{value:0,unit:"minutes"},step_progress:{},updated_at:""},detailsLoaded:!1})})},k=L(()=>w.some(_=>_.progress.status==="in_progress"&&_.progress.updated_at)),Z=L(()=>w.filter(_=>_.progress.status==="completed").length),ie=L(()=>w.filter(_=>_.progress.status==="in_progress"&&_.progress.updated_at).length),G=L(()=>w.slice(0,3)),le=L(()=>{var _;return((_=P.value)==null?void 0:_.name)||"Task Details"}),ue=L(()=>{var _,te;return String(((_=e.workOrder)==null?void 0:_.id)??((te=e.workOrder)==null?void 0:te.name)??"unknown")}),$=async()=>{const _=await zr.getDrafts(ue.value);b.value=!0,_.forEach(te=>{const f=w.find(A=>String(A.id)===String(te.taskId));f&&(f.progress={status:te.status==="draft"?"in_progress":te.status,time_spent:{...te.time_spent},step_progress:{...te.step_progress},updated_at:te.updated_at})})},B=async _=>{F.value=!0,I.value=!0,P.value=null;try{const te=_.task_entry_id||_.taskEntryId||_.id||_.task_id;if(te){const f=await Oa(te),A=f==null?void 0:f.data;A?P.value={..._,...A,steps:Array.isArray(A.steps)&&A.steps.length?A.steps:_.steps||[]}:P.value=_}else P.value=_}catch(te){console.warn("Failed to load task entry details:",te),P.value=_}finally{I.value=!1}},me=()=>{F.value=!1,P.value=null},ne=()=>{var f,A,R,j,oe,ce,K,X,ke,De;const _=ee(),te={taskInfo:{id:((f=P.value)==null?void 0:f.id)||((A=P.value)==null?void 0:A.task_id),name:(R=P.value)==null?void 0:R.name,description:(j=P.value)==null?void 0:j.description},workOrderInfo:{id:(oe=e.workOrder)==null?void 0:oe.id,name:(ce=e.workOrder)==null?void 0:ce.name},stepValues:_,timestamp:new Date().toISOString(),totalSteps:((X=(K=P.value)==null?void 0:K.steps)==null?void 0:X.length)||0};S(te,"taskStepValues",{taskId:(ke=P.value)==null?void 0:ke.id,workOrderId:(De=e.workOrder)==null?void 0:De.id,stepCount:Object.keys(_).length})},ee=()=>{const _={};try{const te=document.querySelector(".drawer-inner .steps-content .steps-preview-container");return te?(te.querySelectorAll(".preview-step-simple").forEach((A,R)=>{const j=W(A,R);j&&(_[`step_${R+1}`]=j)}),console.log("Collected step values:",_),_):(console.warn("Steps preview container not found"),_)}catch(te){return console.error("Error collecting step values:",te),_}},W=(_,te)=>{var f,A,R;try{const j={stepIndex:te+1,stepType:"unknown",value:null,label:null,required:!1},oe=_.querySelector(".preview-label, .step-label, .checkbox-step-preview label");oe&&(j.label=(f=oe.textContent)==null?void 0:f.replace("*","").trim(),j.required=((A=oe.textContent)==null?void 0:A.includes("*"))||!1);const ce=_.querySelector(".el-input-number input");if(ce){j.stepType="number",j.value=ce.value?parseFloat(ce.value):null;const Te=_.querySelector(".unit-label");return Te&&(j.unit=(R=Te.textContent)==null?void 0:R.trim()),j}const K=_.querySelector('.el-checkbox input[type="checkbox"]');if(K)return j.stepType="checkbox",j.value=K.checked,j;const X=_.querySelector(".el-input input, .el-textarea textarea");if(X)return j.stepType="text",j.value=X.value,j;const ke=_.querySelector('input[type="radio"]:checked');if(ke)return j.stepType="inspection",j.value=ke.value,j;if(_.querySelector(".el-upload")){j.stepType="attachment";const Te=_.querySelectorAll(".el-upload-list__item");return j.value={uploadedFiles:Te.length,files:Array.from(Te).map(Le=>{var Pe;const he=Le.querySelector(".el-upload-list__item-name");return he?(Pe=he.textContent)==null?void 0:Pe.trim():"Unknown file"})},j}const Ve=_.querySelector("input, textarea, select");return Ve&&(j.stepType=Ve.type||"unknown",j.value=Ve.value),j}catch(j){return console.error(`Error collecting value for step ${te+1}:`,j),{stepIndex:te+1,stepType:"error",value:null,error:j.message}}},re=()=>{console.log("Submitting task:",P.value),me()};Ue(async()=>{J(),await $()}),ge(()=>e.workOrder,async()=>{J(),await $()});const Y={props:e,emit:y,handleBackToDetail:h,t:c,currentPayload:u,showJsonDisplayer:g,logPayload:S,closeDebugDrawer:T,draftsLoaded:b,taskCards:w,drawerVisible:F,activeTask:P,drawerLoading:I,buildTaskList:J,hasDrafts:k,completedCount:Z,draftCount:ie,displayCards:G,drawerTitle:le,workOrderKey:ue,loadDrafts:$,openTaskDrawer:B,closeDrawer:me,handleLogStepValues:ne,collectStepValues:ee,collectStepValue:W,handleSubmitTask:re,computed:L,onMounted:Ue,reactive:et,ref:O,watch:ge,get ArrowLeft(){return Bt},get useI18n(){return Be},get OfflineStorageService(){return zr},TaskExecutionSummary:Ip,StepsPreview:ra,get getTaskEntryById(){return Oa},get JsonDebugDrawer(){return Xa},get usePayloadLogger(){return zt},get clonePayload(){return Qe}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},Fp={class:"work-order-execution"},xp={class:"execution-header"},Ep={class:"header-right"},Wp={key:0,class:"tasks-summary"},Rp={class:"drawer-header-container",style:{"margin-bottom":"-32px !important"}},Lp={class:"drawer-header-left"},Mp={class:"drawer-title"},qp={key:0,class:"task-id-header"},Up={key:0,class:"drawer-header-description"},zp={class:"task-drawer-content"},Np={key:0,class:"drawer-inner"},Bp={class:"steps-content"},jp={class:"task-actions"};function Hp(l,t,d,e,y,h){var w;const c=D("el-tag"),u=D("el-icon"),g=D("el-button"),S=D("el-empty"),T=D("el-drawer"),b=aa("loading");return i(),p("div",Fp,[a("header",xp,[a("div",null,[a("h2",null,m(((w=d.workOrder)==null?void 0:w.name)||"Work Order"),1),t[2]||(t[2]=a("p",{class:"subtitle"},"Execute tasks and record progress",-1))]),a("div",Ep,[e.hasDrafts?(i(),N(c,{key:0,type:"warning",effect:"light"},{default:o(()=>t[3]||(t[3]=[V("Drafts saved locally  available offline.")])),_:1,__:[3]})):s("v-if",!0),r(g,{type:"default",onClick:e.handleBackToDetail},{default:o(()=>[r(u,null,{default:o(()=>[r(e.ArrowLeft)]),_:1}),V(" "+m(l.$t("workOrder.actions.backToDetail")),1)]),_:1})])]),e.displayCards.length?(i(),p("section",Wp,[(i(!0),p(se,null,fe(e.displayCards,(F,P)=>(i(),N(e.TaskExecutionSummary,{key:F.id,task:F.task,progress:F.progress,index:P,onSelect:I=>e.openTaskDrawer(F.task)},null,8,["task","progress","index","onSelect"]))),128)),e.taskCards.length>3?(i(),N(g,{key:0,type:"text",class:"view-all"},{default:o(()=>t[4]||(t[4]=[V(" View all tasks ")])),_:1,__:[4]})):s("v-if",!0)])):(i(),N(S,{key:1,description:"No tasks available","image-size":120})),r(T,{modelValue:e.drawerVisible,"onUpdate:modelValue":t[0]||(t[0]=F=>e.drawerVisible=F),title:e.drawerTitle,size:"50%","destroy-on-close":"","append-to-body":"",class:"work-order-task-drawer"},{header:o(()=>[a("div",Rp,[s(" Title and ID on left side "),a("div",Lp,[a("div",Mp,m(e.drawerTitle),1),e.activeTask?(i(),p("div",qp,"ID: "+m(e.activeTask.id||e.activeTask.task_id||"N/A"),1)):s("v-if",!0)]),s(" Description "),e.activeTask&&e.activeTask.description?(i(),p("div",Up,m(e.activeTask.description),1)):s("v-if",!0)])]),default:o(()=>[Ct((i(),p("div",zp,[e.activeTask&&!e.drawerLoading?(i(),p("div",Np,[s(" Steps Content "),a("div",Bp,[r(e.StepsPreview,{steps:e.activeTask.steps,interactive:!0},null,8,["steps"])]),s(" Action Buttons "),a("div",jp,[r(g,{onClick:e.closeDrawer},{default:o(()=>t[5]||(t[5]=[V("Cancel")])),_:1,__:[5]}),r(g,{type:"info",onClick:e.handleLogStepValues},{default:o(()=>t[6]||(t[6]=[V("Logs")])),_:1,__:[6]}),r(g,{type:"primary",onClick:e.handleSubmitTask},{default:o(()=>t[7]||(t[7]=[V("Submit")])),_:1,__:[7]})])])):s("v-if",!0)])),[[b,e.drawerLoading]])]),_:1},8,["modelValue","title"]),s(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[1]||(t[1]=F=>e.showJsonDisplayer=F),"payload-data":e.currentPayload,title:"Task Step Values",subtitle:"User input values for each step"},null,8,["modelValue","payload-data"])])}const Yp=Re(Vp,[["render",Hp],["__scopeId","data-v-dc30a23a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/WorkOrderExecution.vue"]]),Jp={__name:"StandardsConfirmDialog",props:{modelValue:{type:Boolean,default:!1},standards:{type:Array,default:()=>[]},workOrderName:{type:String,default:""}},emits:["update:modelValue","confirm","cancel"],setup(l,{expose:t,emit:d}){t();const e=l,y=d,h=L(()=>e.workOrderName?`Review Standards  ${e.workOrderName}`:"Review Standards"),c=L(()=>Array.isArray(e.standards)&&e.standards.length>0),u=O(),g=O(!0),S=k=>k?typeof k=="string"?k:typeof k=="object"&&(k.name||k.label)||"":"",T=k=>{y("update:modelValue",k)},b=()=>{T(!1),y("cancel")},w=()=>{T(!1),y("confirm")},F=()=>{if(!u.value){g.value=!1;return}const k=u.value;if(!(k.scrollHeight>k.clientHeight)){g.value=!1;return}const G=k.scrollTop+k.clientHeight>=k.scrollHeight-8;g.value=!G},P=()=>{F()},I=async()=>{await Me(),u.value&&(u.value.scrollTop=0),F()};ge(()=>e.modelValue,k=>{k&&(g.value=!0,I())}),ge(()=>e.standards,()=>{I()}),Ue(()=>{F()}),Ot(()=>{g.value=!1});const J={props:e,emit:y,dialogTitle:h,hasStandards:c,listRef:u,confirmDisabled:g,formatCategory:S,closeDialog:T,handleCancel:b,handleConfirm:w,updateScrollState:F,handleScroll:P,resetScrollState:I,computed:L,onMounted:Ue,onBeforeUnmount:Ot,ref:O,watch:ge,nextTick:Me,get Document(){return qt}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}},Qp={class:"dialog-intro"},Gp={class:"standard-header"},Kp={class:"standard-name"},Zp={key:0,class:"standard-description"},Xp={key:1,class:"rules-list"},$p={class:"rule-index"},ev={key:2,class:"empty-rule"},tv={class:"dialog-footer"};function av(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-tag"),g=D("el-empty"),S=D("el-button"),T=D("el-dialog");return i(),N(T,{"model-value":d.modelValue,title:e.dialogTitle,width:"680px",top:"10vh","append-to-body":"",class:"review-standards-dialog",onClose:e.handleCancel},{footer:o(()=>[a("div",tv,[r(S,{onClick:e.handleCancel},{default:o(()=>t[1]||(t[1]=[V("Cancel")])),_:1,__:[1]}),r(S,{type:"primary",disabled:e.confirmDisabled,onClick:e.handleConfirm},{default:o(()=>t[2]||(t[2]=[V("Confirm & Continue")])),_:1,__:[2]},8,["disabled"])])]),default:o(()=>[a("div",Qp,[r(c,{class:"intro-icon"},{default:o(()=>[r(e.Document)]),_:1}),t[0]||(t[0]=a("div",null,[a("p",{class:"intro-title"},"Review associated standards before starting execution."),a("p",{class:"intro-subtitle"},"Please confirm all rules have been reviewed.")],-1))]),a("div",{ref:"listRef",class:"standards-wrapper",onScroll:e.handleScroll},[e.hasStandards?(i(!0),p(se,{key:0},fe(d.standards,b=>(i(),p("div",{key:b.id||b.name,class:"standard-card"},[a("div",Gp,[a("div",Kp,m(b.name||"Standard"),1),b.category?(i(),N(u,{key:0,size:"small",type:"info",effect:"plain"},{default:o(()=>[V(m(e.formatCategory(b.category)),1)]),_:2},1024)):s("v-if",!0)]),b.description?(i(),p("p",Zp,m(b.description),1)):s("v-if",!0),b.items&&b.items.length?(i(),p("ul",Xp,[(i(!0),p(se,null,fe(b.items,(w,F)=>(i(),p("li",{key:F},[a("span",$p,m(F+1)+".",1),a("span",null,m(w),1)]))),128))])):(i(),p("div",ev,"No rules provided for this standard."))]))),128)):(i(),N(g,{key:1,description:"No standards associated with this work order.","image-size":120}))],544)]),_:1},8,["model-value","title"])}const rv=Re(Jp,[["render",av],["__scopeId","data-v-aff7eae1"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/StandardsConfirmDialog.vue"]]),ov=be({name:"TodoView"}),nv=Object.assign(ov,{props:{workOrders:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},total:{type:Number,default:0},currentPage:{type:Number,default:1},pageSize:{type:Number,default:10}},emits:["edit","delete","status-change","refresh","work-order-created","work-order-updated","page-change","page-size-change","tab-change"],setup(l,{expose:t,emit:d}){const e=l,y=d,{t:h}=Be(),c=O(null),u=O("todo"),g=O("priority-desc"),S=O("detail"),T=O(null),b=O(!1),w=O(window.innerWidth),F=O(!1),P=O(null),I=O(null),J=it(),k=ht(),Z=O(e.currentPage),ie=O(e.pageSize),G=yt(),le=O("work-order-create"),ue=O(0),$=O(!1),B=O(null),me=O(null),ne=L(()=>`${le.value}-${ue.value}`),ee=L(()=>{var M,z;const v=((M=B.value)==null?void 0:M.standards)||((z=B.value)==null?void 0:z.standard_list);return Array.isArray(v)?v:[]}),W=()=>{if(I.value)try{const v=I.value.$el||I.value,M=v.querySelector(".tasks-section");if(M){const z=v.querySelector(".work-order-create-enhanced");if(z){const pe=M.offsetTop;z.scrollTo({top:pe-50,behavior:"smooth"})}}}catch(v){console.warn("Could not scroll to tasks section:",v)}},re=L(()=>w.value>1800?7:3),Y=L(()=>Array.isArray(e.workOrders)?e.workOrders:[]),_=L(()=>{const v=e.total,M=v===0?0:(Z.value-1)*ie.value+1,z=Math.min(Z.value*ie.value,v);return{start:M,end:z,total:v}}),te=async()=>{if(S.value==="create"&&I.value)try{return(I.value.hasFormChanges?I.value.hasFormChanges():!1)&&(await $e.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}),G&&G.clearDraft&&G.clearDraft()),!0}catch(v){return v==="cancel"||v==="close"?!1:(console.error("Error checking form changes:",v),!0)}return!0},f=async v=>{if(await te())try{b.value=!0;const z=await qa(v.id);z&&z.data?c.value=z.data:c.value=v,S.value="detail"}catch(z){console.error("Failed to fetch work order:",z),c.value=v,S.value="detail",U.error("Failed to load work order details")}finally{b.value=!1}},A=async v=>{if(!await te())return;u.value=v,c.value=null,y("tab-change",{tab:v,statusFilter:v==="todo"?"pending,in_progress":"completed"})},R=v=>{g.value=v},j=({action:v,workOrder:M})=>{switch(v){case"edit":oe(M);break;case"view":f(M);break;case"delete":ce(M);break;case"start":K(M);break;default:console.warn(`Unhandled action: ${v}`,M)}},oe=async v=>{if(await te()){S.value="edit",b.value=!0;try{const z=await qa(v.id),pe=(z==null?void 0:z.data)||v;T.value=pe,c.value=pe}catch(z){console.error("Failed to load work order for edit:",z),U.error("Failed to load the latest work order details. Showing cached data."),T.value=v,c.value=v}finally{b.value=!1}}},ce=v=>{y("delete",v)},K=async v=>{await te()&&(c.value=v,B.value=v,$.value=!0)},X=()=>{$.value=!1,B.value&&(me.value=B.value,S.value="execution",c.value=B.value)},ke=()=>{$.value=!1,B.value=null},De=()=>{S.value="detail",me.value=null,B.value=null},Ve=O(!1),Te=async(v,M)=>{if(!(!v||Ve.value)){Ve.value=!0;try{if(v==="create")je({fromTemplateDesigner:!0});else if(v==="edit"){const z=M?Number(M)||M:null;if(!z){console.warn("Missing workOrderId for edit return context.");return}const pe=Y.value.find(we=>we.id===z);await oe(pe||{id:z})}}finally{Ve.value=!1}}},Le=async()=>{const v={...k.query};delete v.panel,delete v.workOrderId;try{await J.replace({path:k.path,query:v})}catch(M){(M==null?void 0:M.name)!=="NavigationDuplicated"&&console.warn("Failed to cleanup return query:",M)}};ge(()=>k.query.panel,async v=>{const M=Array.isArray(v)?v[0]:v;if(!M)return;let z=Array.isArray(k.query.workOrderId)?k.query.workOrderId[0]:k.query.workOrderId;!z&&G.returnWorkOrderId&&(z=G.returnWorkOrderId),await Te(M,z),await Le(),Me(()=>{setTimeout(()=>{G.clearReturnContext()},100)})},{immediate:!0}),ge(()=>G.returnPanel,async v=>{!v||k.query.panel||(await Te(v,G.returnWorkOrderId),Me(()=>{setTimeout(()=>{G.clearReturnContext()},100)}))},{immediate:!0});const he=v=>{U.success(h("workOrder.messages.shareSuccess"))},Pe=async v=>{try{P.value=v,F.value=!0,U.success("PDF preview opened")}catch(M){console.error("Export error:",M),U.error("Failed to open PDF preview. Please try again.")}},tt=()=>{F.value=!1,P.value=null},Je=({workOrder:v,status:M})=>{y("status-change",{workOrder:v,status:M})},ot=()=>{U.info(h("workOrder.tracking.addParts"))},dt=()=>{U.info(h("workOrder.tracking.addTime"))},nt=()=>{U.info(h("workOrder.tracking.addCosts"))},at=()=>{U.info(h("workOrder.tracking.viewProcedure"))},ct=()=>{U.success(h("workOrder.comments.add"))},ut=async v=>{await te()&&(Z.value=v,y("page-change",v),c.value=null)},mt=v=>{ie.value=v,Z.value=1,y("page-size-change",v),c.value=null};ge(()=>e.workOrders,v=>{v.length>0&&!c.value&&(c.value=Y.value[0])},{immediate:!0}),ge(()=>e.currentPage,v=>{Z.value=v}),ge(()=>e.pageSize,v=>{ie.value=v}),ge(()=>e.filters,(v,M)=>{const z=Ce=>{if(!Ce)return{};const Se={...Ce};return delete Se.page,delete Se.limit,Se},pe=JSON.stringify(z(M)),we=JSON.stringify(z(v));pe!==we&&(Z.value=1,y("page-change",1),c.value=null)},{deep:!0}),ge([u,g],()=>{Z.value=1,y("page-change",1),c.value=null},{deep:!0});const je=(v={})=>{S.value="create",c.value=null,(v.fromTemplateDesigner||G.shouldOpenCreatePanel)&&(ue.value+=1,Me(()=>{setTimeout(()=>{W()},100)}))},ft=()=>{console.log(" TodoView: showDetailView called"),console.log(" TodoView: Setting currentRightPanelView to detail"),S.value="detail",T.value=null,!c.value&&Y.value.length>0&&(c.value=Y.value[0]),console.log(" TodoView: showDetailView completed, currentRightPanelView:",S.value)},x=v=>{y("work-order-created",v)},ze=v=>{const M=Y.value.findIndex(z=>z.id===v.id);M!==-1&&(Y.value[M]=v),c.value&&c.value.id===v.id&&(c.value=v),T.value=null,S.value="detail",y("work-order-updated",v),U.success("Work order updated successfully")},Ge=v=>{const M=Y.value.find(z=>z.id===v);return M?(c.value=M,S.value="detail",!0):(console.warn("Work order not found in displayedWorkOrders"),!1)};t({showCreateForm:je,showDetailView:ft,selectWorkOrderById:Ge}),Ue(()=>{Y.value.length>0&&(c.value=Y.value[0]);const v=()=>{w.value=window.innerWidth};window.addEventListener("resize",v),pa(()=>{window.removeEventListener("resize",v)})});const Ke={props:e,emit:y,t:h,selectedWorkOrder:c,activeTab:u,sortBy:g,currentRightPanelView:S,workOrderToEdit:T,isLoadingWorkOrder:b,screenWidth:w,showPdfPreview:F,pdfPreviewData:P,workOrderCreateRef:I,router:J,route:k,internalCurrentPage:Z,internalPageSize:ie,workOrderDraftStore:G,createPanelKey:le,createPanelRefreshCounter:ue,showStandardsDialog:$,pendingExecutionWorkOrder:B,workOrderInExecution:me,computedCreatePanelKey:ne,executionStandards:ee,scrollToTasksSection:W,pagerCount:re,displayedWorkOrders:Y,paginationInfo:_,checkUnsavedChanges:te,selectWorkOrder:f,handleTabChange:A,handleSortChange:R,handleCardAction:j,handleEdit:oe,handleDelete:ce,handleStartWorkOrder:K,confirmStartExecution:X,cancelStartExecution:ke,handleExecutionClose:De,isProcessingReturnContext:Ve,processReturnPanel:Te,cleanupReturnQuery:Le,handleShare:he,handleExport:Pe,handlePdfPreviewClose:tt,handleStatusChange:Je,handleAddParts:ot,handleAddTime:dt,handleAddCosts:nt,handleViewProcedure:at,handleAddComment:ct,handlePageChange:ut,handlePageSizeChange:mt,showCreateForm:je,showDetailView:ft,handleWorkOrderCreated:x,handleWorkOrderUpdated:ze,selectWorkOrderById:Ge,__MACROS_defineComponent:be,ref:O,computed:L,watch:ge,onMounted:Ue,onUnmounted:pa,nextTick:Me,get useRouter(){return it},get useRoute(){return ht},get useI18n(){return Be},get ElMessage(){return U},get ElMessageBox(){return $e},get getWorkOrderById(){return qa},WorkOrderCard:Ds,WorkOrderDetail:yc,WorkOrderCreate:zm,WorkOrderEdit:mf,PdfPreviewModal:cp,WorkOrderExecution:Yp,StandardsConfirmDialog:rv,get useWorkOrderDraftStore(){return yt}};return Object.defineProperty(Ke,"__isScriptSetup",{enumerable:!1,value:!0}),Ke}}),sv={class:"todo-view"},lv={class:"left-panel"},iv={class:"todo-specific-filters"},dv={class:"sort-options"},cv={class:"sort-label"},uv={class:"work-order-list"},mv={key:0,class:"loading-container"},_v={key:1,class:"empty-list"},fv={key:2,class:"list-content"},gv={class:"pagination-info"},pv={class:"info-text"},vv={class:"cards-container"},hv={key:0,class:"pagination-controls"},yv={class:"right-panel"},wv={key:0,class:"loading-container"};function kv(l,t,d,e,y,h){var I,J;const c=D("el-tab-pane"),u=D("el-tabs"),g=D("el-option"),S=D("el-select"),T=D("el-skeleton"),b=D("el-empty"),w=D("el-col"),F=D("el-row"),P=D("el-pagination");return i(),p("div",sv,[s(" Left Panel - Work Order List "),a("div",lv,[s(" Todo-specific Filters (Status tabs and sorting) "),Ct(a("div",iv,[s(" Status Tabs "),r(u,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=k=>e.activeTab=k),onTabChange:e.handleTabChange,class:"todo-tabs"},{default:o(()=>[r(c,{label:l.$t("workOrder.tabs.todo"),name:"todo"},null,8,["label"]),r(c,{label:l.$t("workOrder.tabs.done"),name:"done"},null,8,["label"])]),_:1},8,["modelValue"]),s(" Sort Options "),a("div",dv,[a("div",cv,m(l.$t("workOrder.sort.sortBy"))+":",1),r(S,{modelValue:e.sortBy,"onUpdate:modelValue":t[1]||(t[1]=k=>e.sortBy=k),onChange:e.handleSortChange,size:"small",style:{width:"180px"}},{default:o(()=>[r(g,{label:l.$t("workOrder.sort.priorityHighest"),value:"priority-desc"},null,8,["label"]),r(g,{label:l.$t("workOrder.sort.priorityLowest"),value:"priority-asc"},null,8,["label"]),r(g,{label:l.$t("workOrder.sort.dueDateNearest"),value:"dueDate-asc"},null,8,["label"]),r(g,{label:l.$t("workOrder.sort.dueDateFarthest"),value:"dueDate-desc"},null,8,["label"]),r(g,{label:l.$t("workOrder.sort.createdNewest"),value:"created-desc"},null,8,["label"]),r(g,{label:l.$t("workOrder.sort.createdOldest"),value:"created-asc"},null,8,["label"])]),_:1},8,["modelValue"])])],512),[[Ga,!1]]),s(" Work Order Cards "),a("div",uv,[d.loading?(i(),p("div",mv,[r(T,{rows:3,animated:""})])):e.displayedWorkOrders&&e.displayedWorkOrders.length===0?(i(),p("div",_v,[r(b,{description:l.$t("workOrder.messages.noData"),"image-size":80},null,8,["description"])])):(i(),p("div",fv,[s(" Pagination Info "),a("div",gv,[a("div",pv,m(l.$t("workOrder.pagination.showing",{start:e.paginationInfo.start,end:e.paginationInfo.end,total:e.paginationInfo.total})),1),r(S,{modelValue:e.internalPageSize,"onUpdate:modelValue":t[2]||(t[2]=k=>e.internalPageSize=k),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:o(()=>[r(g,{label:"10",value:10}),r(g,{label:"20",value:20}),r(g,{label:"50",value:50})]),_:1},8,["modelValue"])]),s(" Cards Container "),a("div",vv,[r(F,{gutter:16},{default:o(()=>[(i(!0),p(se,null,fe(e.displayedWorkOrders,k=>(i(),N(w,{key:k.id},{default:o(()=>{var Z;return[r(e.WorkOrderCard,{"work-order":k,"is-selected":((Z=e.selectedWorkOrder)==null?void 0:Z.id)===k.id,onSelect:e.selectWorkOrder,onAction:e.handleCardAction},null,8,["work-order","is-selected"])]}),_:2},1024))),128))]),_:1})]),s(" Pagination Controls "),e.paginationInfo.total>e.internalPageSize?(i(),p("div",hv,[r(P,{"current-page":e.internalCurrentPage,"page-size":e.internalPageSize,"pager-count":e.pagerCount,total:e.paginationInfo.total,layout:"total, prev, pager, next, jumper",small:!0,onCurrentChange:e.handlePageChange,onSizeChange:e.handlePageSizeChange,"hide-on-single-page":""},null,8,["current-page","page-size","pager-count","total"])])):s("v-if",!0)]))])]),s(" Right Panel - Work Order Detail or Create "),a("div",yv,[s(" Loading State "),e.isLoadingWorkOrder?(i(),p("div",wv,[r(T,{rows:5,animated:""}),t[5]||(t[5]=a("div",{class:"loading-text"},m("Loading work order details..."),-1))])):e.currentRightPanelView==="detail"?(i(),p(se,{key:1},[s(" Work Order Detail View "),r(e.WorkOrderDetail,{"work-order":e.selectedWorkOrder,onEdit:e.handleEdit,onShare:e.handleShare,onExport:e.handleExport,onStatusChange:e.handleStatusChange,onAddParts:e.handleAddParts,onAddTime:e.handleAddTime,onAddCosts:e.handleAddCosts,onViewProcedure:e.handleViewProcedure,onAddComment:e.handleAddComment,onStartWorkOrder:e.handleStartWorkOrder},null,8,["work-order"])],2112)):e.currentRightPanelView==="create"?(i(),p(se,{key:2},[s(" Work Order Create View "),(i(),N(e.WorkOrderCreate,{key:e.computedCreatePanelKey,onBackToDetail:e.showDetailView,onWorkOrderCreated:e.handleWorkOrderCreated,ref:"workOrderCreateRef"}))],2112)):e.currentRightPanelView==="edit"?(i(),p(se,{key:3},[s(" Work Order Edit View "),r(e.WorkOrderEdit,{"work-order":e.workOrderToEdit,onBackToDetail:e.showDetailView,onWorkOrderUpdated:e.handleWorkOrderUpdated},null,8,["work-order"])],2112)):e.currentRightPanelView==="execution"?(i(),N(e.WorkOrderExecution,{key:((I=e.workOrderInExecution)==null?void 0:I.id)||"execution","work-order":e.workOrderInExecution,onClose:e.handleExecutionClose,onBackToDetail:e.showDetailView},null,8,["work-order"])):s("v-if",!0)]),r(e.StandardsConfirmDialog,{modelValue:e.showStandardsDialog,"onUpdate:modelValue":t[3]||(t[3]=k=>e.showStandardsDialog=k),"work-order-name":((J=e.pendingExecutionWorkOrder)==null?void 0:J.name)||"",standards:e.executionStandards,onConfirm:e.confirmStartExecution,onCancel:e.cancelStartExecution},null,8,["modelValue","work-order-name","standards"]),s(" PDF Preview Modal "),r(e.PdfPreviewModal,{visible:e.showPdfPreview,"onUpdate:visible":t[4]||(t[4]=k=>e.showPdfPreview=k),"work-order":e.pdfPreviewData,onClose:e.handlePdfPreviewClose},null,8,["visible","work-order"])])}const bv=Re(nv,[["render",kv],["__scopeId","data-v-27c8d13b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/TodoView.vue"]]),Nr=250,Br=100,Sv={__name:"workOrderCalendar",props:{data:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["date-range-change","view"],setup(l,{expose:t,emit:d}){const e=O(null),y=O([]),h=lr(),c=l,u=d;t({refetchEvents:()=>{var A,R;(R=(A=e.value)==null?void 0:A.getApi())==null||R.refetchEvents()}}),ge(()=>h.lang,A=>{re(A)},{immediate:!0});const g=O(""),S=A=>{g.value=A.view.type};function T(A){var j,oe;const R=((j=e.value)==null?void 0:j.el)||((oe=e.value)==null?void 0:oe.$el);return R?R.querySelector(".fc-scroller, .fc-scroller-harness .fc-scroller"):null}const b=new Map;ir(()=>{const A=T(g.value);A&&b.set(g.value,A.scrollTop)}),Ma(()=>{setTimeout(()=>{const A=T(g.value);if(A){const R=b.get(g.value)??0;A.scrollTop=R}},0)}),Ma(()=>{var A,R;(R=(A=e.value)==null?void 0:A.getApi())==null||R.updateSize()});const w={en:{today:"Today",year:"Year",month:"Month",week:"Week",day:"Day",list:"Weekly List"},zh:{today:"",year:"",month:"",week:"",day:"",list:""}},F=O({plugins:[Ir,Vr,Fr,xr,Er],initialView:"dayGridMonth",headerToolbar:{left:"today",center:"prev,title,next",right:"multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay,listWeek"},events:y.value,eventSources:[{events(A,R,j){const{startStr:oe,endStr:ce}=A;u("date-range-change",{start_date_from:oe,end_date_to:ce,resolve:R,reject:j})}}],eventDataTransform:P,eventClick:I,eventMouseEnter:ne,eventMouseLeave:ee,locales:[Pr,Ar],locale:"en",aspectRatio:"2.9",multiMonthMaxColumns:1,nowIndicator:!0,nowIndicatorClassNames:["custom-now-indicator"],viewDidMount:S,eventMaxStack:!0,dayMaxEventRows:!0});function P(A){var oe,ce,K,X;const R=(oe=A.state)==null?void 0:oe.id,j=Y(A.due_date)&&R!==7&&R!==12;return{id:A.id,title:A.name,start:A.start_date,end:A.end_date||null,groupId:A.recurrence_uuid||null,backgroundColor:j?"#fef2f2":"#f9fafb",borderColor:"#dddddd",textColor:j?"red":"black",display:"block",extendedProps:{...A,stateId:R,dueDate:A.due_date,categories:A.categories,stateName:(ce=A.state)==null?void 0:ce.name,priorityId:(K=A.priority)==null?void 0:K.id,priorityName:(X=A.priority)==null?void 0:X.name,image_list:A.image_list||[],work_order_progress:A.work_order_progress||null,equipment_node:A.equipment_node||null,isOverDue:j}}}function I(A){u("view",{id:A.event.id})}const J=({extendedProps:A})=>{const R=A.stateId;return R===7?nr:R===12?or:void 0},k=A=>{var oe;const R=A.groupId,j=((oe=A.extendedProps.recurrence_type)==null?void 0:oe.id)||null;return R&&j!=null&&j!==1?Na:void 0},Z=({extendedProps:A})=>{const R=A.stateId;return R===7?"green":R===12?"red":""},ie=A=>A?"danger":"default",G=O(),le=O({getBoundingClientRect:()=>new DOMRect(0,0,0,0),contextElement:document.body}),ue=O(!1),$=et({id:"",gropuId:"",title:"",startDate:"",endDate:"",dueDate:"",finished_at:"",priority:null,category:null,state:null,stateId:"",stateName:"",recurrence_type:null,image_list:[],isOverDue:null});let B=null,me=null;function ne(A){const{event:R,jsEvent:j}=A,{clientX:oe,clientY:ce}=j;me&&clearTimeout(me),B&&(clearTimeout(B),B=null),B=window.setTimeout(()=>{$.id=R.id,$.groupId=R.groupId,$.title=R.title,$.startDate=R.start,$.endDate=R.end,$.finished_at=R.extendedProps.finished_at,$.priority=R.extendedProps.priority,$.category=R.extendedProps.categories,$.dueDate=R.extendedProps.dueDate,$.state=R.extendedProps.state,$.stateId=R.extendedProps.stateId,$.stateName=R.extendedProps.stateName,$.recurrence_type=R.extendedProps.recurrence_type,$.image_list=R.extendedProps.image_list,$.work_order_progress=R.extendedProps.work_order_progress,$.equipment_node=R.extendedProps.equipment_node,$.isOverDue=R.extendedProps.isOverDue,le.value.getBoundingClientRect=()=>new DOMRect(oe,ce,0,0),le.value.contextElement=document.body,ue.value=!0},Nr)}function ee(A){B&&clearTimeout(B),me=window.setTimeout(()=>{ue.value=!1,me=null},Br)}const W=A=>A?lt(A):"-";function re(A){var j;const R=(j=e.value)==null?void 0:j.getApi();R&&(R.setOption("locale",A),R.setOption("buttonText",w[A]))}function Y(A){if(!A)return!1;const R=new Date;return R.setHours(0,0,0,0),new Date(A)<R}const _=L(()=>$.image_list&&$.image_list.length>0?540:420),te=[{id:1,name:"Erik Yu"},{id:2,name:"Jane Smith"},{id:3,name:"Mike Johnson"}];Ue(()=>{re(h.lang)});const f={fullCalendarRef:e,events:y,appStore:h,props:c,emit:u,currentViewName:g,handleViewMount:S,getScrollContainer:T,scrollPositions:b,buttonTextMap:w,calendarOptions:F,convertWorkOrderDTOToEventFormat:P,handleEventClick:I,getIconByStateId:J,recurrenceIcon:k,getColorByStateId:Z,getTextTypeByDueDate:ie,workOrderHoverPopover:G,virtualTrigger:le,popoverVisible:ue,popoverData:$,showDelayMs:Nr,hideDelayMs:Br,get hoverTimer(){return B},set hoverTimer(A){B=A},get hideTimer(){return me},set hideTimer(A){me=A},handleEventMouseEnter:ne,handleEventMouseLeave:ee,formatDate:W,setCalendarLocale:re,isDateBeforeToday:Y,popperWidth:_,temporaryUserList:te,get FullCalendar(){return Uo},get dayGridPlugin(){return Ir},get interactionPlugin(){return Fr},get timeGridPlugin(){return Vr},get multiMonthPlugin(){return xr},get listPlugin(){return Er},get enLocale(){return Pr},get zhLocale(){return Ar},onMounted:Ue,ref:O,reactive:et,watch:ge,computed:L,onDeactivated:ir,onActivated:Ma,get ElPopover(){return Wo},get CircleCheck(){return nr},get CircleClose(){return or},get Refresh(){return Na},get Picture(){return ea},get convertToLocalTime(){return lt},get useAppStore(){return lr},PriorityTag:Ka,CategoryTag:Za,StatusTag:so};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},Tv={class:"fc-ref"},Ov={class:"fc-item"},Cv={class:"fc-title"},Dv={style:{display:"flex","align-items":"center"}},Pv={style:{"margin-right":"10px"}},Av={class:"tag-row"},Iv={key:0},Vv={key:1},Fv={key:2},xv={key:3},Ev={style:{display:"flex"}},Wv={key:0,class:"card-thumbnail-circle"},Rv={class:"image-slot-circle"};function Lv(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-text"),g=D("el-tag"),S=D("el-progress"),T=D("el-image"),b=aa("loading");return i(),p(se,null,[Ct((i(),p("div",null,[r(e.FullCalendar,{ref:"fullCalendarRef",options:e.calendarOptions,class:"wo-calendar"},{eventContent:o(({event:w,timeText:F})=>[a("div",Tv,[s(" Work order event display "),a("div",Ov,[a("span",Cv,m(F)+" "+m(w.title),1),s(" State icon "),e.getIconByStateId(w)?(i(),N(c,{key:0,class:"status-icon",color:e.getColorByStateId(w)},{default:o(()=>[(i(),N(ta(e.getIconByStateId(w))))]),_:2},1032,["color"])):s("v-if",!0),s(" Recurrence icon "),e.recurrenceIcon(w)?(i(),N(c,{key:1,class:"status-icon"},{default:o(()=>[(i(),N(ta(e.recurrenceIcon(w))))]),_:2},1024)):s("v-if",!0)])])]),_:1},8,["options"])])),[[b,e.props.loading]]),s(" Tooltip on hover for work order events "),r(e.ElPopover,{ref:"workOrderHoverPopover",visible:e.popoverVisible,"virtual-triggering":"","virtual-ref":e.virtualTrigger,width:e.popperWidth,"popper-class":"wo-popover"},{default:o(()=>{var w,F;return[a("div",Dv,[s(" Left content "),a("div",Pv,[s(" Priority / Category / Status on same row "),a("div",Av,[s(" ID "),a("div",null,[r(u,{size:"large",style:{"font-weight":"600",color:"var(--el-color-primary)"}},{default:o(()=>[V(" #"+m(e.popoverData.id),1)]),_:1})]),e.popoverData.priority!==null?(i(),N(e.PriorityTag,{key:0,priority:e.popoverData.priority},null,8,["priority"])):s("v-if",!0),e.popoverData.category!==null?(i(),N(e.CategoryTag,{key:1,category:e.popoverData.category},null,8,["category"])):s("v-if",!0),e.popoverData.state!==null?(i(),N(e.StatusTag,{key:2,status:e.popoverData.state},null,8,["status"])):s("v-if",!0),s(" Overdue tag "),e.popoverData.isOverDue?(i(),N(g,{key:3,type:"danger",size:"default",effect:"dark"},{default:o(()=>[V(m(l.$t("workOrder.status.overdue")),1)]),_:1})):s("v-if",!0)]),s(" Work Order Title "),a("div",null,[r(u,{tag:"b",size:"large"},{default:o(()=>[V(m(e.popoverData.title),1)]),_:1})]),s(" Recurrence ID "),e.popoverData.groupId?(i(),p("div",Iv,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.calendar.recurrenceId"))+": ",1)]),_:1}),r(u,null,{default:o(()=>[V(m(e.popoverData.groupId),1)]),_:1})])):s("v-if",!0),e.popoverData.recurrence_type?(i(),p("div",Vv,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.table.recurrenceType"))+": ",1)]),_:1}),r(u,null,{default:o(()=>[V(m(e.popoverData.recurrence_type.name),1)]),_:1})])):s("v-if",!0),a("div",null,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.table.startDate"))+": ",1)]),_:1}),r(u,null,{default:o(()=>[V(m(e.formatDate(e.popoverData.startDate)),1)]),_:1})]),s('        <div v-if="popoverData.endDate">'),s("          <el-text>{{ $t('workOrder.calendar.endDate') }}: </el-text>"),s("          <el-text>{{ formatDate(popoverData.endDate || popoverData.startDate) }}</el-text>"),s("        </div>"),a("div",null,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.table.dueDate"))+": ",1)]),_:1}),r(u,{type:e.getTextTypeByDueDate(e.popoverData.isOverDue)},{default:o(()=>[V(m(e.formatDate(e.popoverData.dueDate)),1)]),_:1},8,["type"])]),e.popoverData.finished_at?(i(),p("div",Fv,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.table.finishedDate"))+": ",1)]),_:1}),r(u,null,{default:o(()=>[V(m(e.formatDate(e.popoverData.finished_at)),1)]),_:1})])):s("v-if",!0),a("div",null,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.calendar.assignedUser"))+": ",1)]),_:1}),(i(),p(se,null,fe(e.temporaryUserList,P=>r(g,{key:P.id,style:{"margin-right":"5px"}},{default:o(()=>[V(m(P.name),1)]),_:2},1024)),64))]),e.popoverData.equipment_node?(i(),p("div",xv,[r(u,null,{default:o(()=>[V(m(l.$t("workOrder.calendar.equipment"))+": ",1)]),_:1}),r(u,null,{default:o(()=>{var P;return[V(m((P=e.popoverData.equipment_node)==null?void 0:P.name),1)]}),_:1})])):s("v-if",!0),s(" Task Progress "),a("div",Ev,[r(u,{style:{"margin-right":"10px"}},{default:o(()=>[V(m(l.$t("workOrder.calendar.taskProgress"))+": ",1)]),_:1}),r(S,{percentage:((w=e.popoverData.work_order_progress)==null?void 0:w.completed_task_amount)/((F=e.popoverData.work_order_progress)==null?void 0:F.total_task_amount)||0,style:{flex:"1"}},null,8,["percentage"])])]),s(" Image (First one only) "),e.popoverData.image_list&&e.popoverData.image_list.length?(i(),p("div",Wv,[r(T,{src:e.popoverData.image_list[0],fit:"cover","preview-src-list":e.popoverData.image_list,class:"circular-image","z-index":2e3,"preview-teleported":""},{error:o(()=>[a("div",Rv,[r(c,null,{default:o(()=>[r(e.Picture)]),_:1})])]),_:1},8,["src","preview-src-list"])])):s("v-if",!0)])]}),_:1},8,["visible","virtual-ref","width"])],64)}const Mv=Re(Sv,[["render",Lv],["__scopeId","data-v-59f0f06c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/components/workOrderCalendar.vue"]]),qv=be({name:"WorkOrderManagement"}),Uv=Object.assign(qv,{setup(l,{expose:t}){t();const d=it(),e=ht(),{t:y}=Be(),{showSuccess:h}=va(),c=yt(),{loading:u,list:g,total:S,listQuery:T,expandedRows:b,recurrenceViewMode:w,currentRecurrenceId:F,fetchWorkOrders:P,fetchRecurringWorkOrders:I,exitRecurrenceView:J,loadChildren:k,handleFilter:Z,updateFilters:ie,handleSizeChange:G,handleCurrentChange:le,toggleRowHighlight:ue,handleDelete:$,initializeCommonData:B}=Dr(),me=O(!1),ne=O("todo"),ee=O(),W=O(null),re=()=>{if(e.query.showCreate===void 0)return;const{showCreate:he,...Pe}=e.query;d.replace({path:e.path,query:{...Pe}})};ge(()=>e.query.showCreate,he=>{(he==="1"||he==="true")&&Me(()=>{var Pe;(Pe=W.value)==null||Pe.showCreateForm(),re()})},{immediate:!0}),ge(()=>c.shouldOpenCreatePanel,he=>{he&&Me(()=>{var Pe;(Pe=W.value)==null||Pe.showCreateForm(),c.setShouldOpenCreatePanel(!1)})});const Y=he=>{d.push({name:"ViewWorkOrder",params:{id:he.id}})},_=()=>{var he;ne.value==="todo"?(he=W.value)==null||he.showCreateForm():d.push({name:"NewWorkOrder"})},te=he=>{},f=async(he,Pe)=>{try{await $(he,Pe),h(y("workOrder.messages.deleteSuccess")),await P()}catch(tt){console.error("Delete failed:",tt)}},A=async he=>{ne.value=he,he!=="calendar"&&(delete T.start_date_from,delete T.end_date_to,T.page=1,T.limit=20),he==="todo"?ie({status:"pending,in_progress"}):he==="table"&&ie({status:null})},R=({workOrder:he,status:Pe})=>{h(y("workOrder.messages.statusChanged"))},j=async()=>{try{await P(),h(y("workOrder.messages.refreshSuccess"))}catch(he){console.error("Refresh failed:",he)}},oe=he=>{var Pe;Object.assign(T,he),ne.value==="calendar"?(Pe=ee.value)==null||Pe.refetchEvents():Z()},ce=()=>{},K=async({start_date_from:he,end_date_to:Pe,resolve:tt,reject:Je})=>{Object.assign(T,{start_date_from:he,end_date_to:Pe}),T.page=-1,T.limit=-1;try{await P(),tt(g.value)}catch(ot){Je(ot),console.error("Unable to load work orders:",ot),U.error("Unable to load work-orders")}},X=async he=>{try{if(T.page=1,await P(),W.value&&he.id&&(await Me(),!W.value.selectWorkOrderById(he.id))){if(!g.value.find(Je=>Je.id===he.id)){const Je=T.status;T.status=null,await P(),g.value.find(dt=>dt.id===he.id)||console.warn("Work order not found after creation - possible filtering issue"),T.status=Je,await P()}W.value.showDetailView()}h(y("workOrder.messages.createSuccess"))}catch(Pe){console.error("Failed to refresh after work order creation:",Pe),h(y("workOrder.messages.createSuccess"))}},ke=async he=>{const Pe=g.value.findIndex(tt=>tt.id===he.id);Pe!==-1&&(g.value[Pe]=he),h(y("workOrder.messages.updateSuccess"))},De=async({tab:he,statusFilter:Pe})=>{ie({status:Pe})},Ve=async he=>{if(he)try{await I(he),h(y("workOrder.messages.recurrenceViewEnabled"))}catch(Pe){console.error("Failed to load recurring work orders:",Pe)}},Te=()=>{J(),h(y("workOrder.messages.recurrenceViewDisabled"))};Ue(async()=>{try{await B(),await P()}catch(he){console.error("Failed to initialize work order page:",he)}});const Le={router:d,route:e,t:y,showSuccess:h,workOrderDraftStore:c,listLoading:u,list:g,total:S,listQuery:T,expandedRows:b,recurrenceViewMode:w,currentRecurrenceId:F,fetchWorkOrders:P,fetchRecurringWorkOrders:I,exitRecurrenceView:J,loadChildren:k,handleFilter:Z,updateFilters:ie,handleSizeChange:G,handleCurrentChange:le,toggleRowHighlight:ue,deleteWorkOrder:$,initializeCommonData:B,downloadLoading:me,currentView:ne,calendarViewRef:ee,todoViewRef:W,clearShowCreateFlag:re,handleView:Y,handleCreate:_,handleUpdate:te,handleDelete:f,handleViewChange:A,handleStatusChange:R,handleRefresh:j,handleFilterUpdate:oe,handleDownload:ce,handleCalendarDisplayDateChange:K,handleWorkOrderCreated:X,handleWorkOrderUpdated:ke,handleTabChange:De,handleViewRecurrence:Ve,handleExitRecurrenceView:Te,__MACROS_defineComponent:be,ref:O,onMounted:Ue,nextTick:Me,watch:ge,get useRouter(){return it},get useRoute(){return ht},get useI18n(){return Be},get Calendar(){return Zr},get Grid(){return jr},get List(){return Qa},get View(){return Nt},get Back(){return Fo},get MesLayout(){return xo},UnifiedWorkOrderFilters:Sn,WorkOrderTable:ls,TodoView:bv,CalendarView:Mv,get useWorkOrder(){return Dr},get useErrorHandler(){return va},get ElMessage(){return U},get useWorkOrderDraftStore(){return yt}};return Object.defineProperty(Le,"__isScriptSetup",{enumerable:!1,value:!0}),Le}}),zv={class:"view-mode-selector"},Nv={key:0,class:"table-view"},Bv={key:0,class:"recurrence-view-banner"},jv={class:"banner-content"},Hv={class:"banner-text"},Yv={class:"todo-view-container"},Jv={class:"todo-view-container"},Qv={key:0};function Gv(l,t,d,e,y,h){const c=D("el-icon"),u=D("el-option"),g=D("el-select"),S=D("el-button"),T=D("el-pagination");return i(),N(e.MesLayout,{title:l.$t("workOrder.title"),"view-mode":e.currentView},{viewMode:o(()=>[a("div",zv,[r(g,{modelValue:e.currentView,"onUpdate:modelValue":t[0]||(t[0]=b=>e.currentView=b),onChange:e.handleViewChange,size:"default",style:{width:"140px"}},{default:o(()=>[r(u,{label:l.$t("workOrder.viewModes.todo"),value:"todo"},{default:o(()=>[r(c,{style:{"margin-right":"8px"}},{default:o(()=>[r(e.List)]),_:1}),V(" "+m(l.$t("workOrder.viewModes.todo")),1)]),_:1},8,["label"]),r(u,{label:l.$t("workOrder.viewModes.table"),value:"table"},{default:o(()=>[r(c,{style:{"margin-right":"8px"}},{default:o(()=>[r(e.Grid)]),_:1}),V(" "+m(l.$t("workOrder.viewModes.table")),1)]),_:1},8,["label"]),r(u,{label:l.$t("workOrder.viewModes.calendar"),value:"calendar"},{default:o(()=>[r(c,{style:{"margin-right":"8px"}},{default:o(()=>[r(e.Calendar)]),_:1}),V(" "+m(l.$t("workOrder.viewModes.calendar")),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])])]),head:o(()=>[r(e.UnifiedWorkOrderFilters,{"model-value":{...e.listQuery},"onUpdate:modelValue":e.handleFilterUpdate,"export-loading":e.downloadLoading,"show-todo-actions":e.currentView==="todo","current-view":e.currentView,class:"unified-work-order-filters",onCreate:e.handleCreate,onExport:e.handleDownload,onRefresh:e.handleRefresh},null,8,["model-value","export-loading","show-todo-actions","current-view"])]),body:o(()=>[s(" Table View "),e.currentView==="table"?(i(),p("div",Nv,[s(" Recurrence View Banner "),e.recurrenceViewMode?(i(),p("div",Bv,[a("div",jv,[r(c,{class:"banner-icon"},{default:o(()=>[r(e.View)]),_:1}),a("span",Hv,[V(m(l.$t("workOrder.recurrenceView.title"))+" ",1),a("strong",null,m(e.currentRecurrenceId),1)])]),r(S,{type:"primary",size:"small",onClick:e.handleExitRecurrenceView,class:"exit-button"},{default:o(()=>[r(c,null,{default:o(()=>[r(e.Back)]),_:1}),V(" "+m(l.$t("workOrder.recurrenceView.exitView")),1)]),_:1})])):s("v-if",!0),r(e.WorkOrderTable,{data:e.list,loading:e.listLoading,"expanded-rows":e.expandedRows,"load-children":e.loadChildren,"recurrence-view-mode":e.recurrenceViewMode,class:"work-order-table",onExpandChange:e.toggleRowHighlight,onView:e.handleView,onEdit:e.handleUpdate,onDelete:e.handleDelete,onViewRecurrence:e.handleViewRecurrence},null,8,["data","loading","expanded-rows","load-children","recurrence-view-mode","onExpandChange"])])):e.currentView==="todo"?(i(),p(se,{key:1},[s(" To-Do View "),a("div",Yv,[r(e.TodoView,{ref:"todoViewRef","work-orders":e.list,loading:e.listLoading,filters:e.listQuery,total:e.total,"current-page":e.listQuery.page,"page-size":e.listQuery.limit,onEdit:e.handleUpdate,onDelete:e.handleDelete,onStatusChange:e.handleStatusChange,onRefresh:e.fetchWorkOrders,onWorkOrderCreated:e.handleWorkOrderCreated,onWorkOrderUpdated:e.handleWorkOrderUpdated,onPageChange:e.handleCurrentChange,onPageSizeChange:e.handleSizeChange,onTabChange:e.handleTabChange},null,8,["work-orders","loading","filters","total","current-page","page-size","onRefresh","onPageChange","onPageSizeChange"])])],2112)):e.currentView==="calendar"?(i(),p(se,{key:2},[s(" Calendar View "),a("div",Jv,[r(e.CalendarView,{ref:"calendarViewRef",data:e.list,loading:e.listLoading,onDateRangeChange:e.handleCalendarDisplayDateChange,onView:e.handleView},null,8,["data","loading"])])],2112)):s("v-if",!0)]),foot:o(()=>[e.currentView==="table"?(i(),p("div",Qv,[r(T,{total:e.total,"hide-on-single-page":!0,"current-page":e.listQuery.page,"onUpdate:currentPage":t[1]||(t[1]=b=>e.listQuery.page=b),"page-size":e.listQuery.limit,"onUpdate:pageSize":t[2]||(t[2]=b=>e.listQuery.limit=b),layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])):s("v-if",!0)]),_:1},8,["title","view-mode"])}const Qh=Re(Uv,[["render",Gv],["__scopeId","data-v-61e35d9a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/index.vue"]]);export{Qh as default};
