import"../vue/vue.Dfo81L2Q.js";import{a as yt,u as At}from"../vue-router/vue-router.30cuaQZO.js";import{u as Ge}from"../vue-i18n/vue-i18n.DjO1PVT4.js";import{S as ho,T as er,U as Da,V as Xo,W as $o,H as en,B as Ra,v as $t,X as tn,M as qt,Y as ua,Z as rr,_ as an,P as Ma,$ as or,E as yo,a0 as wo,a1 as rn,a2 as ko,k as on,a3 as Sr,a4 as Tr,a5 as nn,O as sa,a6 as sn,a7 as ln,f as ea,g as nr,A as dn,a as cn,a8 as bo,a9 as sr,aa as So,x as To,n as Oo,z as un,u as mn,ab as fn,b as Or,d as Cr,D as _n}from"../@element-plus/@element-plus.BNeHluFm.js";import{L as gn}from"../index/index.BtHzJbLx.js";import{u as Dr}from"../commonData/commonData.B4nBUyAw.js";import{_ as Re,b as Ar}from"../../assets/index-CE-d1vf_.js";import{E as B,c as lt,d as pn}from"../element-plus/element-plus.CU5xiOkY.js";import{am as D,c as g,o as c,O as l,a,S as r,L as n,F as se,a8 as we,G as xe,a6 as vn,K as Y,Q as x,R as m,d as Ce,_ as it,r as S,j as M,q as He,W as Aa,w as ye,t as Ne,P as ma,E as bt,as as _a,M as Pt,Z as Mt,U as qa,Y as lr,$ as la,aL as hn,a5 as Pr}from"../@vue/@vue.CVGyaoMH.js";import{c as ut}from"../datetime/datetime.39-ZCqKU.js";import{u as Pa}from"../useErrorHandler/useErrorHandler.DVUZjmHi.js";import{g as Ir,d as Vr,a as xr,b as Ia,c as Va,e as xa,f as Fa,h as Ea,i as Fr,u as Er,j as Lr,k as Za}from"../work-order/work-order.DahU_I_M.js";import{u as Ht,w as yn}from"../xlsx/xlsx.mYVfmpqs.js";import{F as wn}from"../file-saver/file-saver.i2TUQTli.js";import{g as Wr}from"../equipment/equipment.hEuZPeX-.js";import{g as Rr,a as Jt}from"../task-entry/task-entry.Cwygjfo-.js";import{u as Mr,S as qr,A as Xa,T as zr,N as Ur,C as Nr,I as Br,a as It,b as La,c as Rt,d as jr,e as Zt,D as ia}from"../ServiceStepPreview/ServiceStepPreview.BMli3z6c.js";import{t as $a,g as Hr,s as Jr,a as tr,b as Yr,c as Gr,u as Qr}from"../task-library/task-library.-tD9DWhJ.js";import{R as Co,u as Kr}from"../useWorkOrder/useWorkOrder.9JcLncGa.js";import{C as Do,M as Ao,a as Po}from"../CardTable/CardTable.Bmr_ZA3b.js";import{d as Wa}from"../lodash-es/lodash-es.BLHqGvLj.js";import{C as Io}from"../CreateStandardDialog/CreateStandardDialog.Cs9pfgV1.js";import{F as Vo}from"../FileUploadMultiple/FileUploadMultiple.BvxDRcEa.js";import{u as da}from"../minio/minio.D0rhAIsD.js";import{l as Zr,a as Xr,i as $r,b as eo,c as to,d as ao,e as ro,F as kn}from"../@fullcalendar/@fullcalendar.CwHAVqfm.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../index/index.6be3zOyE.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../common/common.CFlva48m.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../mitt/mitt.DJ65BbbF.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";import"../MaintenanceWorkOrderCard/MaintenanceWorkOrderCard.CWj1vAV1.js";import"../preact/preact.BuVfYH0o.js";const bn=Ce({name:"UnifiedWorkOrderFilters"}),Sn=Object.assign(bn,{props:{modelValue:{type:Object,default:()=>({})},exportLoading:{type:Boolean,default:!1},showTodoActions:{type:Boolean,default:!1},currentView:{type:String,default:"table"}},emits:["update:modelValue","filter-change","create","export","refresh"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,{t:v}=Ge(),d=Dr(),u=it({assignedTo:e.modelValue.assignedTo||null,dueDate:e.modelValue.dueDate||null,workType:e.modelValue.workType||null,priority:e.modelValue.priority||null,state:e.modelValue.state||null,category:e.modelValue.category||null,search:e.modelValue.search||"",latest_per_recurrence:e.currentView!=="calendar",status:e.modelValue.status||null,equipment:e.modelValue.equipment||null,location:e.modelValue.location||null,recurrence:e.modelValue.recurrence||null}),p=S(!1),w=S(window.innerWidth),h=M(()=>w.value>1800?8:5),k=M(()=>Object.values(E).filter(G=>G.visible).length),C=M(()=>k.value>=h.value),P=()=>{w.value=window.innerWidth};He(()=>{window.addEventListener("resize",P)}),Aa(()=>{window.removeEventListener("resize",P)}),ye(w,(G,re)=>{if(re>1800&&G<=1800&&k.value>5){const De=k.value-5,Pe=Object.keys(E).filter(Ae=>E[Ae].visible);for(let Ae=Pe.length-1;Ae>0;Ae--){const ve=Math.floor(Math.random()*(Ae+1));[Pe[Ae],Pe[ve]]=[Pe[ve],Pe[Ae]]}for(let Ae=0;Ae<De;Ae++){const ve=Pe[Ae];E[ve].visible=!1}B.info(v("workOrder.filters.autoDeselected",{count:De}))}});const O=it({assignedTo:!1,dueDate:!1,workType:!1,priority:!1,search:!1,state:!1,status:!1,category:!1,equipment:!1,location:!1,recurrence:!1}),E=it({assignedTo:{visible:!0,category:"basic"},dueDate:{visible:!0,category:"basic"},workType:{visible:!0,category:"basic"},priority:{visible:!0,category:"basic"},search:{visible:!0,category:"basic"},state:{visible:!1,category:"advanced"},status:{visible:!1,category:"advanced"},category:{visible:!1,category:"advanced"},equipment:{visible:!1,category:"advanced"},location:{visible:!1,category:"advanced"},recurrence:{visible:!1,category:"advanced"}}),T=M(()=>[{id:1,name:"Erik Yu"},{id:2,name:"Jane Smith"},{id:3,name:"Mike Johnson"}]),q=M(()=>d.workTypes||[]),le=M(()=>d.priorities||[]),V=M(()=>d.states||[]),j=M(()=>d.categories||[]),pe=M(()=>[{id:"pending",name:v("workOrder.status.pending")},{id:"in_progress",name:v("workOrder.status.inProgress")},{id:"completed",name:v("workOrder.status.completed")},{id:"cancelled",name:v("workOrder.status.cancelled")}]),oe=M(()=>[{id:1,name:"Production Line A"},{id:2,name:"Production Line B"},{id:3,name:"Packaging Machine 1"},{id:4,name:"Packaging Machine 2"}]),X=M(()=>[{id:1,name:"Factory Floor 1"},{id:2,name:"Factory Floor 2"},{id:3,name:"Warehouse"},{id:4,name:"Office Building"}]),ie=M(()=>[{id:1,name:v("workOrder.recurrence.none")},{id:2,name:v("workOrder.recurrence.daily")},{id:3,name:v("workOrder.recurrence.weekly")},{id:4,name:v("workOrder.recurrence.monthlyByDate")},{id:5,name:v("workOrder.recurrence.yearly")}]),$=M(()=>({assignedTo:{key:"assignedTo",label:v("workOrder.filters.assignedTo"),icon:"User",category:"basic"},dueDate:{key:"dueDate",label:v("workOrder.filters.dueDate"),icon:"Calendar",category:"basic"},workType:{key:"workType",label:v("workOrder.table.workType"),icon:"Tools",category:"basic"},priority:{key:"priority",label:v("workOrder.table.priority"),icon:"Flag",category:"basic"},search:{key:"search",label:v("workOrder.filters.search"),icon:"Search",category:"basic"},state:{key:"state",label:v("workOrder.filters.state"),icon:"CircleCheck",category:"advanced"},status:{key:"status",label:v("workOrder.filters.status"),icon:"CircleCheck",category:"advanced"},category:{key:"category",label:v("workOrder.filters.category"),icon:"Collection",category:"advanced"},equipment:{key:"equipment",label:v("workOrder.filters.equipment"),icon:"Setting",category:"advanced"},location:{key:"location",label:v("workOrder.filters.location"),icon:"Location",category:"advanced"},recurrence:{key:"recurrence",label:v("workOrder.filters.recurrence"),icon:"Refresh",category:"advanced"}})),ce=M(()=>Object.values($.value).filter(G=>G.category==="basic")),ne=M(()=>Object.values($.value).filter(G=>G.category==="advanced")),R=S(""),fe=M(()=>{const G=R.value.trim().toLowerCase();return G?ce.value.filter(re=>(re.label||"").toLowerCase().includes(G)):ce.value}),K=M(()=>{const G=R.value.trim().toLowerCase();return G?ne.value.filter(re=>(re.label||"").toLowerCase().includes(G)):ne.value});M(()=>{const G=[];if(u.assignedTo){const re=T.value.find(Se=>Se.id===u.assignedTo);G.push({key:"assignedTo",label:`${v("workOrder.filters.assignedTo")}: ${(re==null?void 0:re.name)||u.assignedTo}`})}if(u.dueDate){const re={overdue:v("workOrder.filters.overdue"),today:v("workOrder.filters.today"),thisWeek:v("workOrder.filters.thisWeek"),thisMonth:v("workOrder.filters.thisMonth")};G.push({key:"dueDate",label:`${v("workOrder.filters.dueDate")}: ${re[u.dueDate]}`})}if(u.workType){const re=q.value.find(Se=>Se.id===u.workType);G.push({key:"workType",label:`${v("workOrder.table.workType")}: ${(re==null?void 0:re.name)||u.workType}`})}if(u.priority){const re=le.value.find(Se=>Se.id===u.priority);G.push({key:"priority",label:`${v("workOrder.table.priority")}: ${(re==null?void 0:re.name)||u.priority}`})}if(u.state){const re=V.value.find(Se=>Se.id===u.state);G.push({key:"state",label:`${v("workOrder.table.state")}: ${(re==null?void 0:re.name)||u.state}`})}if(u.category){const re=j.value.find(Se=>Se.id===u.category);G.push({key:"category",label:`${v("workOrder.table.category")}: ${(re==null?void 0:re.name)||u.category}`})}if(u.search&&G.push({key:"search",label:`${v("workOrder.placeholder.search")}: ${u.search}`}),u.status){const re=pe.value.find(Se=>Se.id===u.status);G.push({key:"status",label:`${v("workOrder.filters.status")}: ${(re==null?void 0:re.name)||u.status}`})}if(u.category){const re=j.value.find(Se=>Se.id===u.category);G.push({key:"category",label:`${v("workOrder.filters.category")}: ${(re==null?void 0:re.name)||u.category}`})}if(u.equipment){const re=oe.value.find(Se=>Se.id===u.equipment);G.push({key:"equipment",label:`${v("workOrder.filters.equipment")}: ${(re==null?void 0:re.name)||u.equipment}`})}if(u.location){const re=X.value.find(Se=>Se.id===u.location);G.push({key:"location",label:`${v("workOrder.filters.location")}: ${(re==null?void 0:re.name)||u.location}`})}if(u.recurrence){const re=ie.value.find(Se=>Se.id===u.recurrence);G.push({key:"recurrence",label:`${v("workOrder.filters.recurrence")}: ${(re==null?void 0:re.name)||u.recurrence}`})}return G});const _=async()=>{y("update:modelValue",{...u})},de=G=>{switch(G){case"addFilter":p.value=!0;break}},f=()=>{p.value=!1},F=G=>{C.value&&!N(G)&&B.warning(v("workOrder.filters.noSpace"))},U=async G=>{const re=E[G].visible;if(!re&&C.value){B.warning(v("workOrder.filters.limitReached",{max:h.value}));return}E[G].visible=!re,await te(G)},te=async G=>{await Ne(),E[G].visible&&(O[G]=!0,setTimeout(()=>{O[G]=!1},2e3))},N=G=>{var re;return((re=E[G])==null?void 0:re.visible)||!1};ye(()=>e.modelValue,G=>{Object.assign(u,G)},{deep:!0});const ee={props:e,emit:y,t:v,commonDataStore:d,localFilters:u,drawerVisible:p,screenWidth:w,maxFilters:h,activeFilterCount:k,isFilterLimitReached:C,updateScreenWidth:P,animatingFilters:O,availableFilters:E,assignedToOptions:T,workTypeOptions:q,priorityOptions:le,stateOptions:V,categoryOptions:j,statusOptions:pe,equipmentOptions:oe,locationOptions:X,recurrenceOptions:ie,filterDefinitions:$,basicFilters:ce,advancedFilters:ne,filterSearchTerm:R,filteredBasicFilters:fe,filteredAdvancedFilters:K,handleFilterChange:_,handleCustomizationCommand:de,closeFilterDrawer:f,handleDisabledFilterClick:F,toggleFilterVisibility:U,triggerFilterHighlightAnimation:te,isFilterVisible:N,__MACROS_defineComponent:Ce,reactive:it,computed:M,watch:ye,ref:S,nextTick:Ne,onMounted:He,onUnmounted:Aa,get useI18n(){return Ge},get ElMessage(){return B},get Search(){return qt},get Operation(){return tn},get View(){return $t},get Plus(){return Ra},get Star(){return en},get Setting(){return $o},get EditPen(){return Xo},get Download(){return Da},get Refresh(){return er},get Grid(){return ho},get useCommonDataStore(){return Dr}};return Object.defineProperty(ee,"__isScriptSetup",{enumerable:!1,value:!0}),ee}}),Tn={class:"unified-work-order-filters"},On={class:"filter-bar"},Cn={class:"filters-row"},Dn={key:0,class:"filter-item"},An={key:1,class:"filter-item"},Pn={key:2,class:"filter-item"},In={key:3,class:"filter-item"},Vn={key:4,class:"filter-item"},xn={key:5,class:"filter-item"},Fn={key:6,class:"filter-item"},En={key:7,class:"filter-item"},Ln={key:8,class:"filter-item"},Wn={key:9,class:"filter-item"},Rn={class:"right-group"},Mn={key:0,class:"filter-item search-item"},qn={class:"actions-row"},zn={class:"filter-item customization-item"},Un={class:"filter-drawer-content"},Nn={class:"drawer-header"},Bn={class:"filter-section"},jn={class:"section-title"},Hn={class:"filter-list"},Jn=["onClick"],Yn={class:"filter-info"},Gn={class:"filter-label"},Qn={class:"filter-section"},Kn={class:"section-title"},Zn={class:"filter-list"},Xn=["onClick"],$n={class:"filter-info"},es={class:"filter-label"};function ts(s,t,i,e,y,v){const d=D("el-option"),u=D("el-select"),p=D("el-icon"),w=D("el-input"),h=D("el-button"),k=D("el-dropdown-item"),C=D("el-dropdown-menu"),P=D("el-dropdown"),O=D("el-checkbox"),E=D("el-drawer");return c(),g("div",Tn,[l(" Filter Bar "),a("div",On,[l(" Main Filters Row "),a("div",Cn,[l(" Assigned To Filter "),e.isFilterVisible("assignedTo")?(c(),g("div",Dn,[r(u,{modelValue:e.localFilters.assignedTo,"onUpdate:modelValue":t[0]||(t[0]=T=>e.localFilters.assignedTo=T),placeholder:s.$t("workOrder.filters.assignedTo"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.assignedTo}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.assignedToOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Due Date Filter "),e.isFilterVisible("dueDate")?(c(),g("div",An,[r(u,{modelValue:e.localFilters.dueDate,"onUpdate:modelValue":t[1]||(t[1]=T=>e.localFilters.dueDate=T),placeholder:s.$t("workOrder.filters.dueDate"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.dueDate}),onChange:e.handleFilterChange},{default:n(()=>[r(d,{label:s.$t("workOrder.filters.overdue"),value:"overdue"},null,8,["label"]),r(d,{label:s.$t("workOrder.filters.today"),value:"today"},null,8,["label"]),r(d,{label:s.$t("workOrder.filters.thisWeek"),value:"thisWeek"},null,8,["label"]),r(d,{label:s.$t("workOrder.filters.thisMonth"),value:"thisMonth"},null,8,["label"])]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Work Type Filter "),e.isFilterVisible("workType")?(c(),g("div",Pn,[r(u,{modelValue:e.localFilters.workType,"onUpdate:modelValue":t[2]||(t[2]=T=>e.localFilters.workType=T),placeholder:s.$t("workOrder.table.workType"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.workType}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.workTypeOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Priority Filter "),e.isFilterVisible("priority")?(c(),g("div",In,[r(u,{modelValue:e.localFilters.priority,"onUpdate:modelValue":t[3]||(t[3]=T=>e.localFilters.priority=T),placeholder:s.$t("workOrder.table.priority"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.priority}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.priorityOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" State Filter "),e.isFilterVisible("state")?(c(),g("div",Vn,[r(u,{modelValue:e.localFilters.state,"onUpdate:modelValue":t[4]||(t[4]=T=>e.localFilters.state=T),placeholder:s.$t("workOrder.filters.state"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.status}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.stateOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Status Filter "),e.isFilterVisible("status")?(c(),g("div",xn,[r(u,{modelValue:e.localFilters.status,"onUpdate:modelValue":t[5]||(t[5]=T=>e.localFilters.status=T),placeholder:s.$t("workOrder.filters.status"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.status}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.statusOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Category Filter "),e.isFilterVisible("category")?(c(),g("div",Fn,[r(u,{modelValue:e.localFilters.category,"onUpdate:modelValue":t[6]||(t[6]=T=>e.localFilters.category=T),placeholder:s.$t("workOrder.filters.category"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.category}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.categoryOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Equipment Filter "),e.isFilterVisible("equipment")?(c(),g("div",En,[r(u,{modelValue:e.localFilters.equipment,"onUpdate:modelValue":t[7]||(t[7]=T=>e.localFilters.equipment=T),placeholder:s.$t("workOrder.filters.equipment"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.equipment}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.equipmentOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Location Filter "),e.isFilterVisible("location")?(c(),g("div",Ln,[r(u,{modelValue:e.localFilters.location,"onUpdate:modelValue":t[8]||(t[8]=T=>e.localFilters.location=T),placeholder:s.$t("workOrder.filters.location"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.location}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.locationOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Recurrence Filter "),e.isFilterVisible("recurrence")?(c(),g("div",Wn,[r(u,{modelValue:e.localFilters.recurrence,"onUpdate:modelValue":t[9]||(t[9]=T=>e.localFilters.recurrence=T),placeholder:s.$t("workOrder.filters.recurrence"),clearable:"",size:"default",style:{width:"140px"},class:xe({"highlight-animation":e.animatingFilters.recurrence}),onChange:e.handleFilterChange},{default:n(()=>[(c(!0),g(se,null,we(e.recurrenceOptions,T=>(c(),Y(d,{key:T.id,label:T.name,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Right group: Search + Actions "),a("div",Rn,[l(" Search Input (optional) "),e.isFilterVisible("search")?(c(),g("div",Mn,[r(w,{modelValue:e.localFilters.search,"onUpdate:modelValue":t[10]||(t[10]=T=>e.localFilters.search=T),placeholder:s.$t("workOrder.placeholder.search"),style:{width:"200px"},size:"default",clearable:"",class:xe({"highlight-animation":e.animatingFilters.search}),onKeyup:vn(e.handleFilterChange,["enter"]),onClear:e.handleFilterChange},{prefix:n(()=>[r(p,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue","placeholder","class"])])):l("v-if",!0),l(" Action Buttons Row "),a("div",qn,[r(h,{size:"default",type:"primary",icon:e.EditPen,onClick:t[11]||(t[11]=T=>s.$emit("create"))},{default:n(()=>[x(m(s.$t("workOrder.actions.create")),1)]),_:1},8,["icon"]),r(h,{size:"default",loading:i.exportLoading,type:"success",icon:e.Download,onClick:t[12]||(t[12]=T=>s.$emit("export"))},{default:n(()=>[x(m(s.$t("workOrder.actions.export")),1)]),_:1},8,["loading","icon"]),i.showTodoActions?(c(),Y(h,{key:0,size:"default",type:"default",icon:e.Refresh,onClick:t[13]||(t[13]=T=>s.$emit("refresh"))},{default:n(()=>[x(m(s.$t("workOrder.actions.refresh")),1)]),_:1},8,["icon"])):l("v-if",!0)])]),l(" Filter Customization Menu "),a("div",zn,[r(P,{trigger:"click",onCommand:e.handleCustomizationCommand},{dropdown:n(()=>[r(C,null,{default:n(()=>[r(k,{command:"addFilter"},{default:n(()=>[r(p,null,{default:n(()=>[r(e.Setting)]),_:1}),x(" "+m(s.$t("workOrder.filters.filterSetting")),1)]),_:1}),r(k,{divided:"",command:"savePreset"},{default:n(()=>[r(p,null,{default:n(()=>[r(e.Star)]),_:1}),x(" "+m(s.$t("workOrder.filters.savePreset")),1)]),_:1}),r(k,{command:"managePresets"},{default:n(()=>[r(p,null,{default:n(()=>[r(e.Setting)]),_:1}),x(" "+m(s.$t("workOrder.filters.managePresets")),1)]),_:1})]),_:1})]),default:n(()=>[r(h,{type:"text",class:"customization-button"},{default:n(()=>[r(p,null,{default:n(()=>[r(e.Operation)]),_:1})]),_:1})]),_:1})])])]),l(" Filter Drawer "),r(E,{modelValue:e.drawerVisible,"onUpdate:modelValue":t[15]||(t[15]=T=>e.drawerVisible=T),title:s.$t("workOrder.filters.filterDrawerTitle"),direction:"rtl",size:"400px","before-close":e.closeFilterDrawer},{default:n(()=>[a("div",Un,[l(" Drawer Header "),a("div",Nn,[r(w,{modelValue:e.filterSearchTerm,"onUpdate:modelValue":t[14]||(t[14]=T=>e.filterSearchTerm=T),placeholder:s.$t("workOrder.filters.searchFiltersPlaceholder"),class:"drawer-search",size:"default",clearable:""},{prefix:n(()=>[r(p,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue","placeholder"])]),l(" Basic Filters Section "),a("div",Bn,[a("h4",jn,[r(p,null,{default:n(()=>[r(e.Grid)]),_:1}),x(" "+m(s.$t("workOrder.filters.basicFilters")),1)]),a("div",Hn,[(c(!0),g(se,null,we(e.filteredBasicFilters,T=>(c(),g("div",{key:T.key,class:xe(["filter-item-row",{disabled:e.isFilterLimitReached&&!e.isFilterVisible(T.key)}]),onClick:q=>e.handleDisabledFilterClick(T.key)},[r(O,{"model-value":e.isFilterVisible(T.key),disabled:e.isFilterLimitReached&&!e.isFilterVisible(T.key),onChange:q=>e.toggleFilterVisibility(T.key),class:"filter-checkbox"},{default:n(()=>[a("div",Yn,[r(p,{class:"filter-icon"},{default:n(()=>[(c(),Y(ma(T.icon)))]),_:2},1024),a("span",Gn,m(T.label),1)])]),_:2},1032,["model-value","disabled","onChange"])],10,Jn))),128))])]),l(" Advanced Filters Section "),a("div",Qn,[a("h4",Kn,[r(p,null,{default:n(()=>[r(e.Setting)]),_:1}),x(" "+m(s.$t("workOrder.filters.workOrderFilters")),1)]),a("div",Zn,[(c(!0),g(se,null,we(e.filteredAdvancedFilters,T=>(c(),g("div",{key:T.key,class:xe(["filter-item-row",{disabled:e.isFilterLimitReached&&!e.isFilterVisible(T.key)}]),onClick:q=>e.handleDisabledFilterClick(T.key)},[r(O,{"model-value":e.isFilterVisible(T.key),disabled:e.isFilterLimitReached&&!e.isFilterVisible(T.key),onChange:q=>e.toggleFilterVisibility(T.key),class:"filter-checkbox"},{default:n(()=>[a("div",$n,[r(p,{class:"filter-icon"},{default:n(()=>[(c(),Y(ma(T.icon)))]),_:2},1024),a("span",es,m(T.label),1)])]),_:2},1032,["model-value","disabled","onChange"])],10,Xn))),128))])])])]),_:1},8,["modelValue","title"])])}const as=Re(Sn,[["render",ts],["__scopeId","data-v-d2b522a3"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Filters/UnifiedWorkOrderFilters.vue"]]),rs=Ce({name:"WorkOrderImage"}),os=Object.assign(rs,{props:{imagePath:{type:Array,default:()=>[]}},setup(s,{expose:t}){t();const i=s,e=M(()=>i.imagePath&&i.imagePath.length>0),y={props:i,hasImage:e,__MACROS_defineComponent:Ce,computed:M,get IconPicture(){return ua}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),ns={class:"work-order-image"},ss={class:"image-slot"},ls={class:"image-slot"};function is(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-image"),p=D("el-tooltip");return c(),g("div",ns,[e.hasImage?(c(),Y(u,{key:0,style:{width:"50px",height:"50px"},src:i.imagePath[0],"preview-src-list":[i.imagePath[0]],loading:"lazy",alt:s.$t("workOrder.table.preview")},{error:n(()=>[a("div",ss,[r(d,null,{default:n(()=>[r(e.IconPicture)]),_:1})])]),_:1},8,["src","preview-src-list","alt"])):(c(),Y(u,{key:1,style:{width:"50px",height:"50px"}},{error:n(()=>[r(p,null,{content:n(()=>[a("span",null,m(s.$t("workOrder.messages.noImagePlaceholder")),1)]),default:n(()=>[a("div",ls,[r(d,null,{default:n(()=>[r(e.IconPicture)]),_:1})])]),_:1})]),_:1}))])}const ds=Re(os,[["render",is],["__scopeId","data-v-e05a65b7"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/WorkOrderImage.vue"]]);function ar(s){switch(s){case"Urgent":return"#F56C6C";case"High":return"#409EFF";case"Medium":return"#E6A23C";default:return"#909399"}}function oo(s){switch(s){case"Reactive":return"danger";case"Preventative":return"success";case"Other":return"info";case"Follow up":return"warning";default:return"info"}}function no(s){switch(s){case"Inspection":return"primary";case"Mechanical":return"danger";case"Preventative":return"success";case"Safety":return"warning";case"SOP":return"info";case"Electrical":return"success";case"Follow up":return"warning";default:return"info"}}function so(s){return s===1?"info":"primary"}const cs=Ce({name:"PriorityTag"}),us=Object.assign(cs,{props:{priority:{type:Object,default:()=>({})}},setup(s,{expose:t}){t();const i=s,{t:e}=Ge(),y=M(()=>{var w;return(w=i.priority)!=null&&w.name?{Urgent:e("workOrder.priority.urgent"),High:e("workOrder.priority.high"),Medium:e("workOrder.priority.medium"),Low:e("workOrder.priority.low")}[i.priority.name]||i.priority.name:"-"}),v=M(()=>{var p;return ar((p=i.priority)==null?void 0:p.name)}),d=M(()=>{var w,h;const p=(h=(w=i.priority)==null?void 0:w.name)==null?void 0:h.toLowerCase();return{"priority-urgent":p==="urgent","priority-high":p==="high","priority-medium":p==="medium","priority-low":p==="low"}}),u={props:i,t:e,priorityName:y,priorityColor:v,priorityClass:d,__MACROS_defineComponent:Ce,computed:M,get useI18n(){return Ge},get Flag(){return rr},get getPriorityColor(){return ar}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),ms=["title"];function fs(s,t,i,e,y,v){var u;const d=D("el-icon");return c(),g("span",{title:(u=i.priority)==null?void 0:u.description,class:xe(["priority-tag",e.priorityClass])},[r(d,{style:bt({color:e.priorityColor,marginRight:"4px"})},{default:n(()=>[r(e.Flag)]),_:1},8,["style"]),x(" "+m(e.priorityName),1)],10,ms)}const ir=Re(us,[["render",fs],["__scopeId","data-v-bd442eed"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/PriorityTag.vue"]]),_s=Ce({name:"WorkTypeTag"}),gs=Object.assign(_s,{props:{workType:{type:Object,default:()=>({})}},setup(s,{expose:t}){t();const i=s,{t:e}=Ge(),y=M(()=>{var p;return(p=i.workType)!=null&&p.name?{Reactive:e("workOrder.workType.reactive"),Preventative:e("workOrder.workType.preventative"),Other:e("workOrder.workType.other"),"Follow up":e("workOrder.workType.followUp")}[i.workType.name]||i.workType.name:"-"}),v=M(()=>{var u;return oo((u=i.workType)==null?void 0:u.name)}),d={props:i,t:e,workTypeName:y,tagType:v,__MACROS_defineComponent:Ce,computed:M,get useI18n(){return Ge},get getWorkTypeTagType(){return oo}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function ps(s,t,i,e,y,v){var u;const d=D("el-tag");return c(),Y(d,{type:e.tagType,title:(u=i.workType)==null?void 0:u.description,effect:"light"},{default:n(()=>[x(m(e.workTypeName),1)]),_:1},8,["type","title"])}const xo=Re(gs,[["render",ps],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/WorkTypeTag.vue"]]),vs=Ce({name:"CategoryTag"}),hs=Object.assign(vs,{props:{category:{type:Object,default:()=>({})}},setup(s,{expose:t}){t();const i=s,e=M(()=>{var d;return((d=i.category)==null?void 0:d.name)||"-"}),y=M(()=>{var d;return no((d=i.category)==null?void 0:d.name)}),v={props:i,categoryName:e,tagType:y,__MACROS_defineComponent:Ce,computed:M,get getCategoryTagType(){return no}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}});function ys(s,t,i,e,y,v){var u;const d=D("el-tag");return c(),Y(d,{type:e.tagType,title:((u=i.category)==null?void 0:u.description)||s.$t("workOrder.messages.noData"),effect:"plain"},{default:n(()=>[x(m(e.categoryName),1)]),_:1},8,["type","title"])}const dr=Re(hs,[["render",ys],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/CategoryTag.vue"]]),ws=Ce({name:"RecurrenceTag"}),ks=Object.assign(ws,{props:{recurrenceType:{type:Object,default:()=>({})}},setup(s,{expose:t}){t();const i=s,{t:e}=Ge(),y=M(()=>{var p;return(p=i.recurrenceType)!=null&&p.name?{"Does not repeat":e("workOrder.recurrence.none"),Daily:e("workOrder.recurrence.daily"),Weekly:e("workOrder.recurrence.weekly"),Monthly:e("workOrder.recurrence.monthlyByDate"),Yearly:e("workOrder.recurrence.yearly")}[i.recurrenceType.name]||i.recurrenceType.name:"-"}),v=M(()=>{var u;return so((u=i.recurrenceType)==null?void 0:u.id)}),d={props:i,t:e,recurrenceName:y,tagType:v,__MACROS_defineComponent:Ce,computed:M,get useI18n(){return Ge},get getRecurrenceTagType(){return so}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function bs(s,t,i,e,y,v){var u;const d=D("el-tag");return c(),Y(d,{type:e.tagType,title:((u=i.recurrenceType)==null?void 0:u.description)||s.$t("workOrder.recurrence.none"),effect:"dark"},{default:n(()=>[x(m(e.recurrenceName),1)]),_:1},8,["type","title"])}const Ss=Re(ks,[["render",bs],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/RecurrenceTag.vue"]]),Ts=Ce({name:"StatusTag"}),Os=Object.assign(Ts,{props:{status:{type:Object,default:()=>({})}},setup(s,{expose:t}){t();const i=s,{t:e}=Ge(),y=M(()=>{var p;return(p=i.status)!=null&&p.name?{Failed:e("workOrder.status.failed"),Completed:e("workOrder.status.completed"),"In Progress":e("workOrder.status.inProgress"),Pending:e("workOrder.status.pending")}[i.status.name]||i.status.name:"-"}),v=M(()=>{var p;switch((p=i.status)==null?void 0:p.name){case"Failed":return"danger";case"Completed":return"success";case"In Progress":return"warning";default:return"info"}}),d={props:i,t:e,statusName:y,tagType:v,__MACROS_defineComponent:Ce,computed:M,get useI18n(){return Ge}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function Cs(s,t,i,e,y,v){const d=D("el-tag");return c(),Y(d,{type:e.tagType,effect:"dark",round:""},{default:n(()=>[x(m(e.statusName),1)]),_:1},8,["type"])}const Fo=Re(Os,[["render",Cs],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/StatusTag.vue"]]),Ds=Ce({name:"WorkOrderActions"}),As=Object.assign(Ds,{props:{row:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["view","edit","delete"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,{t:v}=Ge(),{confirmAction:d}=Pa(),u=S(!1),w={props:e,emit:y,t:v,confirmAction:d,deleteLoading:u,handleDelete:async()=>{if(await d({title:v("common.confirm"),message:v("common.deleteConfirmMessage",{name:e.row.name}),confirmButtonText:v("workOrder.actions.delete"),cancelButtonText:v("workOrder.actions.cancel"),type:"warning"})){u.value=!0;try{y("delete")}finally{u.value=!1}}},__MACROS_defineComponent:Ce,ref:S,get useI18n(){return Ge},get useErrorHandler(){return Pa}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),Ps={class:"work-order-actions"};function Is(s,t,i,e,y,v){const d=D("el-button");return c(),g("div",Ps,[r(d,{type:"info",size:"small",onClick:t[0]||(t[0]=u=>s.$emit("view")),"aria-label":s.$t("workOrder.actions.view")},{default:n(()=>[x(m(s.$t("workOrder.actions.view")),1)]),_:1},8,["aria-label"]),r(d,{type:"primary",size:"small",onClick:t[1]||(t[1]=u=>s.$emit("edit")),"aria-label":s.$t("workOrder.actions.edit")},{default:n(()=>[x(m(s.$t("workOrder.actions.edit")),1)]),_:1},8,["aria-label"]),i.row.status!=="deleted"?(c(),Y(d,{key:0,size:"small",type:"danger",onClick:e.handleDelete,"aria-label":s.$t("workOrder.actions.delete"),loading:e.deleteLoading},{default:n(()=>[x(m(s.$t("workOrder.actions.delete")),1)]),_:1},8,["aria-label","loading"])):l("v-if",!0)])}const Vs=Re(As,[["render",Is],["__scopeId","data-v-b4c15949"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Actions/WorkOrderActions.vue"]]),xs=Ce({name:"WorkOrderTable"}),Fs=Object.assign(xs,{props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},expandedRows:{type:Set,default:()=>new Set},loadChildren:{type:Function,required:!0},recurrenceViewMode:{type:Boolean,default:!1}},emits:["expand-change","view","edit","delete","view-recurrence"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=S(300),d=S(null),u=({row:j})=>e.expandedRows.has(j.id)?"expanded-highlight":"";let p=null,w=null,h=null,k=null;const C=j=>j&&j.offsetHeight||0,P=()=>{try{let j=window.innerHeight;const pe=document.querySelector(".main-container .fixed-header .navbar"),oe=document.querySelector(".main-container .fixed-header .tags-view-wrapper .el-scrollbar__view"),X=d.value?d.value.closest(".mes-layout"):null,ie=X?X.querySelector(":scope > .header"):null,$=X?X.querySelector(":scope > .footer"):null;j-=C(pe),j-=C(oe),j-=C(ie),j-=C($),j-=20,v.value=Math.max(j,160)}catch{v.value=Math.max(window.innerHeight-320,160)}},O=()=>{P()},E=(j,pe)=>{y("expand-change",j,pe)},T=j=>j?ut(j):"-",q=j=>j&&new Date(j)<new Date,le=j=>{var pe;e.recurrenceViewMode||!j.recurrence_uuid||((pe=j.recurrence_type)==null?void 0:pe.id)===1||y("view-recurrence",j.recurrence_uuid)};He(async()=>{if(await Ne(),P(),window.addEventListener("resize",O),"ResizeObserver"in window){const j=d.value?d.value.closest(".mes-layout"):null,pe=document.querySelector(".main-container .fixed-header .navbar"),oe=document.querySelector(".main-container .fixed-header .tags-view-wrapper .el-scrollbar__view"),X=j?j.querySelector(":scope > .header"):null,ie=j?j.querySelector(":scope > .footer"):null,$=()=>new ResizeObserver(()=>P());pe&&(p=$(),p.observe(pe)),oe&&(w=$(),w.observe(oe)),X&&(h=$(),h.observe(X)),ie&&(k=$(),k.observe(ie))}}),Mt(()=>{window.removeEventListener("resize",O),p&&p.disconnect(),w&&w.disconnect(),h&&h.disconnect(),k&&k.disconnect()});const V={props:e,emit:y,tableHeight:v,rootEl:d,getRowClass:u,get roNavbar(){return p},set roNavbar(j){p=j},get roTagsView(){return w},set roTagsView(j){w=j},get roHeader(){return h},set roHeader(j){h=j},get roFooter(){return k},set roFooter(j){k=j},safeOffsetHeight:C,calcTableHeight:P,updateTableHeight:O,onExpandChange:E,formatDateTime:T,isOverdue:q,handleRecurrenceClick:le,__MACROS_defineComponent:Ce,ref:S,onMounted:He,onBeforeUnmount:Mt,nextTick:Ne,get convertToLocalTime(){return ut},WorkOrderImage:ds,PriorityTag:ir,WorkTypeTag:xo,CategoryTag:dr,RecurrenceTag:Ss,StatusTag:Fo,WorkOrderActions:Vs};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),Es={class:"work-order-table",ref:"rootEl"},Ls={style:{color:"black"}},Ws={style:{color:"grey"}},Rs=["onClick"],Ms=["title"];function qs(s,t,i,e,y,v){const d=D("el-table-column"),u=D("el-table"),p=_a("loading");return c(),g("div",Es,[Pt((c(),Y(u,{data:i.data,border:"",fit:"","highlight-current-row":"",height:e.tableHeight,style:{width:"100%"},"row-key":"id","tree-props":{children:"children"},lazy:!0,load:i.loadChildren,onExpandChange:e.onExpandChange,"row-class-name":e.getRowClass},{default:n(()=>[l(" Work Order Name "),r(d,{label:s.$t("workOrder.table.name"),prop:"name",align:"left",width:"300",fixed:"left"},{default:n(({row:w})=>[a("span",Ls,m(w.name),1)]),_:1},8,["label"]),l(" ID Column "),r(d,{label:s.$t("workOrder.table.id"),prop:"id",align:"center",width:"120"},{default:n(({row:w})=>[a("span",Ws,"#"+m(w.id),1)]),_:1},8,["label"]),l(" Work Order Code "),r(d,{label:s.$t("workOrder.table.code"),prop:"code",align:"center",width:"250"},null,8,["label"]),l(" Due Date (With Highlighting If Overdue) "),r(d,{label:s.$t("workOrder.table.dueDate"),prop:"due_date",align:"center",width:"180"},{default:n(({row:w})=>[a("span",{style:bt({color:e.isOverdue(w.due_date)?"var(--el-color-danger)":""})},m(e.formatDateTime(w.due_date)),5)]),_:1},8,["label"]),l(" Work Order Image "),r(d,{label:s.$t("workOrder.table.preview"),align:"center",width:"150"},{default:n(({row:w})=>[r(e.WorkOrderImage,{"image-path":w.image_list},null,8,["image-path"])]),_:1},8,["label"]),l(" Priority "),r(d,{label:s.$t("workOrder.table.priority"),prop:"priority.name",align:"center",width:"120"},{default:n(({row:w})=>[r(e.PriorityTag,{priority:w.priority},null,8,["priority"])]),_:1},8,["label"]),l(" Maintenance Type "),r(d,{label:s.$t("workOrder.table.workType"),prop:"work_type.name",align:"center",width:"150"},{default:n(({row:w})=>[r(e.WorkTypeTag,{"work-type":w.work_type},null,8,["work-type"])]),_:1},8,["label"]),l(" Category "),r(d,{label:s.$t("workOrder.table.category"),prop:"category.name",align:"center",width:"150"},{default:n(({row:w})=>[r(e.CategoryTag,{category:w.category},null,8,["category"])]),_:1},8,["label"]),l(" Recurrence Type "),r(d,{label:s.$t("workOrder.table.recurrenceType"),prop:"recurrence_type.name",align:"center",width:"150"},{default:n(({row:w})=>{var h;return[a("div",{class:xe({"recurrence-clickable":!i.recurrenceViewMode&&w.recurrence_uuid&&((h=w.recurrence_type)==null?void 0:h.id)!==1}),onClick:k=>e.handleRecurrenceClick(w)},[r(e.RecurrenceTag,{"recurrence-type":w.recurrence_type},null,8,["recurrence-type"])],10,Rs)]}),_:1},8,["label"]),l(" Estimated Time "),r(d,{label:s.$t("workOrder.table.estimatedTime"),prop:"estimated_minutes",align:"center",width:"150"},{default:n(({row:w})=>[x(m(w.estimated_minutes!=null?w.estimated_minutes:"-"),1)]),_:1},8,["label"]),l(" Start Date "),r(d,{label:s.$t("workOrder.table.startDate"),prop:"start_date",align:"center",width:"200"},{default:n(({row:w})=>[x(m(e.formatDateTime(w.start_date)),1)]),_:1},8,["label"]),l(" Finished Date "),r(d,{label:s.$t("workOrder.table.finishedDate"),prop:"finished_at",align:"center",width:"200"},{default:n(({row:w})=>[x(m(w.finished_at?e.formatDateTime(w.finished_at):"-"),1)]),_:1},8,["label"]),l(" Approved At "),r(d,{label:s.$t("workOrder.table.approvedDate"),prop:"approved_at",align:"center",width:"200"},{default:n(({row:w})=>[x(m(w.approved_at?e.formatDateTime(w.approved_at):"-"),1)]),_:1},8,["label"]),l(" State "),r(d,{label:s.$t("workOrder.table.state"),prop:"state.name",align:"center",width:"150"},{default:n(({row:w})=>[r(e.StatusTag,{status:w.state},null,8,["status"])]),_:1},8,["label"]),l(" Created By "),r(d,{label:s.$t("workOrder.table.createdBy"),prop:"created_by",align:"center",width:"150"},null,8,["label"]),l(" Approved By "),r(d,{label:s.$t("workOrder.table.approvedBy"),prop:"approved_by_id",align:"center",width:"150"},{default:n(({row:w})=>[x(m(w.approved_by_id!=null?w.approved_by_id:"-"),1)]),_:1},8,["label"]),l(" Description "),r(d,{label:s.$t("workOrder.table.description"),prop:"description",align:"left","min-width":"200"},{default:n(({row:w})=>[a("span",{title:w.description},m(w.description||"-"),9,Ms)]),_:1},8,["label"]),l(" Actions "),r(d,{label:s.$t("workOrder.table.actions"),align:"center",width:"250","class-name":"small-padding fixed-width action-column",fixed:"right"},{default:n(({row:w,$index:h})=>[r(e.WorkOrderActions,{row:w,index:h,onView:k=>s.$emit("view",w),onEdit:k=>s.$emit("edit",w),onDelete:k=>s.$emit("delete",w,h)},null,8,["row","index","onView","onEdit","onDelete"])]),_:1},8,["label"])]),_:1},8,["data","height","load"])),[[p,i.loading]])],512)}const zs=Re(Fs,[["render",qs],["__scopeId","data-v-1a4e6ae1"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Tables/WorkOrderTable.vue"]]),Us={__name:"StartWorkOrderAction",props:{workOrder:{type:Object,required:!0},disabled:{type:Boolean,default:!1},label:{type:String,default:"Start Work Order"}},emits:["start"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,d={props:e,emit:y,handleClick:()=>{e.disabled||y("start",e.workOrder)},get VideoPlay(){return an}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}};function Ns(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-dropdown-item");return c(),Y(u,{disabled:i.disabled,class:"start-work-order-action",onClick:e.handleClick},{default:n(()=>[r(d,{class:"action-icon"},{default:n(()=>[r(e.VideoPlay)]),_:1}),a("span",null,m(i.label),1)]),_:1},8,["disabled"])}const Eo=Re(Us,[["render",Ns],["__scopeId","data-v-7642fd70"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Actions/StartWorkOrderAction.vue"]]),Bs=Ce({name:"WorkOrderCard"}),js=Object.assign(Bs,{props:{workOrder:{type:Object,required:!0},isSelected:{type:Boolean,default:!1}},emits:["select","action"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,{t:v}=Ge(),d=M(()=>{var E,T;return((E=e.workOrder.state)==null?void 0:E.id)===13||((T=e.workOrder.state)==null?void 0:T.name)==="Incomplete"}),u=M(()=>{var E,T;return((E=e.workOrder.priority)==null?void 0:E.name)==="High"||((T=e.workOrder.priority)==null?void 0:T.name)==="Urgent"}),O={props:e,emit:y,t:v,isIncomplete:d,isHighPriority:u,formatDate:E=>ut(E),getStatusTagType:E=>{switch(E){case"Failed":return"danger";case"Incomplete":return"danger";case"Completed":return"success";case"In Progress":return"warning";default:return"info"}},getStatusName:E=>({Failed:v("workOrder.status.failed"),Completed:v("workOrder.status.completed"),"In Progress":v("workOrder.status.inProgress"),Pending:v("workOrder.status.pending")})[E]||E,getPriorityTagType:E=>{switch(E){case"Urgent":return"danger";case"High":return"warning";case"Medium":return"primary";case"Low":return"info";default:return"info"}},getPriorityName:E=>({Urgent:v("workOrder.priority.urgent"),High:v("workOrder.priority.high"),Medium:v("workOrder.priority.medium"),Low:v("workOrder.priority.low")})[E]||E,handleAction:E=>{y("action",{action:E,workOrder:e.workOrder})},__MACROS_defineComponent:Ce,computed:M,get useI18n(){return Ge},get MoreFilled(){return yo},get Edit(){return or},get View(){return $t},get Delete(){return Ma},get Flag(){return rr},get Picture(){return ua},StartWorkOrderAction:Eo,get convertToLocalTime(){return ut}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),Hs={class:"card-header"},Js={class:"card-id"},Ys={class:"card-actions"},Gs={class:"card-content"},Qs={class:"content-main"},Ks=["title"],Zs={class:"card-meta"},Xs={class:"meta-label"},$s={class:"meta-value"},el={key:0,class:"card-meta"},tl={class:"meta-label"},al={class:"card-badges"},rl={key:0,class:"card-thumbnail-circle"},ol={class:"image-slot-circle"};function nl(s,t,i,e,y,v){var P,O,E;const d=D("el-icon"),u=D("el-button"),p=D("el-dropdown-item"),w=D("el-dropdown-menu"),h=D("el-dropdown"),k=D("el-tag"),C=D("el-image");return c(),g("div",{class:xe(["work-order-card",{selected:i.isSelected,incomplete:e.isIncomplete,"high-priority":e.isHighPriority}]),onClick:t[1]||(t[1]=T=>s.$emit("select",i.workOrder))},[l(" Card Header "),a("div",Hs,[a("div",Js,"#"+m(i.workOrder.id),1),Pt(a("div",Ys,[r(h,{trigger:"click",onCommand:e.handleAction},{dropdown:n(()=>[r(w,null,{default:n(()=>[r(p,{command:"edit"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Edit)]),_:1}),x(" "+m(s.$t("workOrder.actions.edit")),1)]),_:1}),r(p,{command:"view"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.View)]),_:1}),x(" "+m(s.$t("workOrder.actions.view")),1)]),_:1}),r(e.StartWorkOrderAction,{"work-order":i.workOrder,onStart:t[0]||(t[0]=()=>e.emit("action",{action:"start",workOrder:i.workOrder}))},null,8,["work-order"]),r(p,{command:"delete",divided:""},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Delete)]),_:1}),x(" "+m(s.$t("workOrder.actions.delete")),1)]),_:1})]),_:1})]),default:n(()=>[r(u,{type:"text",size:"small",class:"action-button"},{default:n(()=>[r(d,{class:"rotated-icon"},{default:n(()=>[r(e.MoreFilled)]),_:1})]),_:1})]),_:1})],512),[[qa,!1]])]),l(" Card Content "),a("div",Gs,[l(" Main Content Area "),a("div",Qs,[l(" Work Order Title "),a("h4",{class:"card-title",title:i.workOrder.name},m(i.workOrder.name),9,Ks),l(" Requested By "),a("div",Zs,[a("span",Xs,m(s.$t("workOrder.form.createdBy"))+":",1),a("span",$s,m(i.workOrder.created_by||"N/A"),1)]),l(" Due Date "),i.workOrder.due_date?(c(),g("div",el,[a("span",tl,m(s.$t("workOrder.table.dueDate"))+":",1),a("span",{class:xe(["meta-value",{"incomplete-text":e.isIncomplete}])},m(e.formatDate(i.workOrder.due_date)),3)])):l("v-if",!0),l(" Status and Priority Badges "),a("div",al,[r(k,{type:e.getStatusTagType((P=i.workOrder.state)==null?void 0:P.name),size:"small",effect:((O=i.workOrder.state)==null?void 0:O.name)==="Incomplete"?"dark":"plain"},{default:n(()=>{var T;return[x(m(e.getStatusName((T=i.workOrder.state)==null?void 0:T.name)),1)]}),_:1},8,["type","effect"]),r(k,{type:e.getPriorityTagType((E=i.workOrder.priority)==null?void 0:E.name),size:"small",effect:"plain"},{default:n(()=>{var T;return[r(d,{style:{"margin-right":"4px"}},{default:n(()=>[r(e.Flag)]),_:1}),x(" "+m(e.getPriorityName((T=i.workOrder.priority)==null?void 0:T.name)),1)]}),_:1},8,["type"]),l('          <el-tag v-if="isIncomplete" type="danger" size="small" effect="dark">'),l("            {{ $t('workOrder.status.incomplete') }}"),l("          </el-tag>")])]),l(" Circular Thumbnail on Right "),i.workOrder.image_list&&i.workOrder.image_list.length?(c(),g("div",rl,[r(C,{src:i.workOrder.image_list[0],fit:"cover","preview-src-list":i.workOrder.image_list,class:"circular-image","z-index":2e3,"preview-teleported":""},{error:n(()=>[a("div",ol,[r(d,null,{default:n(()=>[r(e.Picture)]),_:1})])]),_:1},8,["src","preview-src-list"])])):l("v-if",!0)])],2)}const sl=Re(js,[["render",nl],["__scopeId","data-v-d4cc0b50"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderCard.vue"]]);function Lo(s,t,i,e){const y=[s],v=new Blob(y,{type:i||"application/octet-stream"}),d=window.URL.createObjectURL(v),u=document.createElement("a");u.style.display="none",u.href=d,u.setAttribute("download",t),typeof u.download>"u"&&u.setAttribute("target","_blank"),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(d)}function Wo(s,t={}){const{includeHeaders:i=!0,dateFormat:e="YYYY-MM-DD HH:mm:ss"}=t;if(!Array.isArray(s)||s.length===0)return[];const y=["Work Order ID","Title","Description","Status","Priority","Category","Start Date/Time","Due Date","Task Count","Duration","Assignees","Is Overdue","Is Current"],v=[];return i&&v.push(y),s.forEach(d=>{var p,w;const u=[d.id||"-",d.title||"-",d.description||"-",d.status||"-",((p=d.priority)==null?void 0:p.name)||d.priority||"-",((w=d.category)==null?void 0:w.name)||d.category||"-",d.timestamp||"-",d.dueDate||"-",d.taskCount!==void 0?d.taskCount:"-",d.duration||"-",d.assignees?d.assignees.map(h=>h.name).join(", "):"-",d.isOverdue?"Yes":"No",d.isCurrent?"Yes":"No"];v.push(u)}),v}function ll(s,t="timeline-export",i={}){try{const e=Wo(s,i);if(e.length===0)throw new Error("No data to export");const d="\uFEFF"+e.map(u=>u.map(p=>`"${String(p).replace(/"/g,'""')}"`).join(",")).join(`
`);return Lo(d,`${t}.csv`,"text/csv;charset=utf-8"),{success:!0,message:"Timeline exported to CSV successfully",recordCount:e.length-1}}catch(e){return console.error("CSV Export Error:",e),{success:!1,message:`Failed to export CSV: ${e.message}`,error:e}}}function il(s,t="timeline-export",i={}){try{const{sheetName:e="Timeline Data",includeMetadata:y=!0}=i,v=Wo(s,i);if(v.length===0)throw new Error("No data to export");const d=Ht.book_new(),u=Ht.aoa_to_sheet(v),p=[{wch:12},{wch:25},{wch:30},{wch:12},{wch:10},{wch:15},{wch:20},{wch:20},{wch:12},{wch:10},{wch:20},{wch:12},{wch:12}];u["!cols"]=p;const w=Ht.decode_range(u["!ref"]);for(let C=w.s.c;C<=w.e.c;C++){const P=Ht.encode_cell({r:0,c:C});u[P]&&(u[P].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{bgColor:{indexed:64},fgColor:{rgb:"366092"}},alignment:{horizontal:"center",vertical:"center"}})}if(Ht.book_append_sheet(d,u,e),y){const C=[["Export Information"],["Generated At",new Date().toLocaleString()],["Total Records",v.length-1],["File Format","Excel (.xlsx)"],[""],["Column Descriptions"],["Work Order ID","Unique identifier for the work order"],["Title","Work order title/name"],["Description","Work order description"],["Status","Current status of the work order"],["Priority","Priority level assigned to the work order"],["Category","Work order category/type"],["Start Date/Time","When the work order was started"],["Due Date","When the work order is due"],["Task Count","Number of tasks in the work order"],["Duration","Time taken to complete (if completed)"],["Assignees","Personnel assigned to the work order"],["Is Overdue","Whether the work order is overdue"],["Is Current","Whether this is the current work order being viewed"]],P=Ht.aoa_to_sheet(C);Ht.book_append_sheet(d,P,"Export Info")}const h=yn(d,{bookType:"xlsx",type:"array"}),k=new Blob([h],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return wn.saveAs(k,`${t}.xlsx`),{success:!0,message:"Timeline exported to Excel successfully",recordCount:v.length-1}}catch(e){return console.error("Excel Export Error:",e),{success:!1,message:`Failed to export Excel: ${e.message}`,error:e}}}function dl(s,t="timeline-export",i={}){try{const{includeMetadata:e=!0,prettyPrint:y=!0}=i;if(!Array.isArray(s)||s.length===0)throw new Error("No data to export");const v={exportInfo:e?{generatedAt:new Date().toISOString(),totalRecords:s.length,fileFormat:"JSON"}:void 0,timelineEvents:s};e||delete v.exportInfo;const d=y?JSON.stringify(v,null,2):JSON.stringify(v);return Lo(d,`${t}.json`,"application/json;charset=utf-8"),{success:!0,message:"Timeline exported to JSON successfully",recordCount:s.length}}catch(e){return console.error("JSON Export Error:",e),{success:!1,message:`Failed to export JSON: ${e.message}`,error:e}}}function lo(s,t="excel",i="timeline-export",e={}){switch(e.currentWorkOrderId&&(s=s.map(y=>({...y,isCurrent:String(y.id)===String(e.currentWorkOrderId)}))),t.toLowerCase()){case"csv":return ll(s,i,e);case"excel":case"xlsx":return il(s,i,e);case"json":return dl(s,i,e);default:return{success:!1,message:`Unsupported export format: ${t}. Supported formats: csv, excel, json`}}}function io(s="timeline-export",t="excel"){const i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);return`${s}-${i}`}const cl=Ce({name:"Timeline"}),ul=Object.assign(cl,{props:{timelineEvents:{type:Array,default:()=>[]},currentWorkOrderId:{type:[String,Number],default:null}},setup(s,{expose:t}){t();const i=s,e=S({dateRange:null}),y=M(()=>{if(!e.value.dateRange)return i.timelineEvents;const[O,E]=e.value.dateRange;return i.timelineEvents.filter(T=>{const q=new Date(T.timestamp);return q>=O&&q<=E})}),v=M(()=>{const O=y.value.filter(V=>V.status==="Completed"&&V.duration);if(O.length===0)return"0h 0m";const E=O.reduce((V,j)=>{var ie,$;const pe=j.duration,oe=parseInt(((ie=pe.match(/(\d+)h/))==null?void 0:ie[1])||"0"),X=parseInt((($=pe.match(/(\d+)m/))==null?void 0:$[1])||"0");return V+oe*60+X},0),T=Math.round(E/O.length),q=Math.floor(T/60),le=T%60;return`${q}h ${le}m`}),P={props:i,timelineFilter:e,filteredTimelineEvents:y,averageTimeConsumed:v,getStatusTagType:O=>({Completed:"success","In Progress":"primary",Pending:"info"})[O]||"info",isEventOverdue:O=>!O.plannedEnd||!O.actualEnd?!1:new Date(O.actualEnd)>new Date(O.plannedEnd),formatDateTime:O=>O?ut(O):"-",getCategoryName:O=>O?typeof O=="string"?O:O.name?O.name:O.id?`Category ${O.id}`:"-":"-",getPriorityName:O=>O?typeof O=="string"?O:O.name?O.name:O.id?`Priority ${O.id}`:"-":"-",getPriorityClass:O=>{var T;const E=(T=O==null?void 0:O.name)==null?void 0:T.toLowerCase();return{"priority-urgent":E==="urgent","priority-high":E==="high","priority-medium":E==="medium","priority-low":E==="low"}},isCurrentWorkOrder:O=>i.currentWorkOrderId&&O.id&&String(O.id)===String(i.currentWorkOrderId),__MACROS_defineComponent:Ce,ref:S,computed:M,get ElMessage(){return B},get Flag(){return rr},get convertToLocalTime(){return ut},get getPriorityColor(){return ar}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),ml={class:"timeline-content"},fl={class:"timeline-stats-bar"},_l={class:"filter-controls"},gl={class:"date-range-filter"},pl={class:"filter-label"},vl={class:"metrics-group"},hl={class:"metric-item"},yl={class:"metric-value"},wl={class:"metric-label"},kl={class:"metric-item"},bl={class:"metric-value"},Sl={class:"metric-label"},Tl={class:"timeline-body"},Ol={class:"event-header"},Cl={class:"title-section"},Dl={class:"event-title"},Al={class:"event-badges"},Pl={class:"event-description"},Il={class:"event-details"},Vl={class:"detail-column"},xl={key:0,class:"detail-item"},Fl={class:"detail-label"},El={key:1,class:"detail-item"},Ll={class:"detail-label"},Wl={class:"detail-value"},Rl={key:2,class:"detail-item"},Ml={class:"detail-label"},ql={class:"assignees-list"},zl={key:0,class:"overflow-indicator"},Ul={class:"detail-column"},Nl={key:0,class:"detail-item"},Bl={class:"detail-label"},jl={key:1,class:"detail-item"},Hl={class:"detail-label"},Jl={class:"detail-value"};function Yl(s,t,i,e,y,v){const d=D("el-date-picker"),u=D("el-tag"),p=D("el-avatar"),w=D("el-icon"),h=D("el-timeline-item"),k=D("el-timeline");return c(),g("div",ml,[l(" Stats Bar Header "),a("div",fl,[a("div",_l,[a("div",gl,[a("label",pl,m(s.$t("workOrder.timeline.timeRange")),1),r(d,{modelValue:e.timelineFilter.dateRange,"onUpdate:modelValue":t[0]||(t[0]=C=>e.timelineFilter.dateRange=C),type:"daterange","range-separator":s.$t("workOrder.timeline.to"),"start-placeholder":s.$t("workOrder.timeline.startDate"),"end-placeholder":s.$t("workOrder.timeline.endDate"),size:"small",class:"date-range-picker"},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"])])]),a("div",vl,[a("div",hl,[a("span",yl,m(e.filteredTimelineEvents.length),1),a("span",wl,m(s.$t("workOrder.timeline.totalEvents")),1)]),a("div",kl,[a("span",bl,m(e.averageTimeConsumed),1),a("span",Sl,m(s.$t("workOrder.timeline.avgTimeConsumed")),1)])])]),l(" Timeline Body "),a("div",Tl,[r(k,{class:"work-order-timeline"},{default:n(()=>[(c(!0),g(se,null,we(e.filteredTimelineEvents,C=>(c(),Y(h,{key:C.id,timestamp:C.timestamp,type:e.isCurrentWorkOrder(C)?"success":C.type,color:e.isCurrentWorkOrder(C)?"var(--el-color-success)":C.color,icon:C.icon,placement:"top",hollow:C.hollow,size:"large",class:xe({"current-work-order":e.isCurrentWorkOrder(C)})},{default:n(()=>{var P,O;return[a("div",{class:xe(["event-card",{"current-work-order-card":e.isCurrentWorkOrder(C)}])},[a("div",Ol,[a("div",Cl,[a("h5",Dl,m(C.title),1),e.isCurrentWorkOrder(C)?(c(),Y(u,{key:0,type:"success",size:"small",class:"current-badge",plain:""},{default:n(()=>[x(m(s.$t("workOrder.timeline.current")),1)]),_:1})):l("v-if",!0)]),a("div",Al,[r(u,{type:e.getStatusTagType(C.status),size:"small"},{default:n(()=>[x(m(C.status),1)]),_:2},1032,["type"]),C.taskCount!==void 0?(c(),Y(u,{key:0,type:"success",size:"small"},{default:n(()=>[x(m(C.taskCount)+" "+m(s.$t("workOrder.timeline.tasks")),1)]),_:2},1024)):l("v-if",!0),e.isEventOverdue(C)?(c(),Y(u,{key:1,type:"danger",size:"small",class:"overdue-badge"},{default:n(()=>[x(m(s.$t("workOrder.timeline.overdue")),1)]),_:1})):l("v-if",!0)])]),a("p",Pl,m(C.description),1),a("div",Il,[a("div",Vl,[C.dueDate?(c(),g("div",xl,[a("span",Fl,m(s.$t("workOrder.table.dueDate"))+":",1),a("span",{class:xe(["detail-value",{"overdue-text":C.isOverdue}])},m(e.formatDateTime(C.dueDate)),3)])):l("v-if",!0),C.category?(c(),g("div",El,[a("span",Ll,m(s.$t("workOrder.table.category"))+":",1),a("span",Wl,m(e.getCategoryName(C.category)),1)])):l("v-if",!0),C.assignees&&C.assignees.length>0?(c(),g("div",Rl,[a("span",Ml,m(s.$t("workOrder.timeline.assignees"))+":",1),a("div",ql,[(c(!0),g(se,null,we(C.assignees.slice(0,2),E=>(c(),Y(p,{key:E.id,size:24,src:E.avatar,class:"assignee-avatar"},{default:n(()=>[x(m(E.name?E.name.charAt(0).toUpperCase():"?"),1)]),_:2},1032,["src"]))),128)),C.assignees.length>2?(c(),g("span",zl," +"+m(C.assignees.length-2),1)):l("v-if",!0)])])):l("v-if",!0)]),a("div",Ul,[C.priority?(c(),g("div",Nl,[a("span",Bl,m(s.$t("workOrder.table.priority"))+":",1),a("span",{class:xe(["detail-value priority-tag",e.getPriorityClass(C.priority)]),style:bt({color:e.getPriorityColor((P=C.priority)==null?void 0:P.name)})},[r(w,{style:bt({color:e.getPriorityColor((O=C.priority)==null?void 0:O.name),marginRight:"4px"})},{default:n(()=>[r(e.Flag)]),_:2},1032,["style"]),x(" "+m(e.getPriorityName(C.priority)),1)],6)])):l("v-if",!0),C.duration?(c(),g("div",jl,[a("span",Hl,m(s.$t("workOrder.timeline.duration"))+":",1),a("span",Jl,m(C.duration),1)])):l("v-if",!0)])])],2)]}),_:2},1032,["timestamp","type","color","icon","hollow","class"]))),128))]),_:1})])])}const Gl=Re(ul,[["render",Yl],["__scopeId","data-v-1739646d"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Timeline/Timeline.vue"]]),Ql=Ce({name:"WorkOrderTaskCard"}),Kl=Object.assign(Ql,{props:{task:{type:Object,required:!0}},emits:["preview"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=M(()=>{const V=e.task;if(V&&typeof V=="object"){if(typeof V.name=="string"&&V.name.trim())return V.name;if(typeof V.task_name=="string"&&V.task_name.trim())return V.task_name;if(typeof V.label=="string"&&V.label.trim())return V.label;if(typeof V.taskListText=="string"&&V.taskListText.trim())return V.taskListText;if(typeof V.task_list_text=="string"&&V.task_list_text.trim())return V.task_list_text;if(typeof V.id=="string"&&V.id.trim())return V.id;if(typeof V.id=="number")return String(V.id)}return typeof V=="string"||typeof V=="number"?String(V):"Task"}),d=M(()=>{var V;return((V=e.task)==null?void 0:V.total_steps)||0}),u=M(()=>{var j;const V=(j=e.task)==null?void 0:j.category;return V?typeof V=="object"?V.name:V:""}),p=M(()=>{var j;const V=(j=e.task)==null?void 0:j.equipment_node;return V?typeof V=="object"?V.name:V:""}),w=M(()=>{const V=e.task;return V!=null&&V.time_estimate_sec?`${Math.round(V.time_estimate_sec/60)} min`:V!=null&&V.estimated_minutes?`${V.estimated_minutes} min`:""}),h=M(()=>{var V,j;return((j=(V=e.task)==null?void 0:V.state)==null?void 0:j.name)||"-"}),k=M(()=>{var j;const V=(j=e.task)==null?void 0:j.personnel;if(!V)return"-";if(Array.isArray(V)){const pe=V.map(oe=>typeof oe=="string"?oe:typeof oe=="object"&&oe.name?oe.name:"").filter(Boolean);return pe.length>0?pe.join(", "):"-"}return typeof V=="object"&&V.name?V.name:typeof V=="string"?V:"-"}),C=M(()=>{var pe,oe;const V=((pe=e.task)==null?void 0:pe.completed_steps)??0,j=((oe=e.task)==null?void 0:oe.total_steps)??0;return`${V} / ${j} Steps`}),P=M(()=>{var j;const V=(j=e.task)==null?void 0:j.time_taken_sec;return V?`${Math.round(V/60)} min`:"-"}),O=M(()=>{var j;const V=(j=e.task)==null?void 0:j.time_estimate_sec;return V?`${Math.round(V/60)} min`:"-"}),E=M(()=>{var V;return((V=e.task)==null?void 0:V.id)||""}),T=M(()=>{var pe,oe;const V=(pe=e.task)==null?void 0:pe.time_taken_sec,j=(oe=e.task)==null?void 0:oe.time_estimate_sec;return!V||!j?!1:V>j}),le={props:e,emit:y,taskLabel:v,stepsCount:d,categoryLabel:u,equipmentLabel:p,timeEstimate:w,taskState:h,assignedPersonnel:k,progressText:C,actualTime:P,estimatedTime:O,taskCode:E,isActualTimeExceeded:T,handleTaskClick:()=>{y("preview",e.task)},__MACROS_defineComponent:Ce,computed:M,get View(){return $t}};return Object.defineProperty(le,"__isScriptSetup",{enumerable:!1,value:!0}),le}}),Zl={class:"template-card"},Xl={class:"card-content"},$l={class:"row-1"},ei={style:{display:"flex","flex-direction":"row","align-items":"center",gap:"10px"}},ti=["title"],ai={class:"right-badges"},ri={key:0,class:"task-code-badge"},oi={class:"row-2 task-details"},ni={class:"detail-item"},si={class:"detail-value"},li={class:"detail-item"},ii={class:"detail-value"},di={class:"detail-item"},ci={class:"detail-value"},ui={key:0,class:"time-exceeded-indicator"},mi={class:"detail-item"},fi={class:"detail-value"},_i={class:"row-3"},gi={class:"detail-item"},pi={class:"detail-value"};function vi(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-tag");return c(),g("div",Zl,[l(" Card Content "),a("div",Xl,[l(" Row 1: Title + Task Code + View Icon "),a("div",$l,[a("div",ei,[a("h4",{class:"card-title",title:e.taskLabel},m(e.taskLabel),9,ti),r(d,{class:"view-icon",onClick:lr(e.handleTaskClick,["stop"]),title:"View Logs"},{default:n(()=>[r(e.View)]),_:1})]),a("div",ai,[l('          <el-tag v-if="categoryLabel" size="small" class="tag-item">'),l("            {{ categoryLabel }}"),l("          </el-tag>"),e.taskCode?(c(),g("div",ri,m(e.taskCode),1)):l("v-if",!0)])]),l(" Row 2: Task Details "),a("div",oi,[a("div",ni,[t[2]||(t[2]=a("span",{class:"detail-label"},"State:",-1)),a("span",si,[e.taskState&&e.taskState.toLowerCase()==="completed"?(c(),Y(u,{key:0,type:"success",size:"small",class:"tag-item"},{default:n(()=>t[0]||(t[0]=[x(" Completed ")])),_:1,__:[0]})):e.taskState&&e.taskState.toLowerCase()==="failed"?(c(),Y(u,{key:1,type:"danger",size:"small",class:"tag-item"},{default:n(()=>t[1]||(t[1]=[x(" Failed ")])),_:1,__:[1]})):(c(),g(se,{key:2},[x(m(e.taskState),1)],64))])]),a("div",li,[t[3]||(t[3]=a("span",{class:"detail-label"},"Progress:",-1)),a("span",ii,m(e.progressText),1)]),a("div",di,[t[4]||(t[4]=a("span",{class:"detail-label"},"Actual Time:",-1)),a("span",ci,[x(m(e.actualTime)+" ",1),e.isActualTimeExceeded?(c(),g("span",ui,"")):l("v-if",!0)])]),a("div",mi,[t[5]||(t[5]=a("span",{class:"detail-label"},"Est. Time:",-1)),a("span",fi,m(e.estimatedTime),1)])]),l(" Row 3: Personnel "),a("div",_i,[a("div",gi,[t[6]||(t[6]=a("span",{class:"detail-label"},"Personnel:",-1)),a("span",pi,m(e.assignedPersonnel),1)])])])])}const hi=Re(Kl,[["render",vi],["__scopeId","data-v-c5623433"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderTaskCard.vue"]]),yi={__name:"StepsPreview",props:{templateId:{type:[String,Number],default:""},steps:{type:Array,default:()=>[]},interactive:{type:Boolean,default:!1},showModeSwitch:{type:Boolean,default:!0}},setup(s,{expose:t}){t();const i=s,{loadTemplate:e}=Mr(),y=S(!1),v=S(!1),d=S(null),u=S(""),p=it({}),w=S(i.interactive);ye(()=>i.interactive,R=>{w.value=R});const h=R=>{const fe=(R||"").toString().toLowerCase();return fe.includes("numeric")||fe==="number"?"number":fe.includes("boolean")||fe.includes("checkbox")?"checkbox":fe.includes("inspection")?"inspection":fe.includes("file")||fe.includes("attachment")?"attachments":fe.includes("service")?"service":fe.includes("text")?"text":fe||"text"},k=R=>{if(R.type)return h(R.type);if(R.value&&R.value.type)return h(R.value.type);if(R.config&&R.config.kind)return h(R.config.kind);if(R.value){if(typeof R.value.value=="number"||R.value.has_upper_limit||R.value.has_lower_limit)return"number";if(typeof R.value.value=="boolean")return"checkbox";if(R.value.files||R.value.file_attachments)return"attachments"}return"text"},C=M(()=>{if(Array.isArray(i.steps)&&i.steps.length>0)return i.steps;const R=d.value;return Array.isArray(R==null?void 0:R.steps)?R.steps:[]}),P=(R,fe)=>{if(!R||typeof R!="object")return{step_id:`step-${fe}`,order:fe+1,type:"text",label:`Step ${fe+1}`,description:"",required:!1,required_image:!1,relevant_tools:[],config:{}};const K=R.value||{},_=h(K.type),de=Array.isArray(R.tools)&&R.tools.length>0?R.tools:R.relevant_tools||[],f=K.numeric_limit_bounds||K.numericLimitBounds||{},F={step_id:R.id||R.step_id||`step-${fe}`,order:fe+1,type:_,label:R.name||R.label||`Step ${fe+1}`,description:R.description||"",required:!!R.required,required_image:!!K.require_image,relevant_tools:de.filter(U=>U&&(U.id||U.tool_id)).map(U=>({tool_id:U.id||U.tool_id,name:U.name||U.tool_name||"Unnamed Tool"})),config:{}};return _==="number"?F.config={default_value:typeof K.value=="number"?K.value:void 0,limits:$a(f),required_image:F.required_image}:_==="checkbox"?F.config={default:!!K.value,required_image:F.required_image}:_==="text"?F.config={default_value:K.value??"",required_image:F.required_image}:_==="inspection"?F.config={default:"pass",required_image:F.required_image}:_==="attachments"&&(F.config={upload_style:{list_type:"picture-card"},required_image:F.required_image}),F},O=(R,fe)=>{if(!R||typeof R!="object")return{step_id:`step-${fe}`,order:fe+1,type:"text",label:`Step ${fe+1}`,description:"",required:!1,required_image:!1,relevant_tools:[],config:{}};const K=k(R),_=R.value||R.config||{},de=Array.isArray(R.tools)&&R.tools.length>0?R.tools:R.relevant_tools||[],f=_.numeric_limit_bounds||_.numericLimitBounds||_.limits||{},F=!!(_.require_image||_.required_image||R.required_image),U={step_id:R.id||R.step_id||`step-${fe}`,order:fe+1,type:K,label:R.name||R.label||`Step ${fe+1}`,description:R.description||"",required:!!R.required,required_image:F,relevant_tools:de.filter(te=>te&&(te.id||te.tool_id)).map(te=>({tool_id:te.id||te.tool_id,name:te.name||te.tool_name||"Unnamed Tool"})),config:{}};if(K==="number")U.config={default_value:typeof _.value=="number"?_.value:typeof _.default_value=="number"?_.default_value:void 0,limits:$a(f),required_image:U.required_image};else if(K==="checkbox"){const te=_.value!==void 0?!!_.value:_.default!==void 0?!!_.default:!1;U.config={default:te,required_image:U.required_image}}else if(K==="text"){const te=_.value??_.default_value??"";U.config={default_value:te,required_image:U.required_image}}else if(K==="inspection"){const te=_.value||_.default||"pass";U.config={default:te,required_image:U.required_image}}else K==="attachments"&&(U.config={upload_style:{list_type:"picture-card"},required_image:U.required_image});return U},E=M(()=>C.value.map((R,fe)=>R&&R.value&&R.value.type?P(R,fe):O(R,fe))),T=M(()=>{if(!u.value)return E.value;const R=u.value.toLowerCase();return E.value.filter(fe=>fe.label.toLowerCase().includes(R))}),q=R=>({inspection:Br,checkbox:Nr,number:Ur,text:zr,files:Xa,attachments:Xa,service:qr})[R]||"div",le=(R,fe)=>!R||typeof R!="object"?{step_id:`step-${fe}`,type:"text",label:`${fe+1}. Step`,description:"",required:!1,config:{}}:{...R,label:`${fe+1}. ${R.label||"Step"}`},V=R=>{R&&(p[R]=!p[R])},j=R=>R?!!p[R]:!1,pe=()=>{},oe=R=>{w.value=R},X=M(()=>Array.isArray(i.steps)&&i.steps.length>0),ie=()=>{Object.keys(p).forEach(R=>{delete p[R]})},$=async()=>{if(!(!i.templateId||X.value)){ie(),y.value=!0,v.value=!1;try{const R=await e(i.templateId);d.value=R}catch(R){console.error("Failed to load template for preview:",R),v.value=!0,B.error("Failed to load template steps")}finally{y.value=!1}}},ce=()=>{if(ie(),X.value){y.value=!1,v.value=!1,d.value=null;return}i.templateId?$():(d.value=null,y.value=!1,v.value=!1)};ye(()=>i.templateId,R=>{X.value||(R?$():(d.value=null,y.value=!1,v.value=!1))},{immediate:!0}),ye(()=>i.steps,()=>{ce()},{deep:!0,immediate:!0});const ne={props:i,loadTemplate:e,loading:y,error:v,template:d,stepSearchQuery:u,stepToolsVisible:p,isInteractive:w,mapValueTypeToPreviewType:h,detectStepType:k,sourceSteps:C,processTemplateStep:P,processStandaloneStep:O,previewSteps:E,filteredPreviewSteps:T,getStepComponent:q,getStepWithNumber:le,toggleStepTools:V,getStepToolsVisible:j,handleStepSearch:pe,handleModeChange:oe,hasExternalSteps:X,resetStepToolsVisibility:ie,fetchTemplate:$,refreshPreviewSource:ce,ref:S,computed:M,reactive:it,watch:ye,get Search(){return qt},get Upload(){return rn},get Tools(){return wo},get ElMessage(){return B},get useTaskLibrary(){return Mr},get transformLimitsFromBackend(){return $a},InspectionStepPreview:Br,CheckboxStepPreview:Nr,NumberStepPreview:Ur,TextStepPreview:zr,AttachmentStepPreview:Xa,ServiceStepPreview:qr};return Object.defineProperty(ne,"__isScriptSetup",{enumerable:!1,value:!0}),ne}},wi={class:"steps-preview-container"},ki={key:0,class:"loading-container"},bi={class:"error-container"},Si={class:"step-search-bar"},Ti={key:0,class:"procedure-preview"},Oi={class:"preview-main viewport-desktop density-comfortable"},Ci={class:"section-content"},Di={class:"step-config-preview"},Ai={key:0,class:"preview-bottom-section"},Pi={class:"desktop-upload-button"},Ii={key:1,class:"desktop-tools-list"},Vi={class:"tools-list-content"},xi={class:"tool-name"},Fi={key:1,class:"empty-steps"};function Ei(s,t,i,e,y,v){const d=D("el-skeleton"),u=D("el-empty"),p=D("el-icon"),w=D("el-input"),h=D("el-button");return c(),g("div",wi,[l(" Loading State "),e.loading?(c(),g("div",ki,[r(d,{rows:3,animated:""})])):e.error?(c(),g(se,{key:1},[l(" Error State "),a("div",bi,[r(u,{description:"Failed to load template steps","image-size":60})])],2112)):(c(),g(se,{key:2},[l(" Content "),a("div",null,[l(" Step Search Bar "),a("div",Si,[r(w,{modelValue:e.stepSearchQuery,"onUpdate:modelValue":t[0]||(t[0]=k=>e.stepSearchQuery=k),placeholder:"Search steps by name...",clearable:"",onInput:e.handleStepSearch},{prefix:n(()=>[r(p,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),l(" Desktop-style Procedure Preview (read-only) "),e.filteredPreviewSteps&&e.filteredPreviewSteps.length>0?(c(),g("div",Ti,[a("div",Oi,[a("div",Ci,[(c(!0),g(se,null,we(e.filteredPreviewSteps,(k,C)=>(c(),g("div",{key:k.step_id||C,class:"preview-step-simple"},[a("div",Di,[(c(),Y(ma(e.getStepComponent(k.type)),{step:e.getStepWithNumber(k,C),"preview-mode":!0,interactive:e.isInteractive},null,8,["step","interactive"])),l(" Bottom section for required image OR tools (desktop style) "),k.required_image||k.relevant_tools&&k.relevant_tools.length>0?(c(),g("div",Ai,[a("div",Pi,[k.required_image?(c(),Y(h,{key:0,type:"info",size:"small",disabled:!e.isInteractive},{default:n(()=>[t[1]||(t[1]=a("span",{class:"required-asterisk"},"*",-1)),r(p,null,{default:n(()=>[r(e.Upload)]),_:1}),t[2]||(t[2]=x(" Upload Image "))]),_:1,__:[1,2]},8,["disabled"])):l("v-if",!0),l(" Show Tools Button "),k.relevant_tools&&k.relevant_tools.length>0?(c(),Y(h,{key:1,disabled:!e.isInteractive,size:"small",plain:"",onClick:P=>e.toggleStepTools(k.step_id),class:"tools-toggle-btn",style:bt(k.required_image?"margin-left: 8px;":"")},{default:n(()=>[r(p,null,{default:n(()=>[r(e.Tools)]),_:1}),x(" "+m(e.getStepToolsVisible(k.step_id)?"Hide Tools":"Show Tools")+" ("+m(k.relevant_tools.length)+") ",1)]),_:2},1032,["disabled","onClick","style"])):l("v-if",!0)])])):l("v-if",!0),l(" Tools List (toggleable) "),e.getStepToolsVisible(k.step_id)&&k.relevant_tools&&k.relevant_tools.length>0?(c(),g("div",Ii,[t[3]||(t[3]=a("div",{class:"tools-list-header"},[a("h4",null,"Required Tools")],-1)),a("div",Vi,[(c(!0),g(se,null,we(k.relevant_tools,P=>(c(),g("div",{key:P.tool_id||P.id,class:"tool-item"},[r(p,null,{default:n(()=>[r(e.Tools)]),_:1}),a("span",xi,m(P.name||"Unnamed Tool"),1)]))),128))])])):l("v-if",!0)])]))),128))])])])):(c(),g("div",Fi,[r(u,{description:e.stepSearchQuery?"No steps match your search":"No steps defined yet","image-size":60},null,8,["description"])]))])],2112))])}const ga=Re(yi,[["render",Ei],["__scopeId","data-v-63ee4a26"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/StepsPreview.vue"]]),Li=Ce({name:"StandardsPreview"}),Wi=Object.assign(Li,{props:{standardId:{type:[String,Number],required:!0}},setup(s,{expose:t}){t();const i=s,e=S(!1),y=S(null),v=S(null),d=S("general"),u=async()=>{var w,h,k;if(!i.standardId){y.value="No standard ID provided";return}e.value=!0,y.value=null;try{console.log(`Loading standard: ${i.standardId}`);const C=await Hr(i.standardId);if(C&&C.data)v.value=((w=C.data)==null?void 0:w.data)||C.data,console.log("Standard loaded:",v.value);else throw new Error("No standard data received")}catch(C){console.error("Failed to load standard for preview:",C),y.value=((k=(h=C.response)==null?void 0:h.data)==null?void 0:k.message)||C.message||"Failed to load standard details",B.error("Failed to load standard details")}finally{e.value=!1}};ye(()=>i.standardId,w=>{w&&u()},{immediate:!0}),He(()=>{i.standardId&&u()});const p={props:i,loading:e,error:y,standard:v,activeTab:d,fetchStandard:u,__MACROS_defineComponent:Ce,ref:S,onMounted:He,watch:ye,get ElMessage(){return B},get getStandard(){return Hr}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Ri={class:"standards-preview"},Mi={key:0,class:"loading-container"},qi={class:"error-container"},zi={class:"standard-details"},Ui={class:"fixed-header-section"},Ni={class:"standard-tabs-header"},Bi={class:"scrollable-content"},ji={class:"tab-content-wrapper"},Hi={key:0,class:"tab-pane-content"},Ji={class:"overview-card"},Yi={class:"card-content"},Gi={class:"info-value highlight"},Qi={class:"standard-id"},Ki={key:0,class:"description-card"},Zi={class:"card-content"},Xi={class:"description-text"},$i={key:1,class:"tab-pane-content"},ed={key:0,class:"rules-list"},td={class:"card-header"},ad={class:"rules-container"},rd={class:"rule-number"},od={class:"rule-content"},nd={class:"rule-text"},sd={key:1,class:"empty-rules"},ld={class:"empty-standard"};function id(s,t,i,e,y,v){const d=D("el-skeleton"),u=D("el-alert"),p=D("el-tab-pane"),w=D("el-tabs"),h=D("el-descriptions-item"),k=D("el-descriptions"),C=D("el-tag"),P=D("el-empty");return c(),g("div",Ri,[l(" Loading State "),e.loading?(c(),g("div",Mi,[r(d,{rows:4,animated:""}),t[1]||(t[1]=a("div",{class:"loading-text"},"Loading standard details...",-1))])):e.error?(c(),g(se,{key:1},[l(" Error State "),a("div",qi,[r(u,{title:"Failed to load standard",description:e.error,type:"error",closable:!1,"show-icon":""},null,8,["description"])])],2112)):e.standard?(c(),g(se,{key:2},[l(" Standard Details (matching exactly StandardsLibraryView structure) "),a("div",zi,[l(" Fixed Header Section "),a("div",Ui,[l(" Tab Navigation "),a("div",Ni,[r(w,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=O=>e.activeTab=O),class:"details-tabs"},{default:n(()=>[r(p,{label:"General",name:"general"}),r(p,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),l(" Scrollable Content Area "),a("div",Bi,[a("div",ji,[l(" General Tab Content "),e.activeTab==="general"?(c(),g("div",Hi,[l(" Standard Overview Card "),a("div",Ji,[a("div",Yi,[r(k,{column:2,direction:"vertical"},{default:n(()=>[r(h,{width:"50%",label:"Category"},{default:n(()=>[x(m(e.standard.category||"Uncategorized"),1)]),_:1}),r(h,{width:"50%",label:"Total Rules"},{default:n(()=>{var O;return[a("span",Gi,m(((O=e.standard.items)==null?void 0:O.length)||0)+" rules",1)]}),_:1}),r(h,{width:"50%",label:"Standard Code"},{default:n(()=>[a("span",Qi,m(e.standard.code||"N/A"),1)]),_:1})]),_:1})])]),l(" Description Section "),e.standard.description?(c(),g("div",Ki,[t[2]||(t[2]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",Zi,[a("div",Xi,m(e.standard.description),1)])])):l("v-if",!0)])):l("v-if",!0),l(" Standard Rules Tab Content "),e.activeTab==="rules"?(c(),g("div",$i,[l(" Standard Rules List "),e.standard.items&&e.standard.items.length>0?(c(),g("div",ed,[a("div",td,[t[4]||(t[4]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(C,{type:"warning",size:"small"},{default:n(()=>t[3]||(t[3]=[x("Read Only")])),_:1,__:[3]})]),a("div",ad,[(c(!0),g(se,null,we(e.standard.items,(O,E)=>(c(),g("div",{key:E,class:"rule-item"},[a("div",rd,m(E+1),1),a("div",od,[a("div",nd,m(O),1)])]))),128))])])):(c(),g("div",sd,[r(P,{description:"No standard rules defined yet","image-size":60})]))])):l("v-if",!0)])])])],2112)):(c(),g(se,{key:3},[l(" No Standard State "),a("div",ld,[r(P,{description:"No standard data available","image-size":60})])],2112))])}const za=Re(Wi,[["render",id],["__scopeId","data-v-c25e20fa"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/StandardsPreview.vue"]]),dd=Ce({name:"TaskLogsView"}),cd=Object.assign(dd,{props:{taskEntryId:{type:String,required:!0},task:{type:Object,default:null}},setup(s,{expose:t}){t();const i=s,e=S(!1),y=S(null),v=S([]),d=M(()=>{var h;return((h=i.task)==null?void 0:h.failure_reason)||""}),u=async()=>{if(!i.taskEntryId){y.value="Task entry ID is required";return}e.value=!0,y.value=null;try{const h=await Rr(i.taskEntryId);console.log("Task logs response:",h),v.value=(h==null?void 0:h.data)||[],console.log("Logs value:",v.value),v.value.sort((k,C)=>{const P=k.time||0;return(C.time||0)-P})}catch(h){console.error("Failed to fetch task logs:",h),y.value="Failed to load task logs. Please try again.",v.value=[]}finally{e.value=!1}},p=h=>{if(!h)return"-";const k=new Date(h*1e3);return ut(k.toISOString())};ye(()=>i.taskEntryId,h=>{h&&u()},{immediate:!0});const w={props:i,loading:e,error:y,logs:v,failureReason:d,fetchLogs:u,formatTimestamp:p,__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,onMounted:He,get getTaskLogsByTaskId(){return Rr},get convertToLocalTime(){return ut},get ElMessage(){return B}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),ud={class:"task-logs-view"},md={key:0,class:"loading-container"},fd={class:"error-container"},_d={class:"empty-container"},gd={class:"logs-list"},pd={key:0,class:"failure-reason-container"},vd={class:"failure-content"},hd={class:"log-content"},yd={class:"log-row"},wd={class:"log-value"},kd={class:"log-row"},bd={class:"log-value"},Sd={class:"log-row"},Td={class:"log-value"};function Od(s,t,i,e,y,v){const d=D("el-skeleton"),u=D("el-alert"),p=D("el-empty");return c(),g("div",ud,[l(" Loading State "),e.loading?(c(),g("div",md,[r(d,{rows:3,animated:""})])):e.error?(c(),g(se,{key:1},[l(" Error State "),a("div",fd,[r(u,{type:"error",closable:!1,title:e.error,"show-icon":""},null,8,["title"])])],2112)):!e.logs.length&&!e.failureReason?(c(),g(se,{key:2},[l(" Empty State "),a("div",_d,[r(p,{description:"No logs available for this task","image-size":100})])],2112)):(c(),g(se,{key:3},[l(" Logs List "),a("div",gd,[l(" Failure Reason Alert (Top Priority) "),e.failureReason?(c(),g("div",pd,[r(u,{type:"error",closable:!1,"show-icon":"",class:"failure-alert"},{title:n(()=>t[0]||(t[0]=[a("div",{class:"failure-title"},"Failure Reason",-1)])),default:n(()=>[a("div",vd,m(e.failureReason),1)]),_:1})])):l("v-if",!0),l(" Regular Logs "),(c(!0),g(se,null,we(e.logs,w=>(c(),g("div",{key:w.id,class:"log-item"},[a("div",hd,[a("div",yd,[t[1]||(t[1]=a("span",{class:"log-label"},"Change:",-1)),a("span",wd,m(w.change||"-"),1)]),a("div",kd,[t[2]||(t[2]=a("span",{class:"log-label"},"User:",-1)),a("span",bd,m(w.user||"-"),1)]),a("div",Sd,[t[3]||(t[3]=a("span",{class:"log-label"},"Time:",-1)),a("span",Td,m(e.formatTimestamp(w.time)),1)])])]))),128))])],2112))])}const Cd=Re(cd,[["render",Od],["__scopeId","data-v-f12ce9f3"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Logs/TaskLogsView.vue"]]),Dd=Ce({name:"WorkOrderDetail"}),Ad=Object.assign(Dd,{props:{workOrder:{type:Object,default:null}},emits:["edit","share","export","add-parts","add-time","add-costs","view-procedure","add-comment","delete","start-work-order"],setup(s,{expose:t,emit:i}){t();const e=yt(),y=s,v=i,d=S("tasks"),u=S(!1),p=S(null),w=S(!1),h=S([]),k=S(!1),C=S(!1),P=S(!1),O=S(null),E=S([]),T=S(!1),q=S(""),le=S([]),V=S(!1),j=S(!1),pe=S(null),oe=S("general"),X=S([]),ie=S({search:"",state:"",assignee:"",timeSpent:""}),$=S("logs"),ce=S("");let ne=null;const R=M(()=>{var I,Z,Q,ge;return((Z=(I=y.workOrder)==null?void 0:I.state)==null?void 0:Z.id)===13||((ge=(Q=y.workOrder)==null?void 0:Q.state)==null?void 0:ge.name)==="Incomplete"}),fe=M(()=>{var I;return((I=y.workOrder)==null?void 0:I.image_list)&&y.workOrder.image_list.length>0}),K=M(()=>{const I=y.workOrder;return I?Array.isArray(I.categories)&&I.categories.length?I.categories:Array.isArray(I.category_list)&&I.category_list.length?I.category_list:I.category?[I.category]:[]:[]}),_=I=>I&&typeof I=="object"?I.id??I.name??JSON.stringify(I):I,de=M(()=>{var Z;const I=(Z=y.workOrder)==null?void 0:Z.recurrence_type;return I?(console.log("IsRecurring check:",I),I.id?I.id!==1:typeof I=="string"?I.toLowerCase()!=="does not repeat"&&I.toLowerCase()!=="none":I.name?I.name.toLowerCase()!=="does not repeat"&&I.name.toLowerCase()!=="none":!1):!1}),f=M(()=>{var Ee;const I=(Ee=y.workOrder)==null?void 0:Ee.work_order_progress;if(!I)return null;const Z=I.total_task_amount||0,Q=I.completed_task_amount||0,ge=I.failed_task_amount||0,Te=Z>0?Math.round(Q/Z*100):0;return{total:Z,completed:Q,failed:ge,percentage:Te,remaining:Z-Q-ge}}),F=M(()=>{var I;return((I=y.workOrder)==null?void 0:I.file_list)&&y.workOrder.file_list.length>0}),U=M(()=>!h.value||!Array.isArray(h.value)?[]:h.value.filter(I=>I&&I.id&&I.name)),te=M(()=>U.value.length>0),N=M(()=>{const I=new Set;return E.value.forEach(Z=>{const Q=Z==null?void 0:Z.personnel;Q&&(Array.isArray(Q)?Q.forEach(ge=>{typeof ge=="string"&&ge&&I.add(ge),typeof ge=="object"&&ge.name&&I.add(ge.name)}):typeof Q=="object"&&Q.name?I.add(Q.name):typeof Q=="string"&&Q&&I.add(Q))}),Array.from(I).sort()}),ee=M(()=>{let I=E.value;if(ie.value.search){const Z=ie.value.search.toLowerCase();I=I.filter(Q=>{const ge=Q.name||Q.task_name||Q.label||Q.taskListText||"",Te=Q.id||"";return ge.toLowerCase().includes(Z)||String(Te).toLowerCase().includes(Z)})}return ie.value.state&&(I=I.filter(Z=>{var ge;return(((ge=Z==null?void 0:Z.state)==null?void 0:ge.name)||"").toLowerCase()===ie.value.state.toLowerCase()})),ie.value.assignee&&(I=I.filter(Z=>{const Q=Z==null?void 0:Z.personnel;return Q?Array.isArray(Q)?Q.some(ge=>(typeof ge=="string"?ge:(ge==null?void 0:ge.name)||"")===ie.value.assignee):typeof Q=="object"&&Q.name?Q.name===ie.value.assignee:typeof Q=="string"?Q===ie.value.assignee:!1:!1})),ie.value.timeSpent&&(I=I.filter(Z=>{const Q=(Z==null?void 0:Z.time_taken_sec)||0,ge=Math.round(Q/60);switch(ie.value.timeSpent){case"lt15":return ge<15;case"15to30":return ge>=15&&ge<=30;case"gt30":return ge>30;default:return!0}})),I}),G=M(()=>{var I;return!((I=y.workOrder)!=null&&I.file_list)||!Array.isArray(y.workOrder.file_list)?[]:y.workOrder.file_list.map((Z,Q)=>{const ge=Z.split("/"),Ee=(ge[ge.length-1]||`file_${Q+1}`).replace(/\d{17}/,"");return{id:Q,name:decodeURIComponent(Ee),url:Z,type:Ke(Ee)}})}),re=I=>{if(!Array.isArray(I)){E.value=[];return}const Z=new Map(Array.isArray(E.value)?E.value.map(Q=>[Q.id,Q]):[]);E.value=I.map((Q,ge)=>{if(typeof Q=="string"||typeof Q=="number"){const Te=String(Q).trim(),Ee=String(Q),qe=Te||`task-${ge}`,Ye=Z.get(qe);return Ye?{...Ye,id:qe,label:Ee,taskListText:Ee,hasValidId:!!Te,index:ge}:{id:qe,label:Ee,taskListText:Ee,hasValidId:!!Te,index:ge}}if(Q&&typeof Q=="object"&&!Array.isArray(Q)){const Te=Q.id||Q._id||Q.task_id||Q.taskId||Q.reference_id||"",Ee=String(Te).trim(),Ye=Q.task_list_text||Q.taskListText||Q.task_name||Q.name||Ee||""||`Task ${ge+1}`,ct=Ee||`task-${ge}`,ht=Z.get(ct);return ht?{...ht,...Q,id:ct,label:Ye,taskListText:Ye,hasValidId:!!Ee,index:ge}:{...Q,id:ct,label:Ye,taskListText:Ye,hasValidId:!!Ee,index:ge}}return{id:`task-${ge}`,label:`Task ${ge+1}`,taskListText:`Task ${ge+1}`,hasValidId:!1,index:ge}})},Se=()=>{E.value=[],q.value="",p.value=null,le.value=[],T.value=!1,u.value=!1,le.value=[]},De=I=>!I||typeof I!="object"?"":I.template_id||I.templateId||I.templateID||"",Pe=async()=>{var I,Z;if(!((Z=(I=y.workOrder)==null?void 0:I.equipment_node_ids)!=null&&Z.length)){h.value=[];return}try{k.value=!0;const Q=y.workOrder.equipment_node_ids.map(Te=>Wr(Te).catch(Ee=>(console.warn(`Failed to load equipment ${Te}:`,Ee),null))),ge=await Promise.all(Q);h.value=ge.filter(Te=>(Te==null?void 0:Te.data)&&Te.data.id).map(Te=>({...Te.data,id:Te.data.id,name:Te.data.name||`Equipment ${Te.data.id}`,manufacturer:Te.data.manufacturer||null,location:Te.data.location||null,person_in_charge:Te.data.person_in_charge||null,image_list:Te.data.image_list||[],type:Te.data.type||Te.data.equipment_type||"Equipment"}))}catch(Q){console.error("Failed to load equipment details:",Q),h.value=[]}finally{k.value=!1}};ye(()=>y.workOrder,I=>{I?(Pe(),Se(),re(I.task_list)):Se()},{immediate:!0}),ye(()=>{var I;return(I=y.workOrder)==null?void 0:I.task_list},I=>{y.workOrder?(q.value="",p.value=null,u.value=!1,le.value=[],re(I)):Se()});const Ae=(I,Z=!1)=>{if(!I)return"-";if(Z){const Q=new Date(I),ge=Q.getFullYear(),Te=String(Q.getMonth()+1).padStart(2,"0"),Ee=String(Q.getDate()).padStart(2,"0");let qe=Q.getHours();const Ye=String(Q.getMinutes()).padStart(2,"0");qe===0&&Q.getDate()!==new Date(I).getDate()&&(qe=24);const ct=String(qe).padStart(2,"0");return`${ge}-${Te}-${Ee} ${ct}:${Ye}`}return ut(I)},ve=()=>{v("start-work-order",y.workOrder)},Fe=I=>{switch(I){case"start":ve();break;case"edit":v("edit",y.workOrder);break;case"share":v("share",y.workOrder);break;case"export":v("export",y.workOrder);break;case"delete":Be();break;default:console.warn(`Unhandled header action: ${I}`)}},Be=()=>{de.value?C.value=!0:lt.confirm("This action will permanently delete this work order. This cannot be undone.","Delete Work Order",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{await et()}).catch(()=>{})},et=async()=>{try{P.value=!0,await xr(y.workOrder.id),B.success("Work order deleted successfully"),v("delete",{workOrder:y.workOrder,type:"individual"})}catch(I){console.error("Failed to delete work order:",I),B.error("Failed to delete work order")}finally{P.value=!1}},dt=async()=>{try{P.value=!0,await Vr(y.workOrder.recurrence_uuid),B.success("All recurring work orders deleted successfully"),v("delete",{workOrder:y.workOrder,type:"recurrence"}),C.value=!1}catch(I){console.error("Failed to delete recurring work orders:",I),B.error("Failed to delete recurring work orders")}finally{P.value=!1}},_t=async I=>{I==="individual"?(await et(),C.value=!1):I==="recurrence"&&await dt()},Vt=async()=>{var I;if(w.value=!0,!de.value||!((I=y.workOrder)!=null&&I.recurrence_uuid)){X.value=[];return}try{V.value=!0;const Q=(await Ir(y.workOrder.recurrence_uuid,1,50)).data.content||[];X.value=wt(Q)}catch(Z){console.error("Failed to load recurring work orders for timeline:",Z),B.error("Failed to load timeline data"),X.value=[]}finally{V.value=!1}},mt=()=>{w.value=!1},rt=async I=>{try{if(!X.value||X.value.length===0){B.warning("No timeline data available to export");return}const Z=io(`work-order-${y.workOrder.id}-timeline`),Q=lo(X.value,I,Z,{currentWorkOrderId:y.workOrder.id,sheetName:`Work Order ${y.workOrder.id} Timeline`,includeMetadata:!0});Q.success?(B.success(`${Q.message} (${Q.recordCount} records)`),w.value=!1):B.error(Q.message)}catch(Z){console.error("Timeline export failed:",Z),B.error("Failed to export timeline data")}},wt=I=>Array.isArray(I)?I.sort((Z,Q)=>new Date(Z.start_date||Z.created_at)-new Date(Q.start_date||Q.created_at)).map((Z,Q)=>{var Ye,ct,ht,kt,Et,Lt,ft;const ge=((ct=(Ye=Z.state)==null?void 0:Ye.name)==null?void 0:ct.toLowerCase())==="completed",Te=((kt=(ht=Z.state)==null?void 0:ht.name)==null?void 0:kt.toLowerCase())==="in progress",Ee=(((Et=Z.state)==null?void 0:Et.id)===13||((Lt=Z.state)==null?void 0:Lt.name)==="Incomplete")&&!ge,qe=Array.isArray(Z.task_list)?Z.task_list.length:0;return{id:Z.id,title:Z.name||`Work Order #${Z.id}`,description:Z.description||"No description provided",timestamp:Ae(Z.start_date||Z.created_at,!0),type:Ee?"danger":ge?"success":Te?"primary":"info",color:Ee?"#f56c6c":ge?"#67c23a":Te?"#409eff":"#909399",icon:"DocumentChecked",hollow:!ge,status:((ft=Z.state)==null?void 0:ft.name)||"Pending",isIncomplete:Ee,dueDate:Z.due_date,category:Z.category||Z.categories,priority:Z.priority,taskCount:qe,duration:Z.estimated_minutes?`${Z.estimated_minutes}m`:null,plannedEnd:Z.due_date,actualEnd:Z.finished_at,assignees:Z.created_by?[{id:1,name:String(Z.created_by).trim()||"Unknown",avatar:""}]:[]}}):[],St=async I=>{if(!I||!I.id||I.hasValidId===!1){B.warning("Task preview is unavailable for this entry.");return}const Z=(Q,ge="",Te=[])=>{const Ee=ge||"",qe=Array.isArray(Te)?Te:[];return!Ee&&qe.length===0?(B.warning("Task preview is unavailable for this entry."),!1):(p.value=Q,q.value=Ee,le.value=qe.map(Ye=>({...Ye})),u.value=!0,!0)};if(I.cachedTask){const Q=I.cachedTemplateId||De(I.cachedTask)||"",ge=Array.isArray(I.cachedTask.steps)?I.cachedTask.steps:[];if(Z(I.cachedTask,Q,ge))return}if(!T.value){q.value="",p.value=null,le.value=[];try{T.value=!0;const Q=await Jt(I.id),ge=Q==null?void 0:Q.data;if(!ge){B.error("Failed to load task details.");return}(I.taskListText||I.label)&&(ge.taskListText=I.taskListText||I.label);const Te=De(ge)||"",Ee=Array.isArray(ge.steps)?ge.steps:[];if(!Z(ge,Te,Ee))return;const qe=E.value.findIndex(Ye=>Ye.id===I.id);if(qe!==-1){const Ye={...E.value[qe],cachedTask:ge,cachedTemplateId:Te,hasValidId:!0};E.value.splice(qe,1,Ye)}}catch(Q){console.error("Failed to load task preview:",Q),B.error("Failed to load task preview.")}finally{T.value=!1}}},gt=()=>{u.value=!1,p.value=null,q.value="",T.value=!1,le.value=[],$.value="logs"},Qe=I=>{pe.value=I,j.value=!0},tt=I=>I?I.split(/[-_]/).map(Z=>Z.charAt(0).toUpperCase()+Z.slice(1).toLowerCase()).join(" "):"",W=()=>{B.info("Navigation to linked work order will be implemented by Yellow Guy")},$e=I=>{switch(I==null?void 0:I.toLowerCase()){case"image":case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return ua;case"video":case"mp4":case"avi":case"mov":case"wmv":case"flv":return Tr;case"audio":case"mp3":case"wav":case"flac":case"aac":return Sr;case"pdf":case"document":case"doc":case"docx":case"txt":case"rtf":return sa;case"download":case"zip":case"rar":case"7z":return Da;default:return sa}},Ke=I=>{var qe;if(!I)return"document";const Z=(qe=I.split(".").pop())==null?void 0:qe.toLowerCase(),Q=["jpg","jpeg","png","gif","bmp","webp","svg"],ge=["mp4","avi","mov","wmv","flv","mkv"],Te=["mp3","wav","flac","aac","ogg"],Ee=["zip","rar","7z","tar","gz"];return Q.includes(Z)?"image":ge.includes(Z)?"video":Te.includes(Z)?"audio":Ee.includes(Z)?"download":"document"},vt={router:e,props:y,emit:v,activeTrackingTab:d,showTaskPreviewDialog:u,selectedTaskForPreview:p,timelineModalVisible:w,equipmentDetails:h,loadingEquipment:k,deleteDialogVisible:C,deleting:P,scheduleSection:O,taskEntries:E,taskPreviewLoading:T,selectedTaskTemplateId:q,selectedTaskSteps:le,timelineLoading:V,showStandardPreviewDialog:j,previewStandardData:pe,standalonePreviewTab:oe,timelineEvents:X,taskFilters:ie,activeTaskPreviewTab:$,searchInput:ce,get searchDebounceTimer(){return ne},set searchDebounceTimer(I){ne=I},isIncomplete:R,hasAttachments:fe,categoryTags:K,categoryKey:_,isRecurring:de,workOrderProgress:f,hasFileAttachments:F,validEquipmentList:U,hasValidEquipment:te,uniqueAssignees:N,filteredTaskEntries:ee,processedFileList:G,normalizeTaskList:re,resetTaskState:Se,resolveTaskTemplateId:De,loadEquipmentDetails:Pe,formatDate:Ae,handleStartWorkOrder:ve,handleHeaderAction:Fe,handleDeleteWorkOrder:Be,performDeleteIndividual:et,performDeleteRecurrence:dt,handleDeleteConfirmation:_t,openTimelineModal:Vt,handleTimelineModalClose:mt,handleExportFormat:rt,transformWorkOrdersToTimeline:wt,handleTaskPreview:St,handleTaskPreviewClose:gt,handleStandardPreview:Qe,formatCategoryName:tt,navigateToLinkedOrder:W,getFileIcon:$e,getFileTypeFromName:Ke,viewRequest:I=>{B.info(`Navigation to request ${I.name} will be implemented`)},scrollToScheduleSection:()=>{if(O.value)O.value.scrollIntoView({behavior:"smooth",block:"start"});else{const I=document.querySelector(".schedule-conditions-section .schedule-header");I?I.scrollIntoView({behavior:"smooth",block:"start"}):console.warn("Schedule section not found for scrolling")}},handleEquipmentClick:I=>{if(!(I!=null&&I.id)){B.warning("Equipment information is not available");return}e.push({path:"/maintenance/equipment",query:{equipmentId:I.id}})},handleSearchInput:I=>{ne&&clearTimeout(ne),ne=setTimeout(()=>{ie.value.search=I},300)},__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,get useRouter(){return yt},get Edit(){return or},get Share(){return ln},get Picture(){return ua},get Download(){return Da},get View(){return $t},get MoreFilled(){return yo},get Tools(){return wo},get Delete(){return Ma},get Warning(){return sn},get Document(){return sa},get DocumentDelete(){return nn},get VideoCamera(){return Tr},get Microphone(){return Sr},get ArrowDown(){return on},get DocumentCopy(){return ko},get Search(){return qt},get convertToLocalTime(){return ut},get exportTimelineData(){return lo},get generateTimestampedFilename(){return io},get getEquipmentById(){return Wr},get deleteIndividualWorkOrder(){return xr},get deleteRecurrenceWorkOrders(){return Vr},get getWorkOrdersByRecurrence(){return Ir},get getTaskEntryById(){return Jt},PriorityTag:ir,WorkTypeTag:xo,CategoryTag:dr,Timeline:Gl,WorkOrderTaskCard:hi,StepsPreview:ga,StandardsPreview:za,StartWorkOrderAction:Eo,TaskLogsView:Cd,get ElMessage(){return B},get ElMessageBox(){return lt}};return Object.defineProperty(vt,"__isScriptSetup",{enumerable:!1,value:!0}),vt}}),Pd={key:0,class:"work-order-detail"},Id={class:"detail-header"},Vd={class:"header-main"},xd={class:"title-row"},Fd={class:"detail-title"},Ed={class:"work-order-id"},Ld={class:"meta-info"},Wd={class:"created-date"},Rd={key:0,class:"updated-date"},Md={class:"header-actions"},qd={class:"detail-section"},zd={class:"detail-value"},Ud={class:"detail-value work-order-code"},Nd={class:"field-value"},Bd={class:"field-value"},jd={key:0,class:"category-tag-list"},Hd={key:1},Jd={class:"detail-value"},Yd={class:"detail-value"},Gd={class:"detail-section dates-section"},Qd={class:"detail-value"},Kd={class:"detail-value"},Zd={class:"recurrence-value-container"},Xd={class:"recurrence-value-container"},$d={key:1,class:"detail-value"},ec={key:0,class:"detail-section"},tc={class:"description-content"},ac={key:1,class:"detail-section"},rc={key:0,class:"loading-container"},oc={key:1,class:"equipment-grid"},nc={class:"equipment-tooltip"},sc={key:0},lc={key:1},ic={key:2},dc={key:3},cc=["onClick"],uc={class:"equipment-image"},mc={class:"equipment-icon"},fc={key:1,class:"equipment-icon"},_c={class:"equipment-info"},gc={class:"equipment-name"},pc={class:"equipment-code"},vc={key:2,class:"no-equipment"},hc={key:2,class:"detail-section"},yc={class:"progress-header"},wc={class:"progress-stats"},kc={class:"stat-item"},bc={class:"stat-value"},Sc={class:"stat-item"},Tc={class:"stat-value completed"},Oc={class:"stat-item"},Cc={class:"stat-value failed"},Dc={class:"stat-item"},Ac={class:"stat-value"},Pc={class:"progress-section"},Ic={class:"progress-bar-container"},Vc={class:"custom-progress-bar"},xc={class:"progress-text"},Fc={key:3,class:"detail-section"},Ec={key:0,class:"images-section"},Lc={class:"image-gallery"},Wc={class:"image-slot"},Rc={key:1,class:"files-section"},Mc={class:"file-list"},qc={key:4,class:"detail-section schedule-conditions-section"},zc={class:"schedule-header",ref:"scheduleSection"},Uc={class:"section-title"},Nc={class:"detail-value"},Bc={class:"detail-value"},jc={class:"detail-section time-cost-tracking-card"},Hc={class:"tab-content"},Jc={key:0,class:"tasks-filter-bar"},Yc={key:1,class:"tasks-list"},Gc={key:2,class:"no-data-placeholder"},Qc={key:3,class:"no-data-placeholder"},Kc={class:"tab-content"},Zc={key:0,class:"standards-list"},Xc=["onClick"],$c={class:"standard-header"},eu={class:"standard-name"},tu={class:"standard-code"},au={class:"standard-tags"},ru={key:1,class:"no-data-placeholder"},ou={key:0,class:"timeline-loading"},nu={key:1,class:"timeline-empty"},su={key:2,class:"timeline-empty"},lu={class:"dialog-footer"},iu={class:"delete-dialog-content"},du={class:"delete-dialog-footer"},cu={class:"preview-dialog-footer"},uu={class:"standalone-standard-preview"},mu={class:"standard-details"},fu={class:"fixed-header-section"},_u={class:"standard-tabs-header"},gu={class:"scrollable-content"},pu={class:"tab-content-wrapper"},vu={key:0,class:"tab-pane-content"},hu={class:"overview-card"},yu={class:"card-content"},wu={class:"info-value highlight"},ku={key:0,class:"description-card"},bu={class:"card-content"},Su={class:"description-text"},Tu={key:1,class:"tab-pane-content"},Ou={key:0,class:"rules-list"},Cu={class:"card-header"},Du={class:"rules-container"},Au={class:"rule-number"},Pu={class:"rule-content"},Iu={class:"rule-text"},Vu={key:1,class:"empty-rules"},xu={key:1,class:"empty-detail"};function Fu(s,t,i,e,y,v){var R,fe,K,_,de;const d=D("el-col"),u=D("el-icon"),p=D("el-button"),w=D("el-dropdown-item"),h=D("el-dropdown-menu"),k=D("el-dropdown"),C=D("el-row"),P=D("el-descriptions-item"),O=D("el-descriptions"),E=D("el-divider"),T=D("el-skeleton"),q=D("el-image"),le=D("el-tooltip"),V=D("el-empty"),j=D("el-link"),pe=D("el-input"),oe=D("el-option"),X=D("el-select"),ie=D("el-tab-pane"),$=D("el-tag"),ce=D("el-tabs"),ne=D("el-dialog");return c(),g(se,null,[i.workOrder?(c(),g("div",Pd,[l(" Detail Header "),a("div",Id,[r(C,{justify:"space-between",align:"top",gutter:16},{default:n(()=>[r(d,{span:18},{default:n(()=>[a("div",Vd,[a("div",xd,[a("h2",Fd,m(i.workOrder.name),1),a("span",Ed,"#"+m(i.workOrder.id),1)]),a("div",Ld,[a("span",Wd,m(s.$t("workOrder.form.createdOn"))+": "+m(e.formatDate(i.workOrder.created_at)),1),i.workOrder.updated_at?(c(),g("span",Rd," Updated: "+m(e.formatDate(i.workOrder.updated_at)),1)):l("v-if",!0)])])]),_:1}),r(d,{span:4},{default:n(()=>[a("div",Md,[r(p,{class:"edit-button",type:"primary",plain:"",size:"default",onClick:t[0]||(t[0]=f=>e.emit("edit",i.workOrder)),"aria-label":s.$t("workOrder.actions.edit")},{default:n(()=>[r(u,{style:{"margin-right":"4px"}},{default:n(()=>[r(e.Edit)]),_:1}),x(" "+m(s.$t("workOrder.actions.edit")),1)]),_:1},8,["aria-label"]),r(k,{trigger:"click",onCommand:e.handleHeaderAction},{dropdown:n(()=>[r(h,null,{default:n(()=>[r(w,{command:"share"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.Share)]),_:1}),x(" "+m(s.$t("workOrder.actions.share")),1)]),_:1}),r(w,{command:"export"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.Download)]),_:1}),x(" "+m(s.$t("workOrder.actions.export")),1)]),_:1}),r(e.StartWorkOrderAction,{"work-order":i.workOrder,onStart:e.handleStartWorkOrder},null,8,["work-order"]),r(w,{command:"delete",divided:"",class:"delete-item"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.Delete)]),_:1}),x(" "+m(s.$t("workOrder.actions.delete")),1)]),_:1})]),_:1})]),default:n(()=>[r(p,{type:"text",size:"default",class:"action-button"},{default:n(()=>[r(u,{class:"rotated-icon"},{default:n(()=>[r(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),l(" General Detail Section "),a("div",qd,[r(O,{column:4,class:"general-details-descriptions"},{default:n(()=>{var f;return[r(P,{label:s.$t("workOrder.table.state")},{default:n(()=>{var F;return[a("span",zd,m(((F=i.workOrder.state)==null?void 0:F.name)||"-"),1)]}),_:1},8,["label"]),i.workOrder.code?(c(),Y(P,{key:0,label:"Work Order Code"},{default:n(()=>[a("span",Ud,m(i.workOrder.code),1)]),_:1})):l("v-if",!0),r(P,{label:s.$t("workOrder.table.priority")},{default:n(()=>[r(e.PriorityTag,{priority:i.workOrder.priority},null,8,["priority"])]),_:1},8,["label"]),r(P,{label:s.$t("workOrder.table.assignedTo")},{default:n(()=>[a("span",Nd,m(i.workOrder.created_by||"Unassigned"),1)]),_:1},8,["label"]),r(P,{label:"Updated By"},{default:n(()=>[a("span",Bd,m(i.workOrder.updated_by||"-"),1)]),_:1}),r(P,{label:s.$t("workOrder.table.workType")},{default:n(()=>[r(e.WorkTypeTag,{"work-type":i.workOrder.work_type},null,8,["work-type"])]),_:1},8,["label"]),r(P,{label:s.$t("workOrder.table.category")},{default:n(()=>[e.categoryTags.length?(c(),g("div",jd,[(c(!0),g(se,null,we(e.categoryTags,F=>(c(),Y(e.CategoryTag,{key:e.categoryKey(F),category:F},null,8,["category"]))),128))])):(c(),g("span",Hd,"-"))]),_:1},8,["label"]),r(P,{label:s.$t("workOrder.table.estimatedTime")},{default:n(()=>[a("span",Jd,m(i.workOrder.estimated_minutes?`${i.workOrder.estimated_minutes} min`:"-"),1)]),_:1},8,["label"]),(f=i.workOrder.vendor_ids)!=null&&f.length?(c(),Y(P,{key:1,label:"Vendors"},{default:n(()=>[a("span",Yd,m(i.workOrder.vendor_ids.join(", ")),1)]),_:1})):l("v-if",!0),i.workOrder.request?(c(),Y(P,{key:2,label:"Related Request"},{default:n(()=>[a("span",{class:"detail-value linked-value",onClick:t[1]||(t[1]=F=>e.viewRequest(i.workOrder.request))},m(i.workOrder.request.name),1)]),_:1})):l("v-if",!0)]}),_:1})]),l(" Dates Section "),a("div",Gd,[r(O,{column:4,class:"dates-descriptions"},{default:n(()=>[r(P,{label:"Start Date"},{default:n(()=>[a("span",Qd,m(i.workOrder.start_date?e.formatDate(i.workOrder.start_date):"-"),1)]),_:1}),r(P,{label:"End Date"},{default:n(()=>[a("span",Kd,m(i.workOrder.end_date?e.formatDate(i.workOrder.end_date):"-"),1)]),_:1}),r(P,{label:s.$t("workOrder.table.dueDate")},{default:n(()=>[a("span",{class:xe(["detail-value",{incomplete:e.isIncomplete}])},m(i.workOrder.due_date?e.formatDate(i.workOrder.due_date):"-"),3)]),_:1},8,["label"]),r(P,{label:"Recurrence Type"},{default:n(()=>[a("div",Zd,[a("div",Xd,[e.isRecurring?(c(),g("span",{key:0,class:xe(["detail-value",{"recurrence-clickable":e.isRecurring}]),onClick:e.openTimelineModal,style:bt({cursor:e.isRecurring?"pointer":"default"})},m(i.workOrder.recurrence_type.name),7)):(c(),g("span",$d,m(i.workOrder.recurrence_type.name),1)),e.isRecurring?(c(),Y(u,{key:2,class:"timeline-icon",onClick:e.openTimelineModal},{default:n(()=>[r(e.View)]),_:1})):l("v-if",!0)])])]),_:1})]),_:1})]),l(" Description Section "),i.workOrder.description?(c(),g("div",ec,[r(O,{column:1,class:"general-details-descriptions"},{default:n(()=>[r(P,{label:s.$t("workOrder.table.description")},{default:n(()=>[a("div",tc,[a("p",null,m(i.workOrder.description),1)])]),_:1},8,["label"])]),_:1})])):l("v-if",!0),l(" Related Equipment Section "),(R=i.workOrder.equipment_node_ids)!=null&&R.length?(c(),g("div",ac,[r(E),t[20]||(t[20]=a("h3",{class:"section-title"},"Related Equipment",-1)),e.loadingEquipment?(c(),g("div",rc,[r(T,{rows:2,animated:""})])):e.hasValidEquipment?(c(),g("div",oc,[(c(!0),g(se,null,we(e.validEquipmentList,f=>(c(),Y(le,{key:`equipment-${f.id}-${f.name}`,effect:"light",placement:"top","popper-class":"equipment-tooltip-popper"},{content:n(()=>{var F,U;return[a("div",nc,[f.manufacturer?(c(),g("div",sc,[t[17]||(t[17]=a("strong",null,"Manufacturer:",-1)),x(" "+m(f.manufacturer.name),1)])):l("v-if",!0),(F=f.location)!=null&&F.name?(c(),g("div",lc,[t[18]||(t[18]=a("strong",null,"Location:",-1)),x(" "+m(f.location.name),1)])):l("v-if",!0),f.person_in_charge?(c(),g("div",ic,[t[19]||(t[19]=a("strong",null,"Person in Charge:",-1)),x(" "+m(f.person_in_charge),1)])):l("v-if",!0),!f.manufacturer&&!((U=f.location)!=null&&U.name)&&!f.person_in_charge?(c(),g("div",dc," No additional details available ")):l("v-if",!0)])]}),default:n(()=>{var F;return[a("div",{class:"equipment-card",onClick:U=>e.handleEquipmentClick(f)},[a("div",uc,[(F=f.image_list)!=null&&F.length?(c(),Y(q,{key:0,src:f.image_list[0],fit:"cover",class:"equipment-thumbnail"},{error:n(()=>[a("div",mc,[r(u,null,{default:n(()=>[r(e.Tools)]),_:1})])]),_:2},1032,["src"])):(c(),g("div",fc,[r(u,null,{default:n(()=>[r(e.Tools)]),_:1})]))]),a("div",_c,[a("div",gc,m(f.name||`Equipment ${f.id}`),1),a("div",pc,"Code : "+m(f.code),1)])],8,cc)]}),_:2},1024))),128))])):(c(),g("div",vc,[r(V,{description:"No equipment details available","image-size":60})]))])):l("v-if",!0),l(" Work Order Progress Section "),e.workOrderProgress?(c(),g("div",hc,[r(E),a("div",yc,[t[25]||(t[25]=a("h3",{class:"section-title"},"Task Progress",-1)),a("div",wc,[a("div",kc,[t[21]||(t[21]=a("span",{class:"stat-label"},"Total Tasks:",-1)),a("span",bc,m(e.workOrderProgress.total),1)]),a("div",Sc,[t[22]||(t[22]=a("span",{class:"stat-label"},"Completed:",-1)),a("span",Tc,m(e.workOrderProgress.completed),1)]),a("div",Oc,[t[23]||(t[23]=a("span",{class:"stat-label"},"Failed:",-1)),a("span",Cc,m(e.workOrderProgress.failed),1)]),a("div",Dc,[t[24]||(t[24]=a("span",{class:"stat-label"},"Remaining:",-1)),a("span",Ac,m(e.workOrderProgress.remaining),1)])])]),a("div",Pc,[a("div",Ic,[a("div",Vc,[a("div",{class:"progress-segment completed",style:bt({width:`${e.workOrderProgress.completed/e.workOrderProgress.total*100}%`})},null,4),a("div",{class:"progress-segment failed",style:bt({width:`${e.workOrderProgress.failed/e.workOrderProgress.total*100}%`})},null,4),a("div",{class:"progress-segment remaining",style:bt({width:`${e.workOrderProgress.remaining/e.workOrderProgress.total*100}%`})},null,4)]),a("div",xc,m(e.workOrderProgress.completed)+" of "+m(e.workOrderProgress.total)+" tasks completed ",1)])])])):l("v-if",!0),l(" Attachments Section - Following equipment details pattern "),e.hasAttachments||e.hasFileAttachments?(c(),g("div",Fc,[r(E),l(" Images Section "),e.hasAttachments?(c(),g("div",Ec,[r(O,{column:1},{default:n(()=>[r(P,{label:"Images"},{default:n(()=>[a("div",Lc,[(c(!0),g(se,null,we(i.workOrder.image_list,(f,F)=>(c(),Y(q,{key:F,src:f,"preview-src-list":i.workOrder.image_list,fit:"cover",class:"workorder-image"},{error:n(()=>[a("div",Wc,[r(u,null,{default:n(()=>[r(e.Picture)]),_:1})])]),_:2},1032,["src","preview-src-list"]))),128))])]),_:1})]),_:1})])):l("v-if",!0),l(" Files Section "),e.hasFileAttachments?(c(),g("div",Rc,[r(O,{column:1,direction:"vertical"},{default:n(()=>[r(P,{label:"Files"},{default:n(()=>[a("div",Mc,[(c(!0),g(se,null,we(e.processedFileList,f=>(c(),g("div",{key:f.id||f.name,class:"file-item"},[r(j,{href:f.url,target:"_blank",icon:e.getFileIcon(f.type),class:"file-link"},{default:n(()=>[x(m(f.name),1)]),_:2},1032,["href","icon"])]))),128))])]),_:1})]),_:1})])):l("v-if",!0)])):l("v-if",!0),l(" Schedule Conditions Section "),e.isRecurring?Pt((c(),g("div",qc,[r(E),a("div",zc,[a("h3",Uc,m(s.$t("workOrder.schedule.title")),1),r(p,{type:"default",size:"small",onClick:e.openTimelineModal,title:s.$t("workOrder.schedule.viewTimeline"),class:"timeline-button"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.View)]),_:1}),x(" "+m(s.$t("workOrder.schedule.viewTimeline")),1)]),_:1},8,["title"])],512),l(" Schedule Details "),r(O,{column:4,class:"general-details-descriptions",style:{"margin-left":"4px !important"}},{default:n(()=>[r(P,{label:s.$t("workOrder.schedule.repeatTypeLabel")},{default:n(()=>[a("span",Nc,m(s.$t("workOrder.schedule.timeBased")),1)]),_:1},8,["label"]),r(P,{label:s.$t("workOrder.schedule.frequencyLabel")},{default:n(()=>[a("span",Bc,m(s.$t("workOrder.schedule.weeklyPattern")),1)]),_:1},8,["label"]),r(P,{label:s.$t("workOrder.schedule.continuedFromLabel")},{default:n(()=>[a("span",{class:"detail-value linked-value",onClick:e.navigateToLinkedOrder},"Daily Wash - Washin Washer")]),_:1},8,["label"])]),_:1})],512)),[[qa,!1]]):l("v-if",!0),l(" Time & Cost Tracking Card "),a("div",jc,[l(" Tracking Tabs "),r(ce,{modelValue:e.activeTrackingTab,"onUpdate:modelValue":t[6]||(t[6]=f=>e.activeTrackingTab=f),class:"tracking-tabs"},{default:n(()=>[l(" Tasks Tab "),r(ie,{label:"Tasks",name:"tasks"},{default:n(()=>[a("div",Hc,[a("div",{class:xe(["tasks-container",{"no-tasks":!e.taskEntries.length}])},[l(" Filter Bar "),e.taskEntries.length?(c(),g("div",Jc,[r(pe,{modelValue:e.searchInput,"onUpdate:modelValue":t[2]||(t[2]=f=>e.searchInput=f),placeholder:"Search by task name or code",clearable:"",class:"filter-search",size:"default",onInput:e.handleSearchInput},{prefix:n(()=>[r(u,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"]),r(X,{modelValue:e.taskFilters.state,"onUpdate:modelValue":t[3]||(t[3]=f=>e.taskFilters.state=f),placeholder:"State",clearable:"",class:"filter-select",size:"default"},{default:n(()=>[r(oe,{label:"Not started",value:"Not started"}),r(oe,{label:"In progress",value:"In progress"}),r(oe,{label:"Completed",value:"Completed"}),r(oe,{label:"Failed",value:"Failed"})]),_:1},8,["modelValue"]),r(X,{modelValue:e.taskFilters.assignee,"onUpdate:modelValue":t[4]||(t[4]=f=>e.taskFilters.assignee=f),placeholder:"Personnel",clearable:"",class:"filter-select",size:"default"},{default:n(()=>[(c(!0),g(se,null,we(e.uniqueAssignees,f=>(c(),Y(oe,{key:f,label:f,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(X,{modelValue:e.taskFilters.timeSpent,"onUpdate:modelValue":t[5]||(t[5]=f=>e.taskFilters.timeSpent=f),placeholder:"Time spent",clearable:"",class:"filter-select",size:"default"},{default:n(()=>[r(oe,{label:"Less than 15 min",value:"lt15"}),r(oe,{label:"15 - 30 min",value:"15to30"}),r(oe,{label:"More than 30 min",value:"gt30"})]),_:1},8,["modelValue"])])):l("v-if",!0),l(" Tasks List "),e.filteredTaskEntries.length?(c(),g("div",Yc,[(c(!0),g(se,null,we(e.filteredTaskEntries,(f,F)=>(c(),Y(e.WorkOrderTaskCard,{key:f.id||F,task:f,onPreview:e.handleTaskPreview,class:"task-card"},null,8,["task"]))),128))])):e.taskEntries.length&&!e.filteredTaskEntries.length?(c(),g("div",Gc,[r(V,{description:"No tasks match the filters","image-size":120})])):(c(),g("div",Qc,[r(V,{description:"No Tasks","image-size":120})]))],2)])]),_:1}),l(" Standards Tab "),r(ie,{label:"Standards",name:"standards"},{default:n(()=>{var f,F;return[a("div",Kc,[a("div",{class:xe(["standards-container",{"no-standards":!((f=i.workOrder.standards)!=null&&f.length)}])},[(F=i.workOrder.standards)!=null&&F.length?(c(),g("div",Zc,[(c(!0),g(se,null,we(i.workOrder.standards,U=>(c(),g("div",{key:U.id,class:"standard-item standard-card",onClick:te=>e.handleStandardPreview(U)},[a("div",$c,[a("span",eu,m(U.name),1),a("span",tu,m(U.code),1)]),l('                  <div v-if="standard.description" class="standard-description">{{ standard.description }}</div>'),a("div",au,[U.category?(c(),Y($,{key:0,size:"small",class:"tag-item"},{default:n(()=>[x(m(e.formatCategoryName(U.category)),1)]),_:2},1024)):l("v-if",!0),U.library_instance==!1?(c(),Y($,{key:1,size:"small",type:"success",class:"tag-item"},{default:n(()=>[...t[26]||(t[26]=[x(" Work Order Only ")])]),_:1,__:[26]})):l("v-if",!0)])],8,Xc))),128))])):(c(),g("div",ru,[r(V,{description:"No Standards","image-size":120})]))],2)])]}),_:1}),l(" Costs Tab "),l('        <el-tab-pane label="Costs" name="costs">'),l('          <div class="tab-content">'),l('            <div class="no-data-placeholder">'),l('              <el-empty description="No Cost Data" :image-size="120" />'),l("            </div>"),l("          </div>"),l("        </el-tab-pane>")]),_:1},8,["modelValue"])]),l(" Work Order Timeline Modal "),r(ne,{modelValue:e.timelineModalVisible,"onUpdate:modelValue":t[8]||(t[8]=f=>e.timelineModalVisible=f),title:s.$t("workOrder.timeline.title"),width:"850px","before-close":e.handleTimelineModalClose,top:"10vh",class:"timeline-modal"},{footer:n(()=>[a("span",lu,[r(p,{onClick:t[7]||(t[7]=f=>e.timelineModalVisible=!1),style:{"margin-right":"12px"}},{default:n(()=>[x(m(s.$t("workOrder.actions.cancel")),1)]),_:1}),r(k,{onCommand:e.handleExportFormat,disabled:e.timelineEvents.length===0},{dropdown:n(()=>[r(h,null,{default:n(()=>[r(w,{command:"csv"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.DocumentCopy)]),_:1}),t[27]||(t[27]=x(" Export as CSV "))]),_:1,__:[27]})]),_:1})]),default:n(()=>[r(p,{type:"primary",disabled:e.timelineEvents.length===0},{default:n(()=>[r(u,{style:{"margin-right":"8px"}},{default:n(()=>[r(e.Download)]),_:1}),x(" "+m(s.$t("workOrder.timeline.export"))+" ",1),r(u,{class:"el-icon--right"},{default:n(()=>[r(e.ArrowDown)]),_:1})]),_:1},8,["disabled"])]),_:1},8,["disabled"])])]),default:n(()=>[e.timelineLoading?(c(),g("div",ou,[r(T,{rows:3,animated:""})])):e.isRecurring?e.timelineEvents.length===0?(c(),g("div",su,[r(V,{description:"No recurring work orders found","image-size":80})])):(c(),Y(e.Timeline,{key:3,"timeline-events":e.timelineEvents,"current-work-order-id":i.workOrder.id},null,8,["timeline-events","current-work-order-id"])):(c(),g("div",nu,[r(V,{description:"This work order does not have recurring instances","image-size":80})]))]),_:1},8,["modelValue","title"]),l(" Delete Confirmation Modal for Recurring Work Orders "),r(ne,{modelValue:e.deleteDialogVisible,"onUpdate:modelValue":t[12]||(t[12]=f=>e.deleteDialogVisible=f),title:"Delete Work Order",width:"480px","before-close":()=>e.deleteDialogVisible=!1,class:"delete-dialog"},{footer:n(()=>[a("div",du,[r(p,{onClick:t[9]||(t[9]=f=>e.deleteDialogVisible=!1),disabled:e.deleting},{default:n(()=>t[29]||(t[29]=[x(" Cancel ")])),_:1,__:[29]},8,["disabled"]),r(p,{type:"warning",onClick:t[10]||(t[10]=f=>e.handleDeleteConfirmation("individual")),loading:e.deleting},{default:n(()=>[r(u,null,{default:n(()=>[r(e.DocumentDelete)]),_:1}),t[30]||(t[30]=x(" Individual "))]),_:1,__:[30]},8,["loading"]),r(p,{type:"danger",onClick:t[11]||(t[11]=f=>e.handleDeleteConfirmation("recurrence")),loading:e.deleting},{default:n(()=>[r(u,null,{default:n(()=>[r(e.DocumentDelete)]),_:1}),t[31]||(t[31]=x(" Recurrence "))]),_:1,__:[31]},8,["loading"])])]),default:n(()=>[a("div",iu,[r(u,{class:"warning-icon"},{default:n(()=>[r(e.Warning)]),_:1}),t[28]||(t[28]=a("div",{class:"delete-message"},[a("h4",null,"This is a recurring work order"),a("p",null,"Choose which work orders you want to delete:")],-1))])]),_:1},8,["modelValue","before-close"])])):l("v-if",!0),l(" Task Preview Dialog "),r(ne,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[14]||(t[14]=f=>e.showTaskPreviewDialog=f),title:`Task Details: ${((fe=e.selectedTaskForPreview)==null?void 0:fe.task_name)||((K=e.selectedTaskForPreview)==null?void 0:K.name)||((_=e.selectedTaskForPreview)==null?void 0:_.taskListText)||"Task"}`,width:"750px","before-close":e.handleTaskPreviewClose,class:"task-preview-modal",top:"10vh",style:{height:"75vh"}},{footer:n(()=>[a("div",cu,[r(p,{onClick:e.handleTaskPreviewClose},{default:n(()=>t[32]||(t[32]=[x("Close")])),_:1,__:[32]})])]),default:n(()=>[r(ce,{modelValue:e.activeTaskPreviewTab,"onUpdate:modelValue":t[13]||(t[13]=f=>e.activeTaskPreviewTab=f),class:"task-preview-tabs"},{default:n(()=>[l(" Logs Tab "),r(ie,{label:"Logs",name:"logs"},{default:n(()=>{var f;return[e.showTaskPreviewDialog&&((f=e.selectedTaskForPreview)!=null&&f.id)?(c(),Y(e.TaskLogsView,{key:0,"task-entry-id":e.selectedTaskForPreview.id,task:e.selectedTaskForPreview},null,8,["task-entry-id","task"])):l("v-if",!0)]}),_:1}),l(" Steps Tab "),r(ie,{label:"Steps",name:"steps"},{default:n(()=>{var f;return[e.showTaskPreviewDialog?(c(),Y(e.StepsPreview,{key:e.selectedTaskTemplateId||((f=e.selectedTaskForPreview)==null?void 0:f.id)||"task-preview","template-id":e.selectedTaskTemplateId,steps:e.selectedTaskSteps,interactive:!1,"show-mode-switch":!1,style:{height:"53vh !important","overflow-y":"auto"}},null,8,["template-id","steps"])):l("v-if",!0)]}),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),l(" Standard Preview Dialog "),r(ne,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[16]||(t[16]=f=>e.showStandardPreviewDialog=f),title:`Preview: ${((de=e.previewStandardData)==null?void 0:de.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:n(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(c(),Y(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(c(),g(se,{key:1},[l(" Standalone Standard Preview "),a("div",uu,[a("div",mu,[l(" Fixed Header Section "),a("div",fu,[a("div",_u,[r(ce,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[15]||(t[15]=f=>e.standalonePreviewTab=f),class:"details-tabs"},{default:n(()=>[r(ie,{label:"General",name:"general"}),r(ie,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),l(" Scrollable Content Area "),a("div",gu,[a("div",pu,[l(" General Tab Content "),e.standalonePreviewTab==="general"?(c(),g("div",vu,[a("div",hu,[a("div",yu,[r(O,{column:2,direction:"vertical"},{default:n(()=>[r(P,{width:"50%",label:"Category"},{default:n(()=>[x(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r(P,{width:"50%",label:"Total Rules"},{default:n(()=>{var f;return[a("span",wu,m(((f=e.previewStandardData.items)==null?void 0:f.length)||0)+" rules",1)]}),_:1}),r(P,{width:"50%",label:"Type"},{default:n(()=>[r($,{type:"primary",size:"small"},{default:n(()=>t[33]||(t[33]=[x("Work Order Only")])),_:1,__:[33]})]),_:1})]),_:1})])]),e.previewStandardData.description?(c(),g("div",ku,[t[34]||(t[34]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",bu,[a("div",Su,m(e.previewStandardData.description),1)])])):l("v-if",!0)])):l("v-if",!0),l(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(c(),g("div",Tu,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(c(),g("div",Ou,[a("div",Cu,[t[36]||(t[36]=a("h3",{class:"card-title"},"Standard Rules",-1)),r($,{type:"warning",size:"small"},{default:n(()=>t[35]||(t[35]=[x("Read Only")])),_:1,__:[35]})]),a("div",Du,[(c(!0),g(se,null,we(e.previewStandardData.items,(f,F)=>(c(),g("div",{key:F,class:"rule-item"},[a("div",Au,m(F+1),1),a("div",Pu,[a("div",Iu,m(f),1)])]))),128))])])):(c(),g("div",Vu,[r(V,{description:"No standard rules defined yet","image-size":60})]))])):l("v-if",!0)])])])])],2112)):l("v-if",!0)]),_:1},8,["modelValue","title"]),l(" Empty State "),i.workOrder?l("v-if",!0):(c(),g("div",xu,[r(V,{description:s.$t("workOrder.selectWorkOrder"),"image-size":120},null,8,["description"])]))],64)}const Eu=Re(Ad,[["render",Fu],["__scopeId","data-v-54c8f79c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderDetail.vue"]]),Lu=Ce({name:"AddTask"}),Wu=Object.assign(Lu,{props:{originPanel:{type:String,default:"create"},originWorkOrderId:{type:[Number,String],default:null}},emits:["close","addTemplates"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=yt(),d=At(),u=It(),p=S([]),w=S(!1),h=S(""),k=S(0),C=S(1),P=S(20),O=S(new Set),E=S(!1),T=S(null),q=S(!1),le=S(null),V=S(!1),j=M(()=>p.value.filter(N=>O.value.has(N.id||N._id))),pe=M(()=>{const N=k.value===0?0:(C.value-1)*P.value+1,ee=Math.min(C.value*P.value,k.value);return{start:N,end:ee,total:k.value}}),oe=async(N=!1)=>{var ee,G,re,Se;N&&(C.value=1),w.value=!0;try{const De={};(ee=h.value)!=null&&ee.trim()&&(De.keyword=h.value.trim());const Pe=await Jr(C.value,P.value,"createdAt","DESC",De),Ae=((G=Pe.data)==null?void 0:G.content)||Pe.data||[];p.value=Array.isArray(Ae)?Ae:[],k.value=((re=Pe.data)==null?void 0:re.totalElements)||((Se=Pe.data)==null?void 0:Se.total)||Pe.totalElements||Pe.total||p.value.length}catch(De){console.error("Error fetching task templates:",De),B.error("Failed to load task templates"),p.value=[],k.value=0}finally{w.value=!1}},X=N=>{C.value=N,oe()},ie=N=>{P.value=N,C.value=1,oe()},$=N=>{const{id:ee,action:G}=N;G==="check"?O.value.add(ee):G==="uncheck"?O.value.delete(ee):G==="focus"&&(T.value=ee)},ce=(N,ee)=>({...N,...ee,steps:Array.isArray(ee==null?void 0:ee.steps)&&ee.steps.length>0?ee.steps:(N==null?void 0:N.steps)||[]}),ne=async N=>{if(Array.isArray(N==null?void 0:N.steps)&&N.steps.length>0)return N;try{const ee=N.id||N._id||N.template_id;if(!ee)throw new Error("Template is missing an identifier");const G=await tr(ee),re=(G==null?void 0:G.data)??G;if(!re)throw new Error("Missing template detail payload");return ce(N,re)}catch(ee){return console.error("Failed to fetch template details:",ee),B.error(`Unable to load steps for template "${(N==null?void 0:N.name)||"Unnamed Template"}"`),null}},R=async()=>{if(!(O.value.size===0||E.value)){E.value=!0;try{const ee=(await Promise.all(j.value.map(G=>ne(G)))).filter(Boolean);if(ee.length===0)return;y("addTemplates",ee),O.value.clear(),y("close")}finally{E.value=!1}}},fe=()=>{if(!T.value){B.warning("Please select a task template to preview");return}le.value=T.value,q.value=!0},K=()=>{q.value=!1,le.value=null},_=()=>{K()},de=()=>{if(!le.value)return"Template";const N=p.value.find(ee=>(ee.id||ee._id||ee.template_id)===le.value);return(N==null?void 0:N.name)||"Template"},f=()=>{const N=d.fullPath||"/work-order/table";u.setReturnRoute(N);const ee=e.originPanel==="edit"?"edit":"create";u.setReturnPanel(ee),ee==="edit"?(u.setReturnWorkOrderId(e.originWorkOrderId??null),u.setShouldOpenCreatePanel(!1)):(u.setReturnWorkOrderId(null),u.setShouldOpenCreatePanel(!0));const G={fromWorkOrder:"true",returnRoute:N,returnPanel:ee};ee==="edit"&&e.originWorkOrderId&&(G.returnWorkOrderId=String(e.originWorkOrderId)),v.push({name:"TaskDesigner",query:G}),y("close")},F=Wa(()=>{oe(!0)},300),U=()=>{O.value.clear(),T.value=null,F()};ye(h,()=>{var N;(N=h.value)!=null&&N.trim()||(O.value.clear(),T.value=null,oe(!0))}),He(()=>{oe()});const te={props:e,emit:y,router:v,route:d,workOrderDraftStore:u,taskTemplates:p,loading:w,searchQuery:h,totalItems:k,currentPage:C,pageSize:P,selectedTemplates:O,isAddingTemplates:E,focusedCardId:T,showPreviewDialog:q,previewTemplateId:le,isInteractive:V,selectedTemplatesList:j,paginationInfo:pe,fetchTaskTemplates:oe,handlePageChange:X,handlePageSizeChange:ie,handleTaskAction:$,mergeTemplateData:ce,ensureTemplateSteps:ne,handleAddTemplates:R,handlePreview:fe,handleBackToAddTask:K,handleClosePreview:_,getPreviewTemplateTitle:de,handleNewTask:f,debouncedSearch:F,handleSearch:U,__MACROS_defineComponent:Ce,ref:S,computed:M,onMounted:He,watch:ye,get Search(){return qt},get ArrowLeft(){return ea},get ElMessage(){return B},CardTable:Do,StepsPreview:ga,get searchTaskTemplates(){return Jr},get getTaskTemplateById(){return tr},get debounce(){return Wa},get useRouter(){return yt},get useRoute(){return At},get useWorkOrderDraftStore(){return It}};return Object.defineProperty(te,"__isScriptSetup",{enumerable:!1,value:!0}),te}}),Ru={class:"task-dialog-container"},Mu={key:0,class:"task-dialog-content"},qu={class:"search-container"},zu={class:"content-area"},Uu={key:0,class:"loading-container"},Nu={key:1,class:"empty-container"},Bu={key:2},ju={class:"pagination-info"},Hu={class:"info-text"},Ju={class:"task-dialog-footer"},Yu={class:"footer-actions"},Gu={class:"preview-dialog-header"},Qu=["id"];function Ku(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-input"),p=D("el-link"),w=D("el-skeleton"),h=D("el-empty"),k=D("el-option"),C=D("el-select"),P=D("el-button"),O=D("el-switch"),E=D("el-tooltip"),T=D("el-dialog");return c(),g("div",Ru,[l(" Main Add Task Content "),e.showPreviewDialog?l("v-if",!0):(c(),g("div",Mu,[l(" Search Container (always visible) "),a("div",qu,[r(u,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=q=>e.searchQuery=q),placeholder:"Search task templates...",size:"default",clearable:"",class:"search-input",onInput:e.handleSearch,onClear:e.handleSearch},{prefix:n(()=>[r(d,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"]),r(p,{type:"primary",onClick:e.handleNewTask,class:"new-task-link"},{default:n(()=>t[4]||(t[4]=[x(" + New Task ")])),_:1,__:[4]})]),l(" Content Area "),a("div",zu,[e.loading?(c(),g("div",Uu,[r(w,{rows:4,animated:""})])):e.taskTemplates.length===0?(c(),g("div",Nu,[r(h,{description:"No task templates found","image-size":80})])):(c(),g("div",Bu,[l(" Pagination Info "),a("div",ju,[a("div",Hu," Showing "+m(e.paginationInfo.start)+"-"+m(e.paginationInfo.end)+" of "+m(e.paginationInfo.total)+" templates ",1),r(C,{modelValue:e.pageSize,"onUpdate:modelValue":t[1]||(t[1]=q=>e.pageSize=q),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:n(()=>[r(k,{label:"10",value:10}),r(k,{label:"20",value:20}),r(k,{label:"50",value:50})]),_:1},8,["modelValue"])]),r(e.CardTable,{module:5,data:e.taskTemplates,maxHeight:"60vh",totalItems:e.totalItems,currentPage:e.currentPage,pageSize:e.pageSize,showBorder:!0,showPagination:!0,showSearch:!1,loading:e.loading,focusedCardId:e.focusedCardId,selectedItems:e.selectedTemplates,onSelection:e.handleTaskAction,onPageChange:e.handlePageChange},null,8,["data","totalItems","currentPage","pageSize","loading","focusedCardId","selectedItems"])]))])])),l(" Footer Actions "),a("div",Ju,[a("div",Yu,[r(P,{type:e.focusedCardId?"success":"",disabled:!e.focusedCardId,onClick:e.handlePreview},{default:n(()=>t[5]||(t[5]=[x(" Preview ")])),_:1,__:[5]},8,["type","disabled"]),r(P,{type:"primary",disabled:e.selectedTemplates.size===0||e.isAddingTemplates,loading:e.isAddingTemplates,onClick:e.handleAddTemplates},{default:n(()=>[x(" Add Templates ("+m(e.selectedTemplates.size)+") ",1)]),_:1},8,["disabled","loading"])])]),l(" Preview Dialog "),r(T,{modelValue:e.showPreviewDialog,"onUpdate:modelValue":t[3]||(t[3]=q=>e.showPreviewDialog=q),width:"700px",top:"5vh","before-close":e.handleClosePreview,class:"preview-dialog"},{header:n(({titleId:q})=>[a("div",Gu,[r(P,{type:"text",onClick:e.handleBackToAddTask,class:"back-button"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:q,class:"dialog-title"}," Preview: "+m(e.getPreviewTemplateTitle()),9,Qu),r(E,{content:"Interactive Mode",placement:"top"},{default:n(()=>[r(O,{modelValue:e.isInteractive,"onUpdate:modelValue":t[2]||(t[2]=le=>e.isInteractive=le)},null,8,["modelValue"])]),_:1})])]),default:n(()=>[e.previewTemplateId?(c(),Y(e.StepsPreview,{key:0,"template-id":e.previewTemplateId,interactive:e.isInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):l("v-if",!0)]),_:1},8,["modelValue"])])}const Ro=Re(Wu,[["render",Ku],["__scopeId","data-v-b224efd8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Task/AddTask.vue"]]),Zu=Ce({name:"AddStandard"}),Xu=Object.assign(Zu,{emits:["close","addStandards"],setup(s,{expose:t,emit:i}){t();const e=i,y=S([]),v=S(!1),d=S(""),u=S(0),p=S(1),w=S(20),h=S(new Set),k=S(null),C=S(!1),P=S(null),O=S(!1),E=S({name:"",description:"",category:"",items:[]}),T=S(!1),q=M(()=>y.value.filter(N=>h.value.has(N.id||N._id))),le=M(()=>{const N=u.value===0?0:(p.value-1)*w.value+1,ee=Math.min(p.value*w.value,u.value);return{start:N,end:ee,total:u.value}}),V=async(N=!1)=>{var ee,G,re,Se;N&&(p.value=1),v.value=!0;try{const De={};(ee=d.value)!=null&&ee.trim()&&(De.keyword=d.value.trim());const Pe={page:p.value,size:w.value,sortField:"createdAt",direction:"DESC"},Ae=await Yr(De,Pe),ve=((G=Ae.data)==null?void 0:G.content)||Ae.data||[];y.value=Array.isArray(ve)?ve:[],u.value=((re=Ae.data)==null?void 0:re.totalElements)||((Se=Ae.data)==null?void 0:Se.total)||Ae.totalElements||Ae.total||y.value.length}catch(De){console.error("Error fetching standards:",De),B.error("Failed to load standards"),y.value=[],u.value=0}finally{v.value=!1}},j=N=>{p.value=N,V()},pe=N=>{w.value=N,p.value=1,V()},oe=N=>{const{id:ee,action:G}=N;G==="check"?h.value.add(ee):G==="uncheck"?h.value.delete(ee):G==="focus"&&(k.value=ee)},X=()=>{h.value.size>0&&(e("addStandards",q.value),h.value.clear(),e("close"))},ie=()=>{if(!k.value){B.warning("Please select a standard to preview");return}P.value=k.value,C.value=!0},$=()=>{C.value=!1,P.value=null},ce=()=>{$()},ne=()=>{if(!P.value)return"Standard";const N=y.value.find(ee=>(ee.id||ee._id||ee.standard_id)===P.value);return(N==null?void 0:N.name)||"Standard"},R=Wa(()=>{V(!0)},300),fe=()=>{h.value.clear(),k.value=null,R()},K=()=>{E.value={name:"",description:"",category:"",items:[]},O.value=!0},_=()=>{O.value=!1,E.value={name:"",description:"",category:"",items:[]}},de=async N=>{console.log("AddStandard received formData:",N),O.value=!1,await f(N)},f=async N=>{try{await lt.confirm("Do you want to save this as a standard template or only for this work order?","Save Standard",{confirmButtonText:"Save as Template",cancelButtonText:"Save Only for Work Order",distinguishCancelAndClose:!0,type:"info"}),await F(N)}catch(ee){ee==="cancel"&&U(N)}},F=async N=>{var ee,G;try{T.value=!0;const re={...N,module:200},Se=await Gr(re);B.success("Standard created successfully"),await V(!0);const De=((ee=Se.data)==null?void 0:ee.id)||((G=Se.data)==null?void 0:G._id);De&&(h.value.add(De),k.value=De)}catch(re){console.error("Failed to create standard:",re),B.error("Failed to create standard")}finally{T.value=!1}},U=N=>{console.log("createStandardForm.value:",N);const ee={id:`work-order-standard-${Date.now()}`,name:N.name,description:N.description,category:N.category,items:N.items,estimated_minutes:15,isStandalone:!0};console.log("standaloneStandard:",ee),e("addStandards",[ee]),B.success("Standard added to work order"),e("close")};ye(d,()=>{var N;(N=d.value)!=null&&N.trim()||(h.value.clear(),k.value=null,V(!0))}),He(()=>{V()});const te={emit:e,standardTemplates:y,loading:v,searchQuery:d,totalItems:u,currentPage:p,pageSize:w,selectedStandards:h,focusedCardId:k,showPreviewDialog:C,previewStandardId:P,showCreateStandardDialog:O,createStandardForm:E,createStandardLoading:T,selectedStandardsList:q,paginationInfo:le,fetchStandards:V,handlePageChange:j,handlePageSizeChange:pe,handleStandardAction:oe,handleAddStandards:X,handlePreview:ie,handleBackToAddStandard:$,handleClosePreview:ce,getPreviewStandardTitle:ne,debouncedSearch:R,handleSearch:fe,handleCreateNewStandard:K,handleCreateStandardCancel:_,handleCreateStandardSubmit:de,promptStandardSaveMode:f,handleSaveAsTemplate:F,handleSaveForWorkOrderOnly:U,__MACROS_defineComponent:Ce,ref:S,computed:M,onMounted:He,watch:ye,get Search(){return qt},get ArrowLeft(){return ea},get ElMessage(){return B},get ElMessageBox(){return lt},CardTable:Do,StandardsPreview:za,CreateStandardDialog:Io,get searchStandards(){return Yr},get createStandard(){return Gr},get debounce(){return Wa}};return Object.defineProperty(te,"__isScriptSetup",{enumerable:!1,value:!0}),te}}),$u={class:"standard-dialog-container"},em={key:0,class:"standard-dialog-content"},tm={class:"search-container"},am={class:"content-area"},rm={key:0,class:"loading-container"},om={key:1,class:"empty-container"},nm={key:2},sm={class:"pagination-info"},lm={class:"info-text"},im={class:"standard-dialog-footer"},dm={class:"footer-actions"},cm={class:"preview-dialog-header"},um=["id"];function mm(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-input"),p=D("el-link"),w=D("el-skeleton"),h=D("el-empty"),k=D("el-option"),C=D("el-select"),P=D("el-button"),O=D("el-dialog");return c(),g("div",$u,[l(" Main Add Standard Content "),e.showPreviewDialog?l("v-if",!0):(c(),g("div",em,[l(" Search Container (always visible) "),a("div",tm,[r(u,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=E=>e.searchQuery=E),placeholder:"Search standards...",size:"default",clearable:"",class:"search-input",onInput:e.handleSearch,onClear:e.handleSearch},{prefix:n(()=>[r(d,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"]),r(p,{type:"primary",onClick:e.handleCreateNewStandard,class:"new-standard-link"},{default:n(()=>t[3]||(t[3]=[x(" + New Standard ")])),_:1,__:[3]})]),l(" Content Area "),a("div",am,[e.loading?(c(),g("div",rm,[r(w,{rows:4,animated:""})])):e.standardTemplates.length===0?(c(),g("div",om,[r(h,{description:"No standards found","image-size":80})])):(c(),g("div",nm,[l(" Pagination Info "),a("div",sm,[a("div",lm," Showing "+m(e.paginationInfo.start)+"-"+m(e.paginationInfo.end)+" of "+m(e.paginationInfo.total)+" standards ",1),r(C,{modelValue:e.pageSize,"onUpdate:modelValue":t[1]||(t[1]=E=>e.pageSize=E),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:n(()=>[r(k,{label:"10",value:10}),r(k,{label:"20",value:20}),r(k,{label:"50",value:50})]),_:1},8,["modelValue"])]),r(e.CardTable,{module:7,data:e.standardTemplates,maxHeight:"60vh",totalItems:e.totalItems,currentPage:e.currentPage,pageSize:e.pageSize,showBorder:!0,showPagination:!0,showSearch:!1,loading:e.loading,focusedCardId:e.focusedCardId,selectedItems:e.selectedStandards,onSelection:e.handleStandardAction,onPageChange:e.handlePageChange},null,8,["data","totalItems","currentPage","pageSize","loading","focusedCardId","selectedItems"])]))])])),l(" Footer Actions "),a("div",im,[a("div",dm,[r(P,{type:e.focusedCardId?"success":"",disabled:!e.focusedCardId,onClick:e.handlePreview},{default:n(()=>t[4]||(t[4]=[x(" Preview ")])),_:1,__:[4]},8,["type","disabled"]),r(P,{type:"primary",disabled:e.selectedStandards.size===0,onClick:e.handleAddStandards},{default:n(()=>[x(" Add Standards ("+m(e.selectedStandards.size)+") ",1)]),_:1},8,["disabled"])])]),l(" Preview Dialog "),r(O,{modelValue:e.showPreviewDialog,"onUpdate:modelValue":t[2]||(t[2]=E=>e.showPreviewDialog=E),width:"700px",top:"5vh","before-close":e.handleClosePreview,class:"preview-dialog"},{header:n(({titleId:E})=>[a("div",cm,[r(P,{type:"text",onClick:e.handleBackToAddStandard,class:"back-button"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:E,class:"dialog-title"}," Preview: "+m(e.getPreviewStandardTitle()),9,um)])]),default:n(()=>[e.previewStandardId?(c(),Y(e.StandardsPreview,{key:0,"standard-id":e.previewStandardId},null,8,["standard-id"])):l("v-if",!0)]),_:1},8,["modelValue"]),l(" Create Standard Dialog "),r(e.CreateStandardDialog,{visible:e.showCreateStandardDialog,"is-edit-mode":!1,"initial-data":e.createStandardForm,loading:e.createStandardLoading,onClose:e.handleCreateStandardCancel,onSubmit:e.handleCreateStandardSubmit},null,8,["visible","initial-data","loading"])])}const Mo=Re(Xu,[["render",mm],["__scopeId","data-v-2d1f5292"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Standard/AddStandard.vue"]]),fm=Ce({name:"JsonTreeItem"}),_m=Object.assign(fm,{props:{nodeKey:{type:[String,Number],required:!0},value:{required:!0},level:{type:Number,default:0},searchTerm:{type:String,default:""},forceExpand:{type:Boolean,default:!1},forceCollapse:{type:Boolean,default:!1}},emits:["reset-force-states"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=S(!1),d=M(()=>e.value!==null&&typeof e.value=="object"&&!Array.isArray(e.value)),u=M(()=>Array.isArray(e.value)),p=M(()=>!d.value&&!u.value),w=M(()=>e.value===null?"null":u.value?`array[${e.value.length}]`:d.value?`object{${Object.keys(e.value).length}}`:typeof e.value),h=M(()=>e.value===null?"null":typeof e.value=="string"?`"${e.value}"`:typeof e.value=="boolean"?e.value.toString():e.value),k=M(()=>{if(!e.searchTerm)return!0;const q=e.searchTerm.toLowerCase(),le=String(e.nodeKey).toLowerCase().includes(q);if(p.value){const V=String(e.value).toLowerCase();return le||V.includes(q)}return le}),C=M(()=>{if(!e.searchTerm||p.value)return!1;const q=(le,V)=>{if(typeof le=="object"&&le!==null){for(const[j,pe]of Object.entries(le))if(String(j).toLowerCase().includes(V)||String(pe).toLowerCase().includes(V)||typeof pe=="object"&&q(pe,V))return!0}return!1};return q(e.value,e.searchTerm.toLowerCase())}),P=M(()=>!e.searchTerm||k.value||C.value),O=M(()=>e.searchTerm&&C.value);ye(()=>e.forceExpand,q=>{q&&!p.value&&(v.value=!0,y("reset-force-states"))}),ye(()=>e.forceCollapse,q=>{q&&!p.value&&(v.value=!1,y("reset-force-states"))}),ye(O,q=>{q&&!p.value&&(v.value=!0)});const T={props:e,emit:y,expanded:v,isObject:d,isArray:u,isLeaf:p,nodeType:w,displayValue:h,matchesSearch:k,hasMatchingChildren:C,isVisible:P,shouldAutoExpand:O,toggleExpanded:()=>{p.value||(v.value=!v.value)},__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,get ArrowRight(){return nr}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),gm={class:"item-key"},pm={key:1,class:"item-value"},vm={key:0,class:"item-children"};function hm(s,t,i,e,y,v){const d=D("el-icon"),u=D("JsonTreeItem",!0);return Pt((c(),g("div",{class:xe(["json-tree-item",{"search-highlight":e.matchesSearch&&i.searchTerm}]),style:bt({paddingLeft:i.level*16+"px"})},[a("div",{class:xe(["item-header",{"is-leaf":e.isLeaf,clickable:!e.isLeaf}]),onClick:e.toggleExpanded},[e.isLeaf?l("v-if",!0):(c(),Y(d,{key:0,class:xe(["expand-icon",{expanded:e.expanded}])},{default:n(()=>[r(e.ArrowRight)]),_:1},8,["class"])),a("span",gm,m(i.nodeKey)+":",1),a("span",{class:xe(["item-type",e.nodeType])},m(e.nodeType),3),e.isLeaf?(c(),g("span",pm,m(e.displayValue),1)):l("v-if",!0)],2),e.expanded&&!e.isLeaf?(c(),g("div",vm,[(c(!0),g(se,null,we(i.value,(p,w)=>(c(),Y(u,{key:w,"node-key":w,value:p,level:i.level+1,"search-term":i.searchTerm,"force-expand":i.forceExpand,"force-collapse":i.forceCollapse,onResetForceStates:t[0]||(t[0]=h=>e.emit("reset-force-states"))},null,8,["node-key","value","level","search-term","force-expand","force-collapse"]))),128))])):l("v-if",!0)],6)),[[qa,e.isVisible]])}const ym=Re(_m,[["render",hm],["__scopeId","data-v-ee860f8f"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/utils/logs/components/JsonTreeItem.vue"]]),wm=Ce({name:"JsonDebugDrawer"}),km=Object.assign(wm,{props:{modelValue:{type:Boolean,default:!1},payloadData:{type:Object,default:null},title:{type:String,default:"Request Payload"},subtitle:{type:String,default:"Click refresh to update"}},emits:["update:modelValue"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=M({get:()=>e.modelValue,set:oe=>y("update:modelValue",oe)}),d=S(""),u=S(!1),p=S(!1),w=S(!1),h=S(500),k=S(500),C=M(()=>`${k.value}px`),P=(oe,X)=>{let ie;return function(...ce){const ne=()=>{clearTimeout(ie),oe(...ce)};clearTimeout(ie),ie=setTimeout(ne,X)}},O=P(oe=>{let X=oe;X<300&&(X=300),X>1200&&(X=1200),k.value=X,X!==oe&&(h.value=X)},300);ye(h,oe=>{oe&&typeof oe=="number"&&O(oe)});const E=()=>{O(h.value)},T=()=>{v.value=!1},q=S(!0);ye(v,(oe,X)=>{oe!==X&&(q.value=!1,setTimeout(()=>{q.value=!0},150))});const pe={props:e,emit:y,visible:v,searchTerm:d,forceExpandAll:u,forceCollapseAll:p,isAllExpanded:w,drawerWidth:h,actualDrawerWidth:k,drawerSize:C,debounce:P,debouncedWidthUpdate:O,updateDrawerWidth:E,closeDrawer:T,isDrawerStable:q,copyToClipboard:async()=>{try{const oe=JSON.stringify(e.payloadData,null,2);await navigator.clipboard.writeText(oe),B.success("Payload copied to clipboard!")}catch(oe){console.error("Failed to copy to clipboard:",oe),B.error("Failed to copy to clipboard")}},toggleExpandCollapse:()=>{w.value?(u.value=!1,p.value=!0,w.value=!1):(p.value=!1,u.value=!0,w.value=!0),setTimeout(()=>{u.value=!1,p.value=!1},100)},resetForceStates:()=>{u.value=!1,p.value=!1},__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,get ElMessage(){return B},get Close(){return cn},get DocumentCopy(){return ko},get Search(){return qt},get Plus(){return Ra},get Minus(){return dn},JsonTreeItem:ym};return Object.defineProperty(pe,"__isScriptSetup",{enumerable:!1,value:!0}),pe}}),bm={class:"drawer-header"},Sm={class:"drawer-actions"},Tm={class:"width-control"},Om={class:"drawer-content"},Cm={class:"payload-info"},Dm={key:0,class:"controls-bar"},Am={class:"search-container"},Pm={class:"control-buttons"},Im={class:"json-tree-container"},Vm={key:0,class:"json-tree"},xm={key:1,class:"loading-tree"},Fm={key:2,class:"no-payload"};function Em(s,t,i,e,y,v){const d=D("el-text"),u=D("el-input"),p=D("el-button"),w=D("el-drawer");return c(),g("div",null,[l(" JSON Payload Drawer "),r(w,{modelValue:e.visible,"onUpdate:modelValue":t[2]||(t[2]=h=>e.visible=h),direction:"ltr",modal:!1,"show-close":!1,"lock-scroll":!1,"close-on-click-modal":!1,"append-to-body":!0,size:e.drawerSize,class:"json-payload-drawer","z-index":99999},{header:n(()=>[a("div",bm,[a("h3",null,m(i.title),1),a("div",Sm,[a("div",Tm,[r(d,{size:"small"},{default:n(()=>t[3]||(t[3]=[x("Width:")])),_:1,__:[3]}),r(u,{modelValue:e.drawerWidth,"onUpdate:modelValue":t[0]||(t[0]=h=>e.drawerWidth=h),modelModifiers:{number:!0},size:"small",type:"number",min:300,max:1200,style:{width:"80px"},onChange:e.updateDrawerWidth},null,8,["modelValue"]),r(d,{size:"small"},{default:n(()=>t[4]||(t[4]=[x("px")])),_:1,__:[4]})]),r(p,{size:"small",onClick:e.copyToClipboard,icon:e.DocumentCopy},{default:n(()=>t[5]||(t[5]=[x(" Copy ")])),_:1,__:[5]},8,["icon"]),r(p,{size:"small",onClick:e.closeDrawer,icon:e.Close},{default:n(()=>t[6]||(t[6]=[x(" Close ")])),_:1,__:[6]},8,["icon"])])])]),default:n(()=>[a("div",Om,[a("div",Cm,[r(d,{type:"info",size:"small"},{default:n(()=>[x(" Fields: "+m(i.payloadData?Object.keys(i.payloadData).length:0)+" | "+m(i.subtitle),1)]),_:1})]),l(" Search and Controls Bar "),i.payloadData?(c(),g("div",Dm,[a("div",Am,[r(u,{modelValue:e.searchTerm,"onUpdate:modelValue":t[1]||(t[1]=h=>e.searchTerm=h),placeholder:"Search keys and values...",size:"small",clearable:"","prefix-icon":e.Search,class:"search-input"},null,8,["modelValue","prefix-icon"])]),a("div",Pm,[r(p,{size:"small",onClick:e.toggleExpandCollapse,icon:e.isAllExpanded?e.Minus:e.Plus,type:e.isAllExpanded?"warning":"primary"},{default:n(()=>[x(m(e.isAllExpanded?"Collapse All":"Expand All"),1)]),_:1},8,["icon","type"])])])):l("v-if",!0),a("div",Im,[i.payloadData&&e.isDrawerStable?(c(),g("div",Vm,[(c(!0),g(se,null,we(i.payloadData,(h,k)=>(c(),Y(e.JsonTreeItem,{key:k,"node-key":k,value:h,level:0,"search-term":e.searchTerm,"force-expand":e.forceExpandAll,"force-collapse":e.forceCollapseAll,onResetForceStates:e.resetForceStates},null,8,["node-key","value","search-term","force-expand","force-collapse"]))),128))])):i.payloadData&&!e.isDrawerStable?(c(),g("div",xm,[r(d,{type:"info",size:"small"},{default:n(()=>t[7]||(t[7]=[x("Loading...")])),_:1,__:[7]})])):(c(),g("div",Fm,[r(d,{type:"placeholder"},{default:n(()=>t[8]||(t[8]=[x('Click "Logs" to view payload')])),_:1,__:[8]})]))])])]),_:1},8,["modelValue","size"])])}const cr=Re(km,[["render",Em],["__scopeId","data-v-678a2ab6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/utils/logs/components/JsonDebugDrawer.vue"]]),Xt=()=>{const s=S(null),t=S(!1);return{currentPayload:s,showJsonDisplayer:t,logPayload:(y,v="default",d={})=>{const u=We(y);s.value=u,t.value=!0;const p={timestamp:new Date().toISOString(),context:v,metadata:d,data:u};console.log(`[${v}] Payload Debug:`,p)},closeDebugDrawer:()=>{t.value=!1}}},We=s=>{if(s==null||typeof s!="object")return s;if(s instanceof Date)return new Date(s.getTime());if(Array.isArray(s))return s.map(i=>We(i));const t={};for(const i in s)s.hasOwnProperty(i)&&(t[i]=We(s[i]));return t},ca=(s,t="default")=>{const i=We(s);switch(i._transform={context:t,timestamp:new Date().toISOString(),version:"1.0.0"},t){case"workOrderCreate":i._context="Work Order Creation";break;case"workOrderUpdate":i._context="Work Order Update";break;case"workOrderEdit":i._context="Work Order Edit";break;default:i._context="Generic"}return i},Lm={__name:"EditStandardDialog",props:{visible:{type:Boolean,default:!1},standard:{type:Object,default:()=>({})}},emits:["update:visible","update:standard"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=S(!1),d=()=>{y("update:visible",!1)},p={props:e,emit:y,loading:v,handleClose:d,handleSubmit:async w=>{v.value=!0;try{e.standard.isStandalone?(y("update:standard",{...e.standard,...w,isStandalone:!0}),B.success("Standard updated for this work order.")):(await Qr(e.standard.standardId,w),B.success("Standard template updated successfully."),y("update:standard",{...e.standard,...w})),d()}catch(h){console.error("Failed to update standard:",h),B.error("Failed to update standard.")}finally{v.value=!1}},ref:S,get ElMessage(){return B},CreateStandardDialog:Io,get updateStandard(){return Qr}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}};function Wm(s,t,i,e,y,v){return c(),Y(e.CreateStandardDialog,{visible:i.visible,"is-edit-mode":!0,"initial-data":i.standard,loading:e.loading,onClose:e.handleClose,onSubmit:e.handleSubmit},null,8,["visible","initial-data","loading"])}const qo=Re(Lm,[["render",Wm],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/EditStandardDialog.vue"]]),Rm=Ce({name:"WorkOrderCreate"}),Mm=Object.assign(Rm,{emits:["back-to-detail","work-order-created"],setup(s,{expose:t,emit:i}){const e=S(!1),y=S(!1),v=S(!1),d=S(null),u=S(!1),p=S(null),w=S(""),h=S([]),k=S(!1),C=S(!1),P=S(null),O=S(null),E=S(null),T=S(!1),q=S("general"),{currentPayload:le,showJsonDisplayer:V,logPayload:j,closeDebugDrawer:pe}=Xt(),oe=()=>{y.value=!0},X=()=>{y.value=!1},ie=()=>{e.value=!0},$=()=>{e.value=!1},ce=({id:A,action:ae,data:J})=>{ae==="edit"?Vt(J):ae==="preview"?Fe(J):ae==="delete"&&(W.tasks=W.tasks.filter(ue=>ue.id!==A),Ke(),B.success(`Task "${J.name}" removed`))},ne=({taskId:A,assigneeIds:ae,taskData:J})=>{const ue=W.tasks.findIndex(je=>je.id===A);if(ue===-1){B.error("Task not found");return}W.tasks[ue].assignee_ids=ae,W.tasks[ue].payload&&(W.tasks[ue].payload.assignee_ids=ae),Ke();const Ve=Tt.value.filter(je=>ae.includes(je.id)).map(je=>je.name).join(", "),Ue=ae.length===0?`Removed all assignees from "${J.name}"`:`Updated assignees for "${J.name}": ${Ve}`;B.success(Ue)},R=({taskId:A,taskData:ae,currentAssigneeIds:J})=>{var Ve;p.value=ae,w.value="";const ue=((Ve=ae.payload)==null?void 0:Ve.assignee_ids)||ae.assignee_ids||[];h.value=[...ue],u.value=!0},fe=M(()=>{if(!w.value)return Tt.value;const A=w.value.toLowerCase();return Tt.value.filter(ae=>ae.name.toLowerCase().includes(A)||ae.email&&ae.email.toLowerCase().includes(A))}),K=A=>h.value.includes(A),_=A=>{K(A.id)?f(A.id):de(A.id)},de=A=>{h.value.includes(A)||h.value.push(A)},f=A=>{h.value=h.value.filter(ae=>ae!==A)},F=()=>{h.value=[]},U=()=>h.value.map(A=>Tt.value.find(J=>J.id===A)||{id:A,name:`User #${A}`,email:""}),te=()=>{p.value&&(ne({taskId:p.value.id,assigneeIds:[...h.value],taskData:p.value}),N())},N=()=>{u.value=!1,p.value=null,h.value=[],w.value=""},ee=({id:A,action:ae,data:J})=>{ae==="edit"?(d.value=J,v.value=!0):ae==="preview"?Be(J):ae==="delete"&&(W.standards=W.standards.filter(ue=>ue.id!==A),H(),B.success(`Standard "${J.name}" removed`))},G=A=>{const ae=W.standards.findIndex(J=>J.id===A.id);ae!==-1&&(W.standards.splice(ae,1,A),H())},re=A=>{A()},Se=A=>{if(!A||A.length===0)return;const ae=A.map(J=>Zt(J));W.tasks.push(...ae),Ze(ae),Ke(),B.success(`${A.length} task template${A.length>1?"s":""} added successfully`),$()},De=()=>{if(W.tasks.length===0){B.warning("No tasks selected to delete");return}lt.confirm(`Are you sure you want to clear all ${W.tasks.length} task${W.tasks.length>1?"s":""}?`,"Confirm Clear All Tasks",{confirmButtonText:"Clear All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{W.tasks=[],Ke(),B.success("All task selections cleared")}).catch(()=>{})},Pe=A=>{if(!A||A.length===0)return;const ae=W.standards.length>0?Math.max(...W.standards.map(ue=>typeof ue.id=="number"?ue.id:0)):0,J=A.map((ue,Ve)=>{const Ue=ae+Ve+1;return{...ue,id:Ue,name:ue.name||ue.title,items:ue.items||[],standardId:ue.id||ue._id}});W.standards.push(...J),H(),B.success(`${A.length} standard${A.length>1?"s":""} added successfully`),X()},Ae=()=>{if(W.standards.length===0){B.warning("No standards selected to delete");return}lt.confirm(`Are you sure you want to clear all ${W.standards.length} standard${W.standards.length>1?"s":""}?`,"Confirm Clear All Standards",{confirmButtonText:"Clear All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{W.standards=[],H(),B.success("All standard selections cleared")}).catch(()=>{})},ve=A=>{A()},Fe=A=>{if(A.source==="adhoc"&&A.steps){O.value=A,P.value=null,k.value=!0;return}const ae=A.templateId||A.template_id||A.id;if(!ae){B.warning("Cannot preview this task - no template ID found");return}P.value=ae,O.value=null,k.value=!0},Be=A=>{E.value=A,C.value=!0},et=()=>{k.value=!1,P.value=null,O.value=null},dt=()=>{et()},_t=()=>{if(O.value)return O.value.name||"Task";if(!P.value)return"Task";const A=W.tasks.find(ae=>(ae.templateId||ae.template_id||ae.id)===P.value);return(A==null?void 0:A.name)||"Task"},Vt=async A=>{var ae,J;try{ft.value=!0;const ue=A.templateId||A.template_id,Ve=A.source==="adhoc"&&!ue;if(!ue&&!Ve){B.warning("This task was created specifically for this work order and cannot be edited as a template.");return}B.info("Opening template editor..."),Qe.setReturnRoute(St.fullPath),Qe.setReturnPanel("create"),Qe.setReturnWorkOrderId(null),Qe.setShouldOpenCreatePanel(!0),Ve?await wt.push({name:"TaskDesignerEdit",params:{id:"standalone"},query:{fromWorkOrder:"true",workOrderId:W.name||"New Work Order",workOrderName:W.name||"New Work Order",taskId:A.id,standalone:"true",taskData:JSON.stringify(A),returnPanel:"create"}}):await wt.push({name:"TaskDesignerEdit",params:{id:ue},query:{fromWorkOrder:"true",workOrderId:W.name||"New Work Order",workOrderName:W.name||"New Work Order",taskId:A.id,originalTemplateId:ue,returnPanel:"create"}})}catch(ue){console.error("Failed to open template editor:",ue);const Ve=((J=(ae=ue.response)==null?void 0:ae.data)==null?void 0:J.message)||ue.message||"Failed to open task editor";B.error(Ve)}finally{ft.value=!1}},mt=i,{t:rt}=Ge(),wt=yt(),St=At(),gt=La(),Qe=It(),tt=A=>{const ae=A.template_id||A.id;W.tasks.forEach((J,ue)=>{if(J.source==="template"&&(J.templateId===ae||J.template_id===ae)){const Ve=Zt(A);W.tasks[ue]={...J,...Ve,id:J.id,payload:{...J.payload||{},...Ve.payload}},Ie(W.tasks[ue])}}),Ke(),W.tasks.some(J=>J.templateId===ae||J.template_id===ae)};He(()=>{Qe.setCreateMode(),vt(),pa(),gt.addTemplateUpdateListener(tt)}),Mt(()=>{gt.removeTemplateUpdateListener(tt)});const W=it(Rt());let $e=!1;const Ke=()=>{W.task_list=W.tasks.map(A=>We(A.payload)).filter(A=>A&&Array.isArray(A.steps)&&A.steps.length>0)},H=()=>{W.standard_list=W.standards.map(A=>{const{id:ae,standardId:J,...ue}=A;return A.isStandalone?{...ue,module:200}:{...ue,standard_id:J,module:200}})},Oe=A=>{if(A&&typeof A=="object"){if(Object.prototype.hasOwnProperty.call(A,"name"))return{id:A.id??A.value??null,name:A.name??A.label??""};if(Object.prototype.hasOwnProperty.call(A,"label"))return{id:A.value??null,name:A.label??""}}const ae=typeof A=="number"?A:Number.parseInt(A,10);if(Number.isNaN(ae))return null;const J=kt.value.find(ue=>ue.id===ae);return J?{id:J.id,name:J.name}:null},Ie=A=>{var Ve,Ue;if(!A)return!1;const ae=((Ve=A.payload)==null?void 0:Ve.category_id)??((Ue=A.payload)==null?void 0:Ue.categoryId)??null,J=Oe(A.category??ae);let ue=!1;if(J?((!A.category||A.category.id!==J.id||A.category.name!==J.name)&&(A.category={id:J.id,name:J.name},ue=!0),A.category_name!==J.name&&(A.category_name=J.name,ue=!0),A.payload&&A.payload.category_id!==J.id&&(A.payload.category_id=J.id??null,ue=!0)):typeof A.category=="string"&&A.category_name!==A.category&&(A.category_name=A.category,ue=!0),A.category&&!A.category_name){const je=A.category.name??A.category.label??"";A.category_name!==je&&(A.category_name=je,ue=!0)}return ue},Ze=A=>{if(!Array.isArray(A))return!1;let ae=!1;return A.forEach(J=>{ae=Ie(J)||ae}),ae},vt=()=>{$e=!0;const A=Qe.hasDraft?jr(Qe.draftForm):Rt();Object.assign(W,A),Ze(W.tasks),Ke(),H(),Ne(()=>{$e=!1,Qe.saveContextAwareDraft(W,"create")})};ye(()=>W.tasks,()=>{$e||(Ze(W.tasks),Ke())},{deep:!0}),ye(()=>W.standards,()=>{$e||H()},{deep:!0}),ye(W,()=>{$e||Qe.saveContextAwareDraft(W,"create")},{deep:!0});const I=(A,ae,J)=>{if(!ae){J(new Error("Start date is required"));return}J()},Z=(A,ae,J)=>{if(!ae){J(new Error("Due date is required"));return}const ue=new Date(ae),Ve=W.start_date?new Date(W.start_date):null;if(Ve&&ue<=Ve){J(new Error("Due date must be after start date"));return}const Ue=new Date,je=new Date(Ue.getTime()+2*365*24*60*60*1e3);if(ue>je){J(new Error("Due date cannot be more than 2 years in the future"));return}J()},Q=(A,ae,J)=>{if(!ae){J();return}const ue=W.recurrence_setting;if(!ue||!ue.start_date_time){J();return}if(W.start_date){const Ve=new Date(W.start_date);if(new Date(ue.start_date_time)<Ve){J(new Error("Recurrence start time cannot be before work order start date"));return}}J()},ge=(A,ae,J)=>{if(!ae){J();return}const ue=W.recurrence_setting;if(!ue||!ue.start_date_time){J();return}const Ve=new Date(ue.start_date_time);if(new Date(ue.end_date_time)<=Ve){J(new Error("Recurrence end time must be after recurrence start time"));return}J()},Te=(A,ae,J)=>{if(!ae){J(new Error("Start time is required for recurring work orders"));return}J()},Ee=(A,ae,J)=>{if(!ae){J(new Error("End time is required for recurring work orders"));return}const ue=W.recurrence_setting;if(!ue||!ue.start_time){J();return}const Ve=ue.start_time,Ue=ae;if(!Ve||!Ue){J();return}const je=ra=>{const[oa,jt]=ra.split(":").map(Number);return oa*60+jt},Ot=je(Ve);if(je(Ue)<=Ot){J(new Error("End time must be after start time"));return}J()},qe=it({name:[{required:!0,message:rt("workOrder.validation.taskTitleRequired"),trigger:"blur"}],category_ids:[{required:!0,message:"At least one category is required",trigger:"change"}],equipment_node_ids:[{required:!0,message:"At least one equipment is required",trigger:"change"}],work_type_id:[{required:!0,message:rt("workOrder.validation.workTypeRequired"),trigger:"change"}],priority_id:[{required:!0,message:rt("workOrder.validation.priorityRequired"),trigger:"change"}],start_date:[{required:!0,message:"Start date is required",trigger:"change"},{validator:I,trigger:"change"}],due_date:[{required:!0,message:"Due date is required",trigger:"change"},{validator:Z,trigger:"change"}],"recurrence_setting.start_date_time":[{validator:Q,trigger:"change"}],"recurrence_setting.end_date_time":[{validator:ge,trigger:"change"}],"recurrence_setting.start_time":[{validator:Te,trigger:"change"}],"recurrence_setting.end_time":[{validator:Ee,trigger:"change"}]}),Ye={children:"children",label:"name",value:"id"},ct=S([]),ht=S([]),kt=S([]),Et=S([]),Lt=S([]),ft=S(!1),Tt=S([{id:84,name:"System"},{id:37,name:"Erik Yu"},{id:43,name:"Chang Shi"},{id:45,name:"Maxwell Wang"},{id:46,name:"Justin Li"},{id:47,name:"Justin Tung"},{id:48,name:"Eric Huang"}]),st=S([{id:36,name:"Yao Li"},{id:41,name:"John Li"}]),Xe=S(null),pa=async()=>{var A,ae;try{ft.value=!0;const[J,ue,Ve,Ue,je]=await Promise.all([Ia(),Va(),xa(),Fa(),Ea()]);J.data&&(ht.value=J.data),ue.data&&(ct.value=ue.data),Ve.data&&(kt.value=Ve.data),Ue.data&&(Et.value=Ue.data),je.data&&(Lt.value=je.data),Ze(W.tasks)}catch(J){console.error("WorkOrderCreate: Failed to load form data:",J);const ue=((ae=(A=J.response)==null?void 0:A.data)==null?void 0:ae.message)||J.message||rt("workOrder.messages.loadDataFailed");B.error(ue),(!ht.value.length||!ct.value.length)&&B.warning(rt("workOrder.messages.criticalDataMissing"))}finally{ft.value=!1}},zt=A=>{if(!A)return null;const ae=A.replace(" ","T"),J=new Date(ae);return isNaN(J.getTime())?null:J.toISOString()},Na=A=>{W.image_list=A},Ba=A=>{W.file_list=A},xt=async()=>{try{let A=[],ae=[];return W.image_list.length>0&&(A=(await da(W.image_list)).data.uploadedFiles||[],W.image_list=A.map(ue=>ue.url)),W.file_list.length>0&&(ae=(await da(W.file_list)).data.uploadedFiles||[],W.file_list=ae.map(ue=>ue.url)),{uploadedImages:A,uploadedFiles:ae}}catch(A){throw console.error("File upload failed:",A),new Error("File upload failed")}},Yt=()=>{var A,ae,J,ue,Ve,Ue,je,Ot;return[(A=W.name)==null?void 0:A.trim(),(ae=W.description)==null?void 0:ae.trim(),W.tasks.length,W.standards.length,(J=W.category_ids)==null?void 0:J.length,(ue=W.equipment_node_ids)==null?void 0:ue.length,(Ve=W.assignee_ids)==null?void 0:Ve.length,W.approved_by_id,W.work_type_id,W.priority_id,W.state_id!==1,W.start_date,W.due_date,(Ue=W.vendor_ids)==null?void 0:Ue.length,(je=W.image_list)==null?void 0:je.length,(Ot=W.file_list)==null?void 0:Ot.length].some(Boolean)},ja=()=>{if(!Yt()){mt("back-to-detail");return}lt.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Xe.value&&Xe.value.resetFields(),$e=!0,Object.assign(W,Rt()),Ke(),H(),Qe.clearDraft(),Ne(()=>{$e=!1}),mt("back-to-detail")}).catch(()=>{})},ta=()=>{if(!Yt()){mt("back-to-detail");return}lt.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{Xe.value&&Xe.value.resetFields(),$e=!0,Object.assign(W,Rt()),Ke(),H(),Qe.clearDraft(),Ne(()=>{$e=!1}),mt("back-to-detail")}).catch(()=>{})},aa=()=>{Xe.value&&Xe.value.resetFields(),$e=!0,Object.assign(W,Rt()),Ke(),H(),Qe.clearDraft(),Ne(()=>{$e=!1})},Ha=()=>{lt.confirm("Are you sure you want to reset the form? All unsaved changes will be lost.","Confirm Reset",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}).then(()=>{aa(),B.success(rt("workOrder.messages.formReset"))}).catch(()=>{})};let Ut=null;const Nt=S(!1),va=()=>{if(Nt.value)return;Nt.value=!0,Ut&&clearTimeout(Ut),Ut=setTimeout(()=>{Nt.value=!1},500);const A=Bt();j(A,"workOrder",{delay:50,showMessage:!0})},Bt=()=>{const A=zt(W.due_date),ae=zt(W.start_date),J={name:W.name,category_ids:W.category_ids,priority_id:W.priority_id,state_id:W.state_id,work_type_id:W.work_type_id,start_date:ae,due_date:A,recurrence_setting_request:W.recurrence_setting_request,task_list:W.task_list,time_zone:W.time_zone,equipment_node_ids:W.equipment_node_ids,description:W.description,location_id:W.location_id,recurrence_uuid:W.recurrence_uuid,halt_type:W.halt_type,recurrence_type_id:W.recurrence_type||W.recurrence_type_id||1,approved_by_id:W.approved_by_id,assignee_ids:W.assignee_ids||[],image_list:W.image_list,file_list:W.file_list,standard_list:W.standard_list||[],request_id:W.request_id,parent_work_order_id:W.parent_work_order_id,vendor_ids:W.vendor_ids};return ca(J,"workOrderCreate")},ha=M(()=>W.start_date&&W.due_date),Ja=()=>{if(!W.start_date||!W.due_date)return"";const A=new Date(W.start_date),J=new Date(W.due_date)-A;if(J<=0)return"Invalid duration";const ue=Math.floor(J/(1e3*60*60*24)),Ve=Math.floor(J%(1e3*60*60*24)/(1e3*60*60)),Ue=Math.floor(J%(1e3*60*60)/(1e3*60));return ue>0?`${ue} day${ue!==1?"s":""} ${Ve}h ${Ue}m`:Ve>0?`${Ve}h ${Ue}m`:`${Ue} minute${Ue!==1?"s":""}`};ye(()=>W.recurrence_setting,A=>{A&&typeof A=="object"&&(W.recurrence_type=A.recurrence_type,W.recurrence_type_id=A.recurrence_type,W.recurrence_setting_request={start_date_time:A.start_date_time||W.start_date,end_date_time:A.end_date_time,month_of_year:A.month_of_year,day_of_month:A.day_of_month,days_of_week:A.days_of_week,interval:A.interval,duration_minutes:A.duration_minutes})},{deep:!0}),ye(()=>W.start_date,()=>{Ne(()=>{Xe.value&&W.due_date&&Xe.value.validateField("due_date"),Xe.value&&W.recurrence_setting&&W.recurrence_setting.start_date_time&&Xe.value.validateField("recurrence_setting.start_date_time")})}),ye(()=>W.due_date,()=>{Ne(()=>{Xe.value&&W.start_date&&Xe.value.validateField("start_date"),Xe.value&&W.recurrence_setting&&W.recurrence_setting.end_date_time&&Xe.value.validateField("recurrence_setting.end_date_time")})}),ye(()=>W.recurrence_setting,A=>{A&&(A.start_date_time||A.end_date_time)&&Ne(()=>{Xe.value&&(A.start_date_time&&Xe.value.validateField("recurrence_setting.start_date_time"),A.end_date_time&&Xe.value.validateField("recurrence_setting.end_date_time"))})},{deep:!0});const ya=async()=>{var A,ae;if(Xe.value)try{if(!await Xe.value.validate()){B.error(rt("workOrder.messages.validationFailed"));return}ft.value=!0,(W.image_list.length>0||W.file_list.length>0)&&await xt();const ue=zt(W.due_date),Ve=zt(W.start_date);!W.recurrence_setting_request.start_date_time&&Ve&&(W.recurrence_setting_request.start_date_time=Ve);const Ue=W.recurrence_type||W.recurrence_type_id||1;Ke(),H();const je=Array.isArray(W.task_list)?W.task_list:[];if(je.length===0){B.error("Please add at least one task before creating the work order."),ft.value=!1;return}const Ot=je.map(Ft=>{const ot=We(Ft);return ot.work_order_id=ot.work_order_id??0,ot.state=ot.state??ia,ot.time_estimate_sec=ot.time_estimate_sec&&ot.time_estimate_sec>0?ot.time_estimate_sec:1800,ot.steps=Array.isArray(ot.steps)?ot.steps:[],ot.assignee_ids=Array.isArray(ot.assignee_ids)?ot.assignee_ids:[],ot});if(Ot.some(Ft=>!Array.isArray(Ft.steps)||Ft.steps.length===0)){B.error("Each task must include at least one step."),ft.value=!1;return}const ra={...Bt(),task_list:Ot,recurrence_type:Ue,recurrence_type_id:Ue},oa=ca(ra,"workOrderCreate"),jt=await Fr(oa);B.success("Work order created successfully!"),(Array.isArray(jt.data)?jt.data:[jt.data]).forEach((Ft,ot)=>{mt("work-order-created",Ft)}),aa()}catch(J){console.error("Failed to create work order:",J);const ue=((ae=(A=J.response)==null?void 0:A.data)==null?void 0:ae.message)||J.message||rt("workOrder.messages.createFailed");B.error(ue)}finally{ft.value=!1}};t({hasFormChanges:Yt});const wa={showAddTaskDialog:e,showAddStandardDialog:y,showEditStandardDialog:v,editingStandard:d,showTaskAssigneeDialog:u,currentEditingTask:p,userSearchQuery:w,localSelectedTaskAssignees:h,showTaskPreviewDialog:k,showStandardPreviewDialog:C,previewTaskTemplateId:P,previewTaskData:O,previewStandardData:E,isTaskInteractive:T,standalonePreviewTab:q,currentPayload:le,showJsonDisplayer:V,logPayload:j,closeDebugDrawer:pe,handleAddStandard:oe,closeAddStandardDialog:X,handleAddTask:ie,closeAddTaskDialog:$,handleTaskAction:ce,handleTaskAssigneeUpdate:ne,handleOpenAssigneeDialog:R,filteredAssigneeOptions:fe,isUserSelected:K,toggleUser:_,addSelectedUser:de,removeSelectedUser:f,clearAllAssignees:F,getSelectedUserObjects:U,saveTaskAssignees:te,resetTaskAssigneeDialog:N,handleStandardAction:ee,onStandardUpdate:G,handleCloseAddTaskDialog:re,onAddTaskTemplates:Se,handleDeleteAllTasks:De,onAddStandards:Pe,handleDeleteAllStandards:Ae,handleCloseAddStandardDialog:ve,handlePreviewTask:Fe,handlePreviewStandard:Be,handleBackToTaskList:et,handleCloseTaskPreview:dt,getPreviewTaskTitle:_t,handleEditTask:Vt,emit:mt,t:rt,router:wt,currentRoute:St,taskLibraryStore:gt,workOrderDraftStore:Qe,handleTemplateUpdate:tt,form:W,get isHydratingForm(){return $e},set isHydratingForm(A){$e=A},syncTaskPayloads:Ke,syncStandards:H,resolveCategoryMeta:Oe,decorateTaskCategory:Ie,decorateTasksCategories:Ze,hydrateFormFromDraft:vt,validateStartDate:I,validateDueDate:Z,validateRecurrenceStartTime:Q,validateRecurrenceEndTime:ge,validateRecurrenceStartTimeOnly:Te,validateRecurrenceEndTimeOnly:Ee,rules:qe,treeProps:Ye,priorityOptions:ct,workTypeOptions:ht,categoryOptions:kt,stateOptions:Et,assetTreeData:Lt,loading:ft,assigneeOptions:Tt,supervisorOptions:st,formRef:Xe,loadFormData:pa,toUtcIso:zt,handleImageListUpdate:Na,handleFilesListUpdate:Ba,uploadFilesToServer:xt,hasFormChanges:Yt,handleBackToDetail:ja,handleCancel:ta,resetFormSilent:aa,resetForm:Ha,get logButtonTimeout(){return Ut},set logButtonTimeout(A){Ut=A},isLoggingInProgress:Nt,logCurrentPayload:va,createWorkOrderPayload:Bt,showWorkOrderDuration:ha,formatWorkOrderDuration:Ja,submitForm:ya,__MACROS_defineComponent:Ce,ref:S,reactive:it,onMounted:He,onBeforeUnmount:Mt,watch:ye,nextTick:Ne,computed:M,get ElMessage(){return B},get ElMessageBox(){return lt},get ArrowLeft(){return ea},get RefreshLeft(){return To},get Plus(){return Ra},get Delete(){return Ma},get DocumentAdd(){return So},get Document(){return sa},get List(){return sr},get DocumentChecked(){return bo},get Search(){return qt},get useI18n(){return Ge},RecurrenceEditor:Co,MaintenanceSelectedTaskCard:Po,MaintenanceSelectedStandardsCard:Ao,AddTask:Ro,AddStandard:Mo,FileUploadMultiple:Vo,get JsonDebugDrawer(){return cr},get usePayloadLogger(){return Xt},get clonePayload(){return We},get transformPayload(){return ca},EditStandardDialog:qo,StepsPreview:ga,StandardsPreview:za,get uploadMultipleToMinio(){return da},get getAllWorkTypes(){return Ia},get getAllPriorities(){return Va},get getAllCategories(){return xa},get getAllStates(){return Fa},get getEquipmentNodeTrees(){return Ea},get createWorkOrder(){return Fr},get useRouter(){return yt},get useRoute(){return At},get useTaskLibraryStore(){return La},get useWorkOrderDraftStore(){return It},get createEmptyWorkOrderForm(){return Rt},get cloneWorkOrderForm(){return jr},get DEFAULT_TASK_STATE(){return ia},get buildDisplayTaskFromTemplate(){return Zt}};return Object.defineProperty(wa,"__isScriptSetup",{enumerable:!1,value:!0}),wa}}),qm={class:"work-order-create-enhanced"},zm={class:"create-header"},Um={class:"header-main"},Nm={class:"create-title"},Bm={class:"header-actions"},jm={class:"form-section"},Hm={class:"form-section"},Jm={class:"form-section"},Ym={class:"form-section"},Gm={class:"form-section"},Qm={class:"form-section tasks-section"},Km={class:"section-header"},Zm={class:"section-title"},Xm={key:0,class:"task-actions"},$m={key:0,class:"empty-tasks"},ef={class:"empty-content"},tf={class:"tasks-list"},af={class:"form-section standards-section"},rf={class:"section-header"},of={class:"section-title"},nf={key:0,class:"standards-actions"},sf={key:0,class:"empty-standards"},lf={class:"empty-content"},df={class:"standards-list"},cf={class:"form-section"},uf={key:0,class:"work-order-duration"},mf={class:"form-section"},ff={class:"form-section"},_f={class:"form-section"},gf={class:"form-section"},pf={class:"form-section"},vf={class:"upload-section"},hf={class:"preview-dialog-header"},yf=["id"],wf={class:"standalone-standard-preview"},kf={class:"standard-details"},bf={class:"fixed-header-section"},Sf={class:"standard-tabs-header"},Tf={class:"scrollable-content"},Of={class:"tab-content-wrapper"},Cf={key:0,class:"tab-pane-content"},Df={class:"overview-card"},Af={class:"card-content"},Pf={class:"info-value highlight"},If={key:0,class:"description-card"},Vf={class:"card-content"},xf={class:"description-text"},Ff={key:1,class:"tab-pane-content"},Ef={key:0,class:"rules-list"},Lf={class:"card-header"},Wf={class:"rules-container"},Rf={class:"rule-number"},Mf={class:"rule-content"},qf={class:"rule-text"},zf={key:1,class:"empty-rules"},Uf={class:"form-actions-fixed"},Nf={class:"form-actions-content"},Bf={class:"assignee-picker"},jf={class:"search-section"},Hf={class:"available-section"},Jf={key:0,class:"empty-users"},Yf={key:1,class:"users-list"},Gf=["onClick"],Qf={class:"user-info"},Kf={class:"user-name"},Zf={key:0,class:"user-email"},Xf={class:"user-actions"},$f={key:0,class:"selected-section"},e_={class:"selected-section-header"},t_={class:"selected-users"},a_={class:"dialog-footer"};function r_(s,t,i,e,y,v){const d=D("el-col"),u=D("el-icon"),p=D("el-button"),w=D("el-row"),h=D("el-input"),k=D("el-form-item"),C=D("el-tree-select"),P=D("el-option"),O=D("el-select"),E=D("el-divider"),T=D("el-date-picker"),q=D("el-text"),le=D("el-dialog"),V=D("el-switch"),j=D("el-tooltip"),pe=D("el-tab-pane"),oe=D("el-tabs"),X=D("el-descriptions-item"),ie=D("el-tag"),$=D("el-descriptions"),ce=D("el-empty"),ne=D("el-form"),R=D("el-checkbox"),fe=_a("loading");return c(),g("div",qm,[l(" Create Header "),a("div",zm,[r(w,{justify:"space-between",align:"top",gutter:16},{default:n(()=>[r(d,{span:18},{default:n(()=>[a("div",Um,[a("h2",Nm,m(s.$t("workOrder.newWorkOrder")),1)])]),_:1}),r(d,{span:6},{default:n(()=>[a("div",Bm,[r(p,{type:"default",onClick:e.handleBackToDetail},{default:n(()=>[r(u,null,{default:n(()=>[r(e.ArrowLeft)]),_:1}),x(" "+m(s.$t("workOrder.actions.backToDetail")),1)]),_:1}),r(p,{type:"warning",onClick:e.resetForm,plain:""},{default:n(()=>[r(u,null,{default:n(()=>[r(e.RefreshLeft)]),_:1}),x(" "+m(s.$t("workOrder.actions.reset")),1)]),_:1})])]),_:1})]),_:1})]),l(" Form Container "),Pt((c(),Y(ne,{ref:"formRef",model:e.form,rules:e.rules,"label-position":"top",class:"create-form"},{default:n(()=>{var K;return[l(" Task Title "),a("div",jm,[r(k,{prop:"name"},{default:n(()=>[r(h,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.form.name=_),placeholder:s.$t("workOrder.create.taskTitlePlaceholder"),size:"large",class:"task-title-input"},null,8,["modelValue","placeholder"])]),_:1})]),l(" Description "),a("div",Hm,[r(k,{label:s.$t("workOrder.form.description"),prop:"description"},{default:n(()=>[r(h,{modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=_=>e.form.description=_),type:"textarea",placeholder:s.$t("workOrder.create.descriptionPlaceholder"),rows:3,resize:"vertical"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Asset Tree Select "),a("div",Jm,[r(k,{label:s.$t("workOrder.create.asset"),prop:"equipment_node_ids"},{default:n(()=>[r(C,{modelValue:e.form.equipment_node_ids,"onUpdate:modelValue":t[2]||(t[2]=_=>e.form.equipment_node_ids=_),data:e.assetTreeData,props:e.treeProps,placeholder:s.$t("workOrder.create.assetPlaceholder"),"check-strictly":"","render-after-expand":!1,multiple:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])]),l(" Supervisor "),a("div",Ym,[r(k,{label:"Supervisor",prop:"approved_by_id"},{default:n(()=>[r(O,{modelValue:e.form.approved_by_id,"onUpdate:modelValue":t[3]||(t[3]=_=>e.form.approved_by_id=_),placeholder:"Select Supervisor",filterable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.supervisorOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l(" Assignees "),a("div",Gm,[r(k,{label:s.$t("workOrder.create.assignTo"),prop:"assignee_ids"},{default:n(()=>[r(O,{modelValue:e.form.assignee_ids,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.assignee_ids=_),placeholder:s.$t("workOrder.create.assigneePlaceholder"),filterable:"",multiple:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.assigneeOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Tasks "),r(E),a("div",Qm,[r(k,null,{label:n(()=>[a("div",Km,[a("span",Zm,[r(u,{class:"section-icon tasks-icon"},{default:n(()=>[r(e.List)]),_:1}),t[23]||(t[23]=x(" Tasks "))]),e.form.tasks.length>0?(c(),g("div",Xm,[r(p,{size:"default",onClick:e.handleAddTask,icon:e.Plus},{default:n(()=>t[24]||(t[24]=[x(" Add Task ")])),_:1,__:[24]},8,["icon"]),r(p,{size:"default",onClick:e.handleDeleteAllTasks,icon:e.Delete},{default:n(()=>[x(" Clear All ("+m(e.form.tasks.length)+") ",1)]),_:1},8,["icon"])])):l("v-if",!0)])]),default:n(()=>[a("div",{class:xe(["tasks-container",{"no-tasks":e.form.tasks.length===0}])},[l(" Empty State "),e.form.tasks.length===0?(c(),g("div",$m,[a("div",ef,[r(u,{class:"empty-icon"},{default:n(()=>[r(e.DocumentAdd)]),_:1}),t[26]||(t[26]=a("h4",null,"No Tasks Added",-1)),t[27]||(t[27]=a("p",null,"Add your first task to start building the work order",-1)),r(p,{type:"primary",onClick:e.handleAddTask},{default:n(()=>[r(u,null,{default:n(()=>[r(e.Plus)]),_:1}),t[25]||(t[25]=x(" Add Task "))]),_:1,__:[25]})])])):(c(),g(se,{key:1},[l(" Tasks List "),a("div",tf,[(c(!0),g(se,null,we(e.form.tasks,_=>(c(),Y(e.MaintenanceSelectedTaskCard,{key:_.id,template:_,"assignee-options":e.assigneeOptions,onSelection:e.handleTaskAction,onAssigneeUpdate:e.handleTaskAssigneeUpdate,onOpenAssigneeDialog:e.handleOpenAssigneeDialog,class:"task-card"},null,8,["template","assignee-options"]))),128))])],2112))],2)]),_:1})]),l(" Standards "),r(E),a("div",af,[r(k,null,{label:n(()=>[a("div",rf,[a("span",of,[r(u,{class:"section-icon standards-icon"},{default:n(()=>[r(e.DocumentChecked)]),_:1}),t[28]||(t[28]=x(" Standards "))]),e.form.standards.length>0?(c(),g("div",nf,[r(p,{size:"default",onClick:e.handleAddStandard,icon:e.Plus},{default:n(()=>t[29]||(t[29]=[x(" Add Standard ")])),_:1,__:[29]},8,["icon"]),r(p,{size:"default",onClick:e.handleDeleteAllStandards,icon:e.Delete},{default:n(()=>[x(" Clear All ("+m(e.form.standards.length)+") ",1)]),_:1},8,["icon"])])):l("v-if",!0)])]),default:n(()=>[a("div",{class:xe(["standards-container",{"no-standards":e.form.standards.length===0}])},[l(" Empty State "),e.form.standards.length===0?(c(),g("div",sf,[a("div",lf,[r(u,{class:"empty-icon"},{default:n(()=>[r(e.Document)]),_:1}),t[31]||(t[31]=a("h4",null,"No Standards Added",-1)),t[32]||(t[32]=a("p",null,"Add your first standard to ensure work order compliance",-1)),r(p,{type:"primary",onClick:e.handleAddStandard},{default:n(()=>[r(u,null,{default:n(()=>[r(e.Plus)]),_:1}),t[30]||(t[30]=x(" Add Standard "))]),_:1,__:[30]})])])):(c(),g(se,{key:1},[l(" Standards List "),a("div",df,[(c(!0),g(se,null,we(e.form.standards,_=>(c(),Y(e.MaintenanceSelectedStandardsCard,{key:_.id,template:_,onSelection:e.handleStandardAction,class:"standard-card"},null,8,["template"]))),128))])],2112))],2)]),_:1})]),l(" Due Date "),a("div",cf,[r(k,{label:s.$t("workOrder.create.dueDate"),prop:"due_date"},{default:n(()=>[r(T,{modelValue:e.form.due_date,"onUpdate:modelValue":t[5]||(t[5]=_=>e.form.due_date=_),type:"datetime",placeholder:s.$t("workOrder.create.dueDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue","placeholder"]),e.showWorkOrderDuration?(c(),g("div",uf,[r(q,{type:"info",size:"small"},{default:n(()=>[x(" Work order duration: "+m(e.formatWorkOrderDuration()),1)]),_:1})])):l("v-if",!0)]),_:1},8,["label"])]),l(" Start Date "),a("div",mf,[r(k,{label:s.$t("workOrder.create.startDate"),prop:"start_date"},{default:n(()=>[r(T,{modelValue:e.form.start_date,"onUpdate:modelValue":t[6]||(t[6]=_=>e.form.start_date=_),type:"datetime",placeholder:s.$t("workOrder.create.startDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Work Type, Priority, and State "),a("div",ff,[r(w,{gutter:16},{default:n(()=>[r(d,{span:8},{default:n(()=>[r(k,{label:s.$t("workOrder.create.workType"),prop:"work_type_id"},{default:n(()=>[r(O,{modelValue:e.form.work_type_id,"onUpdate:modelValue":t[7]||(t[7]=_=>e.form.work_type_id=_),placeholder:s.$t("workOrder.create.workTypePlaceholder"),style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.workTypeOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(d,{span:8},{default:n(()=>[r(k,{label:s.$t("workOrder.create.priority"),prop:"priority_id"},{default:n(()=>[r(O,{modelValue:e.form.priority_id,"onUpdate:modelValue":t[8]||(t[8]=_=>e.form.priority_id=_),placeholder:s.$t("workOrder.create.priorityPlaceholder"),style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.priorityOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(d,{span:8},{default:n(()=>[r(k,{label:"State",prop:"state_id"},{default:n(()=>[r(O,{modelValue:e.form.state_id,"onUpdate:modelValue":t[9]||(t[9]=_=>e.form.state_id=_),placeholder:"Select state...",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.stateOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l(" Recurrence Settings "),a("div",_f,[r(e.RecurrenceEditor,{"recurrence-setting":e.form.recurrence_setting,"onUpdate:recurrenceSetting":t[10]||(t[10]=_=>e.form.recurrence_setting=_),"work-order-start-date":e.form.start_date,"work-order-due-date":e.form.due_date},null,8,["recurrence-setting","work-order-start-date","work-order-due-date"])]),l(" Categories "),a("div",gf,[r(k,{label:s.$t("workOrder.create.categories"),prop:"category_ids"},{default:n(()=>[r(O,{modelValue:e.form.category_ids,"onUpdate:modelValue":t[11]||(t[11]=_=>e.form.category_ids=_),placeholder:s.$t("workOrder.create.categoriesPlaceholder"),multiple:"",filterable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.categoryOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Image and File Upload Section "),a("div",pf,[r(E),a("div",vf,[r(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"image-label":s.$t("workOrder.create.imageUpload"),"file-label":s.$t("workOrder.create.fileUpload"),"upload-type":"both","max-images":5,"max-files":10},null,8,["image-label","file-label"])])]),l(" Add Task Dialog "),r(le,{modelValue:e.showAddTaskDialog,"onUpdate:modelValue":t[12]||(t[12]=_=>e.showAddTaskDialog=_),title:"Add New Task",width:"700px","before-close":e.handleCloseAddTaskDialog,top:"5vh"},{default:n(()=>[e.showAddTaskDialog?(c(),Y(e.AddTask,{key:0,onClose:e.closeAddTaskDialog,onAddTemplates:e.onAddTaskTemplates})):l("v-if",!0)]),_:1},8,["modelValue"]),l(" Add Standard Dialog "),r(le,{modelValue:e.showAddStandardDialog,"onUpdate:modelValue":t[13]||(t[13]=_=>e.showAddStandardDialog=_),title:"Add New Standard",width:"700px",top:"5vh","before-close":e.handleCloseAddStandardDialog},{default:n(()=>[e.showAddStandardDialog?(c(),Y(e.AddStandard,{key:0,onClose:e.closeAddStandardDialog,onAddStandards:e.onAddStandards})):l("v-if",!0)]),_:1},8,["modelValue"]),l(" Edit Standard Dialog "),e.editingStandard?(c(),Y(e.EditStandardDialog,{key:0,visible:e.showEditStandardDialog,standard:e.editingStandard,"onUpdate:visible":t[14]||(t[14]=_=>e.showEditStandardDialog=!1),"onUpdate:standard":e.onStandardUpdate},null,8,["visible","standard"])):l("v-if",!0),l(" Task Preview Dialog "),r(le,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[16]||(t[16]=_=>e.showTaskPreviewDialog=_),width:"700px",top:"5vh","before-close":e.handleCloseTaskPreview,class:"preview-dialog"},{header:n(({titleId:_})=>[a("div",hf,[r(p,{type:"text",onClick:e.handleBackToTaskList,class:"back-button"},{default:n(()=>[r(u,null,{default:n(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:_,class:"dialog-title"}," Preview: "+m(e.getPreviewTaskTitle()),9,yf),r(j,{content:"Interactive Mode",placement:"top"},{default:n(()=>[r(V,{modelValue:e.isTaskInteractive,"onUpdate:modelValue":t[15]||(t[15]=de=>e.isTaskInteractive=de)},null,8,["modelValue"])]),_:1})])]),default:n(()=>[e.previewTaskTemplateId?(c(),Y(e.StepsPreview,{key:0,"template-id":e.previewTaskTemplateId,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):e.previewTaskData&&e.previewTaskData.steps?(c(),Y(e.StepsPreview,{key:1,steps:e.previewTaskData.steps,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["steps","interactive"])):l("v-if",!0)]),_:1},8,["modelValue"]),l(" Standard Preview Dialog "),r(le,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[18]||(t[18]=_=>e.showStandardPreviewDialog=_),title:`Preview: ${((K=e.previewStandardData)==null?void 0:K.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:n(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(c(),Y(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(c(),g(se,{key:1},[l(" Standalone Standard Preview "),a("div",wf,[a("div",kf,[l(" Fixed Header Section "),a("div",bf,[a("div",Sf,[r(oe,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[17]||(t[17]=_=>e.standalonePreviewTab=_),class:"details-tabs"},{default:n(()=>[r(pe,{label:"General",name:"general"}),r(pe,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),l(" Scrollable Content Area "),a("div",Tf,[a("div",Of,[l(" General Tab Content "),e.standalonePreviewTab==="general"?(c(),g("div",Cf,[a("div",Df,[a("div",Af,[r($,{column:2,direction:"vertical"},{default:n(()=>[r(X,{width:"50%",label:"Category"},{default:n(()=>[x(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r(X,{width:"50%",label:"Total Rules"},{default:n(()=>{var _;return[a("span",Pf,m(((_=e.previewStandardData.items)==null?void 0:_.length)||0)+" rules",1)]}),_:1}),r(X,{width:"50%",label:"Type"},{default:n(()=>[r(ie,{type:"primary",size:"small"},{default:n(()=>t[33]||(t[33]=[x("Work Order Only")])),_:1,__:[33]})]),_:1})]),_:1})])]),e.previewStandardData.description?(c(),g("div",If,[t[34]||(t[34]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",Vf,[a("div",xf,m(e.previewStandardData.description),1)])])):l("v-if",!0)])):l("v-if",!0),l(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(c(),g("div",Ff,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(c(),g("div",Ef,[a("div",Lf,[t[36]||(t[36]=a("h3",{class:"card-title"},"Standard Rules",-1)),r(ie,{type:"warning",size:"small"},{default:n(()=>t[35]||(t[35]=[x("Read Only")])),_:1,__:[35]})]),a("div",Wf,[(c(!0),g(se,null,we(e.previewStandardData.items,(_,de)=>(c(),g("div",{key:de,class:"rule-item"},[a("div",Rf,m(de+1),1),a("div",Mf,[a("div",qf,m(_),1)])]))),128))])])):(c(),g("div",zf,[r(ce,{description:"No standard rules defined yet","image-size":60})]))])):l("v-if",!0)])])])])],2112)):l("v-if",!0),l("        <template #footer>"),l('          <div class="standard-dialog-footer">'),l('            <div class="footer-actions">'),l('              <el-button @click="showStandardPreviewDialog = false">Close</el-button>'),l("            </div>"),l("          </div>"),l("        </template>")]),_:1},8,["modelValue","title"]),l(" Submit Button - Fixed at bottom "),a("div",Uf,[a("div",Nf,[r(p,{type:"default",onClick:e.handleCancel,class:"cancel-button"},{default:n(()=>[x(m(s.$t("workOrder.actions.cancel")),1)]),_:1}),r(p,{type:"info",onClick:e.logCurrentPayload,class:"logs-button",loading:e.isLoggingInProgress,disabled:e.isLoggingInProgress},{default:n(()=>[x(m(e.isLoggingInProgress?"Loading...":"Logs"),1)]),_:1},8,["loading","disabled"]),r(p,{type:"primary",onClick:e.submitForm,loading:e.loading,class:"create-button"},{default:n(()=>[x(m(s.$t("workOrder.actions.create")),1)]),_:1},8,["loading"])])])]}),_:1},8,["model","rules"])),[[fe,e.loading]]),l(" Task Assignee Management Dialog "),r(le,{modelValue:e.showTaskAssigneeDialog,"onUpdate:modelValue":t[21]||(t[21]=K=>e.showTaskAssigneeDialog=K),title:"Select Workers",width:"600px",onClose:e.resetTaskAssigneeDialog,top:"8vh"},{footer:n(()=>[a("span",a_,[r(p,{onClick:e.resetTaskAssigneeDialog},{default:n(()=>t[39]||(t[39]=[x("Cancel")])),_:1,__:[39]}),r(p,{type:"primary",onClick:e.saveTaskAssignees},{default:n(()=>[x(" Save Selection ("+m(e.localSelectedTaskAssignees.length)+") ",1)]),_:1})])]),default:n(()=>[a("div",Bf,[l(" Search "),a("div",jf,[r(h,{modelValue:e.userSearchQuery,"onUpdate:modelValue":t[19]||(t[19]=K=>e.userSearchQuery=K),placeholder:"Search users...",clearable:""},{prefix:n(()=>[r(u,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),l(" Available Workers "),a("div",Hf,[t[37]||(t[37]=a("h4",null,"Available Workers",-1)),e.filteredAssigneeOptions.length===0?(c(),g("div",Jf,[r(ce,{description:"No users found","image-size":60})])):(c(),g("div",Yf,[(c(!0),g(se,null,we(e.filteredAssigneeOptions,K=>(c(),g("div",{key:K.id,class:xe(["user-item",{selected:e.isUserSelected(K.id)}]),onClick:_=>e.toggleUser(K)},[a("div",Qf,[a("div",Kf,m(K.name),1),K.email?(c(),g("div",Zf,m(K.email),1)):l("v-if",!0)]),a("div",Xf,[r(R,{"model-value":e.isUserSelected(K.id),onClick:t[20]||(t[20]=lr(()=>{},["stop"])),onChange:_=>e.toggleUser(K)},null,8,["model-value","onChange"])])],10,Gf))),128))]))]),l(" Selected Workers "),e.localSelectedTaskAssignees.length>0?(c(),g("div",$f,[a("div",e_,[a("h4",null,"Selected Workers ("+m(e.localSelectedTaskAssignees.length)+")",1),r(p,{type:"text",size:"small",onClick:e.clearAllAssignees,class:"clear-all-btn"},{default:n(()=>t[38]||(t[38]=[x(" Clear All ")])),_:1,__:[38]})]),a("div",t_,[(c(!0),g(se,null,we(e.getSelectedUserObjects(),K=>(c(),Y(ie,{key:K.id,closable:"",onClose:_=>e.removeSelectedUser(K.id),class:"selected-user-tag"},{default:n(()=>[x(m(K.name),1)]),_:2},1032,["onClose"]))),128))])])):l("v-if",!0)])]),_:1},8,["modelValue"]),l(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[22]||(t[22]=K=>e.showJsonDisplayer=K),"payload-data":e.currentPayload,title:"Work Order Payload",subtitle:"Click 'Logs' to refresh"},null,8,["modelValue","payload-data"])])}const o_=Re(Mm,[["render",r_],["__scopeId","data-v-5399a868"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderCreate.vue"]]);function co(s,t){var u,p;const i=Array.isArray(s.steps)?s.steps:Array.isArray((u=s.payload)==null?void 0:u.steps)?s.payload.steps:[],e=Array.isArray(t.steps)?t.steps:Array.isArray((p=t.payload)==null?void 0:p.steps)?t.payload.steps:[],y=new Map;e.forEach(w=>{const h=w.id||w._id||w.step_id;h&&y.set(String(h),w)});const v=new Map;i.forEach(w=>{const h=w.id||w._id||w.step_id;h&&!fa(h)&&v.set(String(h),w)});const d={step_add_list:[],step_update_list:[],step_delete_list:[]};return i.forEach(w=>{const h=w.id||w._id||w.step_id;if(!h||fa(h)){const k=n_(w);k&&d.step_add_list.push(k)}else if(y.has(String(h))&&zo(w,y.get(String(h)))){const k=s_(w);d.step_update_list.push(k)}}),e.forEach(w=>{const h=w.id||w._id||w.step_id;h&&!v.has(String(h))&&l_(h)&&d.step_delete_list.push(h)}),d}function fa(s){if(!s)return!0;const t=String(s);return t.startsWith("step-")||t.startsWith("new-")||t.startsWith("temp-")||t.startsWith("local-")}function zo(s,t){const i=["name","description","required","remarks","type"];for(const u of i)if(s[u]!==t[u])return!0;const e=JSON.stringify(s.value||{}),y=JSON.stringify(t.value||{});if(e!==y)return!0;const v=uo(s.tools),d=uo(t.tools);return v!==d}function uo(s){if(!Array.isArray(s))return"[]";const t=s.map(i=>typeof i=="number"?i:typeof i=="object"&&i!==null?i.id||i.tool_id||i.toolId:i).filter(i=>i!=null);return JSON.stringify(t.sort((i,e)=>i-e))}function n_(s){return s.name==="Checklist"&&s.description==="Auto-generated step"&&s.type==="template"?null:{name:s.name||"Untitled Step",description:s.description||"",type:s.type||"template",required:s.required||!1,remarks:s.remarks||"",value:s.value||{},tools:Uo(s.tools)}}function s_(s){return{id:s.id||s._id||s.step_id,name:s.name||"Untitled Step",description:s.description||"",type:s.type||"template",required:s.required||!1,remarks:s.remarks||"",value:s.value||{},tools:Uo(s.tools)}}function Uo(s){return Array.isArray(s)?s.map(t=>typeof t=="number"?t:typeof t=="object"&&t!==null?t.id||t.tool_id||t.toolId:typeof t=="string"&&!isNaN(t)?parseInt(t,10):null).filter(t=>t!=null&&!isNaN(t)):[]}function l_(s){if(!s)return!1;const t=String(s);return t!=="null"&&t!=="undefined"&&t.length>0&&!fa(s)}function mo(s){return s.name==="Checklist"&&s.description==="Auto-generated step"&&s.type==="template"}function fo(s,t){const i=s.filter(d=>!mo(d)),e=t.filter(d=>!mo(d));if(i.length!==e.length)return!0;if(i.length===0&&e.length===0)return!1;const y=new Map;e.forEach(d=>{const u=d.id||d._id||d.step_id;u&&y.set(String(u),d)});for(const d of i){const u=d.id||d._id||d.step_id;if(!u||fa(u))return!0;const p=y.get(String(u));if(!p||zo(d,p))return!0}const v=new Map;i.forEach(d=>{const u=d.id||d._id||d.step_id;u&&!fa(u)&&v.set(String(u),d)});for(const d of e){const u=d.id||d._id||d.step_id;if(u&&!v.has(String(u)))return!0}return!1}const i_={__name:"WorkOrderEdit",props:{workOrder:{type:Object,required:!0}},emits:["back-to-detail","work-order-updated","work-order-not-found"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=S(!1),d=S(!1),u=S(!1),p=S(null),w=S(!1),h=S(!1),k=S(null),C=S(null),P=S(null),O=S(!1),E=S(!1),T=S(!1),q=S(null),le=S(""),V=S([]),j=S("general"),{t:pe}=Ge(),oe=yt(),X=At(),ie=La(),$=It(),{currentPayload:ce,showJsonDisplayer:ne,logPayload:R}=Xt(),fe=S(null),K=S(!1),_=S(!1);let de=null;const f=it(Rt());f.workOrderId=null;let F=!1;const U=S(!1),te=S([]),N=S([]),ee=it({added:[],updated:[],deleted:[]}),G=it({added:[],updated:[],deleted:[]}),re=M(()=>{var L;const o=pe("workOrder.editWorkOrder"),b=f.name||((L=e.workOrder)==null?void 0:L.name);return b?`${o} - ${b}`:o}),Se=()=>({name:"Checklist",description:"Auto-generated step",type:"template",required:!1,remarks:"",value:{type:"checkbox",value:!1,require_image:!1,image:[]},tools:[]}),De=o=>Array.isArray(o)?We(o):[],Pe=o=>{if(!o)return null;const b=new Date(o);if(Number.isNaN(b.getTime()))return null;const L=ze=>String(ze).padStart(2,"0"),z=b.getFullYear(),_e=L(b.getMonth()+1),me=L(b.getDate()),he=L(b.getHours()),be=L(b.getMinutes()),ke=L(b.getSeconds());return`${z}-${_e}-${me}T${he}:${be}:${ke}`},Ae=o=>{if(!Array.isArray(o)||o.length===0)return null;const b=o[Math.floor(Math.random()*o.length)];return(b==null?void 0:b.id)??(b==null?void 0:b.value)??null},ve=o=>{if(o==null)return null;const b=String(o).trim();return b.length>0?b:null},Fe=["work-order-task-","new-task-","existing-task-","temp-"],Be=o=>{const b=ve(o);if(!b)return!1;const L=b.toLowerCase();return Fe.some(z=>L.startsWith(z))},et=o=>{if(!o||typeof o!="object")return[];const b=new Set,L=_e=>{const me=ve(_e);me&&!b.has(me)&&b.add(me)},z=o.payload||{};return[o.task_id,o.taskId,o.work_order_task_id,o.workOrderTaskId,o.id,z.task_id,z.id,z.work_order_task_id].forEach(L),Array.from(b)},dt=(o,b)=>{if(!Array.isArray(o)||!b)return-1;const L=et(b);if(L.length===0)return-1;const z=new Set(L);return o.findIndex(_e=>et(_e).some(he=>z.has(he)))},_t=o=>{const b=et(o);for(const L of b)if(L&&!Be(L))return L;return null},Vt=o=>{var b,L,z;return!o||typeof o!="object"?!1:!!(o.templateId||o.template_id||(b=o.payload)!=null&&b.template_id||(L=o.rawTemplate)!=null&&L.template_id||(z=o.rawTemplate)!=null&&z.id)},mt=o=>!(!o||typeof o!="object"||Vt(o)||o.source&&o.source!=="adhoc"),rt=o=>!mt(o)||o!=null&&o.__hasLocalEdits||o!=null&&o.__entryStepsLoaded?!1:!!_t(o),wt=(o,b,{markLocalEdit:L=!1,entryId:z=null}={})=>{if(!o||typeof o!="object")return;const _e=Array.isArray(b)&&b.length>0?We(b):[Se()];if(o.steps=We(_e),(!o.payload||typeof o.payload!="object")&&(o.payload={}),o.payload.steps=We(_e),z){const me=ve(o.id);(!me||Be(me))&&(o.id=z);const he=ve(o.payload.id);(!he||Be(he))&&(o.payload.id=z);const be=ve(o.payload.task_id);(!be||Be(be))&&(o.payload.task_id=z)}L&&(o.__hasLocalEdits=!0),o.__entryStepsLoaded=!0},St=(o,b,L,z=null)=>{if(!Array.isArray(o)||!b)return;const _e=Array.isArray(L)&&L.length>0?We(L):[Se()],me=dt(o,b);if(me===-1)return;const he=o[me];if(!(!he||typeof he!="object")){if(he.steps=We(_e),(!he.payload||typeof he.payload!="object")&&(he.payload={}),he.payload.steps=We(_e),z){const be=ve(he.id);(!be||Be(be))&&(he.id=z);const ke=ve(he.payload.id);(!ke||Be(ke))&&(he.payload.id=z);const ze=ve(he.payload.task_id);(!ze||Be(ze))&&(he.payload.task_id=z)}he.__entryStepsLoaded=!0}},gt=(o,b,L=null)=>{St(te.value,o,b,L),Array.isArray($.originalTasks)&&St($.originalTasks,o,b,L)},Qe=async o=>{var me;if(!rt(o))return{steps:Array.isArray(o==null?void 0:o.steps)&&o.steps.length>0?o.steps:((me=o==null?void 0:o.payload)==null?void 0:me.steps)||[]};const b=_t(o);if(!b)return{steps:(o==null?void 0:o.steps)||[]};const L=await Jt(b),z=(L==null?void 0:L.data)??L;if(!z)throw new Error("Missing task entry payload");const _e=Array.isArray(z.steps)?z.steps:[];return wt(o,_e,{entryId:b}),gt(o,_e,b),z.name&&!o.name&&(o.name=z.name),z.description!==void 0&&z.description!==null&&!o.description&&(o.description=z.description),z.name&&(o.payload.name=z.name),z.description!==void 0&&z.description!==null&&(o.payload.description=z.description),{steps:_e,entryData:z}},tt=o=>o.id||o.task_id||o.template_id||o.templateId||`temp-${Math.random()}`,W=o=>te.value.find(b=>tt(b)===o),$e=(o,b)=>{var ke,ze,Le,nt;if(!b)return!1;if(["name","description","estimated_minutes","category_id","equipment_node_id"].some(pt=>o[pt]!==b[pt]))return!0;const _e=JSON.stringify(o.assignee_ids||[]),me=JSON.stringify(b.assignee_ids||[]);if(_e!==me)return!0;const he=o.steps||((ke=o.payload)==null?void 0:ke.steps)||[],be=o.__originalTemplateSteps||o.__originalSteps||((ze=o.payload)==null?void 0:ze.__originalTemplateSteps)||((Le=o.payload)==null?void 0:Le.__originalSteps)||b.steps||((nt=b.payload)==null?void 0:nt.steps)||[];return fo(he,be)},Ke=()=>{ee.added.length=0,ee.updated.length=0,ee.deleted.length=0,f.tasks.forEach(o=>{var z,_e;const b=tt(o),L=W(b);if(L){if($e(o,L)){const me={id:L.id||L.task_id,name:o.name,description:o.description||"",time_estimate_sec:o.estimated_minutes?o.estimated_minutes*60:o.time_estimate_sec||1800,category_id:o.category_id,equipment_node_id:o.equipment_node_id,assignee_ids:o.assignee_ids||[]};let he=L;o.__originalTemplateSteps||(z=o.payload)!=null&&z.__originalTemplateSteps?he={...L,steps:o.__originalTemplateSteps||o.payload.__originalTemplateSteps,payload:{...L.payload||{},steps:o.__originalTemplateSteps||o.payload.__originalTemplateSteps}}:(o.__originalSteps||(_e=o.payload)!=null&&_e.__originalSteps)&&(he={...L,steps:o.__originalSteps||o.payload.__originalSteps,payload:{...L.payload||{},steps:o.__originalSteps||o.payload.__originalSteps}});const be=co(o,he);me.step_add_list=be.step_add_list,me.step_update_list=be.step_update_list,me.step_delete_list=be.step_delete_list,delete me.steps,ee.updated.push(me)}}else{const me={...o.payload||o};delete me.work_order_id,delete me.category_name,ee.added.push(me)}}),te.value.forEach(o=>{const b=tt(o);f.tasks.find(z=>tt(z)===b)||ee.deleted.push(o.id||o.task_id||o.template_id||o.templateId)})},H=o=>o.id||o.standard_id||o.standardId||`temp-${Math.random()}`,Oe=o=>N.value.find(b=>H(b)===o),Ie=(o,b)=>b?["name","description","category"].some(z=>o[z]!==b[z])||JSON.stringify(o.items||[])!==JSON.stringify(b.items||[]):!1,Ze=()=>{G.added.length=0,G.updated.length=0,G.deleted.length=0,f.standards.forEach(o=>{const b=H(o),L=Oe(b);L?Ie(o,L)&&G.updated.push({...o,id:L.id||L.standard_id,module:200}):G.added.push({...o,module:200})}),N.value.forEach(o=>{const b=H(o);f.standards.find(z=>H(z)===b)||G.deleted.push(o.id||o.standard_id||o.standardId)})},vt=(o,b)=>{const z=[o.id,o.local_id,o.task_id,o.taskId,o.reference_id,o.template_task_id,o.template_id,o.templateId].find(me=>me==null?!1:String(me).trim().length>0);if(!z)return`existing-task-${b}`;const _e=String(z).trim();return _e.length>0?_e:`existing-task-${b}`},I=o=>{if(!o||typeof o!="object")return!1;let b=!1;if(o.category&&typeof o.category=="object"){const L=o.category.name??o.category.label??o.category_name??"";o.category_name!==L&&(o.category_name=L,b=!0)}else typeof o.category=="string"&&o.category_name!==o.category&&(o.category_name=o.category,b=!0);if(o.category&&!o.category_name){const L=o.category.name??o.category.label??"";o.category_name!==L&&(o.category_name=L,b=!0)}return b},Z=o=>{if(!Array.isArray(o))return!1;let b=!1;return o.forEach(L=>{b=I(L)||b}),b},Q=(o,b)=>{var me,he,be,ke,ze;if(o&&typeof o=="object"&&o.payload&&typeof o.payload=="object"){const Le=We(o.payload);if(Le.work_order_id=Le.work_order_id??o.work_order_id??b??0,Le.state=Le.state??o.state??ia,(!Array.isArray(Le.steps)||Le.steps.length===0)&&(Le.steps=[Se()]),!Le.time_estimate_sec||Le.time_estimate_sec<=0){const nt=o.estimated_minutes??o.estimatedMinutes??0;Le.time_estimate_sec=o.time_estimate_sec??o.timeEstimateSec??nt*60}return Le.template_id==null&&(Le.template_id=o.template_id??o.templateId??null),Le.category_id==null&&(Le.category_id=o.category_id??((me=o.category)==null?void 0:me.id)??null),Le.category_name==null&&(Le.category_name=((he=o.category)==null?void 0:he.name)??o.category_name??""),Le.attachments=De(Le.attachments||o.attachments||o.file_list),Le}const L=Array.isArray(o==null?void 0:o.steps)?De(o.steps):[];L.length===0&&L.push(Se());const z=(o==null?void 0:o.estimated_minutes)||(o==null?void 0:o.estimatedMinutes)||0,_e=(o==null?void 0:o.time_estimate_sec)||(o==null?void 0:o.timeEstimateSec)||z*60;return{name:(o==null?void 0:o.name)||(o==null?void 0:o.task_name)||(o==null?void 0:o.task_list_text)||"Task",description:(o==null?void 0:o.description)||"",time_estimate_sec:_e,steps:L,attachments:De((o==null?void 0:o.attachments)||(o==null?void 0:o.file_list)),assignee_ids:De(o==null?void 0:o.assignee_ids),equipment_node_id:(o==null?void 0:o.equipment_node_id)||((be=o==null?void 0:o.equipment_node)==null?void 0:be.id)||null,location_id:(o==null?void 0:o.location_id)??null,category_id:(o==null?void 0:o.category_id)??((ke=o==null?void 0:o.category)==null?void 0:ke.id)??null,category_name:((ze=o==null?void 0:o.category)==null?void 0:ze.name)??(o==null?void 0:o.category_name)??"",work_order_id:(o==null?void 0:o.work_order_id)??b??0,state:(o==null?void 0:o.state)??ia,template_id:(o==null?void 0:o.template_id)??(o==null?void 0:o.templateId)??null}},ge=(o,b)=>Array.isArray(o)?o.map((L,z)=>{var he;if(L&&typeof L=="object"){const be=We(L),ke=Q(be,b),ze=be.category?We(be.category):ke.category_name?{id:ke.category_id??null,name:ke.category_name}:null,Le=(be.estimated_minutes??be.estimatedMinutes??Math.round((ke.time_estimate_sec||0)/60))||0,nt={id:vt(be,z),name:ke.name||`Task ${z+1}`,description:ke.description||"",category:ze,category_name:(ze==null?void 0:ze.name)||be.category_name||ke.category_name||"",estimated_minutes:Le,templateId:ke.template_id,template_id:ke.template_id,steps:Array.isArray(ke.steps)?ke.steps:[],source:be.source||(ke.template_id?"template":"adhoc"),payload:ke,rawTemplate:be.rawTemplate||be.template||null,total_steps:be.total_steps??((he=ke.steps)==null?void 0:he.length)??0,applicable_assets:Array.isArray(be.applicable_assets)?De(be.applicable_assets):be.applicable_assets?[String(be.applicable_assets)]:[]};return I(nt),nt}const _e=typeof L=="string"?L:`Task ${z+1}`,me=Q({name:_e},b);return{id:`existing-task-${z}`,name:_e,description:"",category:null,category_name:"",estimated_minutes:Math.round((me.time_estimate_sec||0)/60)||0,templateId:null,template_id:null,steps:me.steps,source:"adhoc",payload:me,rawTemplate:null,total_steps:me.steps.length,applicable_assets:[]}}):[],Te=S([]),Ee=S([]),qe=S([{id:84,name:"System"},{id:37,name:"Erik Yu"},{id:43,name:"Chang Shi"},{id:45,name:"Maxwell Wang"},{id:46,name:"Justin Li"},{id:47,name:"Justin Tung"},{id:48,name:"Eric Huang"}]),Ye=S([{id:36,name:"Yao Li"},{id:41,name:"John Li"}]),ct=S([]),ht=S([]),kt=S([]),Et=S([]),Lt=S([]),ft={children:"children",label:"name",value:"id"},Tt=o=>{const b=o.template_id||o.id;f.tasks.forEach((L,z)=>{if(L.source==="template"&&(L.templateId===b||L.template_id===b)){const _e=Zt(o);f.tasks[z]={...L,..._e,id:L.id,payload:{...L.payload||{},..._e.payload}},I(f.tasks[z])}}),f.tasks.some(L=>L.templateId===b||L.template_id===b)};He(()=>{ie.addTemplateUpdateListener(Tt)}),Mt(()=>{ie.removeTemplateUpdateListener(Tt)});const st=()=>{F||Ne(()=>{F=!1,$.saveContextAwareDraft(f,"edit")})};ye(()=>f.tasks,()=>{F||(Z(f.tasks),st())},{deep:!0}),ye(()=>f.standards,()=>{F||st()},{deep:!0}),ye(f,()=>{F||$.saveContextAwareDraft(f,"edit")},{deep:!0});const Xe=o=>f.start_date?o.getTime()<new Date(f.start_date).getTime():!1,pa=o=>{const b=new Date;return b.setHours(0,0,0,0),o.getTime()<b.getTime()},zt=M(()=>f.start_date&&f.due_date),Na=()=>{if(!f.start_date||!f.due_date)return"";const o=new Date(f.start_date),L=new Date(f.due_date).getTime()-o.getTime(),z=Math.ceil(L/(1e3*60*60*24));return z===1?"1 day":z>1?`${z} days`:"Less than 1 day"},Ba=o=>{if(!o)return"N/A";try{return new Date(o).toLocaleDateString()}catch{return"Invalid Date"}},xt=o=>{if(!o)return null;try{return new Date(o).toISOString()}catch{return null}},Yt={name:[{required:!0,message:"Work order name is required",trigger:"blur"},{min:3,max:200,message:"Name must be between 3 and 200 characters",trigger:"blur"}],equipment_node_ids:[{required:!0,message:"Please select at least one asset",trigger:"change"}],assignee_ids:[{required:!0,message:"Please assign at least one person",trigger:"change"}],due_date:[{required:!0,message:"Due date is required",trigger:"change"}],start_date:[{required:!0,message:"Start date is required",trigger:"change"}],end_date:[{required:!1,validator:(o,b,L)=>{b&&f.start_date&&new Date(b)<new Date(f.start_date)?L(new Error("End date must be after start date")):L()},trigger:"change"}]},ja=()=>{$.saveContextAwareDraft(f,"edit"),v.value=!0},ta=()=>{v.value=!1},aa=()=>{ta()},Ha=o=>{Array.isArray(o)&&(F=!0,o.forEach(b=>{const L=Zt(b);f.tasks.push(L)}),st(),ta())},Ut=async({action:o,data:b})=>{switch(o){case"preview":await va(b);break;case"edit":await ha(b);break;case"delete":Nt(b)&&B.success(`Task "${(b==null?void 0:b.name)||"Task"}" removed`);break;default:console.warn("Unknown task action:",o)}},Nt=o=>{const b=f.tasks.findIndex(L=>L.id===o.id);return b!==-1?(f.tasks.splice(b,1),st(),!0):!1},va=async o=>{var me,he,be,ke;if(!o)return B.warning("Unable to preview this task."),!1;const b=dt(f.tasks,o),L=b!==-1?f.tasks[b]:o;if(k.value=null,C.value=null,rt(L))try{E.value=!0,await Qe(L)}catch{return B.error("Failed to load task preview."),E.value=!1,!1}finally{E.value=!1}const z=Bt(b!==-1?f.tasks[b]:L),_e=z.templateId||z.template_id||((me=z.payload)==null?void 0:me.template_id)||((he=z.rawTemplate)==null?void 0:he.template_id)||((be=z.rawTemplate)==null?void 0:be.id)||null;if(mt(z)||!_e){const ze=Array.isArray(z.steps)&&z.steps.length>0?z.steps:Array.isArray((ke=z.payload)==null?void 0:ke.steps)?z.payload.steps:[];if(!Array.isArray(ze)||ze.length===0)return B.warning("No steps available to preview for this task."),!1;C.value={...z,steps:We(ze)},k.value=null}else k.value=_e,C.value=null;return w.value=!0,!0},Bt=o=>{var z,_e;Ke();const b=tt(o),L=ee.updated.find(me=>tt(me)===b);return L?{...o,...L,steps:L.steps||((z=L.payload)==null?void 0:z.steps)||o.steps||[],payload:L}:{...o,steps:o.steps||((_e=o.payload)==null?void 0:_e.steps)||[]}},ha=async o=>{var z,_e,me,he,be,ke,ze,Le,nt,pt;if(!o)return B.warning("Unable to edit this task."),!1;const b=dt(f.tasks,o),L=b!==-1?f.tasks[b]:o;try{K.value=!0;let Me=_t(L);if(rt(L))try{await Qe(L),L.__entryStepsLoaded=!0}catch{return B.error("Failed to load task details for editing."),!1}const at=Bt(b!==-1?f.tasks[b]:L),na=at.templateId||at.template_id||((z=at.payload)==null?void 0:z.template_id)||((_e=at.rawTemplate)==null?void 0:_e.template_id)||((me=at.rawTemplate)==null?void 0:me.id)||null,Qa=at.source==="adhoc"&&!na;if(!Qa&&na){const Je=_t(at);if(Je)try{const Ct=await Jt(Je),Qt=(Ct==null?void 0:Ct.data)||Ct;if(Qt&&Array.isArray(Qt.steps)){const Wt=We(Qt.steps);at.__originalTemplateSteps=Wt,b!==-1&&(f.tasks[b].__originalTemplateSteps=Wt),gt(at,Wt,Je)}}catch(Ct){console.warn("Failed to fetch task entry for comparison:",Ct)}else console.warn("Template task missing task entry ID, cannot fetch accurate baseline")}if(!na&&!Qa){B.warning("This task does not have an associated template to edit.");return}const kr=f.name||((he=e.workOrder)==null?void 0:he.name)||"Work Order",Zo=((be=e.workOrder)==null?void 0:be.id)??kr;$.saveContextAwareDraft(f,"edit"),$.setReturnRoute(X.fullPath),$.setReturnPanel("edit"),$.setReturnWorkOrderId(((ke=e.workOrder)==null?void 0:ke.id)??null),$.setShouldOpenCreatePanel(!1);const br=tt(at);if(!br)return B.error("Unable to edit task: missing task identifier. Please try refreshing and editing again."),!1;const Gt=String(br);if(!Me){const Je=ve(Gt);Je&&!Be(Je)&&(Me=Je)}const Ka={fromWorkOrder:"true",workOrderId:String(Zo),workOrderName:kr,taskId:Gt,returnPanel:"edit"};if((ze=e.workOrder)!=null&&ze.id&&(Ka.returnWorkOrderId=String(e.workOrder.id)),Qa){const Je={...o,...at,name:at.name||o.name,description:at.description||o.description,category:at.category||o.category,estimated_minutes:at.estimated_minutes||o.estimated_minutes,equipment_node_id:at.equipment_node_id||o.equipment_node_id,steps:at.steps||((Le=at.payload)==null?void 0:Le.steps)||o.steps||[]};if(Je.id=Gt,Je.task_id==null&&(Je.task_id=Gt),Je.payload&&typeof Je.payload=="object"&&(Je.payload.id==null&&(Je.payload.id=Gt),Je.payload.task_id==null&&(Je.payload.task_id=Gt)),Me&&(Je.entry_id=Me),!Je.name){B.error("Unable to edit task: missing task name. Please try refreshing and editing again.");return}if(!Je.id){B.error("Unable to edit task: missing task ID. Please try refreshing and editing again.");return}const Ct=`standalone-task-${Je.id}-${Date.now()}`;sessionStorage.setItem(Ct,JSON.stringify(Je));try{sessionStorage.setItem("last-standalone-task-key",Ct)}catch(Kt){console.warn("WorkOrderEdit: Failed to persist last standalone task key",Kt)}$.setPendingStandaloneTask(Je);let Qt=null;try{Qt=JSON.stringify(Je)}catch(Kt){console.warn("WorkOrderEdit: Failed to serialize standalone task data for query payload",Kt)}const Wt={...Ka,standalone:"true",taskDataKey:Ct,taskData:Qt||void 0,taskEntryId:Me?String(Me):void 0};Object.keys(Wt).forEach(Kt=>{Wt[Kt]===void 0&&delete Wt[Kt]}),await oe.push({name:"TaskDesignerEdit",params:{id:"standalone"},query:Wt})}else await oe.push({name:"TaskDesignerEdit",params:{id:na},query:{...Ka,originalTemplateId:na}})}catch(Me){const at=((pt=(nt=Me.response)==null?void 0:nt.data)==null?void 0:pt.message)||Me.message||"Failed to open task editor";return B.error(at),!1}finally{K.value=!1}return!0},Ja=()=>{lt.confirm("Are you sure you want to remove all tasks?","Confirm Remove All Tasks",{confirmButtonText:"Remove All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{f.tasks.splice(0),st(),B.success("All tasks removed successfully")}).catch(()=>{})},ya=()=>{w.value=!1,k.value=null,C.value=null},wa=()=>{ya()},A=()=>{if(C.value)return C.value.name||"Unnamed Task";if(k.value){const o=k.value,b=f.tasks.find(L=>{var z;return L.templateId===o||L.template_id===o||((z=L.payload)==null?void 0:z.template_id)===o||L.id===o});return(b==null?void 0:b.name)||"Task Preview"}return"Task Preview"},ae=()=>{d.value=!0},J=()=>{d.value=!1},ue=()=>{J()},Ve=o=>{Array.isArray(o)&&(F=!0,o.forEach(b=>{f.standards.push(b)}),st(),J())},Ue=({action:o,data:b})=>{switch(o){case"preview":Ot(b);break;case"edit":ka(b);break;case"delete":je(b)&&B.success(`Standard "${(b==null?void 0:b.name)||"Standard"}" removed`);break;default:console.warn("Unknown standard action:",o)}},je=o=>{const b=f.standards.findIndex(L=>L.id===o.id);return b!==-1?(f.standards.splice(b,1),st(),!0):!1},Ot=o=>{P.value=o,h.value=!0},ka=o=>{p.value=o,u.value=!0},ra=o=>{const b=f.standards.findIndex(L=>L.id===o.id);b!==-1&&(f.standards.splice(b,1,o),st()),u.value=!1,p.value=null},oa=()=>{lt.confirm("Are you sure you want to remove all standards?","Confirm Remove All Standards",{confirmButtonText:"Remove All",cancelButtonText:"Cancel",type:"warning"}).then(()=>{f.standards.splice(0),st(),B.success("All standards removed successfully")}).catch(()=>{})},jt=o=>{f.image_list=o},ur=o=>{f.file_list=o},Ft=async()=>{try{const o=[...f.image_list,...f.file_list];if(o.length===0)return;const b=await da(o);f.image_list=b.images||[],f.file_list=b.files||[]}catch{throw new Error("File upload failed. Please try again.")}},ot=()=>{if(!fr()){y("back-to-detail");return}lt.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}).then(()=>{y("back-to-detail")}).catch(()=>{})},No=()=>{lt.confirm("Are you sure you want to reset the form? All unsaved changes will be lost.","Confirm Reset",{confirmButtonText:"Reset",cancelButtonText:"Cancel",type:"warning"}).then(()=>{mr()}).catch(()=>{})},mr=()=>{ba(e.workOrder)},fr=()=>{var o,b;return f.name!==(((o=e.workOrder)==null?void 0:o.name)||"")||f.description!==(((b=e.workOrder)==null?void 0:b.description)||"")},ba=o=>{var b,L,z,_e,me;if(o){F=!0;try{f.name=o.name||"",f.description=o.description||"";const he=o.start_date||o.start_date_time||o.expected_start_date,be=o.due_date||o.due_date_time||o.expected_due_date,ke=o.end_date||o.end_date_time||o.expected_end_date||be;if(f.start_date=Pe(he),f.due_date=Pe(be),f.end_date=Pe(ke),Array.isArray(o.categories)&&o.categories.length)f.category_ids=o.categories.map(Me=>Me.id);else if(Array.isArray(o.category_list)&&o.category_list.length)f.category_ids=o.category_list.map(Me=>Me.id);else if(o.category){const Me=typeof o.category=="object"?o.category.id:o.category;f.category_ids=Me?[Me]:[]}else f.category_ids=De(o.category_ids)||[];if(f.equipment_node_ids=Array.isArray(o.equipment_nodes)?o.equipment_nodes.map(Me=>Me.id):De(o.equipment_node_ids),f.assignee_ids=Array.isArray(o.assignees)?o.assignees.map(Me=>Me.id):De(o.assignee_ids),f.vendor_ids=De(o.vendor_ids),f.priority_id=((b=o.priority)==null?void 0:b.id)||o.priority_id||null,f.state_id=((L=o.state)==null?void 0:L.id)||o.state_id||1,f.work_type_id=((z=o.work_type)==null?void 0:z.id)||o.work_type_id||null,f.approved_by_id=((_e=o.approved_by)==null?void 0:_e.id)||o.approved_by_id||null,(!Array.isArray(f.assignee_ids)||f.assignee_ids.length===0)&&qe.value.length>0){const Me=Ae(qe.value);f.assignee_ids=Me?[Me]:[]}if((f.approved_by_id==null||f.approved_by_id==="")&&Ye.value.length>0){const Me=Ae(Ye.value);Me!=null&&(f.approved_by_id=Me)}if((!Array.isArray(f.category_ids)||f.category_ids.length===0)&&kt.value.length>0){const Me=Ae(kt.value);f.category_ids=Me!=null?[Me]:[]}const ze=Array.isArray(o.tasks)&&o.tasks.length>0?o.tasks:Array.isArray(o.task_list)?o.task_list:[];f.tasks=ge(ze,o.id);const Le=Array.isArray(o.standards)&&o.standards.length>0?o.standards:Array.isArray(o.standard_list)?o.standard_list:[],nt=We(Le);f.standards=Array.isArray(nt)?nt:[],te.value=We(f.tasks),N.value=We(f.standards),$.originalTasks=We(f.tasks),$.originalStandards=We(f.standards),f.image_list=De(o.image_list),f.file_list=De(o.file_list),Te.value=De(o.image_list),Ee.value=De(o.file_list);const pt={};o.recurrence_type&&(pt.recurrence_type=o.recurrence_type.id),((me=o.recurrence_type)==null?void 0:me.id)===1&&(he&&(pt.start_date_time=Pe(he)),ke&&(pt.end_date_time=Pe(ke))),f.recurrence_setting=pt,o.recurrence_type&&(f.recurrence_type=o.recurrence_type.id,f.recurrence_type_id=o.recurrence_type.id),f.recurrence_setting_request=We(o.recurrence_setting_request||{start_date_time:he?Pe(he):null,end_date_time:ke?Pe(ke):null}),!f.recurrence_setting_request.start_date_time&&he&&(f.recurrence_setting_request.start_date_time=Pe(he)),!f.recurrence_setting_request.end_date_time&&ke&&(f.recurrence_setting_request.end_date_time=Pe(ke)),Z(f.tasks)}finally{F=!1}st()}},_r=({taskId:o,assigneeIds:b,taskData:L})=>{const z=f.tasks.findIndex(me=>me.id===o);if(z===-1)return;f.tasks[z].payload?f.tasks[z].payload.assignee_ids=b:f.tasks[z].assignee_ids=b,st();const _e=qe.value.filter(me=>b.includes(me.id)).map(me=>me.name).join(", ");b.length===0?B.success(`Removed all assignees from "${L.name}"`):B.success(`Updated assignees for "${L.name}": ${_e}`)},Bo=({taskId:o,taskData:b,currentAssigneeIds:L})=>{var _e;q.value=b,le.value="";const z=((_e=b.payload)==null?void 0:_e.assignee_ids)||b.assignee_ids||[];V.value=[...z],T.value=!0},jo=M(()=>{if(!le.value)return qe.value;const o=le.value.toLowerCase();return qe.value.filter(b=>b.name.toLowerCase().includes(o)||b.email&&b.email.toLowerCase().includes(o))}),gr=o=>V.value.includes(o),Ho=o=>{gr(o.id)?vr(o.id):pr(o.id)},pr=o=>{V.value.includes(o)||V.value.push(o)},vr=o=>{V.value=V.value.filter(b=>b!==o)},Jo=()=>{V.value=[]},Yo=()=>V.value.map(o=>qe.value.find(L=>L.id===o)||{id:o,name:`User #${o}`,email:""}),Go=()=>{q.value&&(_r({taskId:q.value.id,assigneeIds:[...V.value],taskData:q.value}),hr())},hr=()=>{T.value=!1,q.value=null,V.value=[],le.value=""},yr=async()=>{try{K.value=!0;const[o,b,L,z,_e]=await Promise.all([Ia(),Va(),xa(),Fa(),Ea()]);ct.value=o.data||[],ht.value=b.data||[],kt.value=L.data||[],Et.value=z.data||[],Lt.value=_e.data||[],ba(e.workOrder)}catch{B.error("Failed to load form data. Please refresh and try again.")}finally{K.value=!1}},Ya=()=>{var _e;const o=xt(f.due_date),b=xt(f.start_date),L=xt(f.end_date);Ke(),Ze();const z={name:f.name,description:f.description||"",category_ids:f.category_ids||[],priority_id:f.priority_id,state_id:f.state_id,work_type_id:f.work_type_id,start_date:b,due_date:o,end_date:L,assignee_ids:f.assignee_ids||[],approved_by_id:f.approved_by_id,equipment_node_ids:f.equipment_node_ids||[],vendor_ids:f.vendor_ids||[],task_add_list:ee.added,task_update_list:ee.updated,task_delete_list:ee.deleted,standard_add_list:G.added,standard_update_list:G.updated,standard_delete_list:G.deleted,image_list:f.image_list||[],file_list:f.file_list||[],recurrence_setting_request:f.recurrence_setting_request||{},recurrence_type:f.recurrence_type||f.recurrence_type_id||1,recurrence_type_id:f.recurrence_type||f.recurrence_type_id||1,time_zone:f.time_zone||Intl.DateTimeFormat().resolvedOptions().timeZone};return(_e=e.workOrder)!=null&&_e.recurrence_uuid&&(z.recurrence_uuid=e.workOrder.recurrence_uuid),z},Qo=()=>{if(_.value)return;_.value=!0,de&&clearTimeout(de),de=setTimeout(()=>{_.value=!1},500);const o=Ya();R(o,"workOrderEdit",{delay:50,showMessage:!0})},Ko=async()=>{var o,b,L;if(fe.value)try{if(!await fe.value.validate()){B.error(pe("workOrder.messages.validationFailed"));return}K.value=!0,(f.image_list.length>0||f.file_list.length>0)&&await Ft();const _e=xt(f.start_date),me=xt(f.end_date);f.recurrence_setting_request&&(!f.recurrence_setting_request.start_date_time&&_e&&(f.recurrence_setting_request.start_date_time=_e),!f.recurrence_setting_request.end_date_time&&me&&(f.recurrence_setting_request.end_date_time=me));const he=Ya(),be=ca(he,"workOrderUpdate");let ke;const ze=((o=e.workOrder)==null?void 0:o.recurrence_uuid)&&e.workOrder.recurrence_uuid.trim()!=="",Le=((L=(b=e.workOrder)==null?void 0:b.recurrence_type)==null?void 0:L.id)===1;ze&&!Le?ke=await Er(be):ke=await Lr(e.workOrder.id,be);const pt=Array.isArray(ke.data)?ke.data[0]:ke.data;y("work-order-updated",pt),y("back-to-detail")}catch{K.value=!1}finally{K.value=!1}},Sa=()=>{var L,z;if(!$.hasDraft)return;!$.isEditMode&&$.currentContext!==null&&$.setContext("edit"),F=!0;const o=((L=$.draftForm)==null?void 0:L.tasks)||[],b=((z=$.draftForm)==null?void 0:z.standards)||[];if(o.length>0){const _e=[];f.tasks.forEach(me=>{const he=tt(me),be=o.find(ke=>tt(ke)===he);be?_e.push({...be,isFromEdit:!0}):_e.push(me)}),o.forEach(me=>{const he=tt(me);f.tasks.some(ke=>tt(ke)===he)||_e.push({...me,isFromEdit:!0})}),f.tasks.splice(0,f.tasks.length,..._e)}if(b.length>0){const _e=[];f.standards.forEach(me=>{const he=H(me),be=b.find(ke=>H(ke)===he);be?_e.push(be):_e.push(me)}),b.forEach(me=>{const he=H(me);f.standards.some(ke=>H(ke)===he)||_e.push(me)}),f.standards.splice(0,f.standards.length,..._e)}Z(f.tasks),st(),Ne(()=>{if(f.tasks.length>0){const _e=[...f.tasks];f.tasks.splice(0,f.tasks.length,..._e)}if(f.standards.length>0){const _e=[...f.standards];f.standards.splice(0,f.standards.length,..._e)}st(),U.value=!0}),$.originalTasks&&$.originalTasks.length>0&&(te.value=We($.originalTasks)),$.originalStandards&&$.originalStandards.length>0&&(N.value=We($.originalStandards)),Ne(()=>{F=!1,setTimeout(()=>{$.clearDraft(),$.clearReturnContext(),U.value=!1},100)})};He(async()=>{$.setEditModeData(e.workOrder),await yr(),Ne(()=>{setTimeout(()=>{Sa()},150)})}),ye(()=>e.workOrder,o=>{if(o){const b=o.id!==f.workOrderId,L=$.hasDraft,z=U.value;b||!z&&!L?(f.workOrderId=o.id,ba(o)):console.log("WorkOrderEdit: Skipping populateFormFromWorkOrder - preserving hydrated/draft state")}},{immediate:!0}),ye(()=>$.hasDraft,o=>{o&&$.isEditMode&&Sa()});const Ga=o=>{var he,be,ke,ze,Le;const b=new Set;o.id!=null&&b.add(String(o.id)),o.task_id!=null&&b.add(String(o.task_id));const L=f.tasks.findIndex(nt=>et(nt).map(ve).filter(Boolean).some(Me=>b.has(Me)));if(L===-1){B.warning("Could not find task to update");return}const z=f.tasks[L],_e=Array.isArray(o.steps)&&o.steps.length>0?We(o.steps):Array.isArray((he=o.payload)==null?void 0:he.steps)&&o.payload.steps.length>0?We(o.payload.steps):z.steps,me={...z,...o,id:z.id};if(_e&&(me.steps=We(_e)),o.payload)me.payload={...z.payload||{},...o.payload,steps:We(o.payload.steps||_e||((be=z.payload)==null?void 0:be.steps)||[])};else{const nt=_e||((ke=z.payload)==null?void 0:ke.steps)||[];me.payload={...z.payload||{},name:me.name??((ze=z.payload)==null?void 0:ze.name),description:me.description??((Le=z.payload)==null?void 0:Le.description),steps:We(nt)}}me.__hasLocalEdits=!0,me.__entryStepsLoaded=!0,f.tasks.splice(L,1,me),I(f.tasks[L]),st()};ye(()=>X.query.taskData,o=>{if(o)try{const b=JSON.parse(o);Ga(b)}catch{B.error("Failed to process returned task data")}finally{oe.replace({query:{...X.query,taskData:void 0,taskId:void 0,shouldFetchEntry:void 0,taskEntryId:void 0}})}},{immediate:!0}),ye(()=>X.query.taskDataKey,o=>{if(o)try{const b=sessionStorage.getItem(o);if(b){const L=JSON.parse(b);sessionStorage.removeItem(o),Ga(L)}else console.warn("WorkOrderEdit: No session data found for key",o)}catch{B.error("Failed to process returned task data")}finally{oe.replace({query:{...X.query,taskDataKey:void 0,taskId:void 0,shouldFetchEntry:void 0,taskEntryId:void 0}})}},{immediate:!0}),la(()=>{$.hasDraft&&$.isEditMode&&Sa(),ie.addTemplateUpdateListener(Tt)});const wr={props:e,emit:y,showAddTaskDialog:v,showAddStandardDialog:d,showEditStandardDialog:u,editingStandard:p,showTaskPreviewDialog:w,showStandardPreviewDialog:h,previewTaskTemplateId:k,previewTaskData:C,previewStandardData:P,isTaskInteractive:O,previewTaskLoading:E,showTaskAssigneeDialog:T,currentEditingTask:q,userSearchQuery:le,localSelectedTaskAssignees:V,standalonePreviewTab:j,t:pe,router:oe,route:X,taskLibraryStore:ie,workOrderDraftStore:$,currentPayload:ce,showJsonDisplayer:ne,logPayload:R,formRef:fe,loading:K,isLoggingInProgress:_,get logButtonTimeout(){return de},set logButtonTimeout(o){de=o},form:f,get isHydratingForm(){return F},set isHydratingForm(o){F=o},hasHydratedFromDraft:U,originalTasks:te,originalStandards:N,taskChanges:ee,standardChanges:G,editHeaderTitle:re,createFallbackStep:Se,cloneArray:De,formatDateTimeForPicker:Pe,pickRandomOptionId:Ae,normalizeIdentifier:ve,generatedIdPrefixes:Fe,isGeneratedIdentifier:Be,getTaskIdentityCandidates:et,findTaskIndexInCollection:dt,resolveTaskEntryId:_t,hasTemplateAssociation:Vt,isStandaloneTaskRecord:mt,needsStandaloneEntryFetch:rt,applyStepsToTask:wt,updateTaskStepsInCollection:St,syncOriginalTaskEntrySteps:gt,ensureStandaloneTaskEntryData:Qe,getTaskIdentifier:tt,findOriginalTask:W,isTaskModified:$e,calculateTaskChanges:Ke,getStandardIdentifier:H,findOriginalStandard:Oe,isStandardModified:Ie,calculateStandardChanges:Ze,buildExistingTaskId:vt,decorateTaskCategory:I,decorateTasksCategories:Z,buildPayloadFromExistingTask:Q,normalizeExistingTasks:ge,existingImages:Te,existingFiles:Ee,assigneeOptions:qe,supervisorOptions:Ye,workTypeOptions:ct,priorityOptions:ht,categoryOptions:kt,stateOptions:Et,assetTreeData:Lt,treeProps:ft,handleTemplateUpdate:Tt,syncFormData:st,disabledDueDates:Xe,disabledStartDates:pa,showWorkOrderDuration:zt,formatWorkOrderDuration:Na,formatDate:Ba,toUtcIso:xt,rules:Yt,handleAddTask:ja,closeAddTaskDialog:ta,handleCloseAddTaskDialog:aa,onAddTaskTemplates:Ha,handleTaskAction:Ut,handleRemoveTask:Nt,handlePreviewTask:va,getMostCurrentTaskData:Bt,handleEditTask:ha,handleDeleteAllTasks:Ja,handleCloseTaskPreview:ya,handleBackToTaskList:wa,getPreviewTaskTitle:A,handleAddStandard:ae,closeAddStandardDialog:J,handleCloseAddStandardDialog:ue,onAddStandards:Ve,handleStandardAction:Ue,handleRemoveStandard:je,handlePreviewStandard:Ot,handleEditStandard:ka,onStandardUpdate:ra,handleDeleteAllStandards:oa,handleImageListUpdate:jt,handleFilesListUpdate:ur,uploadFilesToServer:Ft,handleBackToDetail:ot,resetForm:No,resetFormSilent:mr,checkForUnsavedChanges:fr,populateFormFromWorkOrder:ba,handleTaskAssigneeUpdate:_r,handleOpenAssigneeDialog:Bo,filteredAssigneeOptions:jo,isUserSelected:gr,toggleUser:Ho,addSelectedUser:pr,removeSelectedUser:vr,clearAllAssignees:Jo,getSelectedUserObjects:Yo,saveTaskAssignees:Go,resetTaskAssigneeDialog:hr,loadFormData:yr,createWorkOrderPayload:Ya,logCurrentPayload:Qo,submitForm:Ko,hydrateFormFromDraft:Sa,applyStandaloneTaskReturn:Ga,ref:S,reactive:it,onMounted:He,onActivated:la,onBeforeUnmount:Mt,watch:ye,nextTick:Ne,computed:M,get ElMessage(){return B},get ElMessageBox(){return lt},get ArrowLeft(){return ea},get RefreshLeft(){return To},get Plus(){return Ra},get Delete(){return Ma},get DocumentAdd(){return So},get Document(){return sa},get List(){return sr},get DocumentChecked(){return bo},get Edit(){return or},get Calendar(){return Oo},get Search(){return qt},get useI18n(){return Ge},RecurrenceEditor:Co,MaintenanceSelectedTaskCard:Po,MaintenanceSelectedStandardsCard:Ao,AddTask:Ro,AddStandard:Mo,FileUploadMultiple:Vo,get JsonDebugDrawer(){return cr},get usePayloadLogger(){return Xt},get clonePayload(){return We},get transformPayload(){return ca},EditStandardDialog:qo,StepsPreview:ga,StandardsPreview:za,get uploadMultipleToMinio(){return da},get getAllWorkTypes(){return Ia},get getAllPriorities(){return Va},get getAllCategories(){return xa},get getAllStates(){return Fa},get getEquipmentNodeTrees(){return Ea},get updateWorkOrder(){return Lr},get updateRecurrenceWorkOrders(){return Er},get getTaskEntryById(){return Jt},get getTaskTemplateById(){return tr},get useRouter(){return yt},get useRoute(){return At},get useTaskLibraryStore(){return La},get useWorkOrderDraftStore(){return It},get createEmptyWorkOrderForm(){return Rt},get DEFAULT_TASK_STATE(){return ia},get buildDisplayTaskFromTemplate(){return Zt},get calculateStepChangesForTask(){return co},get hasAnyStepChanged(){return fo}};return Object.defineProperty(wr,"__isScriptSetup",{enumerable:!1,value:!0}),wr}},d_={class:"work-order-edit-enhanced"},c_={class:"edit-header"},u_={class:"header-main"},m_={class:"edit-title"},f_={key:0,class:"header-meta"},__={class:"edit-info"},g_={class:"edit-info"},p_={class:"header-actions"},v_={class:"form-section"},h_={class:"form-section"},y_={class:"form-section"},w_={class:"form-section"},k_={class:"form-section"},b_={class:"form-section tasks-section"},S_={class:"section-header"},T_={class:"section-title"},O_={key:0,class:"task-actions"},C_={key:0,class:"empty-tasks"},D_={class:"empty-content"},A_={class:"tasks-list"},P_={class:"form-section standards-section"},I_={class:"section-header"},V_={class:"section-title"},x_={key:0,class:"standards-actions"},F_={key:0,class:"empty-standards"},E_={class:"empty-content"},L_={class:"standards-list"},W_={class:"form-section"},R_={key:0,class:"work-order-duration"},M_={class:"form-section"},q_={class:"form-section"},z_={class:"form-section"},U_={class:"form-section"},N_={class:"form-section"},B_={class:"form-section"},j_={class:"upload-section"},H_={class:"form-actions-fixed"},J_={class:"form-actions-content"},Y_={class:"preview-dialog-header"},G_=["id"],Q_={class:"preview-content"},K_={key:2,class:"preview-empty"},Z_={class:"standalone-standard-preview"},X_={class:"standard-details"},$_={class:"fixed-header-section"},eg={class:"standard-tabs-header"},tg={class:"scrollable-content"},ag={class:"tab-content-wrapper"},rg={key:0,class:"tab-pane-content"},og={class:"overview-card"},ng={class:"card-content"},sg={class:"info-value highlight"},lg={key:0,class:"description-card"},ig={class:"card-content"},dg={class:"description-text"},cg={key:1,class:"tab-pane-content"},ug={key:0,class:"rules-list"},mg={class:"card-header"},fg={class:"rules-container"},_g={class:"rule-number"},gg={class:"rule-content"},pg={class:"rule-text"},vg={key:1,class:"empty-rules"},hg={class:"assignee-picker"},yg={class:"search-section"},wg={class:"available-section"},kg={key:0,class:"empty-users"},bg={key:1,class:"users-list"},Sg=["onClick"],Tg={class:"user-info"},Og={class:"user-name"},Cg={key:0,class:"user-email"},Dg={class:"user-actions"},Ag={key:0,class:"selected-section"},Pg={class:"selected-section-header"},Ig={class:"selected-users"},Vg={class:"dialog-footer"};function xg(s,t,i,e,y,v){var K;const d=D("el-icon"),u=D("el-col"),p=D("el-button"),w=D("el-row"),h=D("el-input"),k=D("el-form-item"),C=D("el-tree-select"),P=D("el-option"),O=D("el-select"),E=D("el-divider"),T=D("el-date-picker"),q=D("el-text"),le=D("el-form"),V=D("el-dialog"),j=D("el-switch"),pe=D("el-tooltip"),oe=D("el-tab-pane"),X=D("el-tabs"),ie=D("el-descriptions-item"),$=D("el-tag"),ce=D("el-descriptions"),ne=D("el-empty"),R=D("el-checkbox"),fe=_a("loading");return c(),g("div",d_,[l(" Edit Header "),a("div",c_,[r(w,{justify:"space-between",align:"top",gutter:16},{default:n(()=>[r(u,{span:18},{default:n(()=>[a("div",u_,[a("h2",m_,m(e.editHeaderTitle),1),i.workOrder?(c(),g("div",f_,[a("div",__,[r(d,null,{default:n(()=>[r(e.Edit)]),_:1}),a("span",null,"ID: #"+m(i.workOrder.id),1)]),a("div",g_,[r(d,null,{default:n(()=>[r(e.Calendar)]),_:1}),a("span",null,"Created On: "+m(e.formatDate(i.workOrder.created_at)),1)])])):l("v-if",!0)])]),_:1}),r(u,{span:6},{default:n(()=>[a("div",p_,[r(p,{type:"default",onClick:e.handleBackToDetail},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ArrowLeft)]),_:1}),x(" "+m(s.$t("workOrder.actions.backToDetail")),1)]),_:1}),r(p,{type:"warning",onClick:e.resetForm,plain:""},{default:n(()=>[r(d,null,{default:n(()=>[r(e.RefreshLeft)]),_:1}),x(" "+m(s.$t("workOrder.actions.reset")),1)]),_:1})])]),_:1})]),_:1})]),l(" Form Container "),Pt((c(),Y(le,{ref:"formRef",model:e.form,rules:e.rules,"label-position":"top",class:"edit-form"},{default:n(()=>[l(" Task Title "),a("div",v_,[r(k,{prop:"name"},{default:n(()=>[r(h,{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.form.name=_),placeholder:s.$t("workOrder.create.taskTitlePlaceholder"),size:"large",class:"task-title-input"},null,8,["modelValue","placeholder"])]),_:1})]),l(" Description "),a("div",h_,[r(k,{label:s.$t("workOrder.form.description"),prop:"description"},{default:n(()=>[r(h,{modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=_=>e.form.description=_),type:"textarea",placeholder:s.$t("workOrder.create.descriptionPlaceholder"),rows:3,resize:"vertical"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Asset Tree Select "),a("div",y_,[r(k,{label:s.$t("workOrder.create.asset"),prop:"equipment_node_ids"},{default:n(()=>[r(C,{modelValue:e.form.equipment_node_ids,"onUpdate:modelValue":t[2]||(t[2]=_=>e.form.equipment_node_ids=_),data:e.assetTreeData,props:e.treeProps,placeholder:s.$t("workOrder.create.assetPlaceholder"),"check-strictly":"","render-after-expand":!1,multiple:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])]),l(" Assigned To "),a("div",w_,[r(k,{label:s.$t("workOrder.create.assignTo"),prop:"assignee_ids"},{default:n(()=>[r(O,{modelValue:e.form.assignee_ids,"onUpdate:modelValue":t[3]||(t[3]=_=>e.form.assignee_ids=_),placeholder:s.$t("workOrder.create.assigneePlaceholder"),filterable:"",multiple:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.assigneeOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Supervisor "),a("div",k_,[r(k,{label:"Supervisor",prop:"approved_by_id"},{default:n(()=>[r(O,{modelValue:e.form.approved_by_id,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.approved_by_id=_),placeholder:"Select Supervisor",filterable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.supervisorOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),l(" Tasks "),r(E),a("div",b_,[r(k,null,{label:n(()=>[a("div",S_,[a("span",T_,[r(d,{class:"section-icon tasks-icon"},{default:n(()=>[r(e.List)]),_:1}),t[24]||(t[24]=x(" Tasks "))]),e.form.tasks.length>0?(c(),g("div",O_,[r(p,{size:"default",onClick:e.handleAddTask,icon:e.Plus},{default:n(()=>t[25]||(t[25]=[x(" Add Task ")])),_:1,__:[25]},8,["icon"]),r(p,{size:"default",onClick:e.handleDeleteAllTasks,icon:e.Delete},{default:n(()=>[x(" Clear All ("+m(e.form.tasks.length)+") ",1)]),_:1},8,["icon"])])):l("v-if",!0)])]),default:n(()=>[a("div",{class:xe(["tasks-container",{"no-tasks":e.form.tasks.length===0}])},[l(" Empty State "),e.form.tasks.length===0?(c(),g("div",C_,[a("div",D_,[r(d,{class:"empty-icon"},{default:n(()=>[r(e.DocumentAdd)]),_:1}),t[27]||(t[27]=a("h4",null,"No Tasks Added",-1)),t[28]||(t[28]=a("p",null,"Add the task to start building the work order",-1)),r(p,{type:"primary",onClick:e.handleAddTask},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Plus)]),_:1}),t[26]||(t[26]=x(" Add Task "))]),_:1,__:[26]})])])):(c(),g(se,{key:1},[l(" Tasks List "),a("div",A_,[(c(!0),g(se,null,we(e.form.tasks,_=>(c(),Y(e.MaintenanceSelectedTaskCard,{key:_.id,template:_,"assignee-options":e.assigneeOptions,onSelection:e.handleTaskAction,onAssigneeUpdate:e.handleTaskAssigneeUpdate,onOpenAssigneeDialog:e.handleOpenAssigneeDialog,class:"task-card"},null,8,["template","assignee-options"]))),128))])],2112))],2)]),_:1})]),l(" Standards "),r(E),a("div",P_,[r(k,null,{label:n(()=>[a("div",I_,[a("span",V_,[r(d,{class:"section-icon standards-icon"},{default:n(()=>[r(e.DocumentChecked)]),_:1}),t[29]||(t[29]=x(" Standards "))]),e.form.standards.length>0?(c(),g("div",x_,[r(p,{size:"default",onClick:e.handleAddStandard,icon:e.Plus},{default:n(()=>t[30]||(t[30]=[x(" Add Standard ")])),_:1,__:[30]},8,["icon"]),r(p,{size:"default",onClick:e.handleDeleteAllStandards,icon:e.Delete},{default:n(()=>[x(" Clear All ("+m(e.form.standards.length)+") ",1)]),_:1},8,["icon"])])):l("v-if",!0)])]),default:n(()=>[a("div",{class:xe(["standards-container",{"no-standards":e.form.standards.length===0}])},[l(" Empty State "),e.form.standards.length===0?(c(),g("div",F_,[a("div",E_,[r(d,{class:"empty-icon"},{default:n(()=>[r(e.Document)]),_:1}),t[32]||(t[32]=a("h4",null,"No Standards Added",-1)),t[33]||(t[33]=a("p",null,"Add the standard to ensure work order compliance",-1)),r(p,{type:"primary",onClick:e.handleAddStandard},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Plus)]),_:1}),t[31]||(t[31]=x(" Add Standard "))]),_:1,__:[31]})])])):(c(),g(se,{key:1},[l(" Standards List "),a("div",L_,[(c(!0),g(se,null,we(e.form.standards,_=>(c(),Y(e.MaintenanceSelectedStandardsCard,{key:_.id,template:_,onSelection:e.handleStandardAction,class:"standard-card"},null,8,["template"]))),128))])],2112))],2)]),_:1})]),l(" Due Date "),a("div",W_,[r(k,{label:s.$t("workOrder.create.dueDate"),prop:"due_date"},{default:n(()=>[r(T,{modelValue:e.form.due_date,"onUpdate:modelValue":t[5]||(t[5]=_=>e.form.due_date=_),type:"datetime",placeholder:s.$t("workOrder.create.dueDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledDueDates},null,8,["modelValue","placeholder"]),e.showWorkOrderDuration?(c(),g("div",R_,[r(q,{type:"info",size:"small"},{default:n(()=>[x(" Work order duration: "+m(e.formatWorkOrderDuration()),1)]),_:1})])):l("v-if",!0)]),_:1},8,["label"])]),l(" Start Date "),a("div",M_,[r(k,{label:s.$t("workOrder.create.startDate"),prop:"start_date"},{default:n(()=>[r(T,{modelValue:e.form.start_date,"onUpdate:modelValue":t[6]||(t[6]=_=>e.form.start_date=_),type:"datetime",placeholder:s.$t("workOrder.create.startDatePlaceholder"),style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledStartDates},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" End Date "),a("div",q_,[r(k,{label:"End Date",prop:"end_date"},{default:n(()=>[r(T,{modelValue:e.form.end_date,"onUpdate:modelValue":t[7]||(t[7]=_=>e.form.end_date=_),type:"datetime",placeholder:"Select end date",style:{width:"100%"},format:"MM/DD/YYYY HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":e.disabledDueDates},null,8,["modelValue"])]),_:1})]),l(" Work Type, Priority, and State "),a("div",z_,[r(w,{gutter:16},{default:n(()=>[r(u,{span:8},{default:n(()=>[r(k,{label:s.$t("workOrder.create.workType"),prop:"work_type_id"},{default:n(()=>[r(O,{modelValue:e.form.work_type_id,"onUpdate:modelValue":t[8]||(t[8]=_=>e.form.work_type_id=_),placeholder:s.$t("workOrder.create.workTypePlaceholder"),style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.workTypeOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(u,{span:8},{default:n(()=>[r(k,{label:s.$t("workOrder.create.priority"),prop:"priority_id"},{default:n(()=>[r(O,{modelValue:e.form.priority_id,"onUpdate:modelValue":t[9]||(t[9]=_=>e.form.priority_id=_),placeholder:s.$t("workOrder.create.priorityPlaceholder"),style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.priorityOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),r(u,{span:8},{default:n(()=>[r(k,{label:"State",prop:"state_id"},{default:n(()=>[r(O,{modelValue:e.form.state_id,"onUpdate:modelValue":t[10]||(t[10]=_=>e.form.state_id=_),placeholder:"Select state...",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.stateOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l(" Recurrence Settings "),a("div",U_,[r(e.RecurrenceEditor,{"recurrence-setting":e.form.recurrence_setting,"onUpdate:recurrenceSetting":t[11]||(t[11]=_=>e.form.recurrence_setting=_),"work-order-start-date":e.form.start_date,"work-order-due-date":e.form.due_date},null,8,["recurrence-setting","work-order-start-date","work-order-due-date"])]),l(" Categories "),a("div",N_,[r(k,{label:s.$t("workOrder.create.categories"),prop:"category_ids"},{default:n(()=>[r(O,{modelValue:e.form.category_ids,"onUpdate:modelValue":t[12]||(t[12]=_=>e.form.category_ids=_),placeholder:s.$t("workOrder.create.categoriesPlaceholder"),multiple:"",filterable:"",style:{width:"100%"}},{default:n(()=>[(c(!0),g(se,null,we(e.categoryOptions,_=>(c(),Y(P,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),l(" Image and File Upload Section "),a("div",B_,[r(E),a("div",j_,[r(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"image-label":s.$t("workOrder.create.imageUpload"),"file-label":s.$t("workOrder.create.fileUpload"),"upload-type":"both","max-images":5,"max-files":10,"existing-images":e.existingImages,"existing-files":e.existingFiles},null,8,["image-label","file-label","existing-images","existing-files"])])]),l(" Footer Actions "),a("div",H_,[a("div",J_,[r(p,{onClick:e.logCurrentPayload,size:"default",plain:"",loading:e.isLoggingInProgress,disabled:e.isLoggingInProgress},{default:n(()=>[x(m(e.isLoggingInProgress?"Loading...":"Logs"),1)]),_:1},8,["loading","disabled"]),r(p,{type:"primary",onClick:e.submitForm,loading:e.loading,class:"update-button"},{default:n(()=>[x(m(s.$t("workOrder.actions.update")),1)]),_:1},8,["loading"])])])]),_:1},8,["model"])),[[fe,e.loading]]),l(" Add Task Dialog "),r(V,{modelValue:e.showAddTaskDialog,"onUpdate:modelValue":t[13]||(t[13]=_=>e.showAddTaskDialog=_),title:"Add New Task",width:"700px","before-close":e.handleCloseAddTaskDialog,top:"5vh"},{default:n(()=>{var _;return[e.showAddTaskDialog?(c(),Y(e.AddTask,{key:0,"origin-panel":"edit","origin-work-order-id":(_=i.workOrder)==null?void 0:_.id,onClose:e.closeAddTaskDialog,onAddTemplates:e.onAddTaskTemplates},null,8,["origin-work-order-id"])):l("v-if",!0)]}),_:1},8,["modelValue"]),l(" Add Standard Dialog "),r(V,{modelValue:e.showAddStandardDialog,"onUpdate:modelValue":t[14]||(t[14]=_=>e.showAddStandardDialog=_),title:"Add New Standard",width:"700px",top:"5vh","before-close":e.handleCloseAddStandardDialog},{default:n(()=>[e.showAddStandardDialog?(c(),Y(e.AddStandard,{key:0,onClose:e.closeAddStandardDialog,onAddStandards:e.onAddStandards})):l("v-if",!0)]),_:1},8,["modelValue"]),l(" Edit Standard Dialog "),e.editingStandard?(c(),Y(e.EditStandardDialog,{key:0,visible:e.showEditStandardDialog,standard:e.editingStandard,"onUpdate:visible":t[15]||(t[15]=_=>e.showEditStandardDialog=!1),"onUpdate:standard":e.onStandardUpdate},null,8,["visible","standard"])):l("v-if",!0),l(" Task Preview Dialog "),r(V,{modelValue:e.showTaskPreviewDialog,"onUpdate:modelValue":t[17]||(t[17]=_=>e.showTaskPreviewDialog=_),width:"700px",top:"5vh","before-close":e.handleCloseTaskPreview,class:"preview-dialog"},{header:n(({titleId:_})=>[a("div",Y_,[r(p,{type:"text",onClick:e.handleBackToTaskList,class:"back-button"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ArrowLeft)]),_:1})]),_:1}),a("span",{id:_,class:"dialog-title"}," Preview: "+m(e.getPreviewTaskTitle()),9,G_),r(pe,{content:"Interactive Mode",placement:"top"},{default:n(()=>[r(j,{modelValue:e.isTaskInteractive,"onUpdate:modelValue":t[16]||(t[16]=de=>e.isTaskInteractive=de)},null,8,["modelValue"])]),_:1})])]),default:n(()=>[Pt((c(),g("div",Q_,[e.previewTaskTemplateId?(c(),Y(e.StepsPreview,{key:0,"template-id":e.previewTaskTemplateId,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["template-id","interactive"])):e.previewTaskData&&e.previewTaskData.steps?(c(),Y(e.StepsPreview,{key:1,steps:e.previewTaskData.steps,interactive:e.isTaskInteractive,"show-mode-switch":!1},null,8,["steps","interactive"])):(c(),g("div",K_,"No steps available for preview."))])),[[fe,e.previewTaskLoading]])]),_:1},8,["modelValue"]),l(" Standard Preview Dialog "),r(V,{modelValue:e.showStandardPreviewDialog,"onUpdate:modelValue":t[19]||(t[19]=_=>e.showStandardPreviewDialog=_),title:`Preview: ${((K=e.previewStandardData)==null?void 0:K.name)||"Standard"}`,width:"700px",top:"5vh",class:"preview-dialog"},{default:n(()=>[e.showStandardPreviewDialog&&e.previewStandardData&&!e.previewStandardData.isStandalone?(c(),Y(e.StandardsPreview,{key:0,"standard-id":e.previewStandardData.standardId||e.previewStandardData.id},null,8,["standard-id"])):e.showStandardPreviewDialog&&e.previewStandardData&&e.previewStandardData.isStandalone?(c(),g(se,{key:1},[l(" Standalone Standard Preview "),a("div",Z_,[a("div",X_,[l(" Fixed Header Section "),a("div",$_,[a("div",eg,[r(X,{modelValue:e.standalonePreviewTab,"onUpdate:modelValue":t[18]||(t[18]=_=>e.standalonePreviewTab=_),class:"details-tabs"},{default:n(()=>[r(oe,{label:"General",name:"general"}),r(oe,{label:"Standard Rules",name:"rules"})]),_:1},8,["modelValue"])])]),l(" Scrollable Content Area "),a("div",tg,[a("div",ag,[l(" General Tab Content "),e.standalonePreviewTab==="general"?(c(),g("div",rg,[a("div",og,[a("div",ng,[r(ce,{column:2,direction:"vertical"},{default:n(()=>[r(ie,{width:"50%",label:"Category"},{default:n(()=>[x(m(e.previewStandardData.category||"Uncategorized"),1)]),_:1}),r(ie,{width:"50%",label:"Total Rules"},{default:n(()=>{var _;return[a("span",sg,m(((_=e.previewStandardData.items)==null?void 0:_.length)||0)+" rules",1)]}),_:1}),r(ie,{width:"50%",label:"Type"},{default:n(()=>[r($,{type:"primary",size:"small"},{default:n(()=>t[34]||(t[34]=[x("Work Order Only")])),_:1,__:[34]})]),_:1})]),_:1})])]),e.previewStandardData.description?(c(),g("div",lg,[t[35]||(t[35]=a("div",{class:"card-header"},[a("h3",{class:"card-title"},"Description")],-1)),a("div",ig,[a("div",dg,m(e.previewStandardData.description),1)])])):l("v-if",!0)])):l("v-if",!0),l(" Standard Rules Tab Content "),e.standalonePreviewTab==="rules"?(c(),g("div",cg,[e.previewStandardData.items&&e.previewStandardData.items.length>0?(c(),g("div",ug,[a("div",mg,[t[37]||(t[37]=a("h3",{class:"card-title"},"Standard Rules",-1)),r($,{type:"warning",size:"small"},{default:n(()=>t[36]||(t[36]=[x("Read Only")])),_:1,__:[36]})]),a("div",fg,[(c(!0),g(se,null,we(e.previewStandardData.items,(_,de)=>(c(),g("div",{key:de,class:"rule-item"},[a("div",_g,m(de+1),1),a("div",gg,[a("div",pg,m(_),1)])]))),128))])])):(c(),g("div",vg,[r(ne,{description:"No rules defined for this standard","image-size":80})]))])):l("v-if",!0)])])])])],2112)):l("v-if",!0)]),_:1},8,["modelValue","title"]),l(" Task Assignee Management Dialog "),r(V,{modelValue:e.showTaskAssigneeDialog,"onUpdate:modelValue":t[22]||(t[22]=_=>e.showTaskAssigneeDialog=_),title:"Select Workers",width:"600px",onClose:e.resetTaskAssigneeDialog,top:"8vh"},{footer:n(()=>[a("span",Vg,[r(p,{onClick:e.resetTaskAssigneeDialog},{default:n(()=>t[40]||(t[40]=[x("Cancel")])),_:1,__:[40]}),r(p,{type:"primary",onClick:e.saveTaskAssignees},{default:n(()=>[x(" Save Selection ("+m(e.localSelectedTaskAssignees.length)+") ",1)]),_:1})])]),default:n(()=>[a("div",hg,[l(" Search "),a("div",yg,[r(h,{modelValue:e.userSearchQuery,"onUpdate:modelValue":t[20]||(t[20]=_=>e.userSearchQuery=_),placeholder:"Search users...",clearable:""},{prefix:n(()=>[r(d,null,{default:n(()=>[r(e.Search)]),_:1})]),_:1},8,["modelValue"])]),l(" Available Workers "),a("div",wg,[t[38]||(t[38]=a("h4",null,"Available Workers",-1)),e.filteredAssigneeOptions.length===0?(c(),g("div",kg,[r(ne,{description:"No users found","image-size":60})])):(c(),g("div",bg,[(c(!0),g(se,null,we(e.filteredAssigneeOptions,_=>(c(),g("div",{key:_.id,class:xe(["user-item",{selected:e.isUserSelected(_.id)}]),onClick:de=>e.toggleUser(_)},[a("div",Tg,[a("div",Og,m(_.name),1),_.email?(c(),g("div",Cg,m(_.email),1)):l("v-if",!0)]),a("div",Dg,[r(R,{"model-value":e.isUserSelected(_.id),onClick:t[21]||(t[21]=lr(()=>{},["stop"])),onChange:de=>e.toggleUser(_)},null,8,["model-value","onChange"])])],10,Sg))),128))]))]),l(" Selected Workers "),e.localSelectedTaskAssignees.length>0?(c(),g("div",Ag,[a("div",Pg,[a("h4",null,"Selected Workers ("+m(e.localSelectedTaskAssignees.length)+")",1),r(p,{type:"text",size:"small",onClick:e.clearAllAssignees,class:"clear-all-btn"},{default:n(()=>t[39]||(t[39]=[x(" Clear All ")])),_:1,__:[39]})]),a("div",Ig,[(c(!0),g(se,null,we(e.getSelectedUserObjects(),_=>(c(),Y($,{key:_.id,closable:"",onClose:de=>e.removeSelectedUser(_.id),class:"selected-user-tag"},{default:n(()=>[x(m(_.name),1)]),_:2},1032,["onClose"]))),128))])])):l("v-if",!0)])]),_:1},8,["modelValue"]),l(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[23]||(t[23]=_=>e.showJsonDisplayer=_),"payload-data":e.currentPayload,title:"Work Order Edit Payload",subtitle:"Click 'Debug' to refresh"},null,8,["modelValue","payload-data"])])}const Fg=Re(i_,[["render",xg],["__scopeId","data-v-6c96f50a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/WorkOrderEdit.vue"]]),Eg={__name:"WorkOrderPdf",props:{workOrder:{type:Object,required:!0}},setup(s,{expose:t}){const i=s,e=S(null),y=M(()=>[{title:"VISUAL INSPECTION AND CHECK FOR VISIBLE SIGNS OF WEAR OR DAMAGE",assignee:"Inspection (0.5 hr)",duration:"30 min",requirements:["Visual inspection","Documentation"]},{title:"COMPRESSOR REPLACEMENT",assignee:"Removal and Installation (3hrs)",duration:"3 hrs",requirements:["Mounting Hardware - 1 set","Electrical Connectors - 2 pcs"]},{title:"REFRIGERANT REFILL AND SYSTEM TESTING",assignee:"Refilling and leak test (1 hr)",duration:"1 hr",requirements:["Leak Detection Dye - 1pc","Pressure Gauge - 1pc"]}]),v=M(()=>({id:"CONV-001",name:"Main Production Conveyor",serialNumber:"CB-2023-4567",location:"Plant A > Production Floor > Line 1",manufacturer:"Industrial Conveyor Corp",model:"IC-2000X"})),d=M(()=>[{partNumber:"LUB-001",description:"High-temp bearing grease",quantity:2,unitCost:25.5,totalCost:51,vendor:"Industrial Supply Co"},{partNumber:"BELT-TENS-001",description:"Belt tension adjustment kit",quantity:1,unitCost:85,totalCost:85,vendor:"Conveyor Parts Inc"},{partNumber:"COMP-REP-001",description:"Compressor replacement unit",quantity:1,unitCost:450,totalCost:450,vendor:"HVAC Solutions Ltd"}]),u=M(()=>[{id:1,technicianName:"Mike Johnson",startTime:"2024-08-10T08:00:00Z",stopTime:"2024-08-10T12:00:00Z",hoursWorked:4,hourlyRate:45,totalCost:180},{id:2,technicianName:"Sarah Davis",startTime:"2024-08-10T10:00:00Z",stopTime:"2024-08-10T12:00:00Z",hoursWorked:2,hourlyRate:42,totalCost:84}]),p=M(()=>[{requirement:"LOTO procedures completed",compliance:!0,notes:"All energy sources isolated and tagged"},{requirement:"PPE requirements met",compliance:!0,notes:"Hard hat, safety glasses, steel-toed boots worn"},{requirement:"Confined space permit",compliance:!1,notes:"Not required for this work"},{requirement:"Hot work permit",compliance:!1,notes:"No welding or cutting required"}]),w=M(()=>[{timestamp:"2024-08-08T14:30:00Z",action:"Work Order Created",performedBy:"Erik Yu",details:"Scheduled preventive maintenance"},{timestamp:"2024-08-09T09:15:00Z",action:"Assigned to Technician",performedBy:"Maintenance Supervisor",details:"Assigned to Mike Johnson"},{timestamp:"2024-08-10T08:00:00Z",action:"Work Started",performedBy:"Mike Johnson",details:"Began on-site inspection"},{timestamp:"2024-08-10T12:00:00Z",action:"Work Completed",performedBy:"Mike Johnson",details:"All maintenance tasks completed successfully"}]),h=q=>q?ut(q):"N/A",k=q=>q?ut(q):"N/A",C=()=>d.value.reduce((q,le)=>q+le.totalCost,0).toFixed(2),P=()=>u.value.reduce((q,le)=>q+le.totalCost,0).toFixed(2),O=()=>((parseFloat(C())+parseFloat(P()))*.1).toFixed(2),E=()=>{const q=parseFloat(C())+parseFloat(P()),le=parseFloat(O());return(q+le).toFixed(2)};t({pdfContainer:e,print:()=>window.print()});const T={props:i,pdfContainer:e,workInstructions:y,assetInfo:v,partsUsed:d,laborLog:u,safetyRequirements:p,activityTimeline:w,formatDate:h,formatDateTime:k,calculatePartsCost:C,calculateLaborCost:P,calculateTax:O,calculateTotal:E,computed:M,ref:S,get convertToLocalTime(){return ut}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},Lg={class:"work-order-pdf",ref:"pdfContainer"},Wg={class:"pdf-page"},Rg={class:"pdf-header"},Mg={class:"title-block"},qg={class:"title-left"},zg={class:"work-order-id"},Ug={class:"title-right"},Ng={class:"date-badge"},Bg={class:"pdf-section overview-section"},jg={class:"section-grid"},Hg={class:"overview-left"},Jg={class:"field-group"},Yg={class:"field-value"},Gg={class:"field-subvalue"},Qg={class:"field-contact"},Kg={class:"overview-right"},Zg={class:"field-group"},Xg={class:"field-value"},$g={class:"field-description"},ep={class:"pdf-section instructions-section"},tp={class:"instruction-steps"},ap={class:"step-number"},rp={class:"step-content"},op={class:"step-title"},np={class:"step-details"},sp={class:"step-info"},lp={class:"info-item"},ip={class:"info-item"},dp={class:"step-requirements"},cp={class:"pdf-section technician-section"},up={class:"section-grid"},mp={class:"tech-left"},fp={class:"tech-info"},_p={class:"tech-name"},gp={class:"tech-right"},pp={class:"service-date"},vp={class:"pdf-section approval-section"},hp={class:"section-grid"},yp={class:"approval-left"},wp={class:"approval-fields"},kp={class:"approval-field"},bp={class:"date-line"},Sp={class:"approval-right"},Tp={class:"price-details"},Op={class:"price-row"},Cp={class:"price-row"},Dp={class:"price-row"},Ap={class:"price-row total-row"},Pp={class:"pdf-footer"},Ip={class:"footer-branding"},Vp={class:"footer-budget"},xp={class:"budget-amount"},Fp={class:"footer-copyright"},Ep={class:"pdf-page page-break",style:{"page-break-before":"always"}},Lp={class:"pdf-section asset-section"},Wp={class:"asset-grid"},Rp={class:"asset-field"},Mp={class:"field-value"},qp={class:"asset-field"},zp={class:"field-value"},Up={class:"asset-field"},Np={class:"field-value"},Bp={class:"asset-field"},jp={class:"field-value"},Hp={class:"asset-field"},Jp={class:"field-value"},Yp={class:"asset-field"},Gp={class:"field-value"},Qp={class:"pdf-section parts-section"},Kp={class:"data-table"},Zp={class:"total-row"},Xp={class:"pdf-section time-section"},$p={class:"data-table"},ev={class:"total-row"},tv={class:"pdf-section safety-section"},av={class:"safety-checklist"},rv={key:0},ov={class:"safety-text"},nv={class:"safety-requirement"},sv={key:0,class:"safety-notes"},lv={class:"pdf-section timeline-section"},iv={class:"timeline"},dv={class:"timeline-date"},cv={class:"timeline-content"},uv={class:"timeline-action"},mv={class:"timeline-performer"},fv={key:0,class:"timeline-details"};function _v(s,t,i,e,y,v){return c(),g("div",Lg,[l(" Page 1: Header and Overview "),a("div",Wg,[l(" Header "),a("header",Rg,[t[1]||(t[1]=hn('<div class="header-top" data-v-4de525d7><div class="logo-section" data-v-4de525d7><div class="logo-placeholder" data-v-4de525d7><span class="logo-text" data-v-4de525d7>FPS</span></div></div><div class="company-info" data-v-4de525d7><div class="company-line" data-v-4de525d7>FPS CMMS Solutions</div><div class="company-line" data-v-4de525d7>1234 Maintenance Way, Suite 100</div><div class="company-line" data-v-4de525d7>Victoria, BC V8W 2C5, Canada</div><div class="company-line" data-v-4de525d7>E: support@fpscmms.com | T: +1 250 555 0198</div></div></div>',1)),a("div",Mg,[a("div",qg,[t[0]||(t[0]=a("h1",{class:"work-order-title"},"WORK ORDER",-1)),a("div",zg,"#"+m(i.workOrder.id),1)]),a("div",Ug,[a("div",Ng,m(e.formatDate(i.workOrder.created_at)),1)])])]),l(" Work Order Overview "),a("section",Bg,[a("div",jg,[a("div",Hg,[a("div",Jg,[t[2]||(t[2]=a("label",{class:"field-label"},"CUSTOMER",-1)),a("div",Yg,m(i.workOrder.customer||"Internal Maintenance"),1),a("div",Gg,m(i.workOrder.customerAddress||"Internal Department"),1),a("div",Qg,m(i.workOrder.customerContact||"maintenance@company.com"),1)])]),a("div",Kg,[a("div",Zg,[t[3]||(t[3]=a("label",{class:"field-label"},"SERVICE REQUEST",-1)),a("div",Xg,m(i.workOrder.name),1),a("div",$g,m(i.workOrder.description),1)])])])]),l(" Detailed Order Instructions "),a("section",ep,[t[7]||(t[7]=a("h2",{class:"section-title"},"DETAILED ORDER INSTRUCTIONS",-1)),a("div",tp,[(c(!0),g(se,null,we(e.workInstructions,(d,u)=>(c(),g("div",{key:u,class:"instruction-step"},[a("div",ap,m(String(u+1).padStart(2,"0")),1),a("div",rp,[a("h3",op,m(d.title),1),a("div",np,[a("div",sp,[a("div",lp,[t[4]||(t[4]=a("i",{class:"icon-user"},null,-1)),a("span",null,m(d.assignee||"Technician"),1)]),a("div",ip,[t[5]||(t[5]=a("i",{class:"icon-clock"},null,-1)),a("span",null,m(d.duration||"30 min"),1)])]),a("div",dp,[(c(!0),g(se,null,we(d.requirements,p=>(c(),g("div",{class:"requirement-item",key:p},[t[6]||(t[6]=a("i",{class:"icon-check"},null,-1)),a("span",null,m(p),1)]))),128))])])])]))),128))])]),l(" Technician Information "),a("section",cp,[a("div",up,[a("div",mp,[t[9]||(t[9]=a("h3",{class:"subsection-title"},"TECHNICIAN INFORMATION",-1)),a("div",fp,[a("div",_p,m(i.workOrder.assigned_to||"Mark Smith (Senior Technician)"),1),t[8]||(t[8]=a("div",{class:"tech-contact"},"(555) 234 567",-1))])]),a("div",gp,[t[10]||(t[10]=a("h3",{class:"subsection-title"},"SCHEDULED SERVICE DATE",-1)),a("div",pp,m(e.formatDate(i.workOrder.due_date)),1)])])]),l(" Approval Section "),a("section",vp,[a("div",hp,[a("div",yp,[t[14]||(t[14]=a("h3",{class:"subsection-title"},"APPROVAL",-1)),a("div",wp,[t[12]||(t[12]=a("div",{class:"approval-field"},[a("label",null,"CUSTOMER"),a("div",{class:"signature-line"})],-1)),t[13]||(t[13]=a("div",{class:"approval-field"},[a("label",null,"TECHNICIAN"),a("div",{class:"signature-line"})],-1)),a("div",kp,[t[11]||(t[11]=a("label",null,"DATE",-1)),a("div",bp,m(e.formatDate(new Date)),1)])])]),a("div",Sp,[t[19]||(t[19]=a("h3",{class:"subsection-title"},"PRICE DETAILS",-1)),a("div",Tp,[a("div",Op,[t[15]||(t[15]=a("span",null,"LABOR",-1)),a("span",null,"$"+m(e.calculateLaborCost()),1)]),a("div",Cp,[t[16]||(t[16]=a("span",null,"PARTS",-1)),a("span",null,"$"+m(e.calculatePartsCost()),1)]),a("div",Dp,[t[17]||(t[17]=a("span",null,"TAX (10%)",-1)),a("span",null,"$"+m(e.calculateTax()),1)]),a("div",Ap,[t[18]||(t[18]=a("span",null,"TOTAL",-1)),a("span",null,"$"+m(e.calculateTotal()),1)])])])])]),l(" Footer "),a("footer",Pp,[t[22]||(t[22]=a("div",{class:"footer-note"}," *Please review and approve the work order to authorize the maintenance and repair tasks. ",-1)),a("div",Ip,[t[21]||(t[21]=a("div",{class:"social-icons"},[a("span",{class:"social-icon"},"f"),a("span",{class:"social-icon"},"P"),a("span",{class:"social-icon"},"t")],-1)),a("div",Vp,[t[20]||(t[20]=a("span",{class:"budget-label"},"BUDGET",-1)),a("span",xp,"$"+m(e.calculateTotal()),1)])]),a("div",Fp," "+m(new Date().getFullYear())+" FPS CMMS Solutions  All rights reserved.",1)])]),l(" Page 2: Detailed Information "),a("div",Ep,[l(" Asset Information "),a("section",Lp,[t[29]||(t[29]=a("h2",{class:"section-title"},"ASSET INFORMATION",-1)),a("div",Wp,[a("div",Rp,[t[23]||(t[23]=a("label",null,"Asset ID",-1)),a("div",Mp,m(e.assetInfo.id),1)]),a("div",qp,[t[24]||(t[24]=a("label",null,"Asset Name",-1)),a("div",zp,m(e.assetInfo.name),1)]),a("div",Up,[t[25]||(t[25]=a("label",null,"Serial Number",-1)),a("div",Np,m(e.assetInfo.serialNumber),1)]),a("div",Bp,[t[26]||(t[26]=a("label",null,"Location",-1)),a("div",jp,m(e.assetInfo.location),1)]),a("div",Hp,[t[27]||(t[27]=a("label",null,"Manufacturer",-1)),a("div",Jp,m(e.assetInfo.manufacturer),1)]),a("div",Yp,[t[28]||(t[28]=a("label",null,"Model",-1)),a("div",Gp,m(e.assetInfo.model),1)])])]),l(" Parts and Materials "),a("section",Qp,[t[33]||(t[33]=a("h2",{class:"section-title"},"PARTS AND MATERIALS",-1)),a("table",Kp,[t[32]||(t[32]=a("thead",null,[a("tr",null,[a("th",null,"Part Number"),a("th",null,"Description"),a("th",null,"Qty"),a("th",null,"Unit Cost"),a("th",null,"Total Cost"),a("th",null,"Vendor")])],-1)),a("tbody",null,[(c(!0),g(se,null,we(e.partsUsed,d=>(c(),g("tr",{key:d.partNumber},[a("td",null,m(d.partNumber),1),a("td",null,m(d.description),1),a("td",null,m(d.quantity),1),a("td",null,"$"+m(d.unitCost.toFixed(2)),1),a("td",null,"$"+m(d.totalCost.toFixed(2)),1),a("td",null,m(d.vendor),1)]))),128))]),a("tfoot",null,[a("tr",Zp,[t[30]||(t[30]=a("td",{colspan:"4"},"TOTAL PARTS COST",-1)),a("td",null,"$"+m(e.calculatePartsCost()),1),t[31]||(t[31]=a("td",null,null,-1))])])])]),l(" Time Tracking "),a("section",Xp,[t[36]||(t[36]=a("h2",{class:"section-title"},"TIME TRACKING",-1)),a("table",$p,[t[35]||(t[35]=a("thead",null,[a("tr",null,[a("th",null,"Technician"),a("th",null,"Start Time"),a("th",null,"End Time"),a("th",null,"Hours"),a("th",null,"Rate"),a("th",null,"Cost")])],-1)),a("tbody",null,[(c(!0),g(se,null,we(e.laborLog,d=>(c(),g("tr",{key:d.id},[a("td",null,m(d.technicianName),1),a("td",null,m(e.formatDateTime(d.startTime)),1),a("td",null,m(e.formatDateTime(d.stopTime)),1),a("td",null,m(d.hoursWorked.toFixed(2))+"h",1),a("td",null,"$"+m(d.hourlyRate.toFixed(2)),1),a("td",null,"$"+m(d.totalCost.toFixed(2)),1)]))),128))]),a("tfoot",null,[a("tr",ev,[t[34]||(t[34]=a("td",{colspan:"5"},"TOTAL LABOR COST",-1)),a("td",null,"$"+m(e.calculateLaborCost()),1)])])])]),l(" Safety Requirements "),a("section",tv,[t[37]||(t[37]=a("h2",{class:"section-title"},"SAFETY REQUIREMENTS",-1)),a("div",av,[(c(!0),g(se,null,we(e.safetyRequirements,d=>(c(),g("div",{key:d.requirement,class:"safety-item"},[a("div",{class:xe(["safety-checkbox",{checked:d.compliance}])},[d.compliance?(c(),g("span",rv,"")):l("v-if",!0)],2),a("div",ov,[a("div",nv,m(d.requirement),1),d.notes?(c(),g("div",sv,m(d.notes),1)):l("v-if",!0)])]))),128))])]),l(" Activity Timeline "),a("section",lv,[t[38]||(t[38]=a("h2",{class:"section-title"},"ACTIVITY TIMELINE",-1)),a("div",iv,[(c(!0),g(se,null,we(e.activityTimeline,d=>(c(),g("div",{key:d.timestamp,class:"timeline-item"},[a("div",dv,m(e.formatDateTime(d.timestamp)),1),a("div",cv,[a("div",uv,m(d.action),1),a("div",mv,m(d.performedBy),1),d.details?(c(),g("div",fv,m(d.details),1)):l("v-if",!0)])]))),128))])])])],512)}const gv=Re(Eg,[["render",_v],["__scopeId","data-v-4de525d7"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Reports/WorkOrderPdf.vue"]]),pv=Ce({name:"PdfPreviewModal"}),vv=Object.assign(pv,{props:{visible:{type:Boolean,default:!1},workOrder:{type:Object,default:null}},emits:["update:visible","close"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=S(1),d=S(2),u=S(1),p=S(null),w=M({get:()=>e.visible,set:ce=>y("update:visible",ce)}),h=()=>{v.value=1,u.value=1,y("close")},k=()=>{const ce=document.querySelector(".pdf-preview-content .work-order-pdf");ce&&(ce.offsetHeight,ce.classList.add("pdf-ready-for-export"),C())},C=()=>{const ce=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ce)return;const ne=document.createElement("iframe");ne.style.position="absolute",ne.style.top="-9999px",ne.style.left="-9999px",ne.style.width="210mm",ne.style.height="297mm",ne.style.border="none",document.body.appendChild(ne);const R=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white; }
          @page { size: A4; margin: 0; }
          ${q()}
          .pdf-page {
            width: 210mm;
            min-height: 257mm; /* A4 height minus padding */
            padding: 20mm;
            box-sizing: border-box;
            page-break-after: always;
            position: relative;
          }
          .page-break { page-break-before: always; }
        </style>
      </head>
      <body>
        ${ce.outerHTML}
      </body>
    </html>
  `;ne.contentDocument.open(),ne.contentDocument.write(R),ne.contentDocument.close(),setTimeout(()=>{try{const _=(ne.contentDocument||ne.contentWindow.document).querySelectorAll(".pdf-page").length;_!==d.value&&_>0&&(d.value=_)}catch(fe){console.warn("Could not calculate page count:",fe);const K=ce.querySelectorAll(".pdf-page");d.value=K.length}document.body.removeChild(ne)},1e3)},P=()=>{if(!p.value)return;const ce=p.value,ne=()=>{const fe=ce.querySelectorAll(".pdf-page");if(!fe.length)return;const K=ce.scrollTop,_=ce.clientHeight,de=K+_/2;let f=1,F=1/0;fe.forEach((U,te)=>{const N=U.offsetTop,ee=U.offsetHeight,G=N+ee/2,re=Math.abs(de-G);re<F&&(F=re,f=te+1)}),f!==v.value&&(v.value=f)};ce.addEventListener("scroll",ne);const R=()=>{ce.removeEventListener("scroll",ne)};ce._scrollCleanup=R},O=async()=>{var K;const ce=window.open("","_blank");if(!ce){B.error("Unable to open print window. Please check popup blockers.");return}const ne=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ne){B.error("PDF content not found");return}ne.classList.contains("pdf-ready-for-export")||(await new Promise(_=>setTimeout(_,1e3)),k());const R=ne.outerHTML,fe=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <title>Work Order ${((K=e.workOrder)==null?void 0:K.id)||"Export"}</title>
        <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white; }
          @page {
            size: A4;
            margin: 0;
          }
          ${q()}
          /* Ensure consistent page layout */
          .pdf-page {
            width: 210mm;
            min-height: 257mm; /* A4 height minus padding */
            padding: 20mm;
            box-sizing: border-box;
            page-break-after: always;
            position: relative;
          }
          .pdf-page:last-child {
            page-break-after: avoid;
          }
          .page-break {
            page-break-before: always;
            break-before: page;
          }
          @media print {
            .work-order-pdf { margin: 0; padding: 0; }
            .pdf-page {
              margin: 0;
              page-break-after: always;
            }
            .pdf-page:last-child {
              page-break-after: avoid;
            }
          }
        </style>
      </head>
      <body>
        ${R}
      </body>
    </html>
  `;ce.document.write(fe),ce.document.close(),ce.onload=()=>{setTimeout(()=>{ce.print(),ce.close()},500)}},E=async()=>{var ce;try{if(typeof window.html2pdf>"u"){B.error("PDF download requires html2pdf library. Using print instead."),O();return}const ne=document.createElement("div");ne.style.position="absolute",ne.style.top="-9999px",ne.style.left="-9999px",ne.style.width="210mm",ne.style.height="auto";const R=document.querySelector(".pdf-preview-content .work-order-pdf");if(!R){B.error("PDF content not found");return}R.classList.contains("pdf-ready-for-export")||(await new Promise(de=>setTimeout(de,1e3)),k());const fe=`
      <div style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #333333; line-height: 1.4; background: white;">
        <style>
          ${q()}
        </style>
        ${R.outerHTML}
      </div>
    `;ne.innerHTML=fe,document.body.appendChild(ne);const K=`WorkOrder_${((ce=e.workOrder)==null?void 0:ce.id)||"Export"}_${new Date().toISOString().split("T")[0]}.pdf`,_={margin:0,filename:K,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,allowTaint:!0,foreignObjectRendering:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().set(_).from(ne.firstChild).save(),document.body.removeChild(ne),B.success(`PDF downloaded: ${K}`)}catch(ne){console.error("Download error:",ne),B.error("Failed to download PDF. Please try print instead.")}},T=()=>{var K;const ce=window.open("","_blank","width=900,height=1200");if(!ce){B.error("Unable to open new window. Please check popup blockers.");return}const ne=document.querySelector(".pdf-preview-content .work-order-pdf");if(!ne){B.error("PDF content not found");return}const R=ne.outerHTML,fe=`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <title>Work Order ${((K=e.workOrder)==null?void 0:K.id)||"Preview"}</title>
        <style>
          body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
          }
          ${q()}
        </style>
      </head>
      <body>
        ${R}
      </body>
    </html>
  `;ce.document.write(fe),ce.document.close()},q=()=>`
    /* PDF Layout Styles */
    .work-order-pdf {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      color: #333333;
      line-height: 1.4;
      background: white;
    }

    /* Page Setup */
    .pdf-page {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      padding: 20mm;
      box-sizing: border-box;
      background: white;
      position: relative;
    }

    .page-break {
      page-break-before: always;
    }

    /* Header Styles */
    .pdf-header {
      margin-bottom: 15mm;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 5mm;
      border-bottom: 2px solid #0085a4;
      margin-bottom: 10mm;
    }

    .logo-section {
      display: flex;
      align-items: center;
    }

    .logo-placeholder {
      width: 40px;
      height: 40px;
      background: #0085a4;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }

    .logo-text {
      color: white;
      font-weight: bold;
      font-size: 16px;
    }

    .company-info {
      text-align: right;
    }

    .company-line {
      font-size: 9px;
      color: #555555;
      line-height: 1.2;
      margin-bottom: 2px;
    }

    .title-block {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .work-order-title {
      font-size: 24px;
      font-weight: bold;
      color: #0085a4;
      letter-spacing: 1px;
      margin: 0;
    }

    .work-order-id {
      font-size: 14px;
      color: #0085a4;
      margin-top: 4px;
    }

    .date-badge {
      background: #0085a4;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: bold;
    }

    /* Section Styles */
    .pdf-section {
      margin-bottom: 15mm;
    }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      color: #0085a4;
      margin: 0 0 8mm 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .subsection-title {
      font-size: 10px;
      font-weight: bold;
      color: #0085a4;
      margin: 0 0 5mm 0;
      text-transform: uppercase;
    }

    .section-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20mm;
    }

    /* Overview Section */
    .overview-section {
      padding: 10mm 0;
      border-bottom: 1px solid #cccccc;
    }

    .field-group {
      margin-bottom: 8mm;
    }

    .field-label {
      font-size: 9px;
      font-weight: bold;
      color: #0085a4;
      text-transform: uppercase;
      display: block;
      margin-bottom: 3mm;
    }

    .field-value {
      font-size: 11px;
      font-weight: bold;
      color: #333;
      margin-bottom: 2mm;
    }

    .field-subvalue {
      font-size: 9px;
      color: #666;
      margin-bottom: 1mm;
    }

    .field-contact {
      font-size: 9px;
      color: #666;
    }

    .field-description {
      font-size: 9px;
      color: #666;
      margin-top: 2mm;
    }

    /* Print Styles */
    @media print {
      .work-order-pdf {
        margin: 0;
        padding: 0;
      }

      .pdf-page {
        margin: 0;
        padding: 20mm;
        page-break-after: always;
      }

      .pdf-page:last-child {
        page-break-after: avoid;
      }

      .page-break {
        page-break-before: always;
      }

      @page {
        size: A4;
        margin: 0;
      }
    }
  `,le=()=>{v.value>1&&(v.value--,pe(v.value))},V=()=>{v.value<d.value&&(v.value++,pe(v.value))},j=ce=>{v.value=ce,pe(ce)},pe=ce=>{if(!p.value)return;const ne=p.value.querySelectorAll(".pdf-page");ne&&ne[ce-1]&&ne[ce-1].scrollIntoView({behavior:"smooth",block:"start"})},oe=()=>{u.value<2&&(u.value=Math.min(2,u.value+.25))},X=()=>{u.value>.5&&(u.value=Math.max(.5,u.value-.25))},ie=()=>{u.value=1};ye(()=>e.visible,ce=>{ce&&e.workOrder&&(v.value=1,u.value=1,Ne(()=>{setTimeout(()=>{P(),k()},500)}))}),ye(()=>e.workOrder,ce=>{ce&&e.visible&&(v.value=1,setTimeout(()=>{C()},1500))});const $={props:e,emit:y,currentPage:v,totalPages:d,zoomLevel:u,pdfPreviewContent:p,isVisible:w,handleClose:h,ensurePdfComponentRendered:k,calculateActualPageCount:C,setupScrollListener:P,printPdf:O,downloadPdf:E,openInNewWindow:T,getPdfStyles:q,previousPage:le,nextPage:V,goToPage:j,scrollToPage:pe,zoomIn:oe,zoomOut:X,resetZoom:ie,__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,nextTick:Ne,get ElMessage(){return B},WorkOrderPdf:gv,get Printer(){return fn},get Download(){return Da},get View(){return $t},get ArrowLeft(){return ea},get ArrowRight(){return nr},get ZoomIn(){return mn},get ZoomOut(){return un}};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),hv={class:"pdf-preview-container"},yv={class:"pdf-preview-toolbar"},wv={class:"toolbar-left"},kv={class:"toolbar-center"},bv={class:"page-navigation"},Sv={class:"page-info"},Tv={class:"toolbar-right"},Ov={class:"zoom-controls"},Cv={class:"zoom-info"},Dv={class:"pdf-preview-content print-simulation",ref:"pdfPreviewContent"},Av={class:"page-indicators"},Pv=["onClick"];function Iv(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-button"),p=D("el-button-group"),w=D("el-dialog");return c(),Y(w,{modelValue:e.isVisible,"onUpdate:modelValue":t[0]||(t[0]=h=>e.isVisible=h),title:"Work Order PDF Preview",width:"95%","before-close":e.handleClose,class:"pdf-preview-dialog",top:"2vh"},{default:n(()=>[a("div",hv,[l(" Toolbar for pdf preview "),a("div",yv,[a("div",wv,[r(p,null,{default:n(()=>[r(u,{type:"primary",onClick:e.printPdf},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Printer)]),_:1}),t[1]||(t[1]=x(" Print PDF "))]),_:1,__:[1]}),r(u,{onClick:e.downloadPdf},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Download)]),_:1}),t[2]||(t[2]=x(" Download PDF "))]),_:1,__:[2]}),r(u,{onClick:e.openInNewWindow},{default:n(()=>[r(d,null,{default:n(()=>[r(e.View)]),_:1}),t[3]||(t[3]=x(" Open in New Window "))]),_:1,__:[3]})]),_:1})]),a("div",kv,[l(" Page Navigation "),a("div",bv,[r(u,{size:"small",disabled:e.currentPage<=1,onClick:e.previousPage},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ArrowLeft)]),_:1}),t[4]||(t[4]=x(" Previous "))]),_:1,__:[4]},8,["disabled"]),a("span",Sv," Page "+m(e.currentPage)+" of "+m(e.totalPages),1),r(u,{size:"small",disabled:e.currentPage>=e.totalPages,onClick:e.nextPage},{default:n(()=>[t[5]||(t[5]=x(" Next ")),r(d,null,{default:n(()=>[r(e.ArrowRight)]),_:1})]),_:1,__:[5]},8,["disabled"])])]),a("div",Tv,[l(" Zoom Controls "),a("div",Ov,[r(u,{size:"small",disabled:e.zoomLevel<=.5,onClick:e.zoomOut},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ZoomOut)]),_:1})]),_:1},8,["disabled"]),a("span",Cv,m(Math.round(e.zoomLevel*100))+"%",1),r(u,{size:"small",disabled:e.zoomLevel>=2,onClick:e.zoomIn},{default:n(()=>[r(d,null,{default:n(()=>[r(e.ZoomIn)]),_:1})]),_:1},8,["disabled"]),r(u,{size:"small",onClick:e.resetZoom},{default:n(()=>t[6]||(t[6]=[x(" Reset ")])),_:1,__:[6]})])])]),l(" PDF Content with Scrolling "),a("div",Dv,[a("div",{class:"pdf-content-wrapper",style:bt({transform:`scale(${e.zoomLevel})`,transformOrigin:"top center"})},[i.workOrder?(c(),Y(e.WorkOrderPdf,{key:0,"work-order":i.workOrder,ref:"pdfComponent",class:"preview-print-mode"},null,8,["work-order"])):l("v-if",!0)],4)],512),l(" Page Indicators "),a("div",Av,[(c(!0),g(se,null,we(e.totalPages,h=>(c(),g("div",{key:h,class:xe(["page-indicator",{active:h===e.currentPage}]),onClick:k=>e.goToPage(h)},m(h),11,Pv))),128))])])]),_:1},8,["modelValue"])}const Vv=Re(vv,[["render",Iv],["__scopeId","data-v-99545c2b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/PdfPreview/PdfPreviewModal.vue"]]),xv="StartWorkOrderDB",Dt="drafts",Fv=1;let Ta=null;const Oa=()=>Ta||(Ta=new Promise((s,t)=>{const i=indexedDB.open(xv,Fv);i.onupgradeneeded=()=>{const e=i.result;e.objectStoreNames.contains(Dt)||e.createObjectStore(Dt,{keyPath:"key"})},i.onsuccess=()=>{s(i.result)},i.onerror=()=>{t(i.error)}}),Ta),_o=(s,t)=>`${s}::${t}`,Ca=()=>typeof indexedDB<"u",Ua=s=>`start-work-order-${s}`,Ev=async s=>{const t=Ua(s.workOrderId),e=JSON.parse(localStorage.getItem(t)||"[]").filter(y=>y.taskId!==s.taskId);localStorage.setItem(t,JSON.stringify([...e,s]))},Lv=async s=>{const t=Ua(s);return JSON.parse(localStorage.getItem(t)||"[]")},Wv=async(s,t)=>{const i=Ua(s),y=JSON.parse(localStorage.getItem(i)||"[]").filter(v=>v.taskId!==t);localStorage.setItem(i,JSON.stringify(y))},Rv=async s=>{const t=Ua(s);localStorage.removeItem(t)},go={async saveDraft(s){if(Ca())try{const i=(await Oa()).transaction(Dt,"readwrite");i.objectStore(Dt).put({...s,key:_o(s.workOrderId,s.taskId)}),await new Promise((y,v)=>{i.oncomplete=()=>y(),i.onerror=()=>v(i.error),i.onabort=()=>v(i.error)});return}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}await Ev(s)},async getDrafts(s){if(Ca())try{const i=(await Oa()).transaction(Dt,"readonly"),y=i.objectStore(Dt).getAll(),v=await new Promise((u,p)=>{y.onsuccess=()=>u(y.result),y.onerror=()=>p(y.error)});await new Promise((u,p)=>{i.oncomplete=()=>u(),i.onerror=()=>p(i.error),i.onabort=()=>p(i.error)});const d=String(s);return v.filter(u=>String(u.workOrderId)===d).map(u=>({workOrderId:u.workOrderId,taskId:u.taskId,status:u.status,time_spent:u.time_spent,step_progress:u.step_progress,updated_at:u.updated_at}))}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}return Lv(s)},async removeDraft(s,t){if(Ca())try{const e=(await Oa()).transaction(Dt,"readwrite");e.objectStore(Dt).delete(_o(s,t)),await new Promise((v,d)=>{e.oncomplete=()=>v(),e.onerror=()=>d(e.error),e.onabort=()=>d(e.error)});return}catch(i){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",i)}await Wv(s,t)},async clearWorkOrder(s){if(Ca())try{const i=(await Oa()).transaction(Dt,"readwrite"),e=i.objectStore(Dt),y=e.getAllKeys();(await new Promise((d,u)=>{y.onsuccess=()=>d(y.result),y.onerror=()=>u(y.error)})).filter(d=>typeof d=="string"&&d.startsWith(`${s}::`)).forEach(d=>e.delete(d)),await new Promise((d,u)=>{i.oncomplete=()=>d(),i.onerror=()=>u(i.error),i.onabort=()=>u(i.error)});return}catch(t){console.warn("[StartWorkOrder][IndexedDB] Falling back to localStorage",t)}await Rv(s)}},Mv={__name:"StatusBadge",props:{status:{type:String,default:"draft"}},setup(s,{expose:t}){t();const i=s,e={draft:"info",completed:"success",in_progress:"warning",not_started:"info"},y={draft:"Draft",completed:"Completed",in_progress:"In Progress",not_started:"Not Started"},v=M(()=>{var w,h;return((h=(w=i.status)==null?void 0:w.toLowerCase)==null?void 0:h.call(w))||"draft"}),d=M(()=>e[v.value]||"info"),u=M(()=>y[v.value]||"Draft"),p={props:i,tagTypeMap:e,labelMap:y,normalized:v,tagType:d,label:u,computed:M};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}};function qv(s,t,i,e,y,v){const d=D("el-tag");return c(),Y(d,{type:e.tagType,size:"small",effect:"dark",class:"status-badge"},{default:n(()=>[x(m(e.label),1)]),_:1},8,["type"])}const zv=Re(Mv,[["render",qv],["__scopeId","data-v-edd15a48"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Display/StatusBadge.vue"]]),Uv={__name:"TaskExecutionSummary",props:{task:{type:Object,required:!0},progress:{type:Object,default:()=>({status:"draft",time_spent:{value:0,unit:"minutes"}})},index:{type:Number,default:0}},setup(s,{expose:t}){t();const i=s,e=M(()=>i.index+1),y=M(()=>{var h,k,C,P,O;return Array.isArray((h=i.task)==null?void 0:h.steps)&&i.task.steps.length?i.task.steps.length:Array.isArray((C=(k=i.task)==null?void 0:k.payload)==null?void 0:C.steps)&&i.task.payload.steps.length?i.task.payload.steps.length:Array.isArray((P=i.task)==null?void 0:P.task_steps)&&i.task.task_steps.length?i.task.task_steps.length:Array.isArray((O=i.task)==null?void 0:O.entries)&&i.task.entries.length?i.task.entries.length:0}),v=M(()=>`summary-${d.value}`),d=M(()=>{var k;const h=(k=i.progress)==null?void 0:k.status;return h==="draft"?"in_progress":h==="completed"?"completed":h||"not_started"}),u=M(()=>{var C,P,O,E;const h=(P=(C=i.progress)==null?void 0:C.time_spent)==null?void 0:P.value,k=(E=(O=i.progress)==null?void 0:O.time_spent)==null?void 0:E.unit;return h&&k?`${h} ${k}`:"No time recorded"}),p=M(()=>{var k,C;if((k=i.task)!=null&&k.assignees&&i.task.assignees.length)return i.task.assignees.map(P=>P.name||P).join(", ");if((C=i.task)!=null&&C.assignee_ids&&i.task.assignee_ids.length)return`Assignee #${i.task.assignee_ids[0]}`;const h=["Alex Martinez","Priya Desai","Morgan Chen","Isabella Fernandez","Liam OConnor","Harper Singh"];return h[Math.floor(Math.random()*h.length)]}),w={props:i,indexLabel:e,stepCount:y,statusClass:v,currentStatus:d,formattedTime:u,assignee:p,computed:M,get ArrowRight(){return nr},StatusBadge:zv};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},Nv={class:"summary-header"},Bv={class:"summary-title"},jv={class:"summary-meta"},Hv={class:"summary-meta-row"},Jv={class:"meta-value"},Yv={key:0,class:"summary-description"},Gv={class:"summary-footer"},Qv={class:"footer-time"};function Kv(s,t,i,e,y,v){const d=D("el-icon");return c(),g("div",{class:xe(["task-summary-card",e.statusClass]),onClick:t[0]||(t[0]=u=>s.$emit("select"))},[a("div",Nv,[a("div",Bv,[a("h4",null,m(i.task.name||`Task ${e.indexLabel}`),1),r(e.StatusBadge,{status:e.currentStatus},null,8,["status"])]),a("span",jv,"Steps: "+m(e.stepCount),1)]),a("div",Hv,[t[1]||(t[1]=a("span",{class:"meta-label"},"Assigned To:",-1)),a("span",Jv,m(e.assignee),1)]),i.task.description?(c(),g("p",Yv,m(i.task.description),1)):l("v-if",!0),a("div",Gv,[a("span",Qv,m(e.formattedTime),1),r(d,{class:"footer-icon"},{default:n(()=>[r(e.ArrowRight)]),_:1})])],2)}const Zv=Re(Uv,[["render",Kv],["__scopeId","data-v-312d207a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Execution/TaskExecutionSummary.vue"]]),Xv={__name:"WorkOrderExecution",props:{workOrder:{type:Object,required:!0}},emits:["close","update:progress","back-to-detail"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=()=>{console.log(" WorkOrderExecution: Back to Detail button clicked"),console.log(" WorkOrderExecution: Emitting back-to-detail event"),y("back-to-detail"),console.log(" WorkOrderExecution: back-to-detail event emitted")},{t:d}=Ge(),{currentPayload:u,showJsonDisplayer:p,logPayload:w,closeDebugDrawer:h}=Xt(),k=S(!1),C=it([]),P=S(!1),O=S(null),E=S(!1),T=()=>{var de,f;C.splice(0,C.length),(Array.isArray((de=e.workOrder)==null?void 0:de.tasks)&&e.workOrder.tasks.length?e.workOrder.tasks:Array.isArray((f=e.workOrder)==null?void 0:f.task_list)?e.workOrder.task_list:[]).forEach(F=>{const U=F.id||F.task_id||F.template_id||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`task-${Date.now()}-${Math.random()}`);C.push({id:U,task:F,progress:{status:"not_started",time_spent:{value:0,unit:"minutes"},step_progress:{},updated_at:""},detailsLoaded:!1})})},q=M(()=>C.some(_=>_.progress.status==="in_progress"&&_.progress.updated_at)),le=M(()=>C.filter(_=>_.progress.status==="completed").length),V=M(()=>C.filter(_=>_.progress.status==="in_progress"&&_.progress.updated_at).length),j=M(()=>C.slice(0,3)),pe=M(()=>{var _;return((_=O.value)==null?void 0:_.name)||"Task Details"}),oe=M(()=>{var _,de;return String(((_=e.workOrder)==null?void 0:_.id)??((de=e.workOrder)==null?void 0:de.name)??"unknown")}),X=async()=>{const _=await go.getDrafts(oe.value);k.value=!0,_.forEach(de=>{const f=C.find(F=>String(F.id)===String(de.taskId));f&&(f.progress={status:de.status==="draft"?"in_progress":de.status,time_spent:{...de.time_spent},step_progress:{...de.step_progress},updated_at:de.updated_at})})},ie=async _=>{P.value=!0,E.value=!0,O.value=null;try{const de=_.task_entry_id||_.taskEntryId||_.id||_.task_id;if(de){const f=await Jt(de),F=f==null?void 0:f.data;F?O.value={..._,...F,steps:Array.isArray(F.steps)&&F.steps.length?F.steps:_.steps||[]}:O.value=_}else O.value=_}catch(de){console.warn("Failed to load task entry details:",de),O.value=_}finally{E.value=!1}},$=()=>{P.value=!1,O.value=null},ce=()=>{var f,F,U,te,N,ee,G,re,Se,De;const _=ne(),de={taskInfo:{id:((f=O.value)==null?void 0:f.id)||((F=O.value)==null?void 0:F.task_id),name:(U=O.value)==null?void 0:U.name,description:(te=O.value)==null?void 0:te.description},workOrderInfo:{id:(N=e.workOrder)==null?void 0:N.id,name:(ee=e.workOrder)==null?void 0:ee.name},stepValues:_,timestamp:new Date().toISOString(),totalSteps:((re=(G=O.value)==null?void 0:G.steps)==null?void 0:re.length)||0};w(de,"taskStepValues",{taskId:(Se=O.value)==null?void 0:Se.id,workOrderId:(De=e.workOrder)==null?void 0:De.id,stepCount:Object.keys(_).length})},ne=()=>{const _={};try{const de=document.querySelector(".drawer-inner .steps-content .steps-preview-container");return de?(de.querySelectorAll(".preview-step-simple").forEach((F,U)=>{const te=R(F,U);te&&(_[`step_${U+1}`]=te)}),console.log("Collected step values:",_),_):(console.warn("Steps preview container not found"),_)}catch(de){return console.error("Error collecting step values:",de),_}},R=(_,de)=>{var f,F,U;try{const te={stepIndex:de+1,stepType:"unknown",value:null,label:null,required:!1},N=_.querySelector(".preview-label, .step-label, .checkbox-step-preview label");N&&(te.label=(f=N.textContent)==null?void 0:f.replace("*","").trim(),te.required=((F=N.textContent)==null?void 0:F.includes("*"))||!1);const ee=_.querySelector(".el-input-number input");if(ee){te.stepType="number",te.value=ee.value?parseFloat(ee.value):null;const Ae=_.querySelector(".unit-label");return Ae&&(te.unit=(U=Ae.textContent)==null?void 0:U.trim()),te}const G=_.querySelector('.el-checkbox input[type="checkbox"]');if(G)return te.stepType="checkbox",te.value=G.checked,te;const re=_.querySelector(".el-input input, .el-textarea textarea");if(re)return te.stepType="text",te.value=re.value,te;const Se=_.querySelector('input[type="radio"]:checked');if(Se)return te.stepType="inspection",te.value=Se.value,te;if(_.querySelector(".el-upload")){te.stepType="attachment";const Ae=_.querySelectorAll(".el-upload-list__item");return te.value={uploadedFiles:Ae.length,files:Array.from(Ae).map(ve=>{var Be;const Fe=ve.querySelector(".el-upload-list__item-name");return Fe?(Be=Fe.textContent)==null?void 0:Be.trim():"Unknown file"})},te}const Pe=_.querySelector("input, textarea, select");return Pe&&(te.stepType=Pe.type||"unknown",te.value=Pe.value),te}catch(te){return console.error(`Error collecting value for step ${de+1}:`,te),{stepIndex:de+1,stepType:"error",value:null,error:te.message}}},fe=()=>{console.log("Submitting task:",O.value),$()};He(async()=>{T(),await X()}),ye(()=>e.workOrder,async()=>{T(),await X()});const K={props:e,emit:y,handleBackToDetail:v,t:d,currentPayload:u,showJsonDisplayer:p,logPayload:w,closeDebugDrawer:h,draftsLoaded:k,taskCards:C,drawerVisible:P,activeTask:O,drawerLoading:E,buildTaskList:T,hasDrafts:q,completedCount:le,draftCount:V,displayCards:j,drawerTitle:pe,workOrderKey:oe,loadDrafts:X,openTaskDrawer:ie,closeDrawer:$,handleLogStepValues:ce,collectStepValues:ne,collectStepValue:R,handleSubmitTask:fe,computed:M,onMounted:He,reactive:it,ref:S,watch:ye,get ArrowLeft(){return ea},get useI18n(){return Ge},get OfflineStorageService(){return go},TaskExecutionSummary:Zv,StepsPreview:ga,get getTaskEntryById(){return Jt},get JsonDebugDrawer(){return cr},get usePayloadLogger(){return Xt},get clonePayload(){return We}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}},$v={class:"work-order-execution"},eh={class:"execution-header"},th={class:"header-right"},ah={key:0,class:"tasks-summary"},rh={class:"drawer-header-container",style:{"margin-bottom":"-32px !important"}},oh={class:"drawer-header-left"},nh={class:"drawer-title"},sh={key:0,class:"task-id-header"},lh={key:0,class:"drawer-header-description"},ih={class:"task-drawer-content"},dh={key:0,class:"drawer-inner"},ch={class:"steps-content"},uh={class:"task-actions"};function mh(s,t,i,e,y,v){var C;const d=D("el-tag"),u=D("el-icon"),p=D("el-button"),w=D("el-empty"),h=D("el-drawer"),k=_a("loading");return c(),g("div",$v,[a("header",eh,[a("div",null,[a("h2",null,m(((C=i.workOrder)==null?void 0:C.name)||"Work Order"),1),t[2]||(t[2]=a("p",{class:"subtitle"},"Execute tasks and record progress",-1))]),a("div",th,[e.hasDrafts?(c(),Y(d,{key:0,type:"warning",effect:"light"},{default:n(()=>t[3]||(t[3]=[x("Drafts saved locally  available offline.")])),_:1,__:[3]})):l("v-if",!0),r(p,{type:"default",onClick:e.handleBackToDetail},{default:n(()=>[r(u,null,{default:n(()=>[r(e.ArrowLeft)]),_:1}),x(" "+m(s.$t("workOrder.actions.backToDetail")),1)]),_:1})])]),e.displayCards.length?(c(),g("section",ah,[(c(!0),g(se,null,we(e.displayCards,(P,O)=>(c(),Y(e.TaskExecutionSummary,{key:P.id,task:P.task,progress:P.progress,index:O,onSelect:E=>e.openTaskDrawer(P.task)},null,8,["task","progress","index","onSelect"]))),128)),e.taskCards.length>3?(c(),Y(p,{key:0,type:"text",class:"view-all"},{default:n(()=>t[4]||(t[4]=[x(" View all tasks ")])),_:1,__:[4]})):l("v-if",!0)])):(c(),Y(w,{key:1,description:"No tasks available","image-size":120})),r(h,{modelValue:e.drawerVisible,"onUpdate:modelValue":t[0]||(t[0]=P=>e.drawerVisible=P),title:e.drawerTitle,size:"50%","destroy-on-close":"","append-to-body":"",class:"work-order-task-drawer"},{header:n(()=>[a("div",rh,[l(" Title and ID on left side "),a("div",oh,[a("div",nh,m(e.drawerTitle),1),e.activeTask?(c(),g("div",sh,"ID: "+m(e.activeTask.id||e.activeTask.task_id||"N/A"),1)):l("v-if",!0)]),l(" Description "),e.activeTask&&e.activeTask.description?(c(),g("div",lh,m(e.activeTask.description),1)):l("v-if",!0)])]),default:n(()=>[Pt((c(),g("div",ih,[e.activeTask&&!e.drawerLoading?(c(),g("div",dh,[l(" Steps Content "),a("div",ch,[r(e.StepsPreview,{steps:e.activeTask.steps,interactive:!0},null,8,["steps"])]),l(" Action Buttons "),a("div",uh,[r(p,{onClick:e.closeDrawer},{default:n(()=>t[5]||(t[5]=[x("Cancel")])),_:1,__:[5]}),r(p,{type:"info",onClick:e.handleLogStepValues},{default:n(()=>t[6]||(t[6]=[x("Logs")])),_:1,__:[6]}),r(p,{type:"primary",onClick:e.handleSubmitTask},{default:n(()=>t[7]||(t[7]=[x("Submit")])),_:1,__:[7]})])])):l("v-if",!0)])),[[k,e.drawerLoading]])]),_:1},8,["modelValue","title"]),l(" JSON Debug Drawer "),r(e.JsonDebugDrawer,{modelValue:e.showJsonDisplayer,"onUpdate:modelValue":t[1]||(t[1]=P=>e.showJsonDisplayer=P),"payload-data":e.currentPayload,title:"Task Step Values",subtitle:"User input values for each step"},null,8,["modelValue","payload-data"])])}const fh=Re(Xv,[["render",mh],["__scopeId","data-v-0f85e24e"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Execution/WorkOrderExecution.vue"]]),_h={__name:"StandardsConfirmDialog",props:{modelValue:{type:Boolean,default:!1},standards:{type:Array,default:()=>[]},workOrderName:{type:String,default:""}},emits:["update:modelValue","confirm","cancel"],setup(s,{expose:t,emit:i}){t();const e=s,y=i,v=M(()=>Array.isArray(e.standards)&&e.standards.length>0),d=S(),u=S(!0),p=T=>T?typeof T=="string"?T:typeof T=="object"&&(T.name||T.label)||"":"",w=T=>{y("update:modelValue",T)},h=()=>{w(!1),y("cancel")},k=()=>{w(!1),y("confirm")},C=()=>{if(!d.value){u.value=!1;return}const T=d.value;if(!(T.scrollHeight>T.clientHeight)){u.value=!1;return}const V=T.scrollTop+T.clientHeight>=T.scrollHeight-8;u.value=!V},P=()=>{C()},O=async()=>{await Ne(),d.value&&(d.value.scrollTop=0),C()};ye(()=>e.modelValue,T=>{T&&(u.value=!0,O())}),ye(()=>e.standards,()=>{O()}),He(()=>{C()}),Mt(()=>{u.value=!1});const E={props:e,emit:y,hasStandards:v,listRef:d,confirmDisabled:u,formatCategory:p,closeDialog:w,handleCancel:h,handleConfirm:k,updateScrollState:C,handleScroll:P,resetScrollState:O,computed:M,onMounted:He,onBeforeUnmount:Mt,ref:S,watch:ye,nextTick:Ne};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}},gh={class:"dialog-content"},ph={class:"standard-title"},vh={class:"standard-name"},hh={key:0,class:"rules-list"},yh={class:"dialog-footer"};function wh(s,t,i,e,y,v){const d=D("el-tag"),u=D("el-empty"),p=D("el-button"),w=D("el-dialog");return c(),Y(w,{"model-value":i.modelValue,title:"Review Standards",width:"600px",top:"10vh","append-to-body":"",class:"review-standards-dialog",onClose:e.handleCancel},{footer:n(()=>[a("div",yh,[r(p,{onClick:e.handleCancel,size:"default"},{default:n(()=>t[0]||(t[0]=[x("Cancel")])),_:1,__:[0]}),r(p,{type:"primary",disabled:e.confirmDisabled,onClick:e.handleConfirm,size:"default"},{default:n(()=>t[1]||(t[1]=[x(" Confirm ")])),_:1,__:[1]},8,["disabled"])])]),default:n(()=>[a("div",gh,[a("div",{ref:"listRef",class:"standards-list",onScroll:e.handleScroll},[e.hasStandards?(c(!0),g(se,{key:0},we(i.standards,h=>(c(),g("div",{key:h.id||h.name,class:"standard-item"},[a("div",ph,[a("span",vh,m(h.name||"Standard"),1),h.category?(c(),Y(d,{key:0,size:"small",type:"info",effect:"plain"},{default:n(()=>[x(m(e.formatCategory(h.category)),1)]),_:2},1024)):l("v-if",!0)]),h.items&&h.items.length?(c(),g("ul",hh,[(c(!0),g(se,null,we(h.items,(k,C)=>(c(),g("li",{key:C},m(k),1))),128))])):l("v-if",!0)]))),128)):(c(),Y(u,{key:1,description:"No standards to review","image-size":80}))],544)])]),_:1},8,["model-value"])}const kh=Re(_h,[["render",wh],["__scopeId","data-v-8bd36b34"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/Modals/StandardsConfirmDialog.vue"]]),bh=Ce({name:"TodoView"}),Sh=Object.assign(bh,{props:{workOrders:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},filters:{type:Object,default:()=>({})},total:{type:Number,default:0},currentPage:{type:Number,default:1},pageSize:{type:Number,default:10}},emits:["edit","delete","refresh","work-order-created","work-order-updated","page-change","page-size-change","tab-change"],setup(s,{expose:t,emit:i}){const e=s,y=i,{t:v}=Ge(),d=S(null),u=S("todo"),p=S("priority-desc"),w=S("detail"),h=S(null),k=S(!1),C=S(window.innerWidth),P=S(!1),O=S(null),E=S(null),T=yt(),q=At(),le=S(e.currentPage),V=S(e.pageSize),j=It(),pe=S("work-order-create"),oe=S(0),X=S(!1),ie=S(null),$=S(null),ce=M(()=>`${pe.value}-${oe.value}`),ne=M(()=>{var Oe,Ie;const H=((Oe=ie.value)==null?void 0:Oe.standards)||((Ie=ie.value)==null?void 0:Ie.standard_list);return Array.isArray(H)?H:[]}),R=()=>{if(E.value)try{const H=E.value.$el||E.value,Oe=H.querySelector(".tasks-section");if(Oe){const Ie=H.querySelector(".work-order-create-enhanced");if(Ie){const Ze=Oe.offsetTop;Ie.scrollTo({top:Ze-50,behavior:"smooth"})}}}catch(H){console.warn("Could not scroll to tasks section:",H)}},fe=M(()=>C.value>1800?7:3),K=M(()=>Array.isArray(e.workOrders)?e.workOrders:[]),_=M(()=>{const H=e.total,Oe=H===0?0:(le.value-1)*V.value+1,Ie=Math.min(le.value*V.value,H);return{start:Oe,end:Ie,total:H}}),de=async()=>{if(w.value==="create"&&E.value)try{return(E.value.hasFormChanges?E.value.hasFormChanges():!1)&&(await lt.confirm("Are you sure you want to leave the form? All unsaved changes will be lost.","Confirm Leave",{confirmButtonText:"Leave",cancelButtonText:"Cancel",type:"warning"}),j&&j.clearDraft&&j.clearDraft()),!0}catch(H){return H==="cancel"||H==="close"?!1:(console.error("Error checking form changes:",H),!0)}return!0},f=async H=>{if(await de())try{k.value=!0;const Ie=await Za(H.id);Ie&&Ie.data?d.value=Ie.data:d.value=H,w.value="detail"}catch(Ie){console.error("Failed to fetch work order:",Ie),d.value=H,w.value="detail",B.error("Failed to load work order details")}finally{k.value=!1}},F=async H=>{if(!await de())return;u.value=H,d.value=null,y("tab-change",{tab:H,statusFilter:H==="todo"?"pending,in_progress":"completed"})},U=H=>{p.value=H},te=({action:H,workOrder:Oe})=>{switch(H){case"edit":N(Oe);break;case"view":f(Oe);break;case"delete":ee(Oe);break;case"start":G(Oe);break;default:console.warn(`Unhandled action: ${H}`,Oe)}},N=async H=>{if(await de()){w.value="edit",k.value=!0;try{const Ie=await Za(H.id),Ze=(Ie==null?void 0:Ie.data)||H;h.value=Ze,d.value=Ze}catch(Ie){console.error("Failed to load work order for edit:",Ie),B.error("Failed to load the latest work order details. Showing cached data."),h.value=H,d.value=H}finally{k.value=!1}}},ee=H=>{y("delete",H)},G=async H=>{await de()&&(d.value=H,ie.value=H,X.value=!0)},re=()=>{X.value=!1,ie.value&&($.value=ie.value,w.value="execution",d.value=ie.value)},Se=()=>{X.value=!1,ie.value=null},De=()=>{w.value="detail",$.value=null,ie.value=null},Pe=S(!1),Ae=async(H,Oe)=>{var Ie;if(!(!H||Pe.value)){Pe.value=!0;try{if(H==="create")gt({fromTemplateDesigner:!0});else if(H==="edit"){const Ze=Oe?Number(Oe)||Oe:null;if(!Ze){console.warn("Missing workOrderId for edit return context.");return}if(w.value==="edit"&&((Ie=h.value)==null?void 0:Ie.id)===Ze){console.log("TodoView: Already editing work order",Ze,"- skipping reload to prevent interruption");return}const vt=K.value.find(I=>I.id===Ze);await N(vt||{id:Ze})}}finally{Pe.value=!1}}},ve=async()=>{const H={...q.query};delete H.panel,delete H.workOrderId;try{await T.replace({path:q.path,query:H})}catch(Oe){(Oe==null?void 0:Oe.name)!=="NavigationDuplicated"&&console.warn("Failed to cleanup return query:",Oe)}};ye(()=>q.query.panel,async H=>{const Oe=Array.isArray(H)?H[0]:H;if(!Oe)return;let Ie=Array.isArray(q.query.workOrderId)?q.query.workOrderId[0]:q.query.workOrderId;!Ie&&j.returnWorkOrderId&&(Ie=j.returnWorkOrderId),await Ae(Oe,Ie),await ve(),Ne(()=>{setTimeout(()=>{j.clearReturnContext()},100)})},{immediate:!0}),ye(()=>j.returnPanel,async H=>{!H||q.query.panel||(await Ae(H,j.returnWorkOrderId),Ne(()=>{setTimeout(()=>{j.clearReturnContext()},100)}))},{immediate:!0});const Fe=H=>{B.success(v("workOrder.messages.shareSuccess"))},Be=async H=>{try{O.value=H,P.value=!0,B.success("PDF preview opened")}catch(Oe){console.error("Export error:",Oe),B.error("Failed to open PDF preview. Please try again.")}},et=()=>{P.value=!1,O.value=null},dt=()=>{B.info(v("workOrder.tracking.addParts"))},_t=()=>{B.info(v("workOrder.tracking.addTime"))},Vt=()=>{B.info(v("workOrder.tracking.addCosts"))},mt=()=>{B.info(v("workOrder.tracking.viewProcedure"))},rt=()=>{B.success(v("workOrder.comments.add"))},wt=async H=>{await de()&&(le.value=H,y("page-change",H),d.value=null)},St=H=>{V.value=H,le.value=1,y("page-size-change",H),d.value=null};ye(()=>e.workOrders,H=>{H.length>0&&!d.value&&(d.value=K.value[0])},{immediate:!0}),ye(()=>e.currentPage,H=>{le.value=H}),ye(()=>e.pageSize,H=>{V.value=H}),ye(()=>e.filters,(H,Oe)=>{const Ie=I=>{if(!I)return{};const Z={...I};return delete Z.page,delete Z.limit,Z},Ze=JSON.stringify(Ie(Oe)),vt=JSON.stringify(Ie(H));Ze!==vt&&(le.value=1,y("page-change",1),d.value=null)},{deep:!0}),ye([u,p],()=>{le.value=1,y("page-change",1),d.value=null},{deep:!0});const gt=(H={})=>{w.value="create",d.value=null,(H.fromTemplateDesigner||j.shouldOpenCreatePanel)&&(oe.value+=1,Ne(()=>{setTimeout(()=>{R()},100)}))},Qe=()=>{console.log(" TodoView: showDetailView called"),console.log(" TodoView: Setting currentRightPanelView to detail"),w.value="detail",h.value=null,!d.value&&K.value.length>0&&(d.value=K.value[0]),console.log(" TodoView: showDetailView completed, currentRightPanelView:",w.value)},tt=H=>{y("work-order-created",H)},W=H=>{const Oe=K.value.findIndex(Ie=>Ie.id===H.id);Oe!==-1&&(K.value[Oe]=H),d.value&&d.value.id===H.id&&(d.value=H),h.value=null,w.value="detail",y("work-order-updated",H),B.success("Work order updated successfully")},$e=H=>{const Oe=K.value.find(Ie=>Ie.id===H);return Oe?(d.value=Oe,w.value="detail",!0):(console.warn("Work order not found in displayedWorkOrders"),!1)};t({showCreateForm:gt,showDetailView:Qe,selectWorkOrderById:$e}),He(()=>{K.value.length>0&&(d.value=K.value[0]);const H=()=>{C.value=window.innerWidth};window.addEventListener("resize",H),Aa(()=>{window.removeEventListener("resize",H)})});const Ke={props:e,emit:y,t:v,selectedWorkOrder:d,activeTab:u,sortBy:p,currentRightPanelView:w,workOrderToEdit:h,isLoadingWorkOrder:k,screenWidth:C,showPdfPreview:P,pdfPreviewData:O,workOrderCreateRef:E,router:T,route:q,internalCurrentPage:le,internalPageSize:V,workOrderDraftStore:j,createPanelKey:pe,createPanelRefreshCounter:oe,showStandardsDialog:X,pendingExecutionWorkOrder:ie,workOrderInExecution:$,computedCreatePanelKey:ce,executionStandards:ne,scrollToTasksSection:R,pagerCount:fe,displayedWorkOrders:K,paginationInfo:_,checkUnsavedChanges:de,selectWorkOrder:f,handleTabChange:F,handleSortChange:U,handleCardAction:te,handleEdit:N,handleDelete:ee,handleStartWorkOrder:G,confirmStartExecution:re,cancelStartExecution:Se,handleExecutionClose:De,isProcessingReturnContext:Pe,processReturnPanel:Ae,cleanupReturnQuery:ve,handleShare:Fe,handleExport:Be,handlePdfPreviewClose:et,handleAddParts:dt,handleAddTime:_t,handleAddCosts:Vt,handleViewProcedure:mt,handleAddComment:rt,handlePageChange:wt,handlePageSizeChange:St,showCreateForm:gt,showDetailView:Qe,handleWorkOrderCreated:tt,handleWorkOrderUpdated:W,selectWorkOrderById:$e,__MACROS_defineComponent:Ce,ref:S,computed:M,watch:ye,onMounted:He,onUnmounted:Aa,nextTick:Ne,get useRouter(){return yt},get useRoute(){return At},get useI18n(){return Ge},get ElMessage(){return B},get ElMessageBox(){return lt},get getWorkOrderById(){return Za},WorkOrderCard:sl,WorkOrderDetail:Eu,WorkOrderCreate:o_,WorkOrderEdit:Fg,PdfPreviewModal:Vv,WorkOrderExecution:fh,StandardsConfirmDialog:kh,get useWorkOrderDraftStore(){return It}};return Object.defineProperty(Ke,"__isScriptSetup",{enumerable:!1,value:!0}),Ke}}),Th={class:"todo-view"},Oh={class:"left-panel"},Ch={class:"todo-specific-filters"},Dh={class:"sort-options"},Ah={class:"sort-label"},Ph={class:"work-order-list"},Ih={key:0,class:"loading-container"},Vh={key:1,class:"empty-list"},xh={key:2,class:"list-content"},Fh={class:"pagination-info"},Eh={class:"info-text"},Lh={class:"cards-container"},Wh={key:0,class:"pagination-controls"},Rh={class:"right-panel"},Mh={key:0,class:"loading-container"};function qh(s,t,i,e,y,v){var E,T;const d=D("el-tab-pane"),u=D("el-tabs"),p=D("el-option"),w=D("el-select"),h=D("el-skeleton"),k=D("el-empty"),C=D("el-col"),P=D("el-row"),O=D("el-pagination");return c(),g("div",Th,[l(" Left Panel - Work Order List "),a("div",Oh,[l(" Todo-specific Filters (Status tabs and sorting) "),Pt(a("div",Ch,[l(" Status Tabs "),r(u,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=q=>e.activeTab=q),onTabChange:e.handleTabChange,class:"todo-tabs"},{default:n(()=>[r(d,{label:s.$t("workOrder.tabs.todo"),name:"todo"},null,8,["label"]),r(d,{label:s.$t("workOrder.tabs.done"),name:"done"},null,8,["label"])]),_:1},8,["modelValue"]),l(" Sort Options "),a("div",Dh,[a("div",Ah,m(s.$t("workOrder.sort.sortBy"))+":",1),r(w,{modelValue:e.sortBy,"onUpdate:modelValue":t[1]||(t[1]=q=>e.sortBy=q),onChange:e.handleSortChange,size:"small",style:{width:"180px"}},{default:n(()=>[r(p,{label:s.$t("workOrder.sort.priorityHighest"),value:"priority-desc"},null,8,["label"]),r(p,{label:s.$t("workOrder.sort.priorityLowest"),value:"priority-asc"},null,8,["label"]),r(p,{label:s.$t("workOrder.sort.dueDateNearest"),value:"dueDate-asc"},null,8,["label"]),r(p,{label:s.$t("workOrder.sort.dueDateFarthest"),value:"dueDate-desc"},null,8,["label"]),r(p,{label:s.$t("workOrder.sort.createdNewest"),value:"created-desc"},null,8,["label"]),r(p,{label:s.$t("workOrder.sort.createdOldest"),value:"created-asc"},null,8,["label"])]),_:1},8,["modelValue"])])],512),[[qa,!1]]),l(" Work Order Cards "),a("div",Ph,[i.loading?(c(),g("div",Ih,[r(h,{rows:3,animated:""})])):e.displayedWorkOrders&&e.displayedWorkOrders.length===0?(c(),g("div",Vh,[r(k,{description:s.$t("workOrder.messages.noData"),"image-size":80},null,8,["description"])])):(c(),g("div",xh,[l(" Pagination Info "),a("div",Fh,[a("div",Eh,m(s.$t("workOrder.pagination.showing",{start:e.paginationInfo.start,end:e.paginationInfo.end,total:e.paginationInfo.total})),1),r(w,{modelValue:e.internalPageSize,"onUpdate:modelValue":t[2]||(t[2]=q=>e.internalPageSize=q),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:n(()=>[r(p,{label:"10",value:10}),r(p,{label:"20",value:20}),r(p,{label:"50",value:50})]),_:1},8,["modelValue"])]),l(" Cards Container "),a("div",Lh,[r(P,{gutter:16},{default:n(()=>[(c(!0),g(se,null,we(e.displayedWorkOrders,q=>(c(),Y(C,{key:q.id},{default:n(()=>{var le;return[r(e.WorkOrderCard,{"work-order":q,"is-selected":((le=e.selectedWorkOrder)==null?void 0:le.id)===q.id,onSelect:e.selectWorkOrder,onAction:e.handleCardAction},null,8,["work-order","is-selected"])]}),_:2},1024))),128))]),_:1})]),l(" Pagination Controls "),e.paginationInfo.total>e.internalPageSize?(c(),g("div",Wh,[r(O,{"current-page":e.internalCurrentPage,"page-size":e.internalPageSize,"pager-count":e.pagerCount,total:e.paginationInfo.total,layout:"total, prev, pager, next, jumper",small:!0,onCurrentChange:e.handlePageChange,onSizeChange:e.handlePageSizeChange,"hide-on-single-page":""},null,8,["current-page","page-size","pager-count","total"])])):l("v-if",!0)]))])]),l(" Right Panel - Work Order Detail or Create "),a("div",Rh,[l(" Loading State "),e.isLoadingWorkOrder?(c(),g("div",Mh,[r(h,{rows:5,animated:""}),t[5]||(t[5]=a("div",{class:"loading-text"},m("Loading work order details..."),-1))])):e.currentRightPanelView==="detail"?(c(),g(se,{key:1},[l(" Work Order Detail View "),r(e.WorkOrderDetail,{"work-order":e.selectedWorkOrder,onEdit:e.handleEdit,onShare:e.handleShare,onExport:e.handleExport,onAddParts:e.handleAddParts,onAddTime:e.handleAddTime,onAddCosts:e.handleAddCosts,onViewProcedure:e.handleViewProcedure,onAddComment:e.handleAddComment,onStartWorkOrder:e.handleStartWorkOrder},null,8,["work-order"])],2112)):e.currentRightPanelView==="create"?(c(),g(se,{key:2},[l(" Work Order Create View "),(c(),Y(e.WorkOrderCreate,{key:e.computedCreatePanelKey,onBackToDetail:e.showDetailView,onWorkOrderCreated:e.handleWorkOrderCreated,ref:"workOrderCreateRef"}))],2112)):e.currentRightPanelView==="edit"?(c(),g(se,{key:3},[l(" Work Order Edit View "),r(e.WorkOrderEdit,{"work-order":e.workOrderToEdit,onBackToDetail:e.showDetailView,onWorkOrderUpdated:e.handleWorkOrderUpdated},null,8,["work-order"])],2112)):e.currentRightPanelView==="execution"?(c(),Y(e.WorkOrderExecution,{key:((E=e.workOrderInExecution)==null?void 0:E.id)||"execution","work-order":e.workOrderInExecution,onClose:e.handleExecutionClose,onBackToDetail:e.showDetailView},null,8,["work-order"])):l("v-if",!0)]),r(e.StandardsConfirmDialog,{modelValue:e.showStandardsDialog,"onUpdate:modelValue":t[3]||(t[3]=q=>e.showStandardsDialog=q),"work-order-name":((T=e.pendingExecutionWorkOrder)==null?void 0:T.name)||"",standards:e.executionStandards,onConfirm:e.confirmStartExecution,onCancel:e.cancelStartExecution},null,8,["modelValue","work-order-name","standards"]),l(" PDF Preview Modal "),r(e.PdfPreviewModal,{visible:e.showPdfPreview,"onUpdate:visible":t[4]||(t[4]=q=>e.showPdfPreview=q),"work-order":e.pdfPreviewData,onClose:e.handlePdfPreviewClose},null,8,["visible","work-order"])])}const zh=Re(Sh,[["render",qh],["__scopeId","data-v-27c8d13b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/WorkOrder/TodoView/TodoView.vue"]]),po=250,vo=100,Uh={__name:"workOrderCalendar",props:{data:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["date-range-change","view"],setup(s,{expose:t,emit:i}){const e=S(null),y=S([]),v=Ar(),d=s,u=i;t({refetchEvents:()=>{var F,U;(U=(F=e.value)==null?void 0:F.getApi())==null||U.refetchEvents()}}),ye(()=>v.lang,F=>{fe(F)},{immediate:!0});const p=S(""),w=F=>{p.value=F.view.type};function h(F){var te,N;const U=((te=e.value)==null?void 0:te.el)||((N=e.value)==null?void 0:N.$el);return U?U.querySelector(".fc-scroller, .fc-scroller-harness .fc-scroller"):null}const k=new Map;Pr(()=>{const F=h(p.value);F&&k.set(p.value,F.scrollTop)}),la(()=>{setTimeout(()=>{const F=h(p.value);if(F){const U=k.get(p.value)??0;F.scrollTop=U}},0)}),la(()=>{var F,U;(U=(F=e.value)==null?void 0:F.getApi())==null||U.updateSize()});const C={en:{today:"Today",year:"Year",month:"Month",week:"Week",day:"Day",list:"Weekly List"},zh:{today:"",year:"",month:"",week:"",day:"",list:""}},P=S({plugins:[$r,eo,to,ao,ro],initialView:"dayGridMonth",headerToolbar:{left:"today",center:"prev,title,next",right:"multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay,listWeek"},events:y.value,eventSources:[{events(F,U,te){const{startStr:N,endStr:ee}=F;u("date-range-change",{start_date_from:N,end_date_to:ee,resolve:U,reject:te})}}],eventDataTransform:O,eventClick:E,eventMouseEnter:ce,eventMouseLeave:ne,locales:[Zr,Xr],locale:"en",aspectRatio:"2.9",multiMonthMaxColumns:1,nowIndicator:!0,nowIndicatorClassNames:["custom-now-indicator"],viewDidMount:w,eventMaxStack:!0,dayMaxEventRows:!0});function O(F){var N,ee,G,re;const U=(N=F.state)==null?void 0:N.id,te=K(F.due_date)&&U!==7&&U!==12;return{id:F.id,title:F.name,start:F.start_date,end:F.end_date||null,groupId:F.recurrence_uuid||null,backgroundColor:te?"#fef2f2":"#f9fafb",borderColor:"#dddddd",textColor:te?"red":"black",display:"block",extendedProps:{...F,stateId:U,dueDate:F.due_date,categories:F.categories,stateName:(ee=F.state)==null?void 0:ee.name,priorityId:(G=F.priority)==null?void 0:G.id,priorityName:(re=F.priority)==null?void 0:re.name,image_list:F.image_list||[],work_order_progress:F.work_order_progress||null,equipment_node:F.equipment_node||null,isOverDue:te}}}function E(F){u("view",{id:F.event.id})}const T=({extendedProps:F})=>{const U=F.stateId;return U===7?Cr:U===12?Or:void 0},q=F=>{var N;const U=F.groupId,te=((N=F.extendedProps.recurrence_type)==null?void 0:N.id)||null;return U&&te!=null&&te!==1?er:void 0},le=({extendedProps:F})=>{const U=F.stateId;return U===7?"green":U===12?"red":""},V=F=>F?"danger":"default",j=S(),pe=S({getBoundingClientRect:()=>new DOMRect(0,0,0,0),contextElement:document.body}),oe=S(!1),X=it({id:"",gropuId:"",title:"",startDate:"",endDate:"",dueDate:"",finished_at:"",priority:null,category:null,state:null,stateId:"",stateName:"",recurrence_type:null,image_list:[],isOverDue:null});let ie=null,$=null;function ce(F){const{event:U,jsEvent:te}=F,{clientX:N,clientY:ee}=te;$&&clearTimeout($),ie&&(clearTimeout(ie),ie=null),ie=window.setTimeout(()=>{X.id=U.id,X.groupId=U.groupId,X.title=U.title,X.startDate=U.start,X.endDate=U.end,X.finished_at=U.extendedProps.finished_at,X.priority=U.extendedProps.priority,X.category=U.extendedProps.categories,X.dueDate=U.extendedProps.dueDate,X.state=U.extendedProps.state,X.stateId=U.extendedProps.stateId,X.stateName=U.extendedProps.stateName,X.recurrence_type=U.extendedProps.recurrence_type,X.image_list=U.extendedProps.image_list,X.work_order_progress=U.extendedProps.work_order_progress,X.equipment_node=U.extendedProps.equipment_node,X.isOverDue=U.extendedProps.isOverDue,pe.value.getBoundingClientRect=()=>new DOMRect(N,ee,0,0),pe.value.contextElement=document.body,oe.value=!0},po)}function ne(F){ie&&clearTimeout(ie),$=window.setTimeout(()=>{oe.value=!1,$=null},vo)}const R=F=>F?ut(F):"-";function fe(F){var te;const U=(te=e.value)==null?void 0:te.getApi();U&&(U.setOption("locale",F),U.setOption("buttonText",C[F]))}function K(F){if(!F)return!1;const U=new Date;return U.setHours(0,0,0,0),new Date(F)<U}const _=M(()=>X.image_list&&X.image_list.length>0?540:420),de=[{id:1,name:"Erik Yu"},{id:2,name:"Jane Smith"},{id:3,name:"Mike Johnson"}];He(()=>{fe(v.lang)});const f={fullCalendarRef:e,events:y,appStore:v,props:d,emit:u,currentViewName:p,handleViewMount:w,getScrollContainer:h,scrollPositions:k,buttonTextMap:C,calendarOptions:P,convertWorkOrderDTOToEventFormat:O,handleEventClick:E,getIconByStateId:T,recurrenceIcon:q,getColorByStateId:le,getTextTypeByDueDate:V,workOrderHoverPopover:j,virtualTrigger:pe,popoverVisible:oe,popoverData:X,showDelayMs:po,hideDelayMs:vo,get hoverTimer(){return ie},set hoverTimer(F){ie=F},get hideTimer(){return $},set hideTimer(F){$=F},handleEventMouseEnter:ce,handleEventMouseLeave:ne,formatDate:R,setCalendarLocale:fe,isDateBeforeToday:K,popperWidth:_,temporaryUserList:de,get FullCalendar(){return kn},get dayGridPlugin(){return $r},get interactionPlugin(){return to},get timeGridPlugin(){return eo},get multiMonthPlugin(){return ao},get listPlugin(){return ro},get enLocale(){return Zr},get zhLocale(){return Xr},onMounted:He,ref:S,reactive:it,watch:ye,computed:M,onDeactivated:Pr,onActivated:la,get ElPopover(){return pn},get CircleCheck(){return Cr},get CircleClose(){return Or},get Refresh(){return er},get Picture(){return ua},get convertToLocalTime(){return ut},get useAppStore(){return Ar},PriorityTag:ir,CategoryTag:dr,StatusTag:Fo};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},Nh={class:"fc-ref"},Bh={class:"fc-item"},jh={class:"fc-title"},Hh={style:{display:"flex","align-items":"center"}},Jh={style:{"margin-right":"10px"}},Yh={class:"tag-row"},Gh={key:0},Qh={key:1},Kh={key:2},Zh={key:3},Xh={style:{display:"flex"}},$h={key:0,class:"card-thumbnail-circle"},ey={class:"image-slot-circle"};function ty(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-text"),p=D("el-tag"),w=D("el-progress"),h=D("el-image"),k=_a("loading");return c(),g(se,null,[Pt((c(),g("div",null,[r(e.FullCalendar,{ref:"fullCalendarRef",options:e.calendarOptions,class:"wo-calendar"},{eventContent:n(({event:C,timeText:P})=>[a("div",Nh,[l(" Work order event display "),a("div",Bh,[a("span",jh,m(P)+" "+m(C.title),1),l(" State icon "),e.getIconByStateId(C)?(c(),Y(d,{key:0,class:"status-icon",color:e.getColorByStateId(C)},{default:n(()=>[(c(),Y(ma(e.getIconByStateId(C))))]),_:2},1032,["color"])):l("v-if",!0),l(" Recurrence icon "),e.recurrenceIcon(C)?(c(),Y(d,{key:1,class:"status-icon"},{default:n(()=>[(c(),Y(ma(e.recurrenceIcon(C))))]),_:2},1024)):l("v-if",!0)])])]),_:1},8,["options"])])),[[k,e.props.loading]]),l(" Tooltip on hover for work order events "),r(e.ElPopover,{ref:"workOrderHoverPopover",visible:e.popoverVisible,"virtual-triggering":"","virtual-ref":e.virtualTrigger,width:e.popperWidth,"popper-class":"wo-popover"},{default:n(()=>{var C,P;return[a("div",Hh,[l(" Left content "),a("div",Jh,[l(" Priority / Category / Status on same row "),a("div",Yh,[l(" ID "),a("div",null,[r(u,{size:"large",style:{"font-weight":"600",color:"var(--el-color-primary)"}},{default:n(()=>[x(" #"+m(e.popoverData.id),1)]),_:1})]),e.popoverData.priority!==null?(c(),Y(e.PriorityTag,{key:0,priority:e.popoverData.priority},null,8,["priority"])):l("v-if",!0),e.popoverData.category!==null?(c(),Y(e.CategoryTag,{key:1,category:e.popoverData.category},null,8,["category"])):l("v-if",!0),e.popoverData.state!==null?(c(),Y(e.StatusTag,{key:2,status:e.popoverData.state},null,8,["status"])):l("v-if",!0),l(" Overdue tag "),e.popoverData.isOverDue?(c(),Y(p,{key:3,type:"danger",size:"default",effect:"dark"},{default:n(()=>[x(m(s.$t("workOrder.status.overdue")),1)]),_:1})):l("v-if",!0)]),l(" Work Order Title "),a("div",null,[r(u,{tag:"b",size:"large"},{default:n(()=>[x(m(e.popoverData.title),1)]),_:1})]),l(" Recurrence ID "),e.popoverData.groupId?(c(),g("div",Gh,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.calendar.recurrenceId"))+": ",1)]),_:1}),r(u,null,{default:n(()=>[x(m(e.popoverData.groupId),1)]),_:1})])):l("v-if",!0),e.popoverData.recurrence_type?(c(),g("div",Qh,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.table.recurrenceType"))+": ",1)]),_:1}),r(u,null,{default:n(()=>[x(m(e.popoverData.recurrence_type.name),1)]),_:1})])):l("v-if",!0),a("div",null,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.table.startDate"))+": ",1)]),_:1}),r(u,null,{default:n(()=>[x(m(e.formatDate(e.popoverData.startDate)),1)]),_:1})]),l('        <div v-if="popoverData.endDate">'),l("          <el-text>{{ $t('workOrder.calendar.endDate') }}: </el-text>"),l("          <el-text>{{ formatDate(popoverData.endDate || popoverData.startDate) }}</el-text>"),l("        </div>"),a("div",null,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.table.dueDate"))+": ",1)]),_:1}),r(u,{type:e.getTextTypeByDueDate(e.popoverData.isOverDue)},{default:n(()=>[x(m(e.formatDate(e.popoverData.dueDate)),1)]),_:1},8,["type"])]),e.popoverData.finished_at?(c(),g("div",Kh,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.table.finishedDate"))+": ",1)]),_:1}),r(u,null,{default:n(()=>[x(m(e.formatDate(e.popoverData.finished_at)),1)]),_:1})])):l("v-if",!0),a("div",null,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.calendar.assignedUser"))+": ",1)]),_:1}),(c(),g(se,null,we(e.temporaryUserList,O=>r(p,{key:O.id,style:{"margin-right":"5px"}},{default:n(()=>[x(m(O.name),1)]),_:2},1024)),64))]),e.popoverData.equipment_node?(c(),g("div",Zh,[r(u,null,{default:n(()=>[x(m(s.$t("workOrder.calendar.equipment"))+": ",1)]),_:1}),r(u,null,{default:n(()=>{var O;return[x(m((O=e.popoverData.equipment_node)==null?void 0:O.name),1)]}),_:1})])):l("v-if",!0),l(" Task Progress "),a("div",Xh,[r(u,{style:{"margin-right":"10px"}},{default:n(()=>[x(m(s.$t("workOrder.calendar.taskProgress"))+": ",1)]),_:1}),r(w,{percentage:((C=e.popoverData.work_order_progress)==null?void 0:C.completed_task_amount)/((P=e.popoverData.work_order_progress)==null?void 0:P.total_task_amount)||0,style:{flex:"1"}},null,8,["percentage"])])]),l(" Image (First one only) "),e.popoverData.image_list&&e.popoverData.image_list.length?(c(),g("div",$h,[r(h,{src:e.popoverData.image_list[0],fit:"cover","preview-src-list":e.popoverData.image_list,class:"circular-image","z-index":2e3,"preview-teleported":""},{error:n(()=>[a("div",ey,[r(d,null,{default:n(()=>[r(e.Picture)]),_:1})])]),_:1},8,["src","preview-src-list"])])):l("v-if",!0)])]}),_:1},8,["visible","virtual-ref","width"])],64)}const ay=Re(Uh,[["render",ty],["__scopeId","data-v-59f0f06c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/components/workOrderCalendar.vue"]]),ry=Ce({name:"WorkOrderManagement"}),oy=Object.assign(ry,{setup(s,{expose:t}){t();const i=yt(),e=At(),{t:y}=Ge(),{showSuccess:v}=Pa(),d=It(),{loading:u,list:p,total:w,listQuery:h,expandedRows:k,recurrenceViewMode:C,currentRecurrenceId:P,fetchWorkOrders:O,fetchRecurringWorkOrders:E,exitRecurrenceView:T,loadChildren:q,handleFilter:le,updateFilters:V,handleSizeChange:j,handleCurrentChange:pe,toggleRowHighlight:oe,handleDelete:X,initializeCommonData:ie}=Kr(),$=S(!1),ce=S("todo"),ne=S(),R=S(null),fe=()=>{if(e.query.showCreate===void 0)return;const{showCreate:ve,...Fe}=e.query;i.replace({path:e.path,query:{...Fe}})};ye(()=>e.query.showCreate,ve=>{(ve==="1"||ve==="true")&&Ne(()=>{var Fe;(Fe=R.value)==null||Fe.showCreateForm(),fe()})},{immediate:!0}),ye(()=>d.shouldOpenCreatePanel,ve=>{ve&&Ne(()=>{var Fe;(Fe=R.value)==null||Fe.showCreateForm(),d.setShouldOpenCreatePanel(!1)})});const K=ve=>{i.push({name:"ViewWorkOrder",params:{id:ve.id}})},_=()=>{var ve;ce.value==="todo"?(ve=R.value)==null||ve.showCreateForm():i.push({name:"NewWorkOrder"})},de=ve=>{},f=async(ve,Fe)=>{try{await X(ve,Fe),v(y("workOrder.messages.deleteSuccess")),await O()}catch(Be){console.error("Delete failed:",Be)}},F=async ve=>{ce.value=ve,ve!=="calendar"&&(delete h.start_date_from,delete h.end_date_to,h.page=1,h.limit=20),ve==="todo"?V({status:"pending,in_progress"}):ve==="table"&&V({status:null})},U=async()=>{try{await O(),v(y("workOrder.messages.refreshSuccess"))}catch(ve){console.error("Refresh failed:",ve)}},te=ve=>{var Fe;Object.assign(h,ve),ce.value==="calendar"?(Fe=ne.value)==null||Fe.refetchEvents():le()},N=()=>{},ee=async({start_date_from:ve,end_date_to:Fe,resolve:Be,reject:et})=>{Object.assign(h,{start_date_from:ve,end_date_to:Fe}),h.page=-1,h.limit=-1;try{await O(),Be(p.value)}catch(dt){et(dt),console.error("Unable to load work orders:",dt),B.error("Unable to load work-orders")}},G=async ve=>{try{if(h.page=1,await O(),R.value&&ve.id&&(await Ne(),!R.value.selectWorkOrderById(ve.id))){if(!p.value.find(et=>et.id===ve.id)){const et=h.status;h.status=null,await O(),p.value.find(_t=>_t.id===ve.id)||console.warn("Work order not found after creation - possible filtering issue"),h.status=et,await O()}R.value.showDetailView()}v(y("workOrder.messages.createSuccess"))}catch(Fe){console.error("Failed to refresh after work order creation:",Fe),v(y("workOrder.messages.createSuccess"))}},re=async ve=>{const Fe=p.value.findIndex(Be=>Be.id===ve.id);Fe!==-1&&(p.value[Fe]=ve)},Se=async({tab:ve,statusFilter:Fe})=>{V({status:Fe})},De=async ve=>{if(ve)try{await E(ve),v(y("workOrder.messages.recurrenceViewEnabled"))}catch(Fe){console.error("Failed to load recurring work orders:",Fe)}},Pe=()=>{T(),v(y("workOrder.messages.recurrenceViewDisabled"))};He(async()=>{try{await ie(),await O()}catch(ve){console.error("Failed to initialize work order page:",ve)}});const Ae={router:i,route:e,t:y,showSuccess:v,workOrderDraftStore:d,listLoading:u,list:p,total:w,listQuery:h,expandedRows:k,recurrenceViewMode:C,currentRecurrenceId:P,fetchWorkOrders:O,fetchRecurringWorkOrders:E,exitRecurrenceView:T,loadChildren:q,handleFilter:le,updateFilters:V,handleSizeChange:j,handleCurrentChange:pe,toggleRowHighlight:oe,deleteWorkOrder:X,initializeCommonData:ie,downloadLoading:$,currentView:ce,calendarViewRef:ne,todoViewRef:R,clearShowCreateFlag:fe,handleView:K,handleCreate:_,handleUpdate:de,handleDelete:f,handleViewChange:F,handleRefresh:U,handleFilterUpdate:te,handleDownload:N,handleCalendarDisplayDateChange:ee,handleWorkOrderCreated:G,handleWorkOrderUpdated:re,handleTabChange:Se,handleViewRecurrence:De,handleExitRecurrenceView:Pe,__MACROS_defineComponent:Ce,ref:S,onMounted:He,nextTick:Ne,watch:ye,get useRouter(){return yt},get useRoute(){return At},get useI18n(){return Ge},get Calendar(){return Oo},get Grid(){return ho},get List(){return sr},get View(){return $t},get Back(){return _n},get MesLayout(){return gn},UnifiedWorkOrderFilters:as,WorkOrderTable:zs,TodoView:zh,CalendarView:ay,get useWorkOrder(){return Kr},get useErrorHandler(){return Pa},get ElMessage(){return B},get useWorkOrderDraftStore(){return It}};return Object.defineProperty(Ae,"__isScriptSetup",{enumerable:!1,value:!0}),Ae}}),ny={class:"view-mode-selector"},sy={key:0,class:"table-view"},ly={key:0,class:"recurrence-view-banner"},iy={class:"banner-content"},dy={class:"banner-text"},cy={class:"todo-view-container"},uy={class:"todo-view-container"},my={key:0};function fy(s,t,i,e,y,v){const d=D("el-icon"),u=D("el-option"),p=D("el-select"),w=D("el-button"),h=D("el-pagination");return c(),Y(e.MesLayout,{title:s.$t("workOrder.title"),"view-mode":e.currentView},{viewMode:n(()=>[a("div",ny,[r(p,{modelValue:e.currentView,"onUpdate:modelValue":t[0]||(t[0]=k=>e.currentView=k),onChange:e.handleViewChange,size:"default",style:{width:"140px"}},{default:n(()=>[r(u,{label:s.$t("workOrder.viewModes.todo"),value:"todo"},{default:n(()=>[r(d,{style:{"margin-right":"8px"}},{default:n(()=>[r(e.List)]),_:1}),x(" "+m(s.$t("workOrder.viewModes.todo")),1)]),_:1},8,["label"]),r(u,{label:s.$t("workOrder.viewModes.table"),value:"table"},{default:n(()=>[r(d,{style:{"margin-right":"8px"}},{default:n(()=>[r(e.Grid)]),_:1}),x(" "+m(s.$t("workOrder.viewModes.table")),1)]),_:1},8,["label"]),r(u,{label:s.$t("workOrder.viewModes.calendar"),value:"calendar"},{default:n(()=>[r(d,{style:{"margin-right":"8px"}},{default:n(()=>[r(e.Calendar)]),_:1}),x(" "+m(s.$t("workOrder.viewModes.calendar")),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])])]),head:n(()=>[r(e.UnifiedWorkOrderFilters,{"model-value":{...e.listQuery},"onUpdate:modelValue":e.handleFilterUpdate,"export-loading":e.downloadLoading,"show-todo-actions":e.currentView==="todo","current-view":e.currentView,class:"unified-work-order-filters",onCreate:e.handleCreate,onExport:e.handleDownload,onRefresh:e.handleRefresh},null,8,["model-value","export-loading","show-todo-actions","current-view"])]),body:n(()=>[l(" Table View "),e.currentView==="table"?(c(),g("div",sy,[l(" Recurrence View Banner "),e.recurrenceViewMode?(c(),g("div",ly,[a("div",iy,[r(d,{class:"banner-icon"},{default:n(()=>[r(e.View)]),_:1}),a("span",dy,[x(m(s.$t("workOrder.recurrenceView.title"))+" ",1),a("strong",null,m(e.currentRecurrenceId),1)])]),r(w,{type:"primary",size:"small",onClick:e.handleExitRecurrenceView,class:"exit-button"},{default:n(()=>[r(d,null,{default:n(()=>[r(e.Back)]),_:1}),x(" "+m(s.$t("workOrder.recurrenceView.exitView")),1)]),_:1})])):l("v-if",!0),r(e.WorkOrderTable,{data:e.list,loading:e.listLoading,"expanded-rows":e.expandedRows,"load-children":e.loadChildren,"recurrence-view-mode":e.recurrenceViewMode,class:"work-order-table",onExpandChange:e.toggleRowHighlight,onView:e.handleView,onEdit:e.handleUpdate,onDelete:e.handleDelete,onViewRecurrence:e.handleViewRecurrence},null,8,["data","loading","expanded-rows","load-children","recurrence-view-mode","onExpandChange"])])):e.currentView==="todo"?(c(),g(se,{key:1},[l(" To-Do View "),a("div",cy,[r(e.TodoView,{ref:"todoViewRef","work-orders":e.list,loading:e.listLoading,filters:e.listQuery,total:e.total,"current-page":e.listQuery.page,"page-size":e.listQuery.limit,onEdit:e.handleUpdate,onDelete:e.handleDelete,onRefresh:e.fetchWorkOrders,onWorkOrderCreated:e.handleWorkOrderCreated,onWorkOrderUpdated:e.handleWorkOrderUpdated,onPageChange:e.handleCurrentChange,onPageSizeChange:e.handleSizeChange,onTabChange:e.handleTabChange},null,8,["work-orders","loading","filters","total","current-page","page-size","onRefresh","onPageChange","onPageSizeChange"])])],2112)):e.currentView==="calendar"?(c(),g(se,{key:2},[l(" Calendar View "),a("div",uy,[r(e.CalendarView,{ref:"calendarViewRef",data:e.list,loading:e.listLoading,onDateRangeChange:e.handleCalendarDisplayDateChange,onView:e.handleView},null,8,["data","loading"])])],2112)):l("v-if",!0)]),foot:n(()=>[e.currentView==="table"?(c(),g("div",my,[r(h,{total:e.total,"hide-on-single-page":!0,"current-page":e.listQuery.page,"onUpdate:currentPage":t[1]||(t[1]=k=>e.listQuery.page=k),"page-size":e.listQuery.limit,"onUpdate:pageSize":t[2]||(t[2]=k=>e.listQuery.limit=k),layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])])):l("v-if",!0)]),_:1},8,["title","view-mode"])}const fw=Re(oy,[["render",fy],["__scopeId","data-v-61e35d9a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/workOrder/index.vue"]]);export{fw as default};
