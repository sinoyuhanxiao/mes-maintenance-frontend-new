import"../vue/vue.Dfo81L2Q.js";import{a as j,j as A,P as K,$ as L,B as q}from"../@element-plus/@element-plus.BNeHluFm.js";import{_ as G}from"../../assets/index-fCswSekQ.js";import{c as N}from"../element-plus/element-plus.CU5xiOkY.js";import{am as c,K as k,o as f,L as a,S as t,O as x,a as g,c as h,a8 as Q,R as V,a6 as H,F as w,Q as E,d as U,r as C,w as S,t as P}from"../@vue/@vue.CVGyaoMH.js";const J=U({name:"CreateStandardDialog"}),W=Object.assign(J,{props:{visible:{type:Boolean,default:!1},isEditMode:{type:Boolean,default:!1},initialData:{type:Object,default:()=>({name:"",description:"",category:"",items:[]})},loading:{type:Boolean,default:!1}},emits:["close","submit"],setup(B,{expose:i,emit:p}){i();const e=B,D=p,b=C(null),y=C(!1),l=C({name:"",description:"",category:"",items:[]}),n=C(null),r=C(""),_={name:[{required:!0,message:"Please enter standard title",trigger:"blur"},{min:2,max:100,message:"Title should be between 2 and 100 characters",trigger:"blur"}],category:[{required:!0,message:"Please choose a category",trigger:"blur"}]},s=()=>{var o,m,M,z;l.value.name=((o=e.initialData)==null?void 0:o.name)||"",l.value.description=((m=e.initialData)==null?void 0:m.description)||"",l.value.category=((M=e.initialData)==null?void 0:M.category)||"",l.value.items=(z=e.initialData)!=null&&z.items?[...e.initialData.items]:[]};S(()=>e.visible,o=>{o&&(s(),n.value=null,r.value="",P(()=>{var m;(m=b.value)==null||m.clearValidate()}))},{immediate:!0}),S(l,()=>{var o;y.value=!!((o=l.value.name)!=null&&o.trim()&&l.value.category)},{deep:!0,immediate:!0});const F=o=>{o||R()},R=()=>{l.value={name:"",description:"",category:"",items:[]},n.value=null,r.value="",D("close")},d=async()=>{if(b.value)try{await b.value.validate()&&(console.log("Dialog submitting formData:",l.value),D("submit",{...l.value}))}catch(o){console.error("Validation failed:",o)}},u=()=>{if(n.value!==null)if(r.value&&r.value.trim()!=="")I(n.value);else return;n.value=l.value.items.length,r.value="",l.value.items.push("")},v=(o,m)=>{n.value=o,r.value=m},O=()=>{if(n.value===null)return;l.value.items[n.value]===""&&l.value.items.splice(n.value,1),n.value=null,r.value=""},I=o=>{if(r.value.trim()===""){l.value.items.splice(o,1),n.value=null,r.value="";return}l.value.items[o]=r.value.trim(),n.value=null,r.value=""},T={props:e,emit:D,standardForm:b,isFormValid:y,formData:l,editingRuleIndex:n,editingRuleText:r,formRules:_,resetFormData:s,handleClose:F,handleFormCancel:R,handleFormSubmit:d,addNewRuleToForm:u,editRuleInForm:v,cancelRuleEditInForm:O,saveRuleInForm:I,deleteRuleFromForm:async o=>{try{await N.confirm("Are you sure you want to delete this rule?","Confirm Deletion",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),l.value.items.splice(o,1)}catch{}},__MACROS_defineComponent:U,ref:C,watch:S,nextTick:P,get Plus(){return q},get Edit(){return L},get Delete(){return K},get Check(){return A},get Close(){return j},get ElMessageBox(){return N}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),X={class:"dialog-rules-section",style:{width:"100%"}},Y={class:"dialog-rules-list"},Z={class:"dialog-rules-container"},$={class:"rule-number"},ee={class:"rule-content"},te={key:0,class:"rule-text"},le={class:"rule-actions"},ae={class:"dialog-footer"};function oe(B,i,p,e,D,b){const y=c("el-input"),l=c("el-form-item"),n=c("el-option"),r=c("el-select"),_=c("el-icon"),s=c("el-button"),F=c("el-form"),R=c("el-dialog");return f(),k(R,{"model-value":p.visible,"onUpdate:modelValue":e.handleClose,title:p.isEditMode?"Edit Standard":"Create Standard",width:"600px","before-close":e.handleFormCancel},{footer:a(()=>[g("span",ae,[t(s,{onClick:e.handleFormCancel},{default:a(()=>i[5]||(i[5]=[E("Cancel")])),_:1,__:[5]}),t(s,{type:"primary",onClick:e.handleFormSubmit,loading:p.loading,disabled:!e.isFormValid},{default:a(()=>[E(V(p.isEditMode?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])]),default:a(()=>[t(F,{model:e.formData,rules:e.formRules,ref:"standardForm","label-width":"100px",style:{"margin-right":"16px"}},{default:a(()=>[t(l,{label:"Title",prop:"name"},{default:a(()=>[t(y,{modelValue:e.formData.name,"onUpdate:modelValue":i[0]||(i[0]=d=>e.formData.name=d),placeholder:"Enter standard title"},null,8,["modelValue"])]),_:1}),t(l,{label:"Description",prop:"description"},{default:a(()=>[t(y,{modelValue:e.formData.description,"onUpdate:modelValue":i[1]||(i[1]=d=>e.formData.description=d),type:"textarea",rows:3,placeholder:"Enter detailed description of the standard"},null,8,["modelValue"])]),_:1}),t(l,{label:"Category",prop:"category"},{default:a(()=>[t(r,{modelValue:e.formData.category,"onUpdate:modelValue":i[2]||(i[2]=d=>e.formData.category=d),placeholder:"Select a category",style:{width:"100%"}},{default:a(()=>[t(n,{label:"Food Safety",value:"food-safety"}),t(n,{label:"General",value:"general"})]),_:1},8,["modelValue"])]),_:1}),x(" Rules Management Section "),e.formData.items&&e.formData.items.length>0?(f(),k(l,{key:0,label:"Rules"},{default:a(()=>[g("div",X,[g("div",Y,[g("div",Z,[(f(!0),h(w,null,Q(e.formData.items,(d,u)=>(f(),h("div",{key:u,class:"rule-item"},[g("div",$,V(u+1),1),g("div",ee,[e.editingRuleIndex===null||e.editingRuleIndex!==u?(f(),h("div",te,V(d),1)):(f(),k(y,{key:1,modelValue:e.editingRuleText,"onUpdate:modelValue":i[3]||(i[3]=v=>e.editingRuleText=v),onKeyup:H(v=>e.saveRuleInForm(u),["enter"]),placeholder:"Enter rule text",autosize:""},null,8,["modelValue","onKeyup"]))]),g("div",le,[e.editingRuleIndex===u?(f(),h(w,{key:0},[t(s,{type:"text",size:"default",onClick:v=>e.saveRuleInForm(u),title:"Save"},{default:a(()=>[t(_,null,{default:a(()=>[t(e.Check)]),_:1})]),_:2},1032,["onClick"]),t(s,{type:"text",size:"default",onClick:e.cancelRuleEditInForm,title:"Cancel"},{default:a(()=>[t(_,null,{default:a(()=>[t(e.Close)]),_:1})]),_:1})],64)):(f(),h(w,{key:1},[t(s,{type:"text",size:"default",onClick:v=>e.editRuleInForm(u,d),title:"Edit"},{default:a(()=>[t(_,null,{default:a(()=>[t(e.Edit)]),_:1})]),_:2},1032,["onClick"]),t(s,{type:"text",size:"default",onClick:v=>e.deleteRuleFromForm(u),title:"Delete",class:"delete-btn"},{default:a(()=>[t(_,null,{default:a(()=>[t(e.Delete)]),_:1})]),_:2},1032,["onClick"])],64))])]))),128))])])])]),_:1})):x("v-if",!0),x(" Always visible Add Rule Button "),t(l,null,{default:a(()=>[t(s,{type:"primary",size:"default",onClick:e.addNewRuleToForm,plain:""},{default:a(()=>[t(_,null,{default:a(()=>[t(e.Plus)]),_:1}),i[4]||(i[4]=E(" Rule "))]),_:1,__:[4]})]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}const me=G(W,[["render",oe],["__scopeId","data-v-5c2a9497"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/TaskLibrary/CreateStandardDialog.vue"]]);export{me as C};
