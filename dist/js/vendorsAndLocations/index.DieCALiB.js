import"../vue/vue.Dfo81L2Q.js";import{M as At}from"../index/index.CiC-hohW.js";import{T as Ft,B as ct,U as We,a3 as Je,a4 as Qe,Y as Ye,O as Xe,$ as ut,P as mt}from"../@element-plus/@element-plus.BNeHluFm.js";import{_ as Ae}from"../../assets/index-fCswSekQ.js";import{am as I,c as K,o as A,a as B,S as o,L as m,Q as te,R as ne,j as se,O as U,G as Ct,K as Z,F as ge,a8 as Ne,a6 as Ke,r as v,w as X,_ as je,t as _e,Y as ft,M as Ze,U as $e,q as et}from"../@vue/@vue.CVGyaoMH.js";import{a as Ee}from"../axios/axios.Dq7h7Pqt.js";import{F as _t}from"../FileUploadMultiple/FileUploadMultiple.XhmJ4C99.js";import{u as ze}from"../useErrorHandler/useErrorHandler.DVUZjmHi.js";import{g as tt,u as at,d as ot,a as lt,c as it}from"../vendor/vendor.DrABQpxa.js";import{e as Ue}from"../equipment/equipment.DNKw76bx.js";import{d as Re,u as Fe}from"../minio/minio.DwZpSMzM.js";import{E as re}from"../element-plus/element-plus.CU5xiOkY.js";import{d as nt,u as rt,a as st,b as Oe,c as dt}from"../location/location.BVdMXW2_.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../vue-router/vue-router.30cuaQZO.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../vue-i18n/vue-i18n.DjO1PVT4.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../mitt/mitt.DJ65BbbF.js";import"../lodash-es/lodash-es.BLHqGvLj.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";const St={__name:"UnifiedVendorLocationFilters",props:{activeTab:{type:String,required:!0}},setup(H,{expose:t}){t();const f=H,e=se(()=>f.activeTab==="vendors"?"Vendor":"Root Location"),P={props:f,createButtonText:e,computed:se,get Plus(){return ct},get Refresh(){return Ft}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}},Lt={class:"filter-bar"},kt={class:"right-controls"},Tt={class:"filter-item"},qt={class:"filter-item"};function Ut(H,t,f,e,P,E){const c=I("el-button");return A(),K("div",Lt,[B("div",kt,[B("div",Tt,[o(c,{size:"default",type:"primary",icon:e.Plus,onClick:t[0]||(t[0]=n=>H.$emit("create"))},{default:m(()=>[te(ne(e.createButtonText),1)]),_:1},8,["icon"])]),B("div",qt,[o(c,{size:"default",type:"default",icon:e.Refresh,onClick:t[1]||(t[1]=n=>H.$emit("refresh"))},{default:m(()=>t[2]||(t[2]=[te(" Refresh ")])),_:1,__:[2]},8,["icon"])])])])}const Nt=Ae(St,[["render",Ut],["__scopeId","data-v-05903d72"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Vendors/UnifiedVendorLocationFilters.vue"]]),Et={__name:"VendorCard",props:{vendor:Object,isSelected:Boolean},emits:["select"],setup(H,{expose:t}){t();const f={};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}},It={class:"card-content"},Pt={class:"content-main"},Dt={class:"card-title"},xt={key:0,class:"card-meta"},Rt={class:"meta-value"};function Bt(H,t,f,e,P,E){return A(),K("div",{class:Ct(["vendor-card",{selected:f.isSelected}]),onClick:t[0]||(t[0]=c=>H.$emit("select",f.vendor))},[B("div",It,[B("div",Pt,[B("h4",Dt,ne(f.vendor.name),1),f.vendor.code?(A(),K("div",xt,[t[1]||(t[1]=B("span",{class:"meta-label"},"Code:",-1)),B("span",Rt,ne(f.vendor.code),1)])):U("v-if",!0)])])],2)}const jt=Ae(Et,[["render",Bt],["__scopeId","data-v-672d3ce2"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Vendors/VendorCard.vue"]]),zt={__name:"SearchTable",props:{data:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},enableSearch:{type:Boolean,default:!0},total:{type:Number,default:0},page:{type:Number,default:1},pageSize:{type:Number,default:5},search:{type:String,default:""},emptyText:{type:String,default:"No data found"},clientPageSize:{type:Number,default:5},clientFilterFallback:{type:Boolean,default:!1}},emits:["update:search","update:page"],setup(H,{expose:t,emit:f}){t();const e=H,P=f,E=se(()=>e.total>0),c=v(e.search);X(()=>e.search,k=>{k!==c.value&&(c.value=k)});let n=null;const S=k=>P("update:search",k),d=()=>{clearTimeout(n),n=setTimeout(()=>S(c.value),250)},g=()=>{S(c.value)},q=()=>{c.value="",S("")},w=v(1);X(c,()=>{E.value||(w.value=1)}),X(()=>e.data,()=>{E.value||(w.value=1)});const G=se(()=>{if(!e.enableSearch)return e.data;const k=c.value.trim().toLowerCase();return!k||E.value&&!e.clientFilterFallback?e.data:e.data.filter(j=>Object.values(j??{}).some(M=>String(M??"").toLowerCase().includes(k)))}),R=se(()=>{const k=(w.value-1)*e.clientPageSize;return G.value.slice(k,k+e.clientPageSize)}),z=se(()=>E.value?e.data:R.value),a={props:e,emit:P,useServer:E,internalSearch:c,get debounceTimer(){return n},set debounceTimer(k){n=k},emitSearch:S,onSearchInput:d,onSearchEnter:g,onSearchClear:q,clientPage:w,filteredData:G,pagedData:R,tableRows:z,ref:v,computed:se,watch:X};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},Mt={class:"search-table"},Ot={style:{"margin-top":"8px",display:"flex","justify-content":"flex-end"}};function Kt(H,t,f,e,P,E){const c=I("el-table-column"),n=I("el-input"),S=I("el-table"),d=I("el-pagination");return A(),K("div",Mt,[o(S,{data:e.tableRows,"max-height":240,style:{width:"100%"},"empty-text":f.emptyText},{default:m(()=>[(A(!0),K(ge,null,Ne(f.columns,g=>(A(),Z(c,{key:g.prop||g.label,label:g.label,prop:g.prop},null,8,["label","prop"]))),128)),f.enableSearch?(A(),Z(c,{key:0,align:"right"},{header:m(()=>[o(n,{modelValue:e.internalSearch,"onUpdate:modelValue":t[0]||(t[0]=g=>e.internalSearch=g),size:"default",placeholder:"Search",clearable:"",onClear:e.onSearchClear,onInput:e.onSearchInput,onKeyup:Ke(e.onSearchEnter,["enter"])},null,8,["modelValue"])]),_:1})):U("v-if",!0)]),_:1},8,["data","empty-text"]),B("div",Ot,[U(" Server-side pagination "),e.useServer?(A(),Z(d,{key:0,layout:"total, prev, pager, next",total:f.total,"page-size":f.pageSize,"current-page":f.page,small:!0,onCurrentChange:t[1]||(t[1]=g=>H.$emit("update:page",g))},null,8,["total","page-size","current-page"])):(A(),K(ge,{key:1},[U(" Client-side pagination "),o(d,{layout:"total, prev, pager, next",total:e.filteredData.length,"page-size":f.clientPageSize,"current-page":e.clientPage,"onUpdate:currentPage":t[2]||(t[2]=g=>e.clientPage=g),small:!0},null,8,["total","page-size","current-page"])],2112))])])}const pt=Ae(zt,[["render",Kt],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Locations/SearchTable.vue"]]),Ht={__name:"VendorForm",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(H,{expose:t,emit:f}){const e=H,P=f,E=v(null),c=v(0),n=je({name:"",code:"",phone_number:"",email:"",website:"",address:"",description:"",image_list:[],image_files:[],removed_existing_images:[],file_list:[],file_files:[],removed_existing_files:[]});let S=!1,d=!1;const g=i=>{const L=!Array.isArray(i==null?void 0:i.image_list)||i.image_list.length===0,W=!Array.isArray(i==null?void 0:i.file_list)||i.file_list.length===0;return!(i!=null&&i.name)&&!(i!=null&&i.code)&&L&&W&&(i==null?void 0:i.id)==null},q=i=>Array.isArray(i)?i.map(L=>typeof L=="string"?L:(L==null?void 0:L.url)??"").filter(Boolean):[],w=i=>Array.isArray(i)?i.map(L=>L instanceof File?L:(L==null?void 0:L.raw)instanceof File?L.raw:null).filter(Boolean):[],G=se(()=>{var i;return q((i=e.modelValue)==null?void 0:i.image_list)}),R=se(()=>{var i;return q((i=e.modelValue)==null?void 0:i.file_list)}),z=i=>{n.image_files=w(i)},a=i=>{n.file_files=w(i)},k=i=>{const L=Array.isArray(i)?i:[],W=new Set([...n.removed_existing_images||[],...L]);n.removed_existing_images=Array.from(W);const oe=new Set(L);n.image_list=(n.image_list||[]).filter(ie=>!oe.has(typeof ie=="string"?ie:ie==null?void 0:ie.url))},j=i=>{const L=Array.isArray(i)?i:[],W=new Set([...n.removed_existing_files||[],...L]);n.removed_existing_files=Array.from(W);const oe=new Set(L);n.file_list=(n.file_list||[]).filter(ie=>!oe.has(typeof ie=="string"?ie:ie==null?void 0:ie.url))};X(()=>e.modelValue,(i={})=>{S=!0,n.name=i.name||"",n.code=i.code||"",n.phone_number=i.phone_number||"",n.email=i.email||"",n.website=i.website||"",n.address=i.address||"",n.description=i.description||"",n.image_list=q(i.image_list),n.file_list=q(i.file_list),n.image_files=w(i.image_files),n.file_files=w(i.file_files),n.removed_existing_images=Array.isArray(i.removed_existing_images)?i.removed_existing_images:[],n.removed_existing_files=Array.isArray(i.removed_existing_files)?i.removed_existing_files:[];const L=g(i);L&&!d&&(c.value+=1),d=L,_e(()=>S=!1)},{immediate:!0,deep:!0}),X(n,i=>{S||P("update:modelValue",{...i,image_list:Array.isArray(i.image_list)?i.image_list:[],image_files:Array.isArray(i.image_files)?i.image_files:[],removed_existing_images:Array.isArray(i.removed_existing_images)?i.removed_existing_images:[],file_list:Array.isArray(i.file_list)?i.file_list:[],file_files:Array.isArray(i.file_files)?i.file_files:[],removed_existing_files:Array.isArray(i.removed_existing_files)?i.removed_existing_files:[]})},{deep:!0});const M={name:[{required:!0,message:"Name is required",trigger:"blur"}],code:[{required:!0,message:"Code is required",trigger:"blur"}],phone_number:[{required:!0,message:"Phone number is required",trigger:"blur"},{validator:(i,L,W)=>{L?/^\+[1-9]\d{7,14}$/.test(L)?W():W(new Error("Must start with + followed by country code, then phone number.")):W(new Error("Phone number is required"))},trigger:["blur","change"]}],email:[{required:!0,message:"Email is required",trigger:"blur"},{type:"email",message:"Please enter a valid email address",trigger:["blur","change"]}],website:[{required:!0,message:"Website is required",trigger:"blur"},{validator:(i,L,W)=>{if(!L)return W();/^(https?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w\-./?%&=]*)?$/.test(L)?W():W(new Error("Please enter a valid website URL"))},trigger:["blur","change"]}]};t({validate:()=>{var i;return(i=E.value)==null?void 0:i.validate()},resetFields:()=>{var i,L;return(L=(i=E.value)==null?void 0:i.resetFields)==null?void 0:L.call(i)},getFormData:()=>({...n})});const h={props:e,emit:P,formRef:E,uploaderKey:c,localForm:n,get applyingFromParent(){return S},set applyingFromParent(i){S=i},get lastIsNewForm(){return d},set lastIsNewForm(i){d=i},isNewForm:g,mapToUrls:q,toRealFiles:w,existingImageUrls:G,existingFileUrls:R,onNewImages:z,onNewFiles:a,onRemovedExistingImages:k,onRemovedExistingFiles:j,rules:M,ref:v,reactive:je,watch:X,nextTick:_e,computed:se,FileUploadMultiple:_t};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}};function Gt(H,t,f,e,P,E){const c=I("el-input"),n=I("el-form-item"),S=I("el-form");return A(),Z(S,{ref:"formRef",model:e.localForm,rules:e.rules,"label-width":"150px",class:"vendor-form"},{default:m(()=>[o(n,{label:"Name",prop:"name"},{default:m(()=>[o(c,{modelValue:e.localForm.name,"onUpdate:modelValue":t[0]||(t[0]=d=>e.localForm.name=d),placeholder:"Enter vendor name",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Code",prop:"code"},{default:m(()=>[o(c,{modelValue:e.localForm.code,"onUpdate:modelValue":t[1]||(t[1]=d=>e.localForm.code=d),placeholder:"Enter unique vendor code",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Phone Number",prop:"phone_number"},{default:m(()=>[o(c,{modelValue:e.localForm.phone_number,"onUpdate:modelValue":t[2]||(t[2]=d=>e.localForm.phone_number=d),placeholder:"Enter phone number",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Email",prop:"email"},{default:m(()=>[o(c,{modelValue:e.localForm.email,"onUpdate:modelValue":t[3]||(t[3]=d=>e.localForm.email=d),placeholder:"Enter email",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Website",prop:"website"},{default:m(()=>[o(c,{modelValue:e.localForm.website,"onUpdate:modelValue":t[4]||(t[4]=d=>e.localForm.website=d),placeholder:"Enter website",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Address"},{default:m(()=>[o(c,{modelValue:e.localForm.address,"onUpdate:modelValue":t[5]||(t[5]=d=>e.localForm.address=d),placeholder:"Enter address",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Description"},{default:m(()=>[o(c,{type:"textarea",modelValue:e.localForm.description,"onUpdate:modelValue":t[6]||(t[6]=d=>e.localForm.description=d),placeholder:"Enter description",clearable:""},null,8,["modelValue"])]),_:1}),U(" One uploader that handles both IMAGES and FILES "),o(n,{label:"Attachments"},{default:m(()=>[(A(),Z(e.FileUploadMultiple,{key:e.uploaderKey,"upload-type":"both","max-images":5,"max-files":10,"existing-image-list":e.existingImageUrls,"existing-file-list":e.existingFileUrls,"image-label":"","file-label":"","onUpdate:imageList":e.onNewImages,"onUpdate:filesList":e.onNewFiles,"onUpdate:removedExistingImages":e.onRemovedExistingImages,"onUpdate:removedExistingFiles":e.onRemovedExistingFiles},null,8,["existing-image-list","existing-file-list"]))]),_:1})]),_:1},8,["model"])}const gt=Ae(Ht,[["render",Gt],["__scopeId","data-v-d0e48a43"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Vendors/VendorForm.vue"]]),Wt={__name:"VendorDetail",props:{vendor:Object},emits:["deleted","updated"],setup(H,{expose:t,emit:f}){t();const e=H,P=f,E=v(!1),c=v({}),n=v(null),S=v(!1),d=v([]),g=v(0),q=v(1),w=v(5),G=v(""),R=v(0),z=v(!1),a=v([]),{confirmAction:k,showSuccess:j}=ze(),M=se(()=>{var s,u;const r=((s=e.vendor)==null?void 0:s.files_list)??((u=e.vendor)==null?void 0:u.file_list)??[];return(Array.isArray(r)?r:[]).map(y=>typeof y=="string"?y:y==null?void 0:y.url).filter(Boolean)}),h=v([]),i=async()=>{const r=await Promise.all(M.value.map(async s=>{try{const u=await fetch(s,{method:"HEAD"});return u.ok||u.status===405&&(await fetch(s,{method:"GET",headers:{Range:"bytes=0-0"}})).ok?s:null}catch{return null}}));h.value=r.filter(Boolean)};X(M,()=>{M.value.length?i():h.value=[]},{immediate:!0});function L(r){try{const s=new URL(String(r)).pathname.split("/").pop()||"";return decodeURIComponent(s)||s||"file"}catch{const s=String(r).split("/").pop()||"";try{return decodeURIComponent(s)||s||"file"}catch{return s||"file"}}}const W=se(()=>{var u,y;const r=((u=e.vendor)==null?void 0:u.files_list)??((y=e.vendor)==null?void 0:y.file_list)??[];return(Array.isArray(r)?r:[]).map(_=>typeof _=="string"?_:_==null?void 0:_.url).filter(Boolean).map((_,N)=>({id:N,url:_,name:L(_),type:oe(L(_))}))});function oe(r){var C;if(!r)return"document";const s=(C=String(r).split(".").pop())==null?void 0:C.toLowerCase(),u=["jpg","jpeg","png","gif","bmp","webp","svg"],y=["mp4","avi","mov","wmv","flv","mkv","webm"],_=["mp3","wav","flac","aac","ogg","m4a"],N=["zip","rar","7z","tar","gz"];return u.includes(s)?"image":y.includes(s)?"video":_.includes(s)?"audio":N.includes(s)?"download":s==="pdf"?"pdf":(["doc","docx","txt","rtf","md","ppt","pptx","xls","xlsx","csv"].includes(s),"document")}function ie(r){switch((r||"").toLowerCase()){case"image":return Ye;case"video":return Qe;case"audio":return Je;case"download":return We;case"pdf":case"document":default:return Xe}}let ce=0,pe=0;const he=se(()=>{var s;return(((s=e.vendor)==null?void 0:s.image_list)||[]).map(u=>typeof u=="string"?u:u==null?void 0:u.url).filter(Boolean)}),ve=v([]),Le=async()=>{const r=await Promise.all(he.value.map(async s=>{try{return(await fetch(s,{method:"HEAD"})).ok?s:null}catch{return null}}));ve.value=r.filter(Boolean)};X(he,()=>{he.value.length?Le():ve.value=[]},{immediate:!0});const ke=v({open:!1,url:""}),Ie=r=>{ke.value.url=r,ke.value.open=!0};X(()=>{var r;return(r=e.vendor)==null?void 0:r.id},r=>{G.value="",q.value=1,d.value=[],g.value=0,R.value=0,z.value=!1,r&&(Ce(r),D(r),ae(r))},{immediate:!0});let be=null;X(G,r=>{q.value=1,clearTimeout(be),r!=null&&r.trim()?be=setTimeout(()=>D(),250):(Ce(),D())});const Be=r=>{q.value=r,D()},Ce=async(r=(s=>(s=e.vendor)==null?void 0:s.id)())=>{const u=Number(r);if(!Number.isFinite(u)){R.value=0,z.value=!1;return}const y=++ce;try{const _=await Ue(1,1,"createdAt","DESC",{vendor_ids:[u]});if(y!==ce)return;const N=(_==null?void 0:_.data)??_,C=(N==null?void 0:N.data)??N,T=Number((C==null?void 0:C.totalElements)??(C==null?void 0:C.total)??(Array.isArray(C==null?void 0:C.content)?C.content.length:0));R.value=T,z.value=T>0}catch(_){if(y!==ce)return;console.error("fetchEquipmentBase failed:",_),R.value=0,z.value=!1}},D=async(r=(s=>(s=e.vendor)==null?void 0:s.id)())=>{var _;const u=Number(r);if(!Number.isFinite(u)){d.value=[],g.value=0;return}const y=++pe;try{const N=(_=G.value)==null?void 0:_.trim(),C={vendor_ids:[u]};N&&(C.keyword=N);const T=await Ue(q.value,w.value,"createdAt","DESC",C);if(y!==pe)return;const $=(T==null?void 0:T.data)??T,O=($==null?void 0:$.data)??$,le=Array.isArray(O==null?void 0:O.content)?O.content:Array.isArray(O)?O:[];d.value=le.map(de=>({...de,id:Number(de.id)})),g.value=Number((O==null?void 0:O.totalElements)??(O==null?void 0:O.total)??le.length)}catch(N){if(y!==pe)return;console.error("fetchEquipmentData failed:",N),d.value=[],g.value=0}},ae=async r=>{var s;try{const u=await Ee.get(`http://10.10.12.12:8095/api/vendor/correlative-spare-part/${r}`);a.value=((s=u.data)==null?void 0:s.data)||[]}catch(u){console.error("Failed to fetch spare parts batch:",u),a.value=[]}},Y=()=>{var u,y,_,N;const r=(((u=e.vendor)==null?void 0:u.image_list)??[]).map(C=>typeof C=="string"?C:C==null?void 0:C.url).filter(Boolean),s=(((y=e.vendor)==null?void 0:y.files_list)??((_=e.vendor)==null?void 0:_.file_list)??[]).map(C=>typeof C=="string"?C:C==null?void 0:C.url).filter(Boolean);c.value={...JSON.parse(JSON.stringify(e.vendor||{})),id:(N=e.vendor)==null?void 0:N.id,image_list:r,image_files:[],removed_existing_images:[],file_list:s,file_files:[],removed_existing_files:[]},E.value=!0},l=async()=>{var y,_,N,C,T,$,O,le,de,ee,we,x,J,ye,Ve,Te,Pe;if(!await((_=(y=n.value)==null?void 0:y.validate)==null?void 0:_.call(y)))return;let r=!1;const s=setTimeout(()=>{S.value=!0,r=!0},150),u=V=>{var ue,Se,De;const me=(V==null?void 0:V.uploadedFiles)??((ue=V==null?void 0:V.data)==null?void 0:ue.uploadedFiles)??((De=(Se=V==null?void 0:V.data)==null?void 0:Se.data)==null?void 0:De.uploadedFiles)??(V==null?void 0:V.files)??[];return(Array.isArray(me)?me:[]).map(fe=>(fe==null?void 0:fe.url)||(fe==null?void 0:fe.fileUrl)||(fe==null?void 0:fe.location)||(fe==null?void 0:fe.path)).filter(Boolean)};try{const V=Number((N=e.vendor)==null?void 0:N.id);if(!Number.isFinite(V))throw new Error("Invalid vendor id");const me=(((C=e.vendor)==null?void 0:C.image_list)??[]).map(Q=>typeof Q=="string"?Q:Q==null?void 0:Q.url).filter(Boolean),ue=Array.isArray((T=c.value)==null?void 0:T.removed_existing_images)?c.value.removed_existing_images:[],Se=me.filter(Q=>!ue.includes(Q)),De=Array.isArray(($=c.value)==null?void 0:$.image_files)?c.value.image_files.filter(Q=>Q instanceof File):[];let fe=[];if(De.length){const Q=await Fe(De);fe=u(Q)}const yt=Array.from(new Set([...Se,...fe])),ht=(((O=e.vendor)==null?void 0:O.files_list)??((le=e.vendor)==null?void 0:le.file_list)??[]).map(Q=>typeof Q=="string"?Q:Q==null?void 0:Q.url).filter(Boolean),Me=Array.isArray((de=c.value)==null?void 0:de.removed_existing_files)?c.value.removed_existing_files:[],bt=ht.filter(Q=>!Me.includes(Q)),He=Array.isArray((ee=c.value)==null?void 0:ee.file_files)?c.value.file_files.filter(Q=>Q instanceof File):[];let Ge=[];if(He.length){const Q=await Fe(He);Ge=u(Q)}const wt=Array.from(new Set([...bt,...Ge])),xe={...c.value,image_list:yt,file_list:wt};if(delete xe.image_files,delete xe.removed_existing_images,delete xe.file_files,delete xe.removed_existing_files,await at(V,xe),ue.length)try{await Re({bucketName:"sv-file-bucket",objectUrls:ue})}catch(Q){console.warn("deleteObjectList (images) failed (ignored):",Q)}if(Me.length)try{await Re({bucketName:"sv-file-bucket",objectUrls:Me})}catch(Q){console.warn("deleteObjectList (files) failed (ignored):",Q)}const qe=await tt(V),Vt=((we=qe==null?void 0:qe.data)==null?void 0:we.data)??(qe==null?void 0:qe.data)??qe;re.success("Vendor updated"),E.value=!1,P("updated",Vt)}catch(V){const me=(x=V==null?void 0:V.response)==null?void 0:x.status,ue=String(((ye=(J=V==null?void 0:V.response)==null?void 0:J.data)==null?void 0:ye.message)||((Te=(Ve=V==null?void 0:V.response)==null?void 0:Ve.data)==null?void 0:Te.error)||(V==null?void 0:V.message)||"");me===409||/(duplicate|conflict)/i.test(ue)||/code.*(already|in use)/i.test(ue)?re.error("Update failed: vendor code already exists. Please use a different code."):/Cannot deserialize value of type `java\.lang\.String`/i.test(ue)?re.error("Update failed: server expected file/image URLs, not objects. Check payload shaping."):re.error("Failed to update vendor"),console.error("Update vendor failed:",((Pe=V==null?void 0:V.response)==null?void 0:Pe.data)||V)}finally{clearTimeout(s),r&&(S.value=!1)}},p=v(!1),b={props:e,emit:P,editVendor:E,editForm:c,editFormRef:n,saving:S,equipmentList:d,equipmentTotal:g,equipmentPage:q,equipmentPageSize:w,equipmentSearch:G,equipmentBaseTotal:R,showEquipSection:z,sparePartsBatchList:a,confirmAction:k,showSuccess:j,fileUrls:M,validFileUrls:h,checkFileUrls:i,fileNameFromUrl:L,parsedFiles:W,getFileTypeFromName:oe,getFileIcon:ie,get equipBaseReqSeq(){return ce},set equipBaseReqSeq(r){ce=r},get equipDataReqSeq(){return pe},set equipDataReqSeq(r){pe=r},imageUrls:he,validImageUrls:ve,checkImageUrls:Le,preview:ke,openPreview:Ie,get searchTimer(){return be},set searchTimer(r){be=r},onEquipmentPageChange:Be,fetchEquipmentBase:Ce,fetchEquipmentData:D,fetchSparePartsBatch:ae,enterEditMode:Y,saveEdit:l,deleteLoading:p,handleDelete:async()=>{var u,y,_,N;if(!await k({title:"Confirm",message:`Are you sure you want to delete "${(u=e.vendor)==null?void 0:u.name}"?`,confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}))return;const s=Number((y=e.vendor)==null?void 0:y.id);if(Number.isFinite(s)){p.value=!0;try{await ot(s),j("Vendor deleted successfully"),P("deleted",s)}catch(C){re.error(((N=(_=C==null?void 0:C.response)==null?void 0:_.data)==null?void 0:N.message)||"Failed to delete vendor"),console.error(C)}finally{p.value=!1}}},ref:v,watch:X,computed:se,get axios(){return Ee},SearchTable:pt,VendorForm:gt,get useErrorHandler(){return ze},get ElMessage(){return re},get deactivateVendor(){return ot},get updateVendor(){return at},get getVendorById(){return tt},get getEquipmentNodes(){return Ue},get uploadMultipleToMinio(){return Fe},get deleteObjectList(){return Re},get Delete(){return mt},get Edit(){return ut},get Document(){return Xe},get Picture(){return Ye},get VideoCamera(){return Qe},get Microphone(){return Je},get Download(){return We}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}},Jt={key:0,class:"vendor-detail"},Qt={class:"detail-header"},Yt={class:"header-main"},Xt={class:"detail-title"},Zt={class:"header-actions"},$t={class:"detail-body"},ea={class:"descriptions-container"},ta={key:4},aa={class:"image-grid"},oa=["onClick","onKeydown"],la=["src"],ia={key:6},na={class:"vd-file-list"},ra={key:7,style:{"margin-bottom":"48px"}},sa={key:9},da={class:"preview-wrapper"},ca=["src"];function ua(H,t,f,e,P,E){var R,z,a,k,j,M;const c=I("el-button"),n=I("el-tooltip"),S=I("el-button-group"),d=I("el-descriptions-item"),g=I("el-descriptions"),q=I("el-divider"),w=I("el-link"),G=I("el-dialog");return A(),K(ge,null,[f.vendor?(A(),K("div",Jt,[U(" Detail Header (mimic WorkOrderDetail) "),B("div",Qt,[B("div",Yt,[B("h2",Xt,ne(f.vendor.name),1)]),B("div",Zt,[o(S,{class:"ml-4"},{default:m(()=>[o(n,{content:"Edit",placement:"top",effect:"light","hide-after":0},{default:m(()=>[o(c,{icon:e.Edit,onClick:e.enterEditMode},null,8,["icon"])]),_:1}),o(n,{content:"Delete",placement:"top",effect:"light","hide-after":0},{default:m(()=>[o(c,{icon:e.Delete,loading:e.deleteLoading,onClick:e.handleDelete},null,8,["icon","loading"])]),_:1})]),_:1})])]),B("div",$t,[B("div",ea,[o(g,{class:"two-col",column:2,direction:"vertical"},{default:m(()=>[o(d,{label:"Name"},{default:m(()=>[te(ne(f.vendor.name||"--"),1)]),_:1}),o(d,{label:"Code"},{default:m(()=>[te(ne(f.vendor.code||"--"),1)]),_:1}),o(d,{label:"Phone Number"},{default:m(()=>[te(ne(f.vendor.phone_number||"--"),1)]),_:1}),o(d,{label:"Email"},{default:m(()=>[te(ne(f.vendor.email||"--"),1)]),_:1})]),_:1}),(R=f.vendor.website)!=null&&R.length?(A(),Z(g,{key:0,column:1,direction:"vertical"},{default:m(()=>[o(d,{label:"Website"},{default:m(()=>[te(ne(f.vendor.website||"--"),1)]),_:1})]),_:1})):U("v-if",!0),(z=f.vendor.address)!=null&&z.length?(A(),Z(g,{key:1,column:1,direction:"vertical"},{default:m(()=>[o(d,{label:"Address"},{default:m(()=>[te(ne(f.vendor.address||"--"),1)]),_:1})]),_:1})):U("v-if",!0),(a=f.vendor.description)!=null&&a.length?(A(),Z(g,{key:2,column:1,direction:"vertical"},{default:m(()=>[o(d,{label:"Description"},{default:m(()=>[te(ne(f.vendor.description||"--"),1)]),_:1})]),_:1})):U("v-if",!0),e.validImageUrls.length?(A(),Z(q,{key:3})):U("v-if",!0),e.validImageUrls.length?(A(),K("div",ta,[o(g,{title:"Images"},{default:m(()=>[o(d)]),_:1}),B("div",aa,[(A(!0),K(ge,null,Ne(e.validImageUrls,(h,i)=>(A(),K("button",{key:h+"_"+i,class:"thumb",type:"button",onClick:L=>e.openPreview(h),onKeydown:Ke(ft(L=>e.openPreview(h),["prevent"]),["enter"]),"aria-label":"Preview image"},[B("img",{src:h,alt:""},null,8,la)],40,oa))),128))])])):U("v-if",!0),U(" Files "),e.parsedFiles.length?(A(),Z(q,{key:5})):U("v-if",!0),e.parsedFiles.length?(A(),K("div",ia,[o(g,{title:"Files"},{default:m(()=>[o(d)]),_:1}),B("div",na,[(A(!0),K(ge,null,Ne(e.parsedFiles,h=>(A(),K("div",{key:h.id||h.name,class:"vd-file-item"},[o(w,{href:h.url,target:"_blank",rel:"noopener noreferrer",icon:e.getFileIcon(h.type),class:"vd-file-link"},{default:m(()=>[te(ne(h.name),1)]),_:2},1032,["href","icon"])]))),128))])])):U("v-if",!0),U(" Related Equipment (shows only if vendor actually has equipment at all) "),e.showEquipSection?(A(),K("div",ra,[o(q),o(g,{title:"Related Equipment"},{default:m(()=>[o(d)]),_:1}),(A(),Z(e.SearchTable,{key:`equip-${(k=f.vendor)==null?void 0:k.id}`,data:e.equipmentList,columns:[{label:"Name",prop:"name"},{label:"Code",prop:"code"},{label:"Group",prop:"equipment_group"}],total:e.equipmentTotal,page:e.equipmentPage,"page-size":e.equipmentPageSize,"enable-search":!0,search:e.equipmentSearch,"onUpdate:search":t[0]||(t[0]=h=>e.equipmentSearch=h),"empty-text":"No match found","onUpdate:page":e.onEquipmentPageChange},null,8,["data","total","page","page-size","search"]))])):U("v-if",!0),(j=e.sparePartsBatchList)!=null&&j.length?(A(),Z(q,{key:8})):U("v-if",!0),(M=e.sparePartsBatchList)!=null&&M.length?(A(),K("div",sa,[o(g,{title:"Related Parts Batches"}),o(e.SearchTable,{data:e.sparePartsBatchList,columns:[{label:"Name",prop:"name"},{label:"Part Code",prop:"code"},{label:"Quantity",prop:"quantity"}]},null,8,["data"])])):U("v-if",!0)])])])):U("v-if",!0),U(" Edit Dialog (mirror LocationDetail dialog props/UX) "),o(G,{modelValue:e.editVendor,"onUpdate:modelValue":t[3]||(t[3]=h=>e.editVendor=h),title:"Edit Vendor",width:"600px","align-center":"","append-to-body":"","destroy-on-close":"",class:"vd-edit-dialog","modal-class":"vd-edit-overlay",transition:"vd-fade"},{footer:m(()=>[o(c,{onClick:t[2]||(t[2]=h=>e.editVendor=!1)},{default:m(()=>t[5]||(t[5]=[te("Cancel")])),_:1,__:[5]}),o(c,{type:"primary",loading:e.saving,disabled:e.saving,class:"btn-save",onClick:e.saveEdit},{default:m(()=>t[6]||(t[6]=[te("Save")])),_:1,__:[6]},8,["loading","disabled"])]),default:m(()=>{var h;return[(A(),Z(e.VendorForm,{modelValue:e.editForm,"onUpdate:modelValue":t[1]||(t[1]=i=>e.editForm=i),ref:"editFormRef",key:`vendor-form-${(h=f.vendor)==null?void 0:h.id}-${e.editVendor}`},null,8,["modelValue"]))]}),_:1},8,["modelValue"]),U(" Image Preview "),o(G,{modelValue:e.preview.open,"onUpdate:modelValue":t[4]||(t[4]=h=>e.preview.open=h),width:"80%",top:"5vh","append-to-body":"","destroy-on-close":""},{default:m(()=>[B("div",da,[B("img",{src:e.preview.url,alt:"Preview",class:"preview-image"},null,8,ca)])]),_:1},8,["modelValue"])],64)}const ma=Ae(Wt,[["render",ua],["__scopeId","data-v-1613d2b0"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Vendors/VendorDetail.vue"]]),fa={__name:"LocationForm",props:{modelValue:{type:Object,required:!0},locationTypes:{type:Array,required:!0}},emits:["update:modelValue"],setup(H,{expose:t,emit:f}){const e=H,P=f,E=v(null),c=v(0),n=je({name:"",code:"",location_type_id:null,capacity:"",address:"",description:"",image_list:[],image_files:[],removed_existing_images:[],files_list:[],parent_id:null});let S=!1,d=!1;const g=a=>!(a!=null&&a.name)&&!(a!=null&&a.code)&&(!Array.isArray(a==null?void 0:a.image_list)||a.image_list.length===0)&&(!Array.isArray(a==null?void 0:a.files_list)||a.files_list.length===0)&&(a==null?void 0:a.id)==null,q=se(()=>{var k;const a=(k=e.modelValue)==null?void 0:k.image_list;return Array.isArray(a)?a.map(j=>typeof j=="string"?j:(j==null?void 0:j.url)??"").filter(Boolean):[]}),w=a=>{const k=Array.isArray(a)?a:[],j=new Set([...n.removed_existing_images||[],...k]);n.removed_existing_images=Array.from(j);const M=new Set(k);n.image_list=(n.image_list||[]).filter(h=>!M.has(typeof h=="string"?h:h==null?void 0:h.url))},G=a=>{n.image_files=Array.isArray(a)?a:[]};X(()=>e.modelValue,(a={})=>{var j;S=!0,n.name=a.name||"",n.code=a.code||"",n.location_type_id=((j=a.location_type)==null?void 0:j.id)??a.location_type_id??null,n.capacity=a.capacity??"",n.address=a.address||"",n.description=a.description||"",n.parent_id=a.parent_id??null,n.image_list=Array.isArray(a.image_list)?a.image_list.map(M=>typeof M=="string"?M:(M==null?void 0:M.url)??"").filter(Boolean):[],n.image_files=Array.isArray(a.image_files)?a.image_files.filter(M=>M instanceof File):[],n.removed_existing_images=Array.isArray(a.removed_existing_images)?a.removed_existing_images:[];const k=g(a);k&&!d&&(c.value+=1),d=k,_e(()=>{S=!1})},{immediate:!0,deep:!0}),X(n,a=>{if(S)return;const k=e.locationTypes.find(j=>j.id===a.location_type_id)||null;P("update:modelValue",{...a,location_type:k,image_list:Array.isArray(a.image_list)?a.image_list:[],image_files:Array.isArray(a.image_files)?a.image_files:[],removed_existing_images:Array.isArray(a.removed_existing_images)?a.removed_existing_images:[]})},{deep:!0});const R={name:[{required:!0,message:"Name is required",trigger:"blur"}],code:[{required:!0,message:"Code is required",trigger:"blur"}]};t({validate:()=>{var a;return(a=E.value)==null?void 0:a.validate()},resetFields:()=>{var a,k;return(k=(a=E.value)==null?void 0:a.resetFields)==null?void 0:k.call(a)},getFormData:()=>({...n})});const z={props:e,emit:P,formRef:E,uploaderKey:c,localForm:n,get applyingFromParent(){return S},set applyingFromParent(a){S=a},get lastIsNewForm(){return d},set lastIsNewForm(a){d=a},isNewForm:g,existingImageUrls:q,onRemovedExistingImages:w,onNewImages:G,rules:R,ref:v,reactive:je,watch:X,nextTick:_e,computed:se,FileUploadMultiple:_t};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}};function _a(H,t,f,e,P,E){const c=I("el-input"),n=I("el-form-item"),S=I("el-option"),d=I("el-select"),g=I("el-input-number"),q=I("el-form");return A(),Z(q,{ref:"formRef",model:e.localForm,rules:e.rules,"label-width":"150px",class:"location-form"},{default:m(()=>[o(n,{label:"Name",prop:"name"},{default:m(()=>[o(c,{modelValue:e.localForm.name,"onUpdate:modelValue":t[0]||(t[0]=w=>e.localForm.name=w),placeholder:"Enter location name",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Code",prop:"code"},{default:m(()=>[o(c,{modelValue:e.localForm.code,"onUpdate:modelValue":t[1]||(t[1]=w=>e.localForm.code=w),placeholder:"Enter unique location code",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Location Type"},{default:m(()=>[o(d,{modelValue:e.localForm.location_type_id,"onUpdate:modelValue":t[2]||(t[2]=w=>e.localForm.location_type_id=w),placeholder:"Select location type",clearable:""},{default:m(()=>[(A(!0),K(ge,null,Ne(f.locationTypes,w=>(A(),Z(S,{key:w.id,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"Capacity",prop:"capacity"},{default:m(()=>[o(g,{modelValue:e.localForm.capacity,"onUpdate:modelValue":t[3]||(t[3]=w=>e.localForm.capacity=w),min:0},null,8,["modelValue"])]),_:1}),o(n,{label:"Address"},{default:m(()=>[o(c,{modelValue:e.localForm.address,"onUpdate:modelValue":t[4]||(t[4]=w=>e.localForm.address=w),placeholder:"Enter address",clearable:""},null,8,["modelValue"])]),_:1}),o(n,{label:"Description"},{default:m(()=>[o(c,{type:"textarea",modelValue:e.localForm.description,"onUpdate:modelValue":t[5]||(t[5]=w=>e.localForm.description=w),placeholder:"Enter description",clearable:""},null,8,["modelValue"])]),_:1}),U(" Images "),o(n,{label:"Images"},{default:m(()=>[(A(),Z(e.FileUploadMultiple,{key:e.uploaderKey,"upload-type":"images","max-images":5,"existing-image-list":e.existingImageUrls,"image-label":"","file-label":"","onUpdate:imageList":e.onNewImages,"onUpdate:removedExistingImages":e.onRemovedExistingImages},null,8,["existing-image-list"]))]),_:1})]),_:1},8,["model"])}const vt=Ae(fa,[["render",_a],["__scopeId","data-v-d65ca075"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Locations/LocationForm.vue"]]),pa={__name:"LocationTree",props:{treeData:{type:Array,required:!0},defaultProps:{type:Object,required:!0}},emits:["node-click"],setup(H,{expose:t,emit:f}){const e=H,P=f,E=v(),c=v(""),n=(g,q)=>{var w;return g?(w=q.name)==null?void 0:w.toLowerCase().includes(g.toLowerCase()):!0};X(c,async g=>{var G;(G=E.value)==null||G.filter(g),await _e();const q=R=>{var z;for(const a of R){if(n(g,a))return a;if((z=a.children)!=null&&z.length){const k=q(a.children);if(k)return k}}return null},w=q(e.treeData);w&&(P("node-click",{id:w.id}),_e(()=>{var R;(R=E.value)==null||R.setCurrentKey(w.id)}))});const S=g=>{P("node-click",g)};t({treeRef:E});const d={props:e,emit:P,treeRef:E,filterText:c,filterNode:n,onNodeClick:S,ref:v,watch:X,nextTick:_e};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}};function ga(H,t,f,e,P,E){const c=I("el-input"),n=I("el-tree"),S=I("el-scrollbar");return A(),K("div",null,[o(c,{modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=d=>e.filterText=d),placeholder:"Search Location",clearable:"",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),o(S,null,{default:m(()=>[o(n,{ref:"treeRef",data:f.treeData,props:f.defaultProps,"highlight-current":"","node-key":"id","filter-node-method":e.filterNode,onNodeClick:e.onNodeClick,accordion:""},null,8,["data","props"])]),_:1})])}const va=Ae(pa,[["render",ga],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Locations/LocationTree.vue"]]),ya={__name:"LocationDetail",props:{location:Object,locationTypes:{type:Array,default:()=>[]}},emits:["deleted","updated","add-child"],setup(H,{expose:t,emit:f}){t();const e=H,P=f,E=v(!1),c=v({}),n=v(null),S=v(!1),d=se(()=>{var ae;return(((ae=e.location)==null?void 0:ae.image_list)||[]).map(Y=>typeof Y=="string"?Y:Y==null?void 0:Y.url).filter(Boolean)}),g=v([]),q=async()=>{const D=await Promise.all(d.value.map(async ae=>{try{return(await fetch(ae,{method:"HEAD"})).ok?ae:null}catch{return null}}));g.value=D.filter(Boolean)};X(d,()=>{d.value.length?q():g.value=[]},{immediate:!0});const w=v({open:!1,url:""}),G=D=>{w.value.url=D,w.value.open=!0},R=v([]),z=v(0),a=v(1),k=v(5),j=v(""),M=v(0),h=v(!1);let i=0,L=0;const W=v([]),{confirmAction:oe,showSuccess:ie}=ze();X(()=>{var D;return(D=e.location)==null?void 0:D.id},D=>{j.value="",a.value=1,R.value=[],z.value=0,M.value=0,h.value=!1,D&&(he(D),ve(D),Le(D))},{immediate:!0});let ce=null;X(j,D=>{a.value=1,clearTimeout(ce),D!=null&&D.trim()?ce=setTimeout(()=>ve(),250):(he(),ve())});const pe=D=>{a.value=D,ve()},he=async(D=(ae=>(ae=e.location)==null?void 0:ae.id)())=>{const Y=Number(D);if(!Number.isFinite(Y)){M.value=0,h.value=!1;return}const l=++i;try{const p=await Ue(1,1,"createdAt","DESC",{location_ids:[Y]});if(l!==i)return;const F=(p==null?void 0:p.data)??p,b=(F==null?void 0:F.data)??F,r=Number((b==null?void 0:b.totalElements)??(b==null?void 0:b.total)??(Array.isArray(b==null?void 0:b.content)?b.content.length:0));M.value=r,h.value=r>0}catch(p){if(l!==i)return;console.error("fetchEquipmentBase failed:",p),M.value=0,h.value=!1}},ve=async(D=(ae=>(ae=e.location)==null?void 0:ae.id)())=>{var p;const Y=Number(D);if(!Number.isFinite(Y)){R.value=[],z.value=0;return}const l=++L;try{const F=(p=j.value)==null?void 0:p.trim(),b={location_ids:[Y]};F&&(b.keyword=F);const r=await Ue(a.value,k.value,"createdAt","DESC",b);if(l!==L)return;const s=(r==null?void 0:r.data)??r,u=(s==null?void 0:s.data)??s,y=Array.isArray(u==null?void 0:u.content)?u.content:Array.isArray(u)?u:[];R.value=y.map(_=>({..._,id:Number(_.id)})),z.value=Number((u==null?void 0:u.totalElements)??(u==null?void 0:u.total)??y.length)}catch(F){if(l!==L)return;console.error("fetchEquipmentData failed:",F),R.value=[],z.value=0}},Le=async D=>{var ae;try{const Y=await Ee.get(`http://10.10.12.12:8095/api/location/correlative-spare-part-batch/${D}`);W.value=((ae=Y.data)==null?void 0:ae.data)||[]}catch(Y){console.error("Failed to fetch spare parts batch:",Y),W.value=[]}},ke=()=>{c.value={...JSON.parse(JSON.stringify(e.location)),id:e.location.id},E.value=!0},Ie=async()=>{var p,F,b,r,s,u,y,_,N,C;if(!await((F=(p=n.value)==null?void 0:p.validate)==null?void 0:F.call(p)))return;let ae=!1;const Y=setTimeout(()=>{S.value=!0,ae=!0},150),l=T=>{var O,le,de;const $=(T==null?void 0:T.uploadedFiles)??((O=T==null?void 0:T.data)==null?void 0:O.uploadedFiles)??((de=(le=T==null?void 0:T.data)==null?void 0:le.data)==null?void 0:de.uploadedFiles)??(T==null?void 0:T.files)??[];return(Array.isArray($)?$:[]).map(ee=>(ee==null?void 0:ee.url)||(ee==null?void 0:ee.fileUrl)||(ee==null?void 0:ee.location)||(ee==null?void 0:ee.path)).filter(Boolean)};try{const T=Number((b=e.location)==null?void 0:b.id);if(!Number.isFinite(T))throw new Error("Invalid location id");const $=(((r=e.location)==null?void 0:r.image_list)??[]).map(J=>typeof J=="string"?J:J==null?void 0:J.url).filter(Boolean),O=Array.isArray((s=c.value)==null?void 0:s.removed_existing_images)?c.value.removed_existing_images:[],le=$.filter(J=>!O.includes(J)),de=Array.isArray((u=c.value)==null?void 0:u.image_files)?c.value.image_files.filter(J=>J instanceof File):[];let ee=[];if(de.length){const J=await Fe(de);ee=l(J)}const we=Array.from(new Set([...le,...ee])),x={...c.value,image_list:we};delete x.removed_existing_images,await rt(T,x),O.length&&Promise.resolve().then(async()=>{try{await Re({bucketName:"sv-file-bucket",objectUrls:O})}catch{}}),ie("Location updated"),E.value=!1,P("updated",{id:T})}catch(T){const $=(y=T==null?void 0:T.response)==null?void 0:y.status,O=(((N=(_=T==null?void 0:T.response)==null?void 0:_.data)==null?void 0:N.message)||"").toLowerCase();$===409||/code.*(exist|in use|already)/.test(O)?re.error("Update failed: location code already exists. Please use a different code."):re.error("Update failed"),console.error("Update location failed:",((C=T==null?void 0:T.response)==null?void 0:C.data)||T)}finally{clearTimeout(Y),ae&&(S.value=!1)}},be=v(!1),Ce={props:e,emit:P,editLocation:E,editForm:c,editFormRef:n,saving:S,imageUrls:d,validImageUrls:g,checkImageUrls:q,preview:w,openPreview:G,equipmentList:R,equipmentTotal:z,equipmentPage:a,equipmentPageSize:k,equipmentSearch:j,equipmentBaseTotal:M,showEquipSection:h,get equipBaseReqSeq(){return i},set equipBaseReqSeq(D){i=D},get equipDataReqSeq(){return L},set equipDataReqSeq(D){L=D},sparePartsBatchList:W,confirmAction:oe,showSuccess:ie,get searchTimer(){return ce},set searchTimer(D){ce=D},onEquipmentPageChange:pe,fetchEquipmentBase:he,fetchEquipmentData:ve,fetchSparePartsBatch:Le,enterEditMode:ke,saveEdit:Ie,deleteLoading:be,handleDelete:async()=>{var Y,l;if(!await oe({title:"Confirm",message:`Are you sure you want to delete "${(Y=e.location)==null?void 0:Y.name}"?`,confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}))return;const ae=Number((l=e.location)==null?void 0:l.id);if(Number.isFinite(ae)){be.value=!0;try{await nt(ae),ie("Location deleted successfully"),P("deleted",e.location.id)}catch(p){re.error("Failed to delete location"),console.error(p)}finally{be.value=!1}}},ref:v,watch:X,computed:se,get axios(){return Ee},get Plus(){return ct},get Delete(){return mt},get Edit(){return ut},SearchTable:pt,LocationForm:vt,get useErrorHandler(){return ze},get ElMessage(){return re},get updateLocationById(){return rt},get deactivateLocation(){return nt},get getEquipmentNodes(){return Ue},get uploadMultipleToMinio(){return Fe},get deleteObjectList(){return Re}};return Object.defineProperty(Ce,"__isScriptSetup",{enumerable:!1,value:!0}),Ce}},ha={key:0,class:"location-detail"},ba={class:"detail-header"},wa={class:"header-main"},Va={class:"detail-title"},Aa={class:"header-actions"},Fa={class:"detail-body"},Ca={class:"descriptions-container"},Sa={key:3},La={class:"image-grid"},ka=["onClick","onKeydown"],Ta=["src"],qa={key:4,style:{"margin-bottom":"48px"}},Ua={key:6},Na={class:"preview-wrapper"},Ea=["src"];function Ia(H,t,f,e,P,E){var G,R,z,a,k,j,M;const c=I("el-button"),n=I("el-tooltip"),S=I("el-button-group"),d=I("el-descriptions-item"),g=I("el-descriptions"),q=I("el-divider"),w=I("el-dialog");return A(),K(ge,null,[f.location?(A(),K("div",ha,[U(" Header "),B("div",ba,[B("div",wa,[B("h2",Va,ne(f.location.name),1)]),B("div",Aa,[o(S,{class:"ml-4"},{default:m(()=>[o(n,{content:"Add Child Location",placement:"top",effect:"light","hide-after":0},{default:m(()=>[o(c,{icon:e.Plus,onClick:t[0]||(t[0]=h=>e.emit("add-child",{id:f.location.id}))},null,8,["icon"])]),_:1}),o(n,{content:"Edit",placement:"top",effect:"light","hide-after":0},{default:m(()=>[o(c,{icon:e.Edit,onClick:e.enterEditMode},null,8,["icon"])]),_:1}),o(n,{content:"Delete",placement:"top",effect:"light","hide-after":0},{default:m(()=>[o(c,{icon:e.Delete,loading:e.deleteLoading,onClick:e.handleDelete},null,8,["icon","loading"])]),_:1})]),_:1})])]),B("div",Fa,[B("div",Ca,[o(g,{class:"two-col",column:2,direction:"vertical"},{default:m(()=>[o(d,{label:"Name"},{default:m(()=>[te(ne(f.location.name||"--"),1)]),_:1}),o(d,{label:"Code"},{default:m(()=>[te(ne(f.location.code||"--"),1)]),_:1}),o(d,{label:"Location Type"},{default:m(()=>{var h;return[te(ne(((h=f.location.location_type)==null?void 0:h.name)||"--"),1)]}),_:1}),o(d,{label:"Capacity"},{default:m(()=>[te(ne(f.location.capacity||"--"),1)]),_:1})]),_:1}),(R=(G=f.location)==null?void 0:G.address)!=null&&R.length?(A(),Z(g,{key:0,column:1,direction:"vertical"},{default:m(()=>[o(d,{label:"Address"},{default:m(()=>[te(ne(f.location.address||"--"),1)]),_:1})]),_:1})):U("v-if",!0),(a=(z=f.location)==null?void 0:z.description)!=null&&a.length?(A(),Z(g,{key:1,column:1,direction:"vertical"},{default:m(()=>[o(d,{label:"Description"},{default:m(()=>[te(ne(f.location.description||"--"),1)]),_:1})]),_:1})):U("v-if",!0),U(" Images "),e.validImageUrls.length?(A(),Z(q,{key:2})):U("v-if",!0),e.validImageUrls.length?(A(),K("div",Sa,[o(g,{title:"Images"}),B("div",La,[(A(!0),K(ge,null,Ne(e.validImageUrls,(h,i)=>(A(),K("button",{key:h+"_"+i,class:"thumb",type:"button",onClick:L=>e.openPreview(h),onKeydown:Ke(ft(L=>e.openPreview(h),["prevent"]),["enter"]),"aria-label":"Preview image"},[B("img",{src:h,alt:""},null,8,Ta)],40,ka))),128))])])):U("v-if",!0),U(" Related Equipment "),e.showEquipSection?(A(),K("div",qa,[o(q),o(g,{title:"Related Equipment"}),(A(),Z(e.SearchTable,{key:`loc-equip-${(k=f.location)==null?void 0:k.id}`,data:e.equipmentList,columns:[{label:"Name",prop:"name"},{label:"Code",prop:"code"},{label:"Group",prop:"equipment_group"}],total:e.equipmentTotal,page:e.equipmentPage,"page-size":e.equipmentPageSize,"enable-search":!0,search:e.equipmentSearch,"onUpdate:search":t[1]||(t[1]=h=>e.equipmentSearch=h),"empty-text":"No match found","onUpdate:page":e.onEquipmentPageChange},null,8,["data","total","page","page-size","search"]))])):U("v-if",!0),(j=e.sparePartsBatchList)!=null&&j.length?(A(),Z(q,{key:5})):U("v-if",!0),(M=e.sparePartsBatchList)!=null&&M.length?(A(),K("div",Ua,[o(g,{title:"Related Parts Batches"}),o(e.SearchTable,{data:e.sparePartsBatchList,columns:[{label:"Name",prop:"name"},{label:"Part Code",prop:"code"},{label:"Quantity",prop:"quantity"}]},null,8,["data"])])):U("v-if",!0)])])])):U("v-if",!0),U(" Edit Dialog "),o(w,{modelValue:e.editLocation,"onUpdate:modelValue":t[4]||(t[4]=h=>e.editLocation=h),title:"Edit Location",width:"600px","align-center":"","append-to-body":"","destroy-on-close":"",class:"ld-edit-dialog","modal-class":"ld-edit-overlay",transition:"ld-fade"},{footer:m(()=>[o(c,{onClick:t[3]||(t[3]=h=>e.editLocation=!1)},{default:m(()=>t[6]||(t[6]=[te("Cancel")])),_:1,__:[6]}),o(c,{type:"primary",loading:e.saving,disabled:e.saving,class:"btn-save",onClick:e.saveEdit},{default:m(()=>t[7]||(t[7]=[te("Save")])),_:1,__:[7]},8,["loading","disabled"])]),default:m(()=>[o(e.LocationForm,{modelValue:e.editForm,"onUpdate:modelValue":t[2]||(t[2]=h=>e.editForm=h),"location-types":e.props.locationTypes,ref:"editFormRef"},null,8,["modelValue","location-types"])]),_:1},8,["modelValue"]),U(" Image Preview "),o(w,{modelValue:e.preview.open,"onUpdate:modelValue":t[5]||(t[5]=h=>e.preview.open=h),width:"80%",top:"5vh","append-to-body":"","destroy-on-close":""},{default:m(()=>[B("div",Na,[B("img",{src:e.preview.url,alt:"Preview",class:"preview-image"},null,8,Ea)])]),_:1},8,["modelValue"])],64)}const Pa=Ae(ya,[["render",Ia],["__scopeId","data-v-40ed0ae2"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Locations/LocationDetail.vue"]]),Da={__name:"VendorAndLocationsSplitView",props:{activeTab:String,showCreateDialog:Boolean,search:String},emits:["update:activeTab","update:showCreateDialog"],setup(H,{expose:t,emit:f}){t();const e=H,P=l=>{var F,b,r;const p=(l==null?void 0:l.uploadedFiles)??((F=l==null?void 0:l.data)==null?void 0:F.uploadedFiles)??((r=(b=l==null?void 0:l.data)==null?void 0:b.data)==null?void 0:r.uploadedFiles)??(l==null?void 0:l.files)??[];return(Array.isArray(p)?p:[]).map(s=>(s==null?void 0:s.url)||(s==null?void 0:s.fileUrl)||(s==null?void 0:s.location)||(s==null?void 0:s.path)).filter(Boolean)},E=f,c=v(null),n=v(null),S=v(null),d=v([]),g=v(null),q=v([]),w=v(null),G=v(1),R=v(""),z=v(e.activeTab),a=v(10),k=v(0),j=v(!1),M=v(0);X(()=>e.activeTab,l=>{z.value=l});let h=null;X(R,()=>{G.value=1,h&&clearTimeout(h),h=setTimeout(()=>{e.activeTab==="vendors"&&oe()},300)});const i=v({name:"",code:"",address:"",phone_number:"",email:"",website:"",description:"",image_list:[],file_list:[]}),L=v({name:"",code:"",location_type:null,capacity:"",address:"",description:"",image_list:[],file_list:[],parent_id:null}),W=v([]);et(async()=>{await ie(),e.activeTab==="vendors"?await oe():e.activeTab==="locations"&&await ce()});const oe=async()=>{var l;try{const p=await lt({keyword:R.value||""},{page:G.value,size:a.value,sortField:"createdAt",direction:"DESC"}),F=(p==null?void 0:p.data)??p,b=(F==null?void 0:F.data)??F,s=(Array.isArray(b==null?void 0:b.content)?b.content:Array.isArray(b)?b:[]).map(_=>({..._,id:Number(_.id)}));d.value=s,k.value=Number((b==null?void 0:b.totalElements)??s.length);const u=Number((l=g.value)==null?void 0:l.id),y=s.find(_=>Number(_.id)===u);g.value=y||s[0]||null}catch(p){console.error("Error fetching vendors:",p),d.value=[],k.value=0}},ie=async()=>{var p;const l=await Ee.get("http://10.10.12.12:8095/api/location/location-types");W.value=((p=l.data)==null?void 0:p.data)||[]},ce=async()=>{var l,p;try{const F=await st(),b=F&&F.data!==void 0?F.data:F;let r=[];b!=null&&b.data?r=b.data:Array.isArray(b)?r=b:b&&(r=[b]);const s=Array.isArray(W.value)?W.value:[],u=y=>y.map(_=>{const N=Number(_.id),C=_.locationTypeId!=null?Number(_.locationTypeId):null;return{..._,id:N,locationTypeId:C,location_type:s.find(T=>Number(T.id)===C)||null,children:Array.isArray(_.children)&&_.children.length?u(_.children):[]}}).sort((_,N)=>_.id-N.id);if(q.value=u(r),!w.value&&q.value.length>0){const y=q.value[0];await pe(y),await _e(),(p=(l=S.value)==null?void 0:l.treeRef)==null||p.setCurrentKey(y.id)}}catch(F){console.error("fetchLocationTree failed:",F)}},pe=async l=>{var F,b;const p=Number((l==null?void 0:l.id)??(l==null?void 0:l.locationId));if(!Number.isFinite(p)){console.warn("handleLocationClick: invalid id from node",l);return}try{const r=await Oe(p),s=r&&r.data!==void 0?r.data:r,u=(s==null?void 0:s.data)??s??{},y=((F=u.location_type)==null?void 0:F.id)??u.location_type_id??u.locationTypeId??null,_=(N,C)=>Array.isArray(N)&&N.find(T=>Number(T.id)===Number(C))||null;u.id=p,u.location_type=y!=null?_(W.value,y):null,w.value=u}catch(r){console.error("getLocationById failed:",r);const s=((b=l.location_type)==null?void 0:b.id)??l.location_type_id??l.locationTypeId;w.value={...l,id:p,location_type:s!=null&&Array.isArray(W.value)&&W.value.find(u=>Number(u.id)===Number(s))||null}}},he=l=>{const p=d.value.findIndex(F=>F.id===l);p!==-1&&(d.value.splice(p,1),g.value=d.value.length>0?d.value[Math.max(0,p-1)]:null,oe())},ve=async l=>{var b;let p=null;const F=(r,s=null)=>{var u;for(let y=0;y<r.length;y++){const _=r[y];if(_.id===l){const N=s?s.children:q.value;return p=N[y-1]||N[y+1]||s||null,r.splice(y,1),!0}if((u=_.children)!=null&&u.length&&F(_.children,_))return!0}return!1};F(q.value),((b=w.value)==null?void 0:b.id)===l&&(w.value=null,p&&(await pe({id:p.id}),_e(()=>{var r,s;return(s=(r=S.value)==null?void 0:r.treeRef)==null?void 0:s.setCurrentKey(p.id)})))},Le=async({id:l})=>{var F,b,r,s;const p=Number(l);if(Number.isFinite(p))try{const u=await Oe(p),y=(u==null?void 0:u.data)??u,_=((y==null?void 0:y.data)??y??{})||{},N=((F=_.location_type)==null?void 0:F.id)??_.location_type_id??_.locationTypeId??null;_.id=p,_.location_type=(Array.isArray(W.value)?W.value.find($=>Number($.id)===Number(N)):null)||null,Number((b=w.value)==null?void 0:b.id)===p?Object.assign(w.value,_):w.value=_;const C=$=>{var O;for(const le of $){if(Number(le.id)===p)return Object.assign(le,_),!0;if((O=le.children)!=null&&O.length&&C(le.children))return!0}return!1};(Array.isArray(q.value)?C(q.value):!1)||await ce(),await _e(),(s=(r=S.value)==null?void 0:r.treeRef)==null||s.setCurrentKey(p)}catch(u){console.error("handleLocationUpdated error:",u)}},ke=l=>{j.value=!0,L.value={name:"",code:"",location_type:null,capacity:"",address:"",description:"",image_list:[],file_list:[],parent_id:l.id},E("update:showCreateDialog",!0)},Ie=l=>{g.value=l},be=async()=>{var y,_,N,C,T,$,O,le,de,ee,we;if(!await((_=(y=c.value)==null?void 0:y.validate)==null?void 0:_.call(y)))return;const l=((C=(N=c.value).getFormData)==null?void 0:C.call(N))??{};let p=[],F=[];try{if(Array.isArray(l.image_files)&&l.image_files.length){const x=await Fe(l.image_files);p=P(x)}if(Array.isArray(l.file_files)&&l.file_files.length){const x=await Fe(l.file_files);F=P(x)}}catch(x){re.error("File upload failed"),console.error("uploadMultipleToMinio failed:",((T=x==null?void 0:x.response)==null?void 0:T.data)||x);return}const b=x=>Array.isArray(x)?x.filter(J=>typeof J=="string"):[],r=[...b(l.image_list),...p],s=[...b(l.file_list),...F],u={name:(l.name??"").trim(),code:(l.code??"").trim(),address:(l.address??"").trim(),phone_number:(l.phone_number??"").trim(),email:(l.email??"").trim(),website:(l.website??"").trim(),description:(l.description??"").trim(),image_list:r,file_list:s};try{const x=await it(u),J=(x==null?void 0:x.data)??x,ye=(J==null?void 0:J.data)??J,Ve=Number(ye==null?void 0:ye.id);re.success("Vendor created"),E("update:showCreateDialog",!1),await oe(),await _e(),g.value=(Number.isFinite(Ve)?d.value.find(Te=>Number(Te.id)===Ve):null)||d.value[0]||null}catch(x){const J=($=x==null?void 0:x.response)==null?void 0:$.status,ye=(((le=(O=x==null?void 0:x.response)==null?void 0:O.data)==null?void 0:le.message)||((ee=(de=x==null?void 0:x.response)==null?void 0:de.data)==null?void 0:ee.error)||"").toLowerCase();re.error(J===409||/code.*exist/.test(ye)?"Create failed: vendor code already exists. Please use a different code.":"Create failed"),console.error("Create vendor failed:",((we=x==null?void 0:x.response)==null?void 0:we.data)||x)}},Be=l=>{const p=d.value.findIndex(F=>F.id===l.id);if(p!==-1){Object.assign(d.value[p],l),g.value=d.value[p];return}oe().then(()=>{const F=d.value.findIndex(b=>b.id===l.id);F!==-1&&(g.value=d.value[F])})},Ce=async()=>{var y,_,N,C,T,$,O,le,de,ee,we,x,J,ye,Ve,Te,Pe;if(!await((y=n.value)==null?void 0:y.validate()))return;const l=n.value.getFormData(),p=l.location_type_id==null?null:Number(l.location_type_id),F=l.capacity==null||l.capacity===""?null:parseInt(l.capacity,10);let b=[];try{if(Array.isArray(l.image_files)&&l.image_files.length){const V=await Fe(l.image_files);b=P(V)}}catch(V){re.error("Image upload failed"),console.error("uploadMultipleToMinio failed:",((_=V==null?void 0:V.response)==null?void 0:_.data)||V);return}const r=V=>Array.isArray(V)?V.filter(me=>typeof me=="string"):[],s=Array.from(new Set([...r(l.image_list),...b])),u={name:((N=l.name)==null?void 0:N.trim())||"",code:((C=l.code)==null?void 0:C.trim())||"",description:((T=l.description)==null?void 0:T.trim())||"",parent_id:(($=L.value)==null?void 0:$.parent_id)??l.parent_id??null,address:((O=l.address)==null?void 0:O.trim())||"",image_list:s,...p!=null?{location_type_id:p}:{},...F!=null?{capacity:F}:{}};try{const V=await dt(u),me=(V==null?void 0:V.data)??V,ue=(me==null?void 0:me.data)??me,Se=Number(ue==null?void 0:ue.id);E("update:showCreateDialog",!1),re.success("Location created"),await ce(),await _e(),Number.isFinite(Se)&&(await pe({id:Se}),await _e(),(de=(le=S.value)==null?void 0:le.treeRef)==null||de.setCurrentKey(Se))}catch(V){const me=(ee=V==null?void 0:V.response)==null?void 0:ee.status,ue=(((x=(we=V==null?void 0:V.response)==null?void 0:we.data)==null?void 0:x.message)||"").toLowerCase();me===409||/code.*exist/.test(ue)?(re.error("Create failed: location code already exists. Please use a different code."),(ye=(J=n.value)==null?void 0:J.validateField)==null||ye.call(J,"code",()=>{}),(Te=(Ve=n.value)==null?void 0:Ve.scrollToField)==null||Te.call(Ve,"code")):re.error("Create failed"),console.error("Create location failed:",((Pe=V==null?void 0:V.response)==null?void 0:Pe.data)||V)}},D=l=>{G.value=l,oe()},ae=l=>{a.value=l,G.value=1,oe()};X(()=>e.activeTab,async l=>{if(l==="vendors")w.value=null,d.value.length===0&&await oe(),g.value=d.value[0]||null;else if(l==="locations"){g.value=null,q.value.length===0&&await ce();const p=q.value[0];p&&(await pe(p),_e(()=>{var F,b;return(b=(F=S.value)==null?void 0:F.treeRef)==null?void 0:b.setCurrentKey(p.id)}))}},{immediate:!0}),X(()=>e.showCreateDialog,l=>{l&&(e.activeTab==="vendors"?(Object.assign(i.value,{name:"",code:"",address:"",phone_number:"",email:"",website:"",description:"",image_list:[],file_list:[],removed_existing_images:[]}),M.value+=1):Object.assign(L.value,{name:"",code:"",location_type:null,capacity:"",address:"",description:"",image_list:[],file_list:[],parent_id:j.value?L.value.parent_id:null}))});const Y={props:e,extractUploadedUrls:P,emit:E,vendorFormRef:c,locationFormRef:n,locationTreeRef:S,vendors:d,selected:g,locationTreeData:q,selectedLocation:w,currentPage:G,searchInput:R,activeTab:z,pageSize:a,totalVendors:k,isChildCreate:j,vendorCreateKey:M,get searchTimer(){return h},set searchTimer(l){h=l},newVendor:i,newLocation:L,locationTypes:W,fetchVendors:oe,fetchLocationTypes:ie,fetchLocationTree:ce,handleLocationClick:pe,handleDelete:he,handleLocationDelete:ve,handleLocationUpdated:Le,openAddChildDialog:ke,selectVendor:Ie,submitNewVendor:be,handleVendorUpdated:Be,submitNewLocation:Ce,handlePageChange:D,handleSizeChange:ae,ref:v,onMounted:et,nextTick:_e,watch:X,get ElMessage(){return re},get axios(){return Ee},VendorCard:jt,VendorDetail:ma,VendorForm:gt,LocationForm:vt,LocationTree:va,LocationDetail:Pa,get getLocationTree(){return st},get getLocationById(){return Oe},get createLocation(){return dt},get createVendor(){return it},get searchVendorsGeneral(){return lt},get uploadMultipleToMinio(){return Fe}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},xa={class:"split-view"},Ra={class:"tab-body"},Ba={class:"list-panel"},ja={class:"work-order-list"},za={class:"list-content"},Ma={class:"pagination-info"},Oa={key:0,class:"empty-list"},Ka={class:"cards-container"},Ha={key:0,class:"pagination-controls"},Ga={class:"detail-panel"};function Wa(H,t,f,e,P,E){const c=I("el-tab-pane"),n=I("el-tabs"),S=I("el-input"),d=I("el-empty"),g=I("el-col"),q=I("el-row"),w=I("el-pagination"),G=I("el-scrollbar"),R=I("el-button"),z=I("el-dialog");return A(),K("div",xa,[B("div",Ra,[U(" Left: Tab switcher + list panel "),B("div",Ba,[U(" Tabs "),o(n,{"tab-position":"top","model-value":e.props.activeTab,"onUpdate:modelValue":t[0]||(t[0]=a=>e.emit("update:activeTab",a)),class:"custom-tab"},{default:m(()=>[o(c,{name:"vendors"},{label:m(()=>t[10]||(t[10]=[B("span",{class:"tab-vendors-title"},"Vendors",-1)])),_:1}),o(c,{label:"Locations",name:"locations"})]),_:1},8,["model-value"]),e.props.activeTab==="vendors"?(A(),K(ge,{key:0},[U(" Work-order-like list wrapper (same chrome as TodoView) "),B("div",ja,[B("div",za,[U(" Search is ALWAYS visible "),B("div",Ma,[o(S,{modelValue:e.searchInput,"onUpdate:modelValue":t[1]||(t[1]=a=>e.searchInput=a),placeholder:"Search Vendor",clearable:"",size:"default",class:"search-inline",onClear:t[2]||(t[2]=()=>{e.currentPage=1,e.fetchVendors()})},null,8,["modelValue"])]),U(" Empty vs. Results "),e.vendors.length===0?(A(),K("div",Oa,[o(d,{description:"No vendors","image-size":80})])):(A(),K(ge,{key:1},[U(" Cards Container (scrollable middle) "),B("div",Ka,[o(q,{gutter:16},{default:m(()=>[(A(!0),K(ge,null,Ne(e.vendors,a=>(A(),Z(g,{key:a.id},{default:m(()=>{var k;return[o(e.VendorCard,{vendor:a,"is-selected":((k=e.selected)==null?void 0:k.id)===a.id,onSelect:e.selectVendor},null,8,["vendor","is-selected"])]}),_:2},1024))),128))]),_:1})]),U(" Pagination Controls (bottom bar) "),e.totalVendors>0?(A(),K("div",Ha,[o(w,{"current-page":e.currentPage,"onUpdate:currentPage":t[3]||(t[3]=a=>e.currentPage=a),"page-size":e.pageSize,total:e.totalVendors,layout:"total, prev, pager, next",small:!0,onCurrentChange:e.handlePageChange,onSizeChange:e.handleSizeChange,"hide-on-single-page":!1},null,8,["current-page","page-size","total"])])):U("v-if",!0)],64))])])],64)):(A(),K(ge,{key:1},[U(" Locations list "),o(G,{height:"100%"},{default:m(()=>[o(e.LocationTree,{ref:"locationTreeRef","tree-data":e.locationTreeData,"default-props":{children:"children",label:"name"},onNodeClick:e.handleLocationClick},null,8,["tree-data"])]),_:1})],64))]),U(" Right: Detail panel "),B("div",Ga,[Ze(o(e.VendorDetail,{vendor:e.selected,onDeleted:e.handleDelete,onUpdated:e.handleVendorUpdated},null,8,["vendor"]),[[$e,e.props.activeTab==="vendors"]]),Ze(o(e.LocationDetail,{location:e.selectedLocation,"location-types":e.locationTypes,onDeleted:e.handleLocationDelete,onAddChild:e.openAddChildDialog,onUpdated:e.handleLocationUpdated},null,8,["location","location-types"]),[[$e,e.props.activeTab==="locations"]])])]),U(" Create Vendor Dialog "),o(z,{"model-value":e.props.showCreateDialog&&e.props.activeTab==="vendors","onUpdate:modelValue":t[6]||(t[6]=a=>e.emit("update:showCreateDialog",a)),title:"Create New Vendor",width:"600px"},{footer:m(()=>[o(R,{onClick:t[5]||(t[5]=a=>e.emit("update:showCreateDialog",!1))},{default:m(()=>t[11]||(t[11]=[te("Cancel")])),_:1,__:[11]}),o(R,{type:"primary",onClick:e.submitNewVendor},{default:m(()=>t[12]||(t[12]=[te("Create")])),_:1,__:[12]})]),default:m(()=>[(A(),Z(e.VendorForm,{key:e.vendorCreateKey,modelValue:e.newVendor,"onUpdate:modelValue":t[4]||(t[4]=a=>e.newVendor=a),"original-urls":[],ref:"vendorFormRef"},null,8,["modelValue"]))]),_:1},8,["model-value"]),U(" Create Root Location Dialog "),o(z,{"model-value":e.props.showCreateDialog&&e.props.activeTab==="locations","onUpdate:modelValue":t[9]||(t[9]=a=>e.emit("update:showCreateDialog",a)),title:"Create Location",width:"600px","destroy-on-close":""},{footer:m(()=>[o(R,{onClick:t[8]||(t[8]=a=>e.emit("update:showCreateDialog",!1))},{default:m(()=>t[13]||(t[13]=[te("Cancel")])),_:1,__:[13]}),o(R,{type:"primary",onClick:e.submitNewLocation},{default:m(()=>t[14]||(t[14]=[te("Create")])),_:1,__:[14]})]),default:m(()=>[o(e.LocationForm,{modelValue:e.newLocation,"onUpdate:modelValue":t[7]||(t[7]=a=>e.newLocation=a),"location-types":e.locationTypes,ref:"locationFormRef"},null,8,["modelValue","location-types"])]),_:1},8,["model-value"])])}const Ja=Ae(Da,[["render",Wa],["__scopeId","data-v-f94403a3"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/Vendors/VendorAndLocationsSplitView.vue"]]),Qa={__name:"index",setup(H,{expose:t}){t();const f=v("vendors"),e=v(!1),P=v(null),n={activeTab:f,showCreateDialog:e,splitViewRef:P,handleCreate:()=>{e.value=!0},handleRefresh:()=>{var S,d;f.value==="vendors"&&((d=(S=P.value)==null?void 0:S.refreshVendors)==null||d.call(S))},ref:v,MesLayout:At,UnifiedVendorLocationFilters:Nt,VendorAndLocationsSplitView:Ja};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}};function Ya(H,t,f,e,P,E){return A(),Z(e.MesLayout,{title:"Vendors & Locations","view-mode":"todo"},{head:m(()=>[(A(),Z(e.UnifiedVendorLocationFilters,{key:e.activeTab,"active-tab":e.activeTab,onCreate:e.handleCreate,onRefresh:e.handleRefresh},null,8,["active-tab"]))]),body:m(()=>[o(e.VendorAndLocationsSplitView,{ref:"splitViewRef",activeTab:e.activeTab,"onUpdate:activeTab":t[0]||(t[0]=c=>e.activeTab=c),"show-create-dialog":e.showCreateDialog,"onUpdate:showCreateDialog":t[1]||(t[1]=c=>e.showCreateDialog=c)},null,8,["activeTab","show-create-dialog"])]),_:1})}const xo=Ae(Qa,[["render",Ya],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/vendorsAndLocations/index.vue"]]);export{xo as default};
