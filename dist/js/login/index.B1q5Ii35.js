import"../vue/vue.Dfo81L2Q.js";import{_ as k,W as E,u as R}from"../../assets/index-fCswSekQ.js";import{c as x,a as l,d as v,o as w,am as p,S as i,K as q,L as u,O as F,a6 as W,Y as j,Q as M,r as m,_ as A,j as T,a4 as S,q as K,W as N}from"../@vue/@vue.CVGyaoMH.js";import{u as L,a as B}from"../vue-router/vue-router.30cuaQZO.js";import{E as $}from"../element-plus/element-plus.CU5xiOkY.js";import{d as D}from"../lodash-es/lodash-es.BLHqGvLj.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../vue-i18n/vue-i18n.DjO1PVT4.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../mitt/mitt.DJ65BbbF.js";import"../@element-plus/@element-plus.BNeHluFm.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";const V=()=>{const r=navigator.userAgent.toLowerCase(),o=r.match(/iphone os/i)=="iphone os",t=r.match(/midp/i)=="midp",e=r.match(/rv:1.2.3.4/i)=="rv:1.2.3.4",a=r.match(/ucweb/i)=="ucweb",c=r.match(/android/i)=="android",n=r.match(/windows ce/i)=="windows ce",s=r.match(/windows mobile/i)=="windows mobile";return!!(o||t||e||a||c||n||s)},Q=""+new URL("../../assets/logo-Dx7JUt6b.png",import.meta.url).href,J=v({name:"Logo"}),Y=Object.assign(J,{setup(r,{expose:o}){o();const t={__MACROS_defineComponent:v,get logo(){return Q}};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),G={class:"logo-contanier"},Z=["src"];function ee(r,o,t,e,a,c){return w(),x("div",G,[l("img",{src:e.logo,alt:""},null,8,Z)])}const oe=k(Y,[["render",ee],["__scopeId","data-v-e9d86300"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/login/components/logo.vue"]]),te={__name:"weChatLogin",setup(r,{expose:o}){o();const t=L(),a={route:t,weChatLogin:()=>{const{redirect:c}=t.query,{origin:n,pathname:s}=window.location,b=c?`${n}${s}#/relation?redirect=${c}`:`${n}${s}#/relation`,h="snsapi_login",_=Math.ceil(Math.random()*1e3),d=encodeURIComponent(decodeURIComponent(b)),f=`https://open.weixin.qq.com/connect/qrconnect?appid=${E}&redirect_uri=${d}&response_type=code&scope=${h}&state=${_}#wechat_redirect`;window.open(f,"_blank")},get WX_APPID(){return E},get useRoute(){return L}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},ne={class:"third-login-contanier"};function se(r,o,t,e,a,c){const n=p("svg-icon");return w(),x("div",ne,[i(n,{"class-name":"icons ","icon-class":"wechat",onClick:e.weChatLogin})])}const re=k(te,[["render",se],["__scopeId","data-v-ecbbd36f"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/login/components/weChatLogin.vue"]]),ae=v({name:"LoginPwd"}),ie=Object.assign(ae,{setup(r,{expose:o}){o();const t=B(),e=L(),a=R(),c=m(),n=["blur","change"],s=A({country:"86",captcha:"",account:"admin",password:"admin"}),b={account:[{required:!0,message:"请输入手机或邮箱账号",trigger:n}],password:[{required:!0,message:"请输入密码",trigger:n}],captcha:[{required:!0,message:"请输入校验码",trigger:n}]},h=m(""),_=m(!1),d=m(""),f=m(!1),H=T(()=>{const{captcha:g,account:y,password:I}=s;return _.value?!g||!y||!I:!y||!I});S(()=>{O()});function O(){const g=e.query;h.value=g.bindToken||""}async function P(){}async function X(){f.value=!0;try{a.SET_TOKEN("token"),t.push("/")}catch{}finally{f.value=!1}}function z(){f.value=!0,c.value.validate(async g=>{if(g)try{if([{username:"admin",password:"admin"},{username:"user",password:"user"}].some(C=>C.username===s.account&&C.password===s.password)){const C="hardcoded-token-"+Date.now();a.SET_TOKEN(C),t.push("/")}else $.error("用户名或密码错误！请使用 admin/admin 登录")}catch{$.error("登录失败，请重试")}finally{f.value=!1,_.value&&await P()}})}const U={router:t,route:e,userStore:a,ruleForm:c,trigger:n,formState:s,rules:b,bindToken:h,showCaptcha:_,captchaImg:d,loading:f,disabledLogin:H,getQueryParams:O,updateImage:P,freeLogin:X,loginHandle:z,__MACROS_defineComponent:v,ref:m,onBeforeMount:S,reactive:A,computed:T,get useUserStore(){return R},get useRouter(){return B},get useRoute(){return L},get ElMessage(){return $}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),ce={style:{position:"relative"}},le={class:"code-inp"},de={class:"code"},ue=["src"];function me(r,o,t,e,a,c){const n=p("el-input"),s=p("el-form-item"),b=p("el-button"),h=p("el-link"),_=p("el-form");return w(),q(_,{ref:"ruleForm",model:e.formState,rules:e.rules,"label-width":"0","status-icon":"",class:"login-ruleForm"},{default:u(()=>[i(s,{prop:"account"},{default:u(()=>[i(n,{ref:"account",modelValue:e.formState.account,"onUpdate:modelValue":o[0]||(o[0]=d=>e.formState.account=d),class:"h40",name:"account",placeholder:"邮箱/手机",clearable:!0,tabindex:"1",type:"text",maxlength:"100",autocomplete:"off"},null,8,["modelValue"])]),_:1}),i(s,{prop:"password"},{default:u(()=>[i(n,{ref:"password",modelValue:e.formState.password,"onUpdate:modelValue":o[1]||(o[1]=d=>e.formState.password=d),class:"h40","show-password":"",name:"password",placeholder:"请输入密码",clearable:!0,tabindex:"2",maxlength:"16",type:"password",autocomplete:"off",onKeyup:W(e.loginHandle,["enter"])},null,8,["modelValue"])]),_:1}),e.showCaptcha?(w(),q(s,{key:0,prop:"captcha"},{default:u(()=>[l("div",ce,[l("div",le,[i(n,{ref:"captcha",modelValue:e.formState.captcha,"onUpdate:modelValue":o[2]||(o[2]=d=>e.formState.captcha=d),class:"h40",type:"text",name:"captcha",placeholder:"请输入校验码",clearable:!0,tabindex:"3",maxlength:"6",autocomplete:"off",onKeyup:W(e.loginHandle,["enter"])},null,8,["modelValue"])]),l("div",de,[l("img",{src:e.captchaImg,alt:"",onClick:e.updateImage},null,8,ue)])])]),_:1})):F("v-if",!0),i(s,{style:{"margin-bottom":"0"}},{default:u(()=>[i(b,{class:"h40",loading:e.loading,disabled:e.disabledLogin,type:"primary",style:{width:"100%"},onClick:j(e.loginHandle,["prevent"])},{default:u(()=>o[3]||(o[3]=[M(" 快速登录 ")])),_:1,__:[3]},8,["loading","disabled"]),i(h,{type:"primary",underline:!1,loading:e.loading,class:"",style:{width:"100%",margin:"15px"},onClick:j(e.freeLogin,["prevent"])},{default:u(()=>o[4]||(o[4]=[M(" 免登录 ")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"])}const pe=k(ie,[["render",me],["__scopeId","data-v-e5729d1b"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/login/loginPwd.vue"]]),_e=v({name:"Login"}),fe=Object.assign(_e,{setup(r,{expose:o}){o();const t=m(!0),e=D(()=>{t.value=!V()},50);S(()=>{t.value=!V()}),K(()=>{window.addEventListener("resize",e)}),N(()=>{window.removeEventListener("resize",e)});const a={isShowWX:t,resizeCb:e,__MACROS_defineComponent:v,ref:m,onBeforeMount:S,onMounted:K,onUnmounted:N,get isMobile(){return V},get debounce(){return D},Logo:oe,get WeChatLogin(){return re},LoginPwd:pe};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),ge={class:"section-container login-container un-select"},he={class:"body fix-width"},we={class:"top"},ve={class:"main"},be={key:0,class:"foot-link"};function ye(r,o,t,e,a,c){const n=p("el-divider"),s=p("yu-copyright");return w(),x("div",ge,[l("div",he,[l("div",we,[i(e.Logo,{class:"logos"}),o[0]||(o[0]=l("div",{class:"top-title"},"账号密码登录",-1))]),l("div",ve,[i(e.LoginPwd),o[2]||(o[2]=l("div",{class:"foot-link clearFix"},null,-1)),e.isShowWX?(w(),x("div",be,[i(n,{"content-position":"center"},{default:u(()=>o[1]||(o[1]=[M("其他方式登录")])),_:1,__:[1]}),i(e.WeChatLogin)])):F("v-if",!0)])]),i(s)])}const eo=k(fe,[["render",ye],["__scopeId","data-v-2bf2fc29"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/login/index.vue"]]);export{eo as default};
