import{h as o}from"../../assets/index-fCswSekQ.js";const w=e=>({inspection:{kind:"inspection",choices:["pass","fail"],default:"pass",require_comment_on_fail:!1,require_photo_on_fail:!1},checkbox:{kind:"checkbox",default:!1},number:{kind:"number",unit:"",decimal_places:0,limits:null,default_value:0},text:{kind:"text",multiline:!0,max_length:1e3,default_value:""},attachments:{kind:"attachments",allow_types:["image","pdf"],max_files:5,max_file_size_mb:10}})[e]||{},f=e=>({numeric:"number",boolean:"checkbox",checkbox:"checkbox",text:"text",file:"attachments",inspection:"inspection",service:"service"})[e]||"text",v=e=>Array.isArray(e)?e.map(r=>({tool_id:r.id,name:r.name||"Unnamed Tool"})):[],y=(e,r)=>{const t={required_image:!!r.require_image};switch(e){case"number":return{...t,kind:"number",unit:r.unit||"",decimal_places:r.decimal_places||0,default_value:typeof r.value=="number"?r.value:0,limits:g(r.numeric_limit_bounds)};case"checkbox":return{...t,kind:"checkbox",default:!!r.value};case"text":return{...t,kind:"text",multiline:!0,max_length:1e3,default_value:String(r.value||"")};case"inspection":return{...t,kind:"inspection",choices:["pass","fail"],default:r.value?"pass":"fail",require_comment_on_fail:!1,require_photo_on_fail:!1};case"attachments":return{...t,kind:"attachments",allow_types:["image","pdf"],max_files:5,max_file_size_mb:10};default:return t}},k=(e,r)=>{const t=e.value||{},i=f(t.type);return{step_id:e.id||e._id||`step-${Date.now()}-${r}`,order:r+1,type:i,label:e.name||`Step ${r+1}`,description:e.description||"",required:!!e.required,required_image:!!t.require_image,relevant_tools:v(e.tools||[]),relevant_resources:e.relevant_resources||[],config:y(i,t)}},d=e=>{var t,i;if(!e||e.lower===null&&e.upper===null)return{lower_limit_exclusive:null,lower_limit_inclusive:null,upper_limit_exclusive:null,upper_limit_inclusive:null,equal_to:null};const r={lower_limit_exclusive:null,lower_limit_inclusive:null,upper_limit_exclusive:null,upper_limit_inclusive:null,equal_to:null};return e.lower!==null&&e.lower!==void 0&&((t=e.inclusive)!=null&&t.lower?r.lower_limit_inclusive=e.lower:r.lower_limit_exclusive=e.lower),e.upper!==null&&e.upper!==void 0&&((i=e.inclusive)!=null&&i.upper?r.upper_limit_inclusive=e.upper:r.upper_limit_exclusive=e.upper),r},g=e=>{if(!e)return{lower:null,upper:null,inclusive:{lower:!0,upper:!0}};const r={lower:null,upper:null,inclusive:{lower:!0,upper:!0}};return e.lower_limit_inclusive!==null&&e.lower_limit_inclusive!==void 0?(r.lower=e.lower_limit_inclusive,r.inclusive.lower=!0):e.lower_limit_exclusive!==null&&e.lower_limit_exclusive!==void 0&&(r.lower=e.lower_limit_exclusive,r.inclusive.lower=!1),e.upper_limit_inclusive!==null&&e.upper_limit_inclusive!==void 0?(r.upper=e.upper_limit_inclusive,r.inclusive.upper=!0):e.upper_limit_exclusive!==null&&e.upper_limit_exclusive!==void 0&&(r.upper=e.upper_limit_exclusive,r.inclusive.upper=!1),e.equal_to!==null&&e.equal_to!==void 0&&(r.lower=e.equal_to,r.upper=e.equal_to,r.inclusive.lower=!0,r.inclusive.upper=!0),r},x=(e,r="")=>{var a,c;if(!e)return"No limits set";const t=e.lower,i=e.upper,l=((a=e.inclusive)==null?void 0:a.lower)!==!1,u=((c=e.inclusive)==null?void 0:c.upper)!==!1,n=r?" "+r:"";let s="";return t!=null&&(s+=`${l?"≥":">"} ${t}${n}`),i!=null&&(s&&(s+=" and "),s+=`${u?"≤":"<"} ${i}${n}`),s||"No limits set"},m={"Preventive Maintenance":1,"Preventative Maintenance":1,PM:1,Inspection:2,Repair:3,"Corrective Maintenance":3,Calibration:4,"Safety Check":5,Safety:5,Other:6,General:6},p=6,h=e=>{if(!e||typeof e!="object")throw new Error("Invalid template data provided for transformation");const r=(e.steps||[]).map(i=>{if(!i||typeof i!="object")return null;const l={name:i.label||i.name||"Untitled Step",description:i.description||"",type:"template",required:!!i.required,remarks:i.remarks||""};i.relevant_tools&&Array.isArray(i.relevant_tools)&&i.relevant_tools.length>0&&(l.tools=i.relevant_tools.map(n=>typeof n=="object"&&n.tool_id?parseInt(n.tool_id)||0:typeof n=="object"&&n.id?parseInt(n.id)||0:parseInt(n)||0).filter(n=>n>0));const u=i.config||{};switch(i.type){case"number":l.value={type:"numeric",value:parseFloat(u.default_value)||0,numeric_limit_bounds:d(u.limits),require_image:!!i.required_image,image:[]};break;case"checkbox":l.value={type:"checkbox",value:!!u.default,require_image:!!i.required_image,image:[]};break;case"text":l.value={type:"text",value:String(u.default_value||""),require_image:!!i.required_image,image:[]};break;case"inspection":l.value={type:"inspection",value:u.default==="pass",remarks:"",require_image:!!i.required_image,image:[]};break;case"attachments":l.value={type:"file",file:[]};break;default:l.value={type:"checkbox",value:!1,require_image:!!i.required_image,image:[]}}return l}).filter(Boolean),t={name:e.name,description:e.description||"",time_estimate_sec:e.estimated_minutes?e.estimated_minutes*60:1800,steps:r};if(e.applicable_assets){if(typeof e.applicable_assets=="number")t.equipment_node_id=e.applicable_assets;else if(typeof e.applicable_assets=="string"&&!isNaN(e.applicable_assets))t.equipment_node_id=parseInt(e.applicable_assets);else if(Array.isArray(e.applicable_assets)&&e.applicable_assets.length>0){const i=e.applicable_assets[0];typeof i=="number"?t.equipment_node_id=i:typeof i=="string"&&!isNaN(i)&&(t.equipment_node_id=parseInt(i))}}if(e.category){const i=parseInt(e.category);!isNaN(i)&&i>0?t.category_id=i:t.category_id=m[e.category]||p}else t.category_id=p;return t},b=(e,r)=>{if(!e||typeof e!="object")throw new Error("Invalid template data provided for update transformation");const t={};if(e.name!==void 0&&(t.name=e.name),e.description!==void 0&&(t.description=e.description),e.estimated_minutes!==void 0&&(t.time_estimate_sec=e.estimated_minutes*60),e.applicable_assets!==void 0)if(e.applicable_assets===null||e.applicable_assets==="")t.equipment_node_id=null;else if(typeof e.applicable_assets=="number")t.equipment_node_id=e.applicable_assets;else if(typeof e.applicable_assets=="string"&&!isNaN(e.applicable_assets))t.equipment_node_id=parseInt(e.applicable_assets);else if(Array.isArray(e.applicable_assets)&&e.applicable_assets.length>0){const s=e.applicable_assets[0];typeof s=="number"?t.equipment_node_id=s:typeof s=="string"&&!isNaN(s)&&(t.equipment_node_id=parseInt(s))}else Array.isArray(e.applicable_assets)&&e.applicable_assets.length===0&&(t.equipment_node_id=null);if(e.category){const s=parseInt(e.category);!isNaN(s)&&s>0?t.category_id=s:t.category_id=m[e.category]||p}const i=e.steps||[],l=r&&r.steps||[],u=new Map;l.forEach(s=>{const a=s.id||s._id||s.step_id;a&&u.set(a,s)});const n=new Map;return i.forEach(s=>{const a=s.step_id;a&&!a.startsWith("step-")&&n.set(a,s)}),t.step_add_list=[],t.step_update_list=[],t.step_delete_list=[],i.forEach(s=>{const a=s.step_id;if(!a||a.startsWith("step-")){const c=_(s,!1);t.step_add_list.push(c)}else if(u.has(a)){const c=_(s,!0);a&&a!=="null"&&a!=="undefined"&&t.step_update_list.push(c)}}),l.forEach(s=>{const a=s.id||s._id||s.step_id;a&&!n.has(a)&&a&&a!=="null"&&a!=="undefined"&&t.step_delete_list.push(a)}),t},_=(e,r=!1)=>{if(!e||typeof e!="object")throw new Error("Invalid step data provided for transformation");const t={name:e.label||e.name||"Untitled Step",description:e.description||"",type:"template",required:!!e.required,remarks:e.remarks||""};r&&(e.step_id||e.id||e._id)&&(t.id=e.step_id||e.id||e._id),e.relevant_tools&&Array.isArray(e.relevant_tools)&&e.relevant_tools.length>0&&(t.tools=e.relevant_tools.map(l=>typeof l=="object"&&l.tool_id?parseInt(l.tool_id)||0:typeof l=="object"&&l.id?parseInt(l.id)||0:parseInt(l)||0).filter(l=>l>0));const i=e.config||{};switch(e.type){case"number":t.value={type:"numeric",value:parseFloat(i.default_value)||0,numeric_limit_bounds:d(i.limits),require_image:!!e.required_image,image:[]};break;case"checkbox":t.value={type:"checkbox",value:!!i.default,require_image:!!e.required_image,image:[]};break;case"text":t.value={type:"text",value:String(i.default_value||""),require_image:!!e.required_image,image:[]};break;case"inspection":t.value={type:"inspection",value:i.default==="pass",remarks:"",require_image:!!e.required_image,image:[]};break;case"attachments":t.value={type:"file",file:[]};break;default:t.value={type:"checkbox",value:!1,require_image:!!e.required_image,image:[]}}return t},I=(e=1,r=10,t="createdAt",i="DESC",l={})=>o.request({method:"post",url:"/task/templates/search",params:{page:e,size:r,sortField:t,direction:i},data:l}),B=e=>o.request({method:"get",url:`/task/template/${e}`}),T=(e,r,t=null)=>{if(!e||e==="undefined"||e==="null")throw new Error(`Invalid template ID provided: ${e}`);const i=b(r,t);return o.request({method:"patch",url:`/task/template/${e}`,data:i})},A=e=>{const r=h(e);return o.request({method:"post",url:"/task/template",data:r})},S=e=>o.request({method:"delete",url:`/task/template/${e}`}),$=async(e={},r={})=>{var t,i;return o.request({method:"post",url:"/library/standards/search",params:{page:r.page,size:r.size,sortField:r.sortField,direction:r.direction},data:{keyword:(t=e.keyword)==null?void 0:t.trim(),category:(i=e.category)==null?void 0:i.trim()}})},N=async e=>{try{return{data:(await o.request({method:"get",url:`/library/standard/${e}`})).data}}catch(r){throw console.error("Failed to fetch standard:",r),r}},F=async e=>{try{return{data:(await o.request({method:"post",url:"/library/standard",data:e})).data}}catch(r){throw console.error("Failed to create standard:",r),r}},E=async(e,r)=>{try{return{data:(await o.request({method:"put",url:"/library/standard",data:{standard_id:e,...r}})).data}}catch(t){throw console.error("Failed to update standard:",t),t}},C=async e=>{try{return await o.request({method:"delete",url:`/library/standard/${e}`}),{success:!0}}catch(r){throw console.error("Failed to delete standard:",r),r}};export{$ as a,S as b,F as c,C as d,T as e,A as f,N as g,B as h,h as i,k as j,_ as k,x as l,w as m,I as s,g as t,E as u};
