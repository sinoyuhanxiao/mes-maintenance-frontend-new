import"../vue/vue.Dfo81L2Q.js";import{u as Ke}from"../vue-router/vue-router.30cuaQZO.js";import{ad as Ye,a0 as Qe,W as We,ae as He,U as qe,a3 as Le,a4 as xe,Y as De,O as we,g as Ue,l as Ce,E as Re,af as ct,ag as ut}from"../@element-plus/@element-plus.BNeHluFm.js";import{d as Ze,g as _e,e as fe,f as Ie,h as ke,i as Je,j as Xe}from"./equipment.DNKw76bx.js";import{_ as ne}from"../../assets/index-fCswSekQ.js";import{E as W,e as mt,c as $e}from"../element-plus/element-plus.CU5xiOkY.js";import{am as i,c as V,o as d,O as X,a as E,K as G,S as t,L as n,Q as U,R as J,P as Me,Y as et,G as pt,r as o,q as le,w as H,h as Ae,t as ae,as as je,M as ze,F as oe,a8 as ue,aM as lt,E as tt,Z as at,H as it,ao as Ve,_ as me,j as te}from"../@vue/@vue.CVGyaoMH.js";import{g as Se,a as be}from"../location/location.BVdMXW2_.js";import{v as Fe}from"../vue3-grid-layout/vue3-grid-layout.CKCGUfup.js";import{g as ft,i as _t,e as gt}from"../echarts/echarts.DOymG6Ya.js";import{M as Ge}from"../MaintenanceCardTable/MaintenanceCardTable.Hn5QWkZz.js";import{u as ce,d as Te}from"../minio/minio.DwZpSMzM.js";import{F as Ee}from"../FileUploadMultiple/FileUploadMultiple.XhmJ4C99.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../vue-i18n/vue-i18n.DjO1PVT4.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../mitt/mitt.DJ65BbbF.js";import"../lodash-es/lodash-es.BLHqGvLj.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";import"../tslib/tslib.BDyQ-Jie.js";import"../zrender/zrender.DldvXODt.js";import"../MaintenanceWorkOrderCard/MaintenanceWorkOrderCard.CBR2k6k0.js";import"../datetime/datetime.39-ZCqKU.js";const nt=""+new URL("../../assets/production-line-BZdYYlx6.svg",import.meta.url).href,ot="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%2020010904//EN'%20'http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd'%3e%3csvg%20version='1.0'%20xmlns='http://www.w3.org/2000/svg'%20width='300.000000pt'%20height='334.000000pt'%20viewBox='0%200%20300.000000%20334.000000'%20preserveAspectRatio='xMidYMid%20meet'%3e%3cmetadata%3e%20Created%20by%20potrace%201.10,%20written%20by%20Peter%20Selinger%202001-2011%20%3c/metadata%3e%3cg%20transform='translate(0.000000,334.000000)%20scale(0.100000,-0.100000)'%20fill='%23000000'%20stroke='none'%3e%3cpath%20d='M834%203207%20c-3%20-8%20-4%20-171%20-2%20-363%20l3%20-349%2058%20-104%2057%20-104%200%20-258%200%20-259%20-64%200%20-64%200%20-159%20248%20c-106%20163%20-171%20255%20-193%20270%20-32%2021%20-42%2022%20-179%2020%20l-146%20-3%20-3%20-1097%20-2%20-1098%2040%200%20c76%200%20159%2063%20185%20140%20l10%2031%20493%202%20492%202%200%20-53%20c0%20-48%204%20-58%2034%20-88%2029%20-29%2041%20-34%2081%20-34%2040%200%2052%205%2081%2034%2019%2019%2034%2045%2035%2058%200%2012%202%2035%202%2051%20l2%2027%20492%203%20493%202%205%20-27%20c17%20-75%20107%20-148%20185%20-148%20l40%200%202%20467%203%20468%2041%20-3%20c26%20-2%2045%202%2052%2011%209%2011%2012%20177%2010%20673%20l-3%20659%20-659%203%20c-486%201%20-662%20-1%20-673%20-9%20-11%20-10%20-13%20-67%20-13%20-308%20l1%20-296%20-170%20-3%20-171%20-2%200%20256%200%20256%2060%20112%2059%20112%201%20347%20c1%20190%20-1%20351%20-5%20357%20-4%206%20-96%2010%20-256%2010%20-200%200%20-251%20-3%20-255%20-13z%20m458%20-364%20l-3%20-318%20-46%20-90%20c-25%20-49%20-49%20-94%20-53%20-99%20-5%20-4%20-50%20-9%20-101%20-9%20l-92%20-1%20-53%20100%20-54%2099%200%20318%200%20317%20203%200%20202%200%20-3%20-317z%20m1568%20-1128%20l0%20-615%20-615%200%20-615%200%200%20615%200%20615%20615%200%20615%200%200%20-615z%20m-1689%20305%20l0%20-245%20-81%20-3%20-80%20-3%200%20251%200%20251%2080%20-3%2081%20-3%200%20-245z%20m-715%20196%20c16%20-18%2060%20-82%2099%20-142%2038%20-60%20102%20-159%20142%20-221%20l72%20-112%203%20-320%203%20-321%20-287%200%20-288%200%200%20575%200%20575%20114%200%20114%200%2028%20-34z%20m1115%20-808%20l0%20-303%20-371%20-3%20-370%20-2%200%20303%20c0%20167%202%20306%204%20308%202%202%20169%203%20370%202%20l367%20-2%200%20-303z%20m1180%20-712%20l0%20-346%20-1276%20-3%20-1275%20-2%200%20347%200%20348%201273%202%20c699%202%201273%203%201275%202%201%20-1%203%20-157%203%20-348z%20m-2441%20-426%20c0%20-31%20-101%20-118%20-114%20-98%20-1%201%200%2028%202%2058%20l4%2055%2054%201%20c44%200%2054%20-3%2054%20-16z%20m1228%20-19%20c6%20-62%20-49%20-102%20-97%20-72%20-12%208%20-33%2095%20-25%20103%201%202%2029%203%2061%202%2058%20-1%2058%20-1%2061%20-33z%20m1215%20-24%20c2%20-71%20-10%20-73%20-69%20-13%20-60%2060%20-58%2073%2012%2071%20l56%20-2%201%20-56z'/%3e%3cpath%20d='M1855%202098%20c-3%20-7%20-4%20-184%20-3%20-393%20l3%20-380%20390%200%20390%200%200%20390%200%20390%20-388%203%20c-305%202%20-389%200%20-392%20-10z%20m725%20-386%20l0%20-337%20-335%200%20-335%200%200%20340%200%20340%20335%20-3%20335%20-3%200%20-337z'/%3e%3cpath%20d='M1996%201995%20c-8%20-21%20-8%20-538%200%20-559%205%20-14%2037%20-16%20249%20-16%20212%200%20244%202%20249%2016%209%2024%207%20547%20-3%20562%20-5%208%20-17%2012%20-27%2010%20-18%20-3%20-19%20-18%20-22%20-266%20l-2%20-262%20-45%200%20-45%200%20-2%20263%20-3%20262%20-25%200%20-25%200%20-3%20-262%20-2%20-263%20-45%200%20-45%200%20-2%20263%20-3%20262%20-25%200%20-25%200%20-3%20-262%20-2%20-263%20-45%200%20-45%200%20-2%20263%20c-3%20258%20-3%20262%20-24%20265%20-13%202%20-24%20-4%20-28%20-13z'/%3e%3cpath%20d='M1695%201878%20c-3%20-8%20-4%20-86%20-3%20-173%20l3%20-160%2025%200%2025%200%200%20170%20c0%20169%200%20170%20-23%20173%20-12%202%20-24%20-3%20-27%20-10z'/%3e%3cpath%20d='M354%20915%20c-3%20-8%20-3%20-22%200%20-30%205%20-13%2027%20-15%20138%20-13%20l133%203%200%2025%200%2025%20-133%203%20c-111%202%20-133%200%20-138%20-13z'/%3e%3cpath%20d='M1336%20914%20c-14%20-36%2011%20-44%20138%20-44%20128%200%20150%206%20144%2036%20-3%2017%20-15%2019%20-139%2022%20-120%202%20-137%200%20-143%20-14z'/%3e%3cpath%20d='M2324%20915%20c-3%20-8%20-3%20-22%200%20-30%205%20-13%2027%20-15%20138%20-13%20l133%203%200%2025%200%2025%20-133%203%20c-111%202%20-133%200%20-138%20-13z'/%3e%3cpath%20d='M1465%20722%20c-124%20-3%20-142%20-9%20-124%20-44%209%20-16%2024%20-18%20132%20-18%20122%200%20147%206%20147%2037%200%2023%20-33%2028%20-155%2025z'/%3e%3cpath%20d='M354%20705%20c-4%20-8%20-1%20-22%206%20-30%2011%20-13%2036%20-15%20139%20-13%20l126%203%203%2028%203%2027%20-136%200%20c-112%200%20-137%20-3%20-141%20-15z'/%3e%3cpath%20d='M2324%20705%20c-16%20-39%200%20-45%20128%20-45%20130%200%20152%206%20146%2036%20-3%2017%20-15%2019%20-136%2022%20-111%202%20-133%200%20-138%20-13z'/%3e%3cpath%20d='M360%20504%20c-10%20-11%20-11%20-21%20-4%20-31%208%20-12%2033%20-15%20132%20-15%2067%201%20127%201%20133%201%206%201%209%2013%207%2029%20l-3%2027%20-126%203%20c-106%202%20-128%200%20-139%20-14z'/%3e%3cpath%20d='M1346%20505%20c-14%20-14%20-12%20-44%203%20-45%203%20-1%2062%20-1%20131%20-2%20103%20-1%20126%202%20134%2015%207%2011%206%2020%20-3%2031%20-19%2023%20-242%2023%20-265%201z'/%3e%3cpath%20d='M2329%20504%20c-8%20-10%20-10%20-21%20-3%20-30%207%20-12%2034%20-15%20129%20-15%2066%200%20126%200%20133%200%2018%201%2015%2048%20-4%2055%20-9%203%20-66%206%20-129%206%20-90%200%20-115%20-3%20-126%20-16z'/%3e%3c/g%3e%3c/svg%3e",vt={__name:"index",emits:["node-click","request-delete","request-add"],setup(A,{expose:a,emit:c}){const e=()=>Ae("img",{src:nt,alt:"",class:"node-icon-img"}),D=()=>Ae("img",{src:ot,alt:"",class:"node-icon-img"}),L=c,r=o(!1),l=o(""),s=o(null),u=o(!1),g=o(null),C=o([]),I=o([]),x=o(null),p=o(0),y={children:"children",label:"label"},O=q=>{switch(q){case 0:return He;case 1:return e;case 2:return D;case 3:return We;case 4:return Qe;default:return Ye}},m=(q,T=0)=>{const S={id:q.id,label:T===0?q.name:`T${T}: ${q.name}`,level:T};if(T>=4)return{...S,children:void 0};const h=Array.isArray(q.children)?q.children.map(f=>m(f,T+1)):void 0;return{...S,children:h&&h.length?h:void 0}};function _(q){for(const T of q??[]){const S=(T==null?void 0:T.children)??[];for(const h of S){const f=(h==null?void 0:h.children)??[];if(f.length)return{expand:[T.id,h.id],select:f[0].id}}}for(const T of q??[]){const S=(T==null?void 0:T.children)??[];if(S.length)return{expand:[T.id],select:S[0].id}}return null}function P(q){var T;I.value=q,(T=s.value)!=null&&T.setExpandedKeys?s.value.setExpandedKeys(q):p.value++}async function v(){var h,f,F,b,N;if(await ae(),((F=((f=(h=s.value)==null?void 0:h.getExpandedKeys)==null?void 0:f.call(h))??I.value)==null?void 0:F.length)>0)return;const T=_(C.value);if(!T)return;P(T.expand),x.value=T.select;const S=(N=(b=s.value)==null?void 0:b.getNode)==null?void 0:N.call(b,T.select);if(S){const w=[];let k=S;for(;k;)w.unshift(k.data),k=k.parent;L("node-click",S.data,w)}}const R=async()=>{var q;u.value=!0,g.value=null;try{const T=await Ze();let S;(q=T.data)!=null&&q.data?S=T.data.data:Array.isArray(T.data)?S=T.data:T.data?S=[T.data]:S=[],C.value=S.map(h=>m(h,0)),await ae(),await v()}catch(T){g.value=T.message||"Failed to load equipment tree"}finally{u.value=!1}},K=async()=>{await R()};le(R),H(l,q=>{var T;return(T=s.value)==null?void 0:T.filter(q)});const ee=(q,T)=>!q||T.label.toLowerCase().includes(q.toLowerCase());function M(q,T){x.value=q.id;const S=[];let h=T;for(;h;)S.unshift(h.data),h=h.parent;L("node-click",q,S)}function z(q){return(q.level??0)>=1}function $(q){const T=[];let S=q;for(;S;)T.unshift(S.data),S=S.parent;return T}function ie(q,T){const S=(q.level??0)+1;if(S>4)return W.warning("Reached deepest level.");L("request-add",{nextLevel:S,parentId:q.id,node:q,breadcrumb:$(T)})}function se(q,T){const S=T.level??0;if(S===1)return W.warning("Tier 1 cannot be deleted.");L("request-delete",{level:S,node:T,breadcrumb:$(q)})}function de(q,T=C.value){for(const S of T||[]){if(S.id===q)return S;if(Array.isArray(S.children)){const h=de(q,S.children);if(h)return h}}return null}function re(q,T=C.value,S=[]){for(const h of T||[]){const f=[...S,h];if(h.id===q)return f;if(Array.isArray(h.children)){const F=re(q,h.children,f);if(F)return F}}return null}function j(q){const T=de(q);return Array.isArray(T==null?void 0:T.children)?T.children:[]}function Z(q){var f,F,b,N,w,k;const T=re(q);if(!T)return console.warn(`Equipment with ID ${q} not found in tree`),!1;const S=T.slice(0,-1).map(B=>B.id);I.value=S,(F=(f=s.value)==null?void 0:f.setExpandedKeys)==null||F.call(f,S),x.value=q,(N=(b=s.value)==null?void 0:b.setCurrentKey)==null||N.call(b,q);const h=(k=(w=s.value)==null?void 0:w.getNode)==null?void 0:k.call(w,q);if(h){const B=[];let Q=h;for(;Q;)B.unshift(Q.data),Q=Q.parent;return L("node-click",h.data,B),!0}return!1}a({refreshTree:K,getChildrenOf:j,focusNode:Z});const Y={ProductionLineIcon:e,EquipmentGroupIcon:D,emit:L,isEditMode:r,filterText:l,treeRef:s,loading:u,error:g,treeData:C,expandedKeys:I,currentKey:x,treeRenderKey:p,defaultProps:y,getIconForLevel:O,transformNode:m,findFirstT2Path:_,applyExpandedPath:P,openAndSelectFirstT2IfNoneOpen:v,fetchEquipmentTree:R,refreshTree:K,filterNode:ee,handleNodeClick:M,canShowActions:z,collectBreadcrumbFromNodeCtx:$,addNode:ie,requestDelete:se,findNodeById:de,buildPathNodesTo:re,getChildrenOf:j,focusNode:Z,ref:o,watch:H,onMounted:le,nextTick:ae,h:Ae,get ElMessage(){return W},get OfficeBuilding(){return He},get Setting(){return We},get Tools(){return Qe},get Folder(){return Ye},get getEquipmentTree(){return Ze},get productionLineUrl(){return nt},get equipmentGroupUrl(){return ot}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},bt={class:"simple-tree-container"},yt={class:"tree-toolbar"},ht={class:"node-content"},wt=["title"],Dt={key:0,class:"node-actions"};function qt(A,a,c,e,D,L){const r=i("el-input"),l=i("el-button"),s=i("el-icon"),u=i("el-tree");return d(),V("div",bt,[X(" Toolbar: Search + Edit toggle (now sticky) "),E("div",yt,[t(r,{modelValue:e.filterText,"onUpdate:modelValue":a[0]||(a[0]=g=>e.filterText=g),placeholder:"Search by name",clearable:"",class:"tree-search"},null,8,["modelValue"]),t(l,{class:"edit-toggle",type:e.isEditMode?"success":"primary",onClick:a[1]||(a[1]=g=>e.isEditMode=!e.isEditMode)},{default:n(()=>[U(J(e.isEditMode?"Done":"Edit"),1)]),_:1},8,["type"])]),(d(),G(u,{key:e.treeRenderKey,ref:"treeRef",data:e.treeData,"node-key":"id","default-expanded-keys":e.expandedKeys,"current-node-key":e.currentKey,"highlight-current":"",props:e.defaultProps,"filter-node-method":e.filterNode,"expand-on-click-node":!1,"render-after-expand":!1,accordion:"",onNodeClick:a[2]||(a[2]=(g,C)=>e.handleNodeClick(g,C)),style:{"max-width":"600px"}},{default:n(({node:g,data:C})=>[E("div",{class:pt(["node-row",{"is-view":!e.isEditMode}])},[E("div",ht,[t(s,{class:"node-icon"},{default:n(()=>[(d(),G(Me(e.getIconForLevel(C.level))))]),_:2},1024),E("span",{class:"node-label",title:C.label},J(C.label),9,wt)]),X(" actions "),e.isEditMode&&e.canShowActions(C)?(d(),V("div",Dt,[(C.level??0)<=3?(d(),G(l,{key:0,class:"action-btn",type:"primary",link:"",onClick:et(I=>e.addNode(C,g),["stop"])},{default:n(()=>a[3]||(a[3]=[U(" Add ")])),_:2,__:[3]},1032,["onClick"])):X("v-if",!0),(C.level??0)>=2?(d(),G(l,{key:1,class:"action-btn",type:"danger",link:"",onClick:et(I=>e.requestDelete(g,C),["stop"])},{default:n(()=>a[4]||(a[4]=[U(" Delete ")])),_:2,__:[4]},1032,["onClick"])):X("v-if",!0)])):X("v-if",!0)],2)]),_:1},8,["data","default-expanded-keys","current-node-key"]))])}const Lt=ne(vt,[["render",qt],["__scopeId","data-v-b8cafad3"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentTree/index.vue"]]),xt={__name:"Details",props:{equipmentId:{type:Number}},setup(A,{expose:a}){a();const c=A,e=o(null),D=o([]),L=o(!1),r=o(null),l=x=>!x||!Array.isArray(x)?[]:x.map((p,y)=>{const O=p.split("/"),_=(O[O.length-1]||`file_${y+1}`).replace(/\d{17}/,"");return{id:y,name:decodeURIComponent(_),url:p,type:C(_)}}),s=async()=>{var x;if(c.equipmentId)try{L.value=!0,r.value=null;const p=await _e(c.equipmentId);e.value=p.data,e.value.file_list&&Array.isArray(e.value.file_list)&&(e.value.file_list=l(e.value.file_list)),(x=e.value.location)!=null&&x.id&&typeof e.value.location.id!="object"&&e.value.location.status!==0?await u(e.value.location.id):D.value=[]}catch(p){r.value=p.message||"Failed to fetch equipment data"}finally{L.value=!1}},u=async x=>{try{const p=await Se(x);D.value=p.data||[]}catch{D.value=[]}};function g(x){switch(x==null?void 0:x.toLowerCase()){case"image":case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return De;case"video":case"mp4":case"avi":case"mov":case"wmv":case"flv":return xe;case"audio":case"mp3":case"wav":case"flac":case"aac":return Le;case"pdf":case"document":case"doc":case"docx":case"txt":case"rtf":return we;case"download":case"zip":case"rar":case"7z":return qe;default:return we}}function C(x){var P;if(!x)return"document";const p=(P=x.split(".").pop())==null?void 0:P.toLowerCase(),y=["jpg","jpeg","png","gif","bmp","webp","svg"],O=["mp4","avi","mov","wmv","flv","mkv"],m=["mp3","wav","flac","aac","ogg"],_=["zip","rar","7z","tar","gz"];return y.includes(p)?"image":O.includes(p)?"video":m.includes(p)?"audio":_.includes(p)?"download":"document"}le(()=>{s()}),H(()=>c.equipmentId,x=>{x&&s()});const I={props:c,equipmentData:e,locationPath:D,loading:L,error:r,parseFileList:l,fetchEquipmentData:s,fetchLocationPath:u,getFileIcon:g,getFileTypeFromName:C,ref:o,onMounted:le,watch:H,get ArrowRight(){return Ue},get Document(){return we},get Picture(){return De},get VideoCamera(){return xe},get Microphone(){return Le},get Download(){return qe},get getEquipmentById(){return _e},get getLocationPathById(){return Se}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}},It={class:"t2-details"},kt={class:"general-information"},St={class:"location"},Tt={class:"image"},Ct={key:0,class:"image-gallery"},Et={key:1,class:"no-images"},Pt={class:"files"},Nt={class:"file-list"},Vt={key:0},Ft={key:1,class:"no-files"},Ot={key:1,class:"loading-state","element-loading-text":"Loading equipment details..."},At={key:2,class:"error-state"},Ut={key:3,class:"no-data"};function Rt(A,a,c,e,D,L){const r=i("el-descriptions-item"),l=i("el-descriptions"),s=i("el-divider"),u=i("el-breadcrumb-item"),g=i("el-breadcrumb"),C=i("el-image"),I=i("el-text"),x=i("el-link"),p=i("el-alert"),y=i("el-empty"),O=je("loading");return d(),V("div",It,[e.equipmentData?(d(),V(oe,{key:0},[E("div",kt,[t(l,{column:2,direction:"vertical"},{default:n(()=>[t(r,{label:"Name"},{default:n(()=>[U(J(e.equipmentData.name),1)]),_:1}),t(r,{label:"Code"},{default:n(()=>[U(J(e.equipmentData.code),1)]),_:1}),t(r,{label:"Description",class:"highlighted-item"},{default:n(()=>[U(J(e.equipmentData.description||"No description available"),1)]),_:1})]),_:1})]),t(s),E("div",St,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Location Path"},{default:n(()=>[t(g,{"separator-icon":e.ArrowRight},{default:n(()=>[(d(!0),V(oe,null,ue(e.locationPath,m=>(d(),G(u,{key:m.id},{default:n(()=>[U(J(m.name),1)]),_:2},1024))),128)),e.locationPath.length===0?(d(),G(u,{key:0},{default:n(()=>a[0]||(a[0]=[U(" No location path available ")])),_:1,__:[0]})):X("v-if",!0)]),_:1},8,["separator-icon"])]),_:1})]),_:1})]),t(s),E("div",Tt,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Images"},{default:n(()=>[e.equipmentData.image_list&&e.equipmentData.image_list.length>0?(d(),V("div",Ct,[(d(!0),V(oe,null,ue(e.equipmentData.image_list,(m,_)=>(d(),G(C,{key:_,src:m,"preview-src-list":e.equipmentData.image_list,fit:"cover",class:"equipment-image"},null,8,["src","preview-src-list"]))),128))])):(d(),V("div",Et,[t(I,null,{default:n(()=>a[1]||(a[1]=[U("No equipment images available")])),_:1,__:[1]})]))]),_:1})]),_:1})]),t(s),E("div",Pt,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Files"},{default:n(()=>[E("div",Nt,[e.equipmentData.file_list&&e.equipmentData.file_list.length>0?(d(),V("div",Vt,[(d(!0),V(oe,null,ue(e.equipmentData.file_list,m=>(d(),V("div",{key:m.id||m.name,class:"file-item"},[t(x,{href:m.url,target:"_blank",icon:e.getFileIcon(m.type),class:"file-link"},{default:n(()=>[U(J(m.name),1)]),_:2},1032,["href","icon"])]))),128))])):(d(),V("div",Ft,[t(I,null,{default:n(()=>a[2]||(a[2]=[U(" No files available ")])),_:1,__:[2]})]))])]),_:1})]),_:1})])],64)):e.loading?ze((d(),V("div",Ot,a[3]||(a[3]=[E("div",{style:{height:"200px"}},null,-1)]))),[[O,!0]]):e.error?(d(),V("div",At,[t(p,{type:"error",title:e.error,"show-icon":""},null,8,["title"])])):(d(),V("div",Ut,[t(y,{description:"No equipment data found"})]))])}const Mt=ne(xt,[["render",Rt],["__scopeId","data-v-a211cecb"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/Details.vue"]]),jt={__name:"EquipmentSubItemCard",props:{number:{type:[String,Number],default:1},text:{type:String,default:"Sub-Item Text"},circleColor:{type:String,default:"#409EFF"}},setup(A,{expose:a}){a(),lt(e=>({"85c6ff79-circleColor":A.circleColor}));const c={};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},zt={class:"card-content"},Gt={class:"number-circle"},Bt={class:"number"},Kt={class:"text-content"};function Yt(A,a,c,e,D,L){const r=i("el-text"),l=i("el-card");return d(),G(l,{class:"sub-item-card",shadow:"hover"},{default:n(()=>[E("div",zt,[E("div",Gt,[E("span",Bt,J(c.number),1)]),E("div",Kt,[t(r,null,{default:n(()=>[U(J(c.text),1)]),_:1})])])]),_:1})}const Qt=ne(jt,[["render",Yt],["__scopeId","data-v-85c6ff79"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/components/EquipmentSubItemCard.vue"]]),Wt={__name:"SubItems",props:{imageUrl:{type:String,default:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},imageAlt:{type:String,default:"Equipment image"},items:{type:Array,default:()=>[{id:1,text:"Primary safety features included",textType:"default"},{id:2,text:"Requires regular maintenance",textType:"default"},{id:3,text:"High performance rating achieved",textType:"default"},{id:4,text:"Temperature monitoring system",textType:"default"},{id:5,text:"Emergency shutdown capability",textType:"default"},{id:6,text:"Energy efficient operation mode",textType:"default"},{id:7,text:"User-friendly interface design",textType:"default"},{id:8,text:"Automated diagnostic functions",textType:"default"},{id:9,text:"Backup power supply available",textType:"default"},{id:10,text:"Compliance with safety standards",textType:"default"},{id:11,text:"Advanced monitoring capabilities",textType:"default"},{id:12,text:"Remote control functionality",textType:"default"},{id:13,text:"Predictive maintenance alerts",textType:"default"},{id:14,text:"Quality assurance protocols",textType:"default"}]}},setup(A,{expose:a}){a();const c={get Picture(){return De},EquipmentSubItemCard:Qt};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},Ht={class:"t2-sub-items"},Zt={class:"image"},Jt={class:"image-slot"},Xt={class:"label-cards"};function $t(A,a,c,e,D,L){const r=i("el-icon"),l=i("el-image"),s=i("el-col"),u=i("el-row");return d(),V("div",Ht,[E("div",Zt,[t(l,{src:c.imageUrl,alt:c.imageAlt,fit:"cover","preview-src-list":[c.imageUrl]},{error:n(()=>[E("div",Jt,[t(r,null,{default:n(()=>[t(e.Picture)]),_:1}),a[0]||(a[0]=E("span",null,"No Image",-1))])]),_:1},8,["src","alt","preview-src-list"])]),E("div",Xt,[t(u,{gutter:0},{default:n(()=>[(d(!0),V(oe,null,ue(c.items,(g,C)=>(d(),G(s,{key:g.id,xs:24,sm:24,md:24,lg:24},{default:n(()=>[t(e.EquipmentSubItemCard,{number:C+1,text:g.text,"text-type":g.textType||"default","text-size":g.textSize||"default","circle-color":g.circleColor},null,8,["number","text","text-type","text-size","circle-color"])]),_:2},1024))),128))]),_:1})])])}const ea=ne(Wt,[["render",$t],["__scopeId","data-v-b61970b5"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/SubItems.vue"]]),ta={__name:"ColorDisplayButton",props:{name:{type:String,default:"Name"},value:{type:Number,default:1},color:{type:String,default:"#409EFF"}},setup(A,{expose:a}){a();const c={get ElText(){return mt}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},aa={class:"custom-field"};function na(A,a,c,e,D,L){return d(),V("div",aa,[t(e.ElText,{class:"value",style:tt({color:c.color})},{default:n(()=>[U(J(c.value),1)]),_:1},8,["style"]),t(e.ElText,{class:"name",style:tt({color:c.color,border:"1px solid "+c.color,padding:"6px 12px",borderRadius:"10px",display:"block",width:"100%",textAlign:"center"})},{default:n(()=>[U(J(c.name),1)]),_:1},8,["style"])])}const oa=ne(ta,[["render",na],["__scopeId","data-v-de7740b5"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Common/ColorDisplayButton.vue"]]),la={__name:"PieChart",props:{title:{type:String,default:"Pie Chart"},data:{type:Array,required:!0}},setup(A,{expose:a}){a();const c=A,e=o(null),D=o(null);let L=null;function r(){if(!e.value)return;const s=e.value.getBoundingClientRect();if(s.width===0||s.height===0){setTimeout(r,100);return}const u=ft(e.value);u&&u.dispose(),D.value=_t(e.value),D.value.setOption({title:{text:"",left:"center"},tooltip:{trigger:"item"},color:c.data.map(g=>g.color),series:[{name:"Status",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:25,fontWeight:"bold"}},labelLine:{show:!1},data:c.data}]})}le(async()=>{await ae(),setTimeout(()=>{r()},50),L=new ResizeObserver(()=>{D.value&&D.value.resize()}),e.value&&L.observe(e.value)}),at(()=>{L&&e.value&&L.unobserve(e.value),D.value&&D.value.dispose()}),H(()=>c.data,s=>{D.value&&D.value.setOption({color:s.map(u=>u.color),series:[{data:s}]})}),H(()=>c.title,s=>{D.value&&D.value.setOption({title:{text:s}})});const l={props:c,chart:e,myChart:D,get resizeObserver(){return L},set resizeObserver(s){L=s},renderChart:r,get echarts(){return gt},onMounted:le,ref:o,watch:H,onBeforeUnmount:at,nextTick:ae,ColorDisplayButton:oa};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},ia={class:"pie-chart-widget"},ra={class:"title"},sa={class:"buttons-grid"},da={ref:"chart",class:"chart-container"};function ca(A,a,c,e,D,L){return d(),V("div",ia,[E("h3",ra,J(e.props.title),1),E("div",sa,[(d(!0),V(oe,null,ue(e.props.data,(r,l)=>(d(),G(e.ColorDisplayButton,{key:l,name:r.name,value:r.value,color:r.color},null,8,["name","value","color"]))),128))]),E("div",da,null,512)])}const Oe=ne(la,[["render",ca],["__scopeId","data-v-64454056"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/components/Widgets/PieChart.vue"]]),ua={__name:"WorkOrders",setup(A,{expose:a}){a();const e={layout:o([{x:0,y:0,w:6,h:20,i:"1",component:Ve(Oe),props:{title:"",data:[{value:40,name:"Windows",color:"#4CAF50"},{value:30,name:"macOS",color:"#2196F3"},{value:20,name:"Linux",color:"#FF9800"},{value:10,name:"Other",color:"#9E9E9E"}]}}]),ref:o,markRaw:Ve,get GridLayout(){return Fe.GridLayout},get GridItem(){return Fe.GridItem},WidgetPie:Oe};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},ma={class:"page-container"},pa={class:"card"};function fa(A,a,c,e,D,L){return d(),V("div",ma,[t(e.GridLayout,{layout:e.layout,"col-num":6,"row-height":10,"is-draggable":!1,"is-resizable":!1,"use-css-transforms":!0,margin:[10,10]},{default:n(()=>[(d(!0),V(oe,null,ue(e.layout,r=>(d(),G(e.GridItem,{key:r.i,x:r.x,y:r.y,w:r.w,h:r.h,i:r.i},{default:n(()=>[E("div",pa,[(d(),G(Me(r.component),it({ref_for:!0},r.props,{class:"widget"}),null,16))])]),_:2},1032,["x","y","w","h","i"]))),128))]),_:1},8,["layout"])])}const _a=ne(ua,[["render",fa],["__scopeId","data-v-0814e318"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/WorkOrders.vue"]]),ga={__name:"Tasks",setup(A,{expose:a}){a();const c=o(null),e=o([{id:1,title:"Fix Bug #12",description:"Fix the UI layout issue on login page."},{id:2,title:"Write Tests",description:"Add unit tests for user service."},{id:3,title:"Code Review",description:"Review pull request #42."},{id:4,title:"Deploy Update",description:"Deploy v1.3 to staging environment."},{id:5,title:"Write Docs",description:"Update README with new API usage."},{id:6,title:"Schedule Meeting",description:"Book sync-up with frontend team."},{id:7,title:"Fix Lint Errors",description:"Resolve ESLint issues in dashboard module."},{id:8,title:"Add Feature Flag",description:"Introduce dark mode toggle for beta users."}]),D=me({page:1,limit:6});function L(s){c.value=s,console.log("Selected data:",c.value)}function r(s){D.page=s,console.log("Task library current page changed to:",s)}const l={selectedData:c,taskData:e,taskListQuery:D,handleRequestData:L,handleTaskCurrentChange:r,ref:o,reactive:me,MaintenanceCardTable:Ge};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},va={class:"t2-tasks-container"};function ba(A,a,c,e,D,L){const r=i("el-descriptions-item"),l=i("el-descriptions");return d(),V("div",va,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Task Library"},{default:n(()=>[t(e.MaintenanceCardTable,{items:e.taskData,pageSize:6,module:4,onRequestData:e.handleRequestData,height:"405px",totalItems:e.taskData.length,handleCurrentChange:e.handleTaskCurrentChange,currentPage:e.taskListQuery.page},null,8,["items","totalItems","currentPage"])]),_:1})]),_:1})])}const ya=ne(ga,[["render",ba],["__scopeId","data-v-44188c2e"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/Tasks.vue"]]),ha={__name:"Personnel",setup(A,{expose:a}){a();const c=o(""),e=o(1),D=o(15),L=o(Array.from({length:22},(g,C)=>{const I=["Alice","Bob","Charlie","Diana","Eve","Frank","Grace","Hank","Ivy","Jake","Kate","Leo","Mona","Nina","Owen","Paul"],x=I[C%I.length],p=Math.floor(Math.random()*5),y=Math.floor(Math.random()*20),O=Math.floor(Math.random()*3),m=Math.floor(Math.random()*5),_=p+y+O+m;return{name:x,active:p,complete:y,failed:O,incomplete:m,total:_}})),r=te(()=>c.value.trim()?L.value.filter(g=>g.name.toLowerCase().includes(c.value.toLowerCase())):L.value),l=te(()=>{const g=(e.value-1)*D.value;return r.value.slice(g,g+D.value)});function s(g){e.value=g}const u={searchQuery:c,currentPage:e,pageSize:D,tableData:L,filteredData:r,paginatedData:l,handlePageChange:s,ref:o,computed:te};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}},wa={class:"t2-personnel-container"},Da={class:"table"},qa={class:"search-bar"},La={class:"table-wrapper"},xa={class:"pagination-wrapper"};function Ia(A,a,c,e,D,L){const r=i("el-input"),l=i("el-table-column"),s=i("el-table"),u=i("el-descriptions-item"),g=i("el-descriptions"),C=i("el-pagination");return d(),V("div",wa,[E("div",Da,[t(g,{column:1,direction:"vertical"},{default:n(()=>[t(u,{label:"Associated Personnel Work Order Statistics"},{default:n(()=>[E("div",qa,[t(r,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=I=>e.searchQuery=I),placeholder:"Search by Name...",clearable:"","prefix-icon":"el-icon-search"},null,8,["modelValue"])]),E("div",La,[t(s,{data:e.paginatedData,"default-sort":{prop:"active",order:"descending"},style:{width:"100%"},height:"calc(100vh - 395px)"},{default:n(()=>[t(l,{prop:"name",label:"Name",sortable:""}),t(l,{prop:"active",label:"Active",sortable:""}),t(l,{prop:"complete",label:"Complete",sortable:""}),t(l,{prop:"failed",label:"Failed",sortable:""}),t(l,{prop:"incomplete",label:"Incomplete",sortable:""}),t(l,{prop:"total",label:"Total",sortable:""})]),_:1},8,["data"])])]),_:1})]),_:1})]),E("div",xa,[t(C,{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.filteredData.length,onCurrentChange:e.handlePageChange},null,8,["current-page","page-size","total"])])])}const ka=ne(ha,[["render",Ia],["__scopeId","data-v-8ddc2b28"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/Personnel.vue"]]),Sa={__name:"AddEquipmentGroup",props:{parentId:{type:[Number,String],default:null},productionLineId:{type:[Number,String],default:null},productionLineName:{type:String,default:""},lockProductionLine:{type:Boolean,default:!1}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o(!1),p=o([]),y=o([]),O=o([]),m=o([]),_=A,P=c,v=me({name:"",code:"",description:"",parentId:_.parentId,selectedLocationId:null,equipmentId:_.lockProductionLine?_.productionLineId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]});H(()=>_.parentId,(S,h)=>{S!==h&&S!==null&&(v.parentId=S,de({keepLockedT1:!0}),Z())}),H(()=>_.productionLineId,S=>{_.lockProductionLine&&(v.equipmentId=S??null)},{immediate:!0});const R={children:"children",label:"name"};H(s,S=>{var h;return(h=u.value)==null?void 0:h.filter(S)});const K=(S,h)=>!S||h.name.toLowerCase().includes(S.toLowerCase()),ee=S=>{g.value=S.id,v.selectedLocationId=S.id},M=S=>{y.value=S,v.imageList=S},z=S=>{m.value=S,v.explodedViewDrawing=S},$=S=>{O.value=S,v.filesList=S},ie=async()=>{try{let S=[],h=[],f=[];return v.imageList.length>0&&(S=(await ce(v.imageList)).data.uploadedFiles||[],v.imageList=S.map(b=>b.url)),v.explodedViewDrawing.length>0&&(h=(await ce(v.explodedViewDrawing)).data.uploadedFiles||[],v.explodedViewDrawing=h.map(b=>b.url)),v.filesList.length>0&&(f=(await ce(v.filesList)).data.uploadedFiles||[],v.filesList=f.map(b=>b.url)),{uploadedImages:S,uploadedFiles:f}}catch{throw new Error("File upload failed")}},se=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{(v.imageList.length>0||v.filesList.length>0)&&await ie();const h={name:v.name,code:v.code,description:v.description,node_type_id:4,parent_id:v.parentId,location_id:v.selectedLocationId,sequence_order:Number(v.sequenceOrder),image_list:v.imageList,exploded_view_drawing:v.explodedViewDrawing,file_list:v.filesList},f=await Ie(h);W.success("Equipment group created successfully!"),re(),P("close"),P("success",f.data)}catch(h){W.error(`Failed to create equipment group: ${h.message}`)}finally{C.value=!1}}};function de({keepLockedT1:S=!1}={}){e.value&&e.value.resetFields(),Object.assign(v,{name:"",code:"",description:"",parentId:_.parentId,selectedLocationId:null,equipmentId:S&&_.lockProductionLine||_.lockProductionLine?_.productionLineId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]}),g.value=null,y.value=[],m.value=[],O.value=[]}function re(){de({keepLockedT1:!0}),Z()}function j(){re(),P("close"),P("cancel")}async function Z(){var S,h;if(_.parentId){x.value=!0;try{if(_.lockProductionLine)I.value=[];else{const B=await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[3]});I.value=((S=B.data)==null?void 0:S.content)||[]}const b=(((h=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[4],parent_ids:[_.parentId]})).data)==null?void 0:h.content)||[]).map(B=>B.sequence_order).filter(B=>B!=null&&!isNaN(B));p.value=b;const w=(b.length>0?Math.max(...b):0)+1,k=b.length+1;v.sequenceOrder=Math.min(w,k)}catch{W.error("Failed to load production line metadata")}finally{x.value=!1}}}const Y=te(()=>{const S=p.value.length+1;return Math.max(S,v.sequenceOrder||1)}),q=async()=>{var S;r.value=!0,l.value=null;try{const h=await be();let f;(S=h.data)!=null&&S.data?f=h.data.data:Array.isArray(h.data)?f=h.data:h.data?f=[h.data]:f=[],L.value=f}catch(h){l.value=h.message||"Failed to load location tree",W.error("Failed to load location tree")}finally{r.value=!1}};le(()=>{q(),_.parentId&&Z()});const T={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,productionLines:I,productionLineLoading:x,sequenceOrders:p,uploadedImages:y,uploadedFiles:O,uploadedExplosionView:m,props:_,emit:P,formData:v,treeProps:R,filterNode:K,handleNodeClick:ee,handleImageListUpdate:M,handleExplosionViewUpdate:z,handleFilesListUpdate:$,uploadFilesToServer:ie,handleConfirm:se,resetFormData:de,resetForm:re,handleCancel:j,fetchProductionMeta:Z,maxSequenceOrder:Y,fetchLocationTree:q,ref:o,reactive:me,onMounted:le,watch:H,computed:te,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get createNewNode(){return Ie},get uploadMultipleToMinio(){return ce},FileUploadMultiple:Ee};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}},Ta={class:"add-new-t2"},Ca={class:"general-information"},Ea={class:"tree-container"},Pa={key:0,class:"tree-loading"},Na={key:1,class:"tree-error"},Va={class:"file-upload"},Fa={class:"file-upload"},Oa={class:"dialog-footer"};function Aa(A,a,c,e,D,L){const r=i("el-input"),l=i("el-form-item"),s=i("el-col"),u=i("el-row"),g=i("el-icon"),C=i("el-alert"),I=i("el-tree"),x=i("el-option"),p=i("el-select"),y=i("el-input-number"),O=i("el-form"),m=i("el-divider"),_=i("el-button");return d(),V("div",Ta,[E("div",Ca,[t(O,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Equipment Group Name",prop:"name",rules:[{required:!0,message:"Equipment Group name is required"},{type:"string",message:"Equipment Group name must be a string"}]},{default:n(()=>[t(r,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=P=>e.formData.name=P)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Equipment Group Code",prop:"code",rules:[{required:!0,message:"Equipment Group code is required"}]},{default:n(()=>[t(r,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=P=>e.formData.code=P)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(l,{label:"Description",prop:"description"},{default:n(()=>[t(r,{modelValue:e.formData.description,"onUpdate:modelValue":a[2]||(a[2]=P=>e.formData.description=P),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(l,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",Ea,[t(r,{modelValue:e.filterText,"onUpdate:modelValue":a[3]||(a[3]=P=>e.filterText=P),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",Pa,[t(g,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[6]||(a[6]=U(" Loading locations... "))])):e.error?(d(),V("div",Na,[t(C,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(I,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Production Line",prop:"equipmentId",rules:[{required:!0,message:"Production Line is required"}]},{default:n(()=>[t(p,{modelValue:e.formData.equipmentId,"onUpdate:modelValue":a[4]||(a[4]=P=>e.formData.equipmentId=P),placeholder:c.lockProductionLine?"":"Select production line",filterable:!c.lockProductionLine,clearable:!c.lockProductionLine,disabled:c.lockProductionLine,style:{width:"100%"},loading:e.productionLineLoading},{default:n(()=>[X(" Locked: show only the chosen line "),c.lockProductionLine&&c.productionLineId?(d(),G(x,{key:0,label:c.productionLineName||"Selected line",value:c.productionLineId},null,8,["label","value"])):(d(),V(oe,{key:1},[X(" Unlocked: normal list "),(d(!0),V(oe,null,ue(e.productionLines,P=>(d(),G(x,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))],64))]),_:1},8,["modelValue","placeholder","filterable","clearable","disabled","loading"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:P=>Number(P)}]},{default:n(()=>[t(y,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[5]||(a[5]=P=>e.formData.sequenceOrder=P),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label-position","model"]),t(m),E("div",Va,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleExplosionViewUpdate,"image-label":"Upload Exploded View","upload-type":"images","max-images":1,"title-label-position":e.labelPosition},null,8,["title-label-position"])]),t(m),E("div",Fa,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"upload-type":"both","max-images":5,"max-files":5,"title-label-position":e.labelPosition},null,8,["title-label-position"])]),E("div",Oa,[t(_,{onClick:e.handleCancel},{default:n(()=>a[7]||(a[7]=[U("Cancel")])),_:1,__:[7]}),t(_,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[8]||(a[8]=[U("Confirm")])),_:1,__:[8]},8,["loading"])])])])}const rt=ne(Sa,[["render",Aa],["__scopeId","data-v-f2359a85"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/components/AddEquipmentGroup.vue"]]),Ua={__name:"EditEquipmentGroup",props:{equipmentId:{type:[Number,String],required:!0}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o(!1),p=o([]),y=o(!1),O=o([]),m=o([]),_=o([]),P=o([]),v=o([]),R=o([]),K=A,ee=c,M=me({name:"",code:"",description:"",parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),z={children:"children",label:"name"},$=()=>{O.value=[],m.value=[],_.value=[],P.value=[],v.value=[],R.value=[]},ie=async b=>{if(!(!u.value||!b))try{if(await ae(),L.value.length===0)return;u.value.setCurrentKey(b);const N=u.value.getNode(b);if(!N)return;let w=N.parent;for(;w&&w.key!==void 0;)w.expanded=!0,w=w.parent;M.selectedLocationId=b,e.value&&(await ae(),e.value.clearValidate("selectedLocationId"))}catch{}},se=async()=>{var b;if(K.equipmentId){y.value=!0;try{const w=(await _e(K.equipmentId)).data,k=w.data||w;return $(),M.name=k.name||"",M.code=k.code||"",M.description=k.description||"",M.parentId=k.parent_id||k.parent_equipment_node_id,M.selectedLocationId=k.location_id,M.sequenceOrder=k.sequence_order||1,M.imageList=k.image_list||[],M.filesList=k.file_list||[],g.value=((b=k.location)==null?void 0:b.id)||k.location_id,k}catch(N){throw W.error("Failed to load equipment details"),N}finally{y.value=!1}}},de=async()=>{var b;r.value=!0,l.value=null;try{const N=await be();let w;return(b=N.data)!=null&&b.data?w=N.data.data:Array.isArray(N.data)?w=N.data:N.data?w=[N.data]:w=[],L.value=w,w}catch(N){throw l.value=N.message||"Failed to load location tree",W.error("Failed to load location tree"),N}finally{r.value=!1}},re=async b=>{var w;if(!b)return;const N=((w=b.location)==null?void 0:w.id)||b.location_id;N&&(await ae(),u.value&&L.value.length>0&&await ie(N))},j=(b,N)=>{switch(b){case"imageList":O.value=N;break;case"filesList":m.value=N;break;case"removeImage":_.value=N;break;case"removeFile":P.value=N;break}},Z=async()=>{var b,N;try{if(O.value.length>0){const w=await ce(O.value);v.value=((b=w.data.uploadedFiles)==null?void 0:b.map(k=>k.url))||[]}if(m.value.length>0){const w=await ce(m.value);R.value=((N=w.data.uploadedFiles)==null?void 0:N.map(k=>k.url))||[]}}catch{throw new Error("File upload failed")}},Y=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{let N=M.imageList||[],w=M.filesList||[];(O.value.length>0||m.value.length>0)&&await Z(),N=[...N||[],...v.value||[]],w=[...w||[],...R.value||[]],N=N.filter(Q=>!_.value.includes(Q)),w=w.filter(Q=>!P.value.includes(Q));const k={name:M.name,code:M.code,description:M.description,node_type_id:4,parent_id:M.parentId,location_id:M.selectedLocationId,sequence_order:Number(M.sequenceOrder),image_list:N,file_list:w},B=await ke(K.equipmentId,k);if(W.success("Equipment group updated successfully!"),_.value.length>0||P.value.length>0){const Q=[..._.value,...P.value];Promise.resolve().then(async()=>{try{(await Te({bucketName:"sv-file-bucket",objectUrls:Q})).status===0&&W.success("Old files deleted successfully!")}catch{}})}$(),ee("close"),ee("success",B.data)}catch(N){W.error(`Failed to update equipment group: ${N.message}`)}finally{C.value=!1}}},q=()=>{$(),ee("close"),ee("cancel")},T=async()=>{var b,N;if(M.parentId){x.value=!0;try{const k=((b=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[3]})).data)==null?void 0:b.content)||[];I.value=k;const pe=(((N=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[4],parent_ids:[M.parentId]})).data)==null?void 0:N.content)||[]).filter(ve=>ve.id!==parseInt(K.equipmentId)).map(ve=>ve.sequence_order).filter(ve=>ve!=null&&!isNaN(ve));p.value=pe}catch{W.error("Failed to load production lines")}finally{x.value=!1}}},S=te(()=>{const b=p.value.length+1;return Math.max(b,M.sequenceOrder||1)});H(s,b=>{var N;(N=u.value)==null||N.filter(b)});const h=(b,N)=>b?N.name.toLowerCase().includes(b.toLowerCase()):!0,f=async(b,N)=>{g.value=b.id,M.selectedLocationId=b.id,await ae(),e.value&&e.value.validateField("selectedLocationId")};H(()=>M.parentId,(b,N)=>{b&&b!==N&&T()},{immediate:!1}),H(L,async b=>{b.length>0&&g.value&&(await ae(),await ie(g.value))}),H(()=>M.selectedLocationId,async(b,N)=>{b&&b!==N&&(g.value=b,L.value.length>0&&(await ae(),await ie(b)))}),le(async()=>{try{$();const[b]=await Promise.all([se(),de()]);b&&(await re(b),(b.parent_id||b.parent_equipment_node_id)&&await T())}catch{}}),H(()=>K.equipmentId,(b,N)=>{b&&b!==N&&($(),Object.assign(M,{name:"",code:"",description:"",parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),g.value=null,se())},{immediate:!1});const F={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,productionLines:I,productionLineLoading:x,sequenceOrders:p,dataLoading:y,newImages:O,newFiles:m,removedImages:_,removedFiles:P,newImageUrls:v,newFileUrls:R,props:K,emit:ee,formData:M,treeProps:z,resetFileState:$,setCurrentTreeNode:ie,fetchEquipmentData:se,fetchLocationTree:de,initializeTreeSelection:re,handleFileUpdate:j,uploadFilesToServer:Z,handleConfirm:Y,handleCancel:q,fetchProductionLines:T,maxSequenceOrder:S,filterNode:h,handleNodeClick:f,ref:o,reactive:me,onMounted:le,watch:H,computed:te,nextTick:ae,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get editEquipmentNode(){return ke},get getEquipmentById(){return _e},get uploadMultipleToMinio(){return ce},get deleteObjectList(){return Te},FileUploadMultiple:Ee};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}},Ra={class:"edit-equipment-group"},Ma={key:0,class:"loading-container"},ja={key:1,class:"general-information"},za={class:"tree-container"},Ga={key:0,class:"tree-loading"},Ba={key:1,class:"tree-error"},Ka={class:"file-upload"},Ya={class:"dialog-footer"};function Qa(A,a,c,e,D,L){const r=i("el-icon"),l=i("el-input"),s=i("el-form-item"),u=i("el-col"),g=i("el-row"),C=i("el-alert"),I=i("el-tree"),x=i("el-option"),p=i("el-select"),y=i("el-input-number"),O=i("el-form"),m=i("el-divider"),_=i("el-button");return d(),V("div",Ra,[e.dataLoading?(d(),V("div",Ma,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[10]||(a[10]=U(" Loading equipment data... "))])):(d(),V("div",ja,[t(O,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Equipment Group Name",prop:"name",rules:[{required:!0,message:"Equipment Group name is required"},{type:"string",message:"Equipment Group name must be a string"}]},{default:n(()=>[t(l,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=P=>e.formData.name=P)},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Equipment Group Code",prop:"code",rules:[{required:!0,message:"Equipment Group code is required"}]},{default:n(()=>[t(l,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=P=>e.formData.code=P)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(s,{label:"Description",prop:"description"},{default:n(()=>[t(l,{modelValue:e.formData.description,"onUpdate:modelValue":a[2]||(a[2]=P=>e.formData.description=P),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(s,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",za,[t(l,{modelValue:e.filterText,"onUpdate:modelValue":a[3]||(a[3]=P=>e.filterText=P),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",Ga,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[11]||(a[11]=U(" Loading locations... "))])):e.error?(d(),V("div",Ba,[t(C,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(I,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Production Line",prop:"parentId",rules:[{required:!0,message:"Production Line is required"}]},{default:n(()=>[t(p,{modelValue:e.formData.parentId,"onUpdate:modelValue":a[4]||(a[4]=P=>e.formData.parentId=P),placeholder:"Select production line",filterable:"",clearable:"",style:{width:"100%"},loading:e.productionLineLoading},{default:n(()=>[(d(!0),V(oe,null,ue(e.productionLines,P=>(d(),G(x,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:P=>Number(P)}]},{default:n(()=>[t(y,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[5]||(a[5]=P=>e.formData.sequenceOrder=P),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label-position","model"]),t(m),E("div",Ka,[t(e.FileUploadMultiple,{"onUpdate:imageList":a[6]||(a[6]=P=>e.handleFileUpdate("imageList",P)),"onUpdate:filesList":a[7]||(a[7]=P=>e.handleFileUpdate("filesList",P)),"onUpdate:removedExistingImages":a[8]||(a[8]=P=>e.handleFileUpdate("removeImage",P)),"onUpdate:removedExistingFiles":a[9]||(a[9]=P=>e.handleFileUpdate("removeFile",P)),"upload-type":"both","max-images":5,"max-files":5,existingImageList:e.formData.imageList,existingFileList:e.formData.filesList,"title-label-position":e.labelPosition},null,8,["existingImageList","existingFileList","title-label-position"])]),E("div",Ya,[t(_,{onClick:e.handleCancel},{default:n(()=>a[12]||(a[12]=[U("Cancel")])),_:1,__:[12]}),t(_,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[13]||(a[13]=[U("Update")])),_:1,__:[13]},8,["loading"])])]))])}const Wa=ne(Ua,[["render",Qa],["__scopeId","data-v-6826aede"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/components/EditEquipmentGroup.vue"]]),Ha={__name:"DeactivateNode",props:{equipmentId:{type:[Number,String],required:!0}},emits:["close","success"],setup(A,{expose:a,emit:c}){a();const e=A,D=c,L=o(!1),r=o(!1),l=o(null),s=o(0),u=async()=>{if(e.equipmentId)try{const p=await _e(e.equipmentId);l.value=p.data}catch(p){console.error("Error fetching equipment data:",p),W.error("Failed to load equipment details")}},g=async()=>{var p;if(e.equipmentId)try{const O=((p=(await Je(e.equipmentId)).data)==null?void 0:p.children)||[];s.value=O.length}catch(y){console.error("Error fetching children count:",y),s.value=0}},C=async()=>{var p,y,O,m;if(!L.value){W.warning("Please confirm that you understand this action is permanent");return}try{await $e.confirm("This will permanently delete the equipment node and all associated data. Continue?","Final Confirmation",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"el-button--danger"}),r.value=!0,console.log("Calling deactivateEquipmentNode with ID:",e.equipmentId);const _=await Xe(e.equipmentId);console.log("API response:",_),W.success("Equipment node deleted successfully!"),D("success",e.equipmentId),D("close")}catch(_){if(_==="cancel")return;console.error("Full error object:",_),console.error("Error response:",_.response),console.error("Error message:",_.message),console.error("Error status:",(p=_.response)==null?void 0:p.status),console.error("Error data:",(y=_.response)==null?void 0:y.data);const P=((m=(O=_.response)==null?void 0:O.data)==null?void 0:m.message)||_.message||"Unknown error";W.error(`Failed to delete equipment node: ${P}`)}finally{r.value=!1}},I=()=>{D("close")};le(()=>{u(),g()}),H(()=>e.equipmentId,(p,y)=>{p&&p!==y&&(l.value=null,s.value=0,L.value=!1,u(),g())},{immediate:!1});const x={props:e,emit:D,confirmDeletion:L,submitting:r,nodeData:l,childrenCount:s,fetchEquipmentData:u,fetchChildrenCount:g,handleConfirm:C,handleCancel:I,ref:o,onMounted:le,watch:H,get ElMessage(){return W},get ElMessageBox(){return $e},get deactivateEquipmentNode(){return Xe},get getEquipmentById(){return _e},get getEquipmentSubtree(){return Je}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},Za={class:"deactivate-container"},Ja={key:0},Xa={class:"button-group"};function $a(A,a,c,e,D,L){const r=i("el-text"),l=i("el-alert"),s=i("el-divider"),u=i("el-descriptions-item"),g=i("el-descriptions"),C=i("el-checkbox"),I=i("el-button");return d(),V("div",Za,[t(l,{title:"Delete Equipment Node",type:"warning",closable:!1,"show-icon":""},{default:n(()=>[t(r,null,{default:n(()=>a[1]||(a[1]=[U("Are you sure you want to delete this equipment node?")])),_:1,__:[1]}),a[3]||(a[3]=E("br",null,null,-1)),a[4]||(a[4]=E("br",null,null,-1)),t(r,null,{default:n(()=>a[2]||(a[2]=[E("strong",null,"Warning:",-1),U(" This action cannot be undone. All associated data, sub-items, work orders, and tasks will be permanently removed. ")])),_:1,__:[2]})]),_:1,__:[3,4]}),t(s),e.nodeData?(d(),V("div",Ja,[t(g,{column:1,border:""},{default:n(()=>[t(u,{label:"Name"},{default:n(()=>[U(J(e.nodeData.name||"N/A"),1)]),_:1}),t(u,{label:"Code"},{default:n(()=>[U(J(e.nodeData.code||"N/A"),1)]),_:1}),t(u,{label:"Children"},{default:n(()=>[U(J(e.childrenCount),1)]),_:1})]),_:1})])):X("v-if",!0),t(s),t(C,{modelValue:e.confirmDeletion,"onUpdate:modelValue":a[0]||(a[0]=x=>e.confirmDeletion=x),size:"large"},{default:n(()=>[t(r,null,{default:n(()=>a[5]||(a[5]=[U("I understand that this action is permanent and cannot be undone")])),_:1,__:[5]})]),_:1},8,["modelValue"]),t(s),E("div",Xa,[t(I,{onClick:e.handleCancel,disabled:e.submitting},{default:n(()=>a[6]||(a[6]=[U(" Cancel ")])),_:1,__:[6]},8,["disabled"]),t(I,{type:"danger",onClick:e.handleConfirm,loading:e.submitting,disabled:!e.confirmDeletion},{default:n(()=>a[7]||(a[7]=[U(" Delete Equipment Node ")])),_:1,__:[7]},8,["loading","disabled"])])])}const Be=ne(Ha,[["render",$a],["__scopeId","data-v-0463fb35"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/common/DeactivateNode.vue"]]),en={__name:"index",props:{node:{type:Object,required:!0},breadcrumb:{type:Array,default:()=>[]}},emits:["refresh-tree","refresh-data","after-delete"],setup(A,{expose:a,emit:c}){const e=A,D=c,L=te(()=>{const M=e.breadcrumb.filter((z,$)=>$>0&&z&&typeof z=="object"&&"id"in z);return M.length>=2?M[M.length-2].id:null}),r=o("details"),l=o(!1),s=o(!1),u=o(!1),g=o(0),C=o(0),I=()=>{l.value=!1},x=()=>{I(),D("refresh-tree")},p=()=>{C.value+=1,s.value=!0},y=()=>{s.value=!1},O=()=>{y(),D("refresh-tree"),setTimeout(()=>{R()},100)},m=()=>{u.value=!0},_=()=>{u.value=!1},P=()=>{_(),D("refresh-tree"),D("after-delete",{parentId:L.value,deletedId:e.node.id})},v=M=>{M()},R=()=>{g.value+=1,D("refresh-data",e.node.id)},K=()=>{D("refresh-tree")};a({openDeactivateDialog:m});const ee={props:e,emit:D,parentId:L,activeTab:r,showAddDialog:l,showEditDialog:s,showDeactivateDialog:u,refreshKey:g,editDialogKey:C,closeAddDialog:I,handleAddSuccess:x,openEditDialog:p,closeEditDialog:y,handleEditSuccess:O,openDeactivateDialog:m,closeDeactivateDialog:_,handleDeleteSuccess:P,handleCloseDialog:v,refreshViewData:R,handleRefreshTree:K,ref:o,computed:te,get MoreFilled(){return Re},DetailsTab:Mt,SubItemsTab:ea,WorkOrderTab:_a,TasksTab:ya,PersonnelTab:ka,AddEquipmentGroup:rt,EditEquipmentGroup:Wa,DeactivateNode:Be};return Object.defineProperty(ee,"__isScriptSetup",{enumerable:!1,value:!0}),ee}},tn={class:"t2-main-container"},an={class:"t2-main-header"},nn={class:"t2-sub-header"},on={class:"t2-main-details"};function ln(A,a,c,e,D,L){const r=i("el-breadcrumb-item"),l=i("el-breadcrumb"),s=i("el-icon"),u=i("el-dropdown-item"),g=i("el-dropdown-menu"),C=i("el-dropdown"),I=i("el-tab-pane"),x=i("el-tabs"),p=i("el-dialog");return d(),V("div",tn,[E("div",an,[t(l,{separator:"/"},{default:n(()=>[(d(!0),V(oe,null,ue(c.breadcrumb,(y,O)=>(d(),G(r,{key:O},{default:n(()=>[U(J(y.label),1)]),_:2},1024))),128))]),_:1}),E("div",nn,[E("h1",null,J(e.props.node.label),1),t(C,{class:"kebab-dropdown"},{dropdown:n(()=>[t(g,null,{default:n(()=>[t(u,{onClick:e.openEditDialog},{default:n(()=>a[4]||(a[4]=[U("Edit Tier 2")])),_:1,__:[4]})]),_:1})]),default:n(()=>[t(s,{class:"kebab-icon"},{default:n(()=>[t(e.MoreFilled)]),_:1})]),_:1})])]),E("div",on,[(d(),G(x,{modelValue:e.activeTab,"onUpdate:modelValue":a[0]||(a[0]=y=>e.activeTab=y),type:"border-card",key:e.refreshKey},{default:n(()=>[t(I,{label:"Details",name:"details"},{default:n(()=>[(d(),G(e.DetailsTab,{equipmentId:e.props.node.id,key:`details-${e.refreshKey}`},null,8,["equipmentId"]))]),_:1}),t(I,{label:"Sub Items",name:"subItems"},{default:n(()=>[(d(),G(e.SubItemsTab,{key:`subitems-${e.refreshKey}`}))]),_:1}),t(I,{label:"Work Orders",name:"workOrders"},{default:n(()=>[(d(),G(e.WorkOrderTab,{key:`workorders-${e.refreshKey}`}))]),_:1}),t(I,{label:"Tasks",name:"tasks"},{default:n(()=>[(d(),G(e.TasksTab,{key:`tasks-${e.refreshKey}`}))]),_:1}),t(I,{label:"Personnel",name:"personnel"},{default:n(()=>[(d(),G(e.PersonnelTab,{key:`personnel-${e.refreshKey}`}))]),_:1})]),_:1},8,["modelValue"]))]),X(" Add "),t(p,{modelValue:e.showAddDialog,"onUpdate:modelValue":a[1]||(a[1]=y=>e.showAddDialog=y),title:"Add New Tier 2",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showAddDialog?(d(),G(e.AddEquipmentGroup,{key:0,onClose:e.closeAddDialog,onSuccess:e.handleAddSuccess,parentId:e.parentId},null,8,["parentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),X(" Edit "),t(p,{modelValue:e.showEditDialog,"onUpdate:modelValue":a[2]||(a[2]=y=>e.showEditDialog=y),title:"Edit Tier 2",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showEditDialog?(d(),G(e.EditEquipmentGroup,{key:`edit-${e.props.node.id}-${e.editDialogKey}`,onClose:e.closeEditDialog,onSuccess:e.handleEditSuccess,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),X(" Delete "),t(p,{modelValue:e.showDeactivateDialog,"onUpdate:modelValue":a[3]||(a[3]=y=>e.showDeactivateDialog=y),title:"Delete Tier 2",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showDeactivateDialog?(d(),G(e.DeactivateNode,{key:0,onClose:e.closeDeactivateDialog,onSuccess:e.handleDeleteSuccess,onRefreshTree:e.handleRefreshTree,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"])])}const rn=ne(en,[["render",ln],["__scopeId","data-v-c78504ed"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipmentGroup/index.vue"]]),sn={__name:"Details",props:{equipmentId:{type:Number}},setup(A,{expose:a}){a();const c=A,e=o(null),D=o([]),L=o(!1),r=o(null),l=p=>!p||!Array.isArray(p)?[]:p.map((y,O)=>{const m=y.split("/"),P=(m[m.length-1]||`file_${O+1}`).replace(/\d{17}/,"");return{id:O,name:decodeURIComponent(P),url:y,type:C(P)}}),s=async()=>{var p;if(c.equipmentId)try{L.value=!0,r.value=null;const y=await _e(c.equipmentId);e.value=y.data,e.value.file_list&&Array.isArray(e.value.file_list)&&(e.value.file_list=l(e.value.file_list)),(p=e.value.location)!=null&&p.id&&typeof e.value.location.id!="object"&&e.value.location.status!==0?await u(e.value.location.id):D.value=[]}catch(y){r.value=y.message||"Failed to fetch equipment data"}finally{L.value=!1}},u=async p=>{try{const y=await Se(p);D.value=y.data||[]}catch{D.value=[]}};function g(p){switch(p==null?void 0:p.toLowerCase()){case"image":case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return De;case"video":case"mp4":case"avi":case"mov":case"wmv":case"flv":return xe;case"audio":case"mp3":case"wav":case"flac":case"aac":return Le;case"pdf":case"document":case"doc":case"docx":case"txt":case"rtf":return we;case"download":case"zip":case"rar":case"7z":return qe;default:return we}}function C(p){var v;if(!p)return"document";const y=(v=p.split(".").pop())==null?void 0:v.toLowerCase(),O=["jpg","jpeg","png","gif","bmp","webp","svg"],m=["mp4","avi","mov","wmv","flv","mkv"],_=["mp3","wav","flac","aac","ogg"],P=["zip","rar","7z","tar","gz"];return O.includes(y)?"image":m.includes(y)?"video":_.includes(y)?"audio":P.includes(y)?"download":"document"}function I(p){if(!p)return"N/A";try{const y=new Date(p);return isNaN(y.getTime())?"N/A":y.toISOString().split("T")[0]}catch{return"N/A"}}le(()=>{s()}),H(()=>c.equipmentId,p=>{p&&s()});const x={props:c,equipmentData:e,locationPath:D,loading:L,error:r,parseFileList:l,fetchEquipmentData:s,fetchLocationPath:u,getFileIcon:g,getFileTypeFromName:C,formatInstallDate:I,ref:o,onMounted:le,watch:H,get ArrowRight(){return Ue},get Document(){return we},get Picture(){return De},get VideoCamera(){return xe},get Microphone(){return Le},get Download(){return qe},get getEquipmentById(){return _e},get getLocationPathById(){return Se}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},dn={class:"t3-details"},cn={class:"general-information"},un={class:"location"},mn={class:"image"},pn={key:0,class:"image-gallery"},fn={key:1,class:"no-images"},_n={class:"files"},gn={class:"file-list"},vn={key:0},bn={key:1,class:"no-files"},yn={key:1,class:"loading-state","element-loading-text":"Loading equipment details..."},hn={key:2,class:"error-state"},wn={key:3,class:"no-data"};function Dn(A,a,c,e,D,L){const r=i("el-descriptions-item"),l=i("el-descriptions"),s=i("el-divider"),u=i("el-breadcrumb-item"),g=i("el-breadcrumb"),C=i("el-image"),I=i("el-text"),x=i("el-link"),p=i("el-alert"),y=i("el-empty"),O=je("loading");return d(),V("div",dn,[e.equipmentData?(d(),V(oe,{key:0},[E("div",cn,[t(l,{column:3,direction:"vertical"},{default:n(()=>[t(r,{label:"Name"},{default:n(()=>[U(J(e.equipmentData.name),1)]),_:1}),t(r,{label:"Code"},{default:n(()=>[U(J(e.equipmentData.code),1)]),_:1}),t(r,{label:"Model"},{default:n(()=>[U(J(e.equipmentData.serial_number||"N/A"),1)]),_:1}),t(r,{label:"PLC"},{default:n(()=>[U(J(e.equipmentData.plc),1)]),_:1}),t(r,{label:"Power"},{default:n(()=>[U(J(e.equipmentData.power)+"V",1)]),_:1}),t(r,{label:"Install Date"},{default:n(()=>[U(J(e.formatInstallDate(e.equipmentData.installation_date)),1)]),_:1}),t(r,{label:"Description",class:"highlighted-item"},{default:n(()=>[U(J(e.equipmentData.description||"No description available"),1)]),_:1})]),_:1})]),t(s),E("div",un,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Location Path"},{default:n(()=>[t(g,{"separator-icon":e.ArrowRight},{default:n(()=>[(d(!0),V(oe,null,ue(e.locationPath,m=>(d(),G(u,{key:m.id},{default:n(()=>[U(J(m.name),1)]),_:2},1024))),128)),e.locationPath.length===0?(d(),G(u,{key:0},{default:n(()=>a[0]||(a[0]=[U(" No location path available ")])),_:1,__:[0]})):X("v-if",!0)]),_:1},8,["separator-icon"])]),_:1})]),_:1})]),t(s),E("div",mn,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Images"},{default:n(()=>[e.equipmentData.image_list&&e.equipmentData.image_list.length>0?(d(),V("div",pn,[(d(!0),V(oe,null,ue(e.equipmentData.image_list,(m,_)=>(d(),G(C,{key:_,src:m,"preview-src-list":e.equipmentData.image_list,fit:"cover",class:"equipment-image"},null,8,["src","preview-src-list"]))),128))])):(d(),V("div",fn,[t(I,null,{default:n(()=>a[1]||(a[1]=[U("No equipment images available")])),_:1,__:[1]})]))]),_:1})]),_:1})]),t(s),E("div",_n,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Files"},{default:n(()=>[E("div",gn,[e.equipmentData.file_list&&e.equipmentData.file_list.length>0?(d(),V("div",vn,[(d(!0),V(oe,null,ue(e.equipmentData.file_list,m=>(d(),V("div",{key:m.id||m.name,class:"file-item"},[t(x,{href:m.url,target:"_blank",icon:e.getFileIcon(m.type),class:"file-link"},{default:n(()=>[U(J(m.name),1)]),_:2},1032,["href","icon"])]))),128))])):(d(),V("div",bn,[t(I,null,{default:n(()=>a[2]||(a[2]=[U(" No files available ")])),_:1,__:[2]})]))])]),_:1})]),_:1})])],64)):e.loading?ze((d(),V("div",yn,a[3]||(a[3]=[E("div",{style:{height:"200px"}},null,-1)]))),[[O,!0]]):e.error?(d(),V("div",hn,[t(p,{type:"error",title:e.error,"show-icon":""},null,8,["title"])])):(d(),V("div",wn,[t(y,{description:"No equipment data found"})]))])}const qn=ne(sn,[["render",Dn],["__scopeId","data-v-ae86daf6"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/Details.vue"]]),Ln={__name:"EquipmentSubItemCard",props:{number:{type:[String,Number],default:1},text:{type:String,default:"Sub-Item Text"},circleColor:{type:String,default:"#409EFF"}},setup(A,{expose:a}){a(),lt(e=>({"8f8248b7-circleColor":A.circleColor}));const c={};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},xn={class:"card-content"},In={class:"number-circle"},kn={class:"number"},Sn={class:"text-content"};function Tn(A,a,c,e,D,L){const r=i("el-text"),l=i("el-card");return d(),G(l,{class:"sub-item-card",shadow:"hover"},{default:n(()=>[E("div",xn,[E("div",In,[E("span",kn,J(c.number),1)]),E("div",Sn,[t(r,null,{default:n(()=>[U(J(c.text),1)]),_:1})])])]),_:1})}const Cn=ne(Ln,[["render",Tn],["__scopeId","data-v-8f8248b7"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/components/EquipmentSubItemCard.vue"]]),En={__name:"SubItems",props:{imageUrl:{type:String,default:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},imageAlt:{type:String,default:"Equipment image"},items:{type:Array,default:()=>[{id:1,text:"Primary safety features included",textType:"default"},{id:2,text:"Requires regular maintenance",textType:"default"},{id:3,text:"High performance rating achieved",textType:"default"},{id:4,text:"Temperature monitoring system",textType:"default"},{id:5,text:"Emergency shutdown capability",textType:"default"},{id:6,text:"Energy efficient operation mode",textType:"default"},{id:7,text:"User-friendly interface design",textType:"default"},{id:8,text:"Automated diagnostic functions",textType:"default"},{id:9,text:"Backup power supply available",textType:"default"},{id:10,text:"Compliance with safety standards",textType:"default"},{id:11,text:"Advanced monitoring capabilities",textType:"default"},{id:12,text:"Remote control functionality",textType:"default"},{id:13,text:"Predictive maintenance alerts",textType:"default"},{id:14,text:"Quality assurance protocols",textType:"default"}]}},setup(A,{expose:a}){a();const c={get Picture(){return De},EquipmentSubItemCard:Cn};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},Pn={class:"t2-sub-items"},Nn={class:"image"},Vn={class:"image-slot"},Fn={class:"label-cards"};function On(A,a,c,e,D,L){const r=i("el-icon"),l=i("el-image"),s=i("el-col"),u=i("el-row");return d(),V("div",Pn,[E("div",Nn,[t(l,{src:c.imageUrl,alt:c.imageAlt,fit:"cover","preview-src-list":[c.imageUrl]},{error:n(()=>[E("div",Vn,[t(r,null,{default:n(()=>[t(e.Picture)]),_:1}),a[0]||(a[0]=E("span",null,"No Image",-1))])]),_:1},8,["src","alt","preview-src-list"])]),E("div",Fn,[t(u,{gutter:0},{default:n(()=>[(d(!0),V(oe,null,ue(c.items,(g,C)=>(d(),G(s,{key:g.id,xs:24,sm:24,md:24,lg:24},{default:n(()=>[t(e.EquipmentSubItemCard,{number:C+1,text:g.text,"text-type":g.textType||"default","text-size":g.textSize||"default","circle-color":g.circleColor},null,8,["number","text","text-type","text-size","circle-color"])]),_:2},1024))),128))]),_:1})])])}const An=ne(En,[["render",On],["__scopeId","data-v-88423e0c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/SubItems.vue"]]),Un={__name:"WorkOrders",setup(A,{expose:a}){a();const e={layout:o([{x:0,y:0,w:6,h:20,i:"1",component:Ve(Oe),props:{title:"",data:[{value:40,name:"Windows",color:"#4CAF50"},{value:30,name:"macOS",color:"#2196F3"},{value:20,name:"Linux",color:"#FF9800"},{value:10,name:"Other",color:"#9E9E9E"}]}}]),ref:o,markRaw:Ve,get GridLayout(){return Fe.GridLayout},get GridItem(){return Fe.GridItem},WidgetPie:Oe};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}},Rn={class:"page-container"},Mn={class:"card"};function jn(A,a,c,e,D,L){return d(),V("div",Rn,[t(e.GridLayout,{layout:e.layout,"col-num":6,"row-height":10,"is-draggable":!1,"is-resizable":!1,"use-css-transforms":!0,margin:[10,10]},{default:n(()=>[(d(!0),V(oe,null,ue(e.layout,r=>(d(),G(e.GridItem,{key:r.i,x:r.x,y:r.y,w:r.w,h:r.h,i:r.i},{default:n(()=>[E("div",Mn,[(d(),G(Me(r.component),it({ref_for:!0},r.props,{class:"widget"}),null,16))])]),_:2},1032,["x","y","w","h","i"]))),128))]),_:1},8,["layout"])])}const zn=ne(Un,[["render",jn],["__scopeId","data-v-536f2dc8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/WorkOrders.vue"]]),Gn={__name:"Tasks",setup(A,{expose:a}){a();const c=o(null),e=o([{id:1,title:"Fix Bug #12",description:"Fix the UI layout issue on login page."},{id:2,title:"Write Tests",description:"Add unit tests for user service."},{id:3,title:"Code Review",description:"Review pull request #42."},{id:4,title:"Deploy Update",description:"Deploy v1.3 to staging environment."},{id:5,title:"Write Docs",description:"Update README with new API usage."},{id:6,title:"Schedule Meeting",description:"Book sync-up with frontend team."},{id:7,title:"Fix Lint Errors",description:"Resolve ESLint issues in dashboard module."},{id:8,title:"Add Feature Flag",description:"Introduce dark mode toggle for beta users."}]),D=me({page:1,limit:6});function L(s){c.value=s,console.log("Selected data:",c.value)}function r(s){D.page=s,console.log("Task library current page changed to:",s)}const l={selectedData:c,taskData:e,taskListQuery:D,handleRequestData:L,handleTaskCurrentChange:r,ref:o,reactive:me,MaintenanceCardTable:Ge};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}},Bn={class:"t2-tasks-container"};function Kn(A,a,c,e,D,L){const r=i("el-descriptions-item"),l=i("el-descriptions");return d(),V("div",Bn,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Task Library"},{default:n(()=>[t(e.MaintenanceCardTable,{items:e.taskData,pageSize:6,module:4,onRequestData:e.handleRequestData,height:"405px",totalItems:e.taskData.length,handleCurrentChange:e.handleTaskCurrentChange,currentPage:e.taskListQuery.page},null,8,["items","totalItems","currentPage"])]),_:1})]),_:1})])}const Yn=ne(Gn,[["render",Kn],["__scopeId","data-v-b1b08182"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/Tasks.vue"]]),Qn={__name:"Personnel",setup(A,{expose:a}){a();const c=o(""),e=o(1),D=o(15),L=o(Array.from({length:22},(g,C)=>{const I=["Alice","Bob","Charlie","Diana","Eve","Frank","Grace","Hank","Ivy","Jake","Kate","Leo","Mona","Nina","Owen","Paul"],x=I[C%I.length],p=Math.floor(Math.random()*5),y=Math.floor(Math.random()*20),O=Math.floor(Math.random()*3),m=Math.floor(Math.random()*5),_=p+y+O+m;return{name:x,active:p,complete:y,failed:O,incomplete:m,total:_}})),r=te(()=>c.value.trim()?L.value.filter(g=>g.name.toLowerCase().includes(c.value.toLowerCase())):L.value),l=te(()=>{const g=(e.value-1)*D.value;return r.value.slice(g,g+D.value)});function s(g){e.value=g}const u={searchQuery:c,currentPage:e,pageSize:D,tableData:L,filteredData:r,paginatedData:l,handlePageChange:s,ref:o,computed:te};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}},Wn={class:"t2-personnel-container"},Hn={class:"table"},Zn={class:"search-bar"},Jn={class:"table-wrapper"},Xn={class:"pagination-wrapper"};function $n(A,a,c,e,D,L){const r=i("el-input"),l=i("el-table-column"),s=i("el-table"),u=i("el-descriptions-item"),g=i("el-descriptions"),C=i("el-pagination");return d(),V("div",Wn,[E("div",Hn,[t(g,{column:1,direction:"vertical"},{default:n(()=>[t(u,{label:"Associated Personnel Work Order Statistics"},{default:n(()=>[E("div",Zn,[t(r,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=I=>e.searchQuery=I),placeholder:"Search by Name...",clearable:"","prefix-icon":"el-icon-search"},null,8,["modelValue"])]),E("div",Jn,[t(s,{data:e.paginatedData,"default-sort":{prop:"active",order:"descending"},style:{width:"100%"},height:"calc(100vh - 395px)"},{default:n(()=>[t(l,{prop:"name",label:"Name",sortable:""}),t(l,{prop:"active",label:"Active",sortable:""}),t(l,{prop:"complete",label:"Complete",sortable:""}),t(l,{prop:"failed",label:"Failed",sortable:""}),t(l,{prop:"incomplete",label:"Incomplete",sortable:""}),t(l,{prop:"total",label:"Total",sortable:""})]),_:1},8,["data"])])]),_:1})]),_:1})]),E("div",Xn,[t(C,{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.filteredData.length,onCurrentChange:e.handlePageChange},null,8,["current-page","page-size","total"])])])}const eo=ne(Qn,[["render",$n],["__scopeId","data-v-162a83af"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/Personnel.vue"]]),to={__name:"DocumentsLoad",setup(A,{expose:a}){a();const c={get UploadFilled(){return ct}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},ao={class:"t3-documents-load"},no={class:"t3-documents-header"},oo={class:"t3-documents-content"};function lo(A,a,c,e,D,L){const r=i("el-text"),l=i("el-divider"),s=i("el-icon"),u=i("el-upload");return d(),V("div",ao,[E("div",no,[t(r,null,{default:n(()=>a[0]||(a[0]=[U(" No documents uploaded. Please upload the equipment manual. ")])),_:1,__:[0]}),t(l)]),E("div",oo,[t(u,{class:"upload-demo",drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:""},{tip:n(()=>a[1]||(a[1]=[E("div",{class:"el-upload__tip"},"pdf files with a size of less than 500kb",-1)])),default:n(()=>[t(s,{class:"el-icon--upload"},{default:n(()=>[t(e.UploadFilled)]),_:1}),a[2]||(a[2]=E("div",{class:"el-upload__text"},[U("Drop file here or "),E("em",null,"click to upload")],-1))]),_:1,__:[2]})])])}const io=ne(to,[["render",lo],["__scopeId","data-v-bea30122"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/DocumentsLoad.vue"]]),ro={__name:"DocumentsView",props:{pdfUrl:{type:String,default:"https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf"},documentTitle:{type:String,default:"Equipment Manual"}},setup(A,{expose:a}){a();const c=A,e=o(!1),D=te(()=>c.pdfUrl?`${c.pdfUrl}#toolbar=1&navpanes=0&scrollbar=1&view=FitH`:"");async function L(){if(c.pdfUrl)try{const I=await fetch(c.pdfUrl,{mode:"cors",headers:{Accept:"application/pdf"}});if(!I.ok)throw new Error("Failed to download PDF");const x=await I.blob();r(x)}catch(I){console.error("Download failed:",I),window.open(c.pdfUrl,"_blank")}}function r(I){const x=URL.createObjectURL(I),p=document.createElement("a");p.href=x,p.download=c.documentTitle+".pdf",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(x)}function l(){c.pdfUrl&&window.open(c.pdfUrl,"_blank")}function s(){console.log("Select PDF clicked")}function u(){console.log("PDF loaded successfully in browser native viewer"),e.value=!1}function g(){console.error("PDF failed to load in browser native viewer"),e.value=!0}le(()=>{console.log("PDF viewer component mounted - using browser native viewer")});const C={props:c,iframeError:e,directPdfUrl:D,downloadPdf:L,downloadBlob:r,openInNewTab:l,selectPdf:s,onIframeLoad:u,onIframeError:g,ref:o,computed:te,onMounted:le,get Download(){return qe},get Link(){return ut}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},so={class:"t3-documents-view"},co={class:"t3-documents-header"},uo={class:"header-actions"},mo={class:"t3-documents-content"},po={key:0,class:"pdf-container"},fo=["src"],_o={key:1,class:"no-pdf"};function go(A,a,c,e,D,L){const r=i("el-text"),l=i("el-icon"),s=i("el-button"),u=i("el-empty");return d(),V("div",so,[E("div",co,[t(r,null,{default:n(()=>[U(J(c.documentTitle),1)]),_:1}),E("div",uo,[t(s,{onClick:e.downloadPdf},{default:n(()=>[t(l,{style:{"margin-right":"10px"}},{default:n(()=>[t(e.Download)]),_:1}),a[0]||(a[0]=U(" Download "))]),_:1,__:[0]}),t(s,{onClick:e.openInNewTab},{default:n(()=>[t(l,{style:{"margin-right":"10px"}},{default:n(()=>[t(e.Link)]),_:1}),a[1]||(a[1]=U(" Open in New Tab "))]),_:1,__:[1]})])]),E("div",mo,[c.pdfUrl?(d(),V("div",po,[X(" Direct PDF embed (browser's native viewer) "),E("iframe",{src:e.directPdfUrl,class:"pdf-viewer",frameborder:"0",allowfullscreen:"",onLoad:e.onIframeLoad,onError:e.onIframeError},null,40,fo)])):(d(),V("div",_o,[t(u,{description:"No PDF selected"},{default:n(()=>[t(s,{type:"primary",onClick:e.selectPdf},{default:n(()=>a[2]||(a[2]=[U("Select PDF")])),_:1,__:[2]})]),_:1})]))])])}const vo=ne(ro,[["render",go],["__scopeId","data-v-512081ed"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/DocumentsView.vue"]]),bo={__name:"AddEquipment",props:{parentId:{type:[Number,String],default:null},productionLineId:{type:[Number,String],default:null},lockProductionLine:{type:Boolean,default:!0}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o(!1),p=o([]),y=o([]),O=o([]),m=o([]),_=A,P=c,v=(h,f,F)=>{f!=null&&f!==""&&(!Number.isInteger(f)||f<0)?F(new Error("Power must be a positive integer")):F()},R=me({name:"",code:"",description:"",serialNumber:"",plc:"",power:null,installationDate:null,parentId:_.parentId,selectedLocationId:null,equipmentId:_.lockProductionLine?_.productionLineId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]});H(()=>_.parentId,(h,f)=>{h!==f&&(R.parentId=h,Y(),$())}),H(()=>_.productionLineId,h=>{_.lockProductionLine&&(R.equipmentId=h)});const K={children:"children",label:"name"};H(s,h=>{var f;(f=u.value)==null||f.filter(h)});const ee=(h,f)=>h?f.name.toLowerCase().includes(h.toLowerCase()):!0,M=h=>{g.value=h.id,R.selectedLocationId=h.id},z=async()=>{var h;r.value=!0,l.value=null;try{const f=await be();let F;(h=f.data)!=null&&h.data?F=f.data.data:Array.isArray(f.data)?F=f.data:f.data?F=[f.data]:F=[],L.value=F}catch(f){l.value=f.message||"Failed to load location tree",W.error("Failed to load location tree")}finally{r.value=!1}},$=async()=>{var h,f;x.value=!0;try{const F=await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[3]});if(I.value=((h=F.data)==null?void 0:h.content)||[],_.parentId){const N=(((f=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[5],parent_ids:[_.parentId]})).data)==null?void 0:f.content)||[]).map(k=>k.sequence_order).filter(k=>k!=null&&!isNaN(k)),w=(N.length?Math.max(...N):0)+1;R.sequenceOrder=Math.min(w,N.length+1)}}finally{x.value=!1}},ie=te(()=>{const h=p.value.length+1;return Math.max(h,R.sequenceOrder||1)}),se=h=>{y.value=h,R.imageList=h},de=h=>{m.value=h,R.explodedViewDrawing=h},re=h=>{O.value=h,R.filesList=h},j=async()=>{try{let h=[],f=[],F=[];return R.imageList.length>0&&(h=(await ce(R.imageList)).data.uploadedFiles||[],R.imageList=h.map(N=>N.url)),R.explodedViewDrawing.length>0&&(f=(await ce(R.explodedViewDrawing)).data.uploadedFiles||[],R.explodedViewDrawing=f.map(N=>N.url)),R.filesList.length>0&&(F=(await ce(R.filesList)).data.uploadedFiles||[],R.filesList=F.map(N=>N.url)),{upImages:h,upFiles:F}}catch{throw new Error("File upload failed")}},Z=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{(R.imageList.length>0||R.filesList.length>0||R.explodedViewDrawing.length>0)&&await j();const f={name:R.name,code:R.code,description:R.description,serial_number:R.serialNumber,plc:R.plc,power:R.power,installation_date:R.installationDate?`${R.installationDate}T00:00:00Z`:null,node_type_id:5,parent_id:R.parentId,location_id:R.selectedLocationId,sequence_order:Number(R.sequenceOrder),image_list:R.imageList,exploded_view_drawing:R.explodedViewDrawing,file_list:R.filesList},F=await Ie(f);W.success("Equipment created successfully!"),q(),P("close"),P("success",F.data)}catch(f){W.error(`Failed to create equipment: ${f.message}`)}finally{C.value=!1}}},Y=()=>{e.value&&e.value.resetFields(),Object.assign(R,{name:"",code:"",description:"",serialNumber:"",plc:"",power:null,installationDate:null,parentId:_.parentId,selectedLocationId:null,equipmentId:_.lockProductionLine?_.productionLineId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]}),g.value=null,y.value=[],m.value=[],O.value=[]},q=()=>{Y(),$()},T=()=>{q(),P("close"),P("cancel")};le(()=>{_.lockProductionLine&&(R.equipmentId=_.productionLineId),z(),$()});const S={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,productionLines:I,productionLineLoading:x,sequenceOrders:p,uploadedImages:y,uploadedFiles:O,uploadedExplosionView:m,props:_,emit:P,validatePowerInteger:v,formData:R,treeProps:K,filterNode:ee,handleNodeClick:M,fetchLocationTree:z,fetchProductionLines:$,maxSequenceOrder:ie,handleImageListUpdate:se,handleExplosionViewUpdate:de,handleFilesListUpdate:re,uploadFilesToServer:j,handleConfirm:Z,resetFormData:Y,resetForm:q,handleCancel:T,ref:o,reactive:me,onMounted:le,watch:H,computed:te,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get createNewNode(){return Ie},get uploadMultipleToMinio(){return ce},FileUploadMultiple:Ee};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},yo={class:"add-new-t2"},ho={class:"general-information"},wo={class:"tree-container"},Do={key:0,class:"tree-loading"},qo={key:1,class:"tree-error"},Lo={class:"file-upload"},xo={class:"file-upload"},Io={class:"dialog-footer"};function ko(A,a,c,e,D,L){const r=i("el-input"),l=i("el-form-item"),s=i("el-col"),u=i("el-row"),g=i("el-input-number"),C=i("el-date-picker"),I=i("el-icon"),x=i("el-alert"),p=i("el-tree"),y=i("el-option"),O=i("el-select"),m=i("el-form"),_=i("el-divider"),P=i("el-button");return d(),V("div",yo,[E("div",ho,[t(m,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Equipment Name",prop:"name",rules:[{required:!0,message:"Equipment name is required"},{type:"string",message:"Equipment name must be a string"}]},{default:n(()=>[t(r,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=v=>e.formData.name=v)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Equipment Code",prop:"code",rules:[{required:!0,message:"Equipment code is required"}]},{default:n(()=>[t(r,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=v=>e.formData.code=v)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Model",prop:"serialNumber"},{default:n(()=>[t(r,{modelValue:e.formData.serialNumber,"onUpdate:modelValue":a[2]||(a[2]=v=>e.formData.serialNumber=v),placeholder:"Enter equipment model"},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"PLC",prop:"plc"},{default:n(()=>[t(r,{modelValue:e.formData.plc,"onUpdate:modelValue":a[3]||(a[3]=v=>e.formData.plc=v),placeholder:"Enter PLC information"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Power",prop:"power",rules:[{type:"number",message:"Power must be a number",transform:v=>Number(v)},{validator:e.validatePowerInteger,trigger:"blur"}]},{default:n(()=>[t(g,{modelValue:e.formData.power,"onUpdate:modelValue":a[4]||(a[4]=v=>e.formData.power=v),placeholder:"Enter power specifications",min:0,precision:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Install Date",prop:"installationDate"},{default:n(()=>[t(C,{modelValue:e.formData.installationDate,"onUpdate:modelValue":a[5]||(a[5]=v=>e.formData.installationDate=v),type:"date",placeholder:"Select installation date",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(l,{label:"Description",prop:"description"},{default:n(()=>[t(r,{modelValue:e.formData.description,"onUpdate:modelValue":a[6]||(a[6]=v=>e.formData.description=v),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),X(" Location "),t(l,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",wo,[t(r,{modelValue:e.filterText,"onUpdate:modelValue":a[7]||(a[7]=v=>e.filterText=v),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",Do,[t(I,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[10]||(a[10]=U(" Loading locations... "))])):e.error?(d(),V("div",qo,[t(x,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(p,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),X(" Production Line (T1) - prefilled & locked when lockProductionLine is true "),t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Production Line",prop:"equipmentId",rules:[{required:!0,message:"Production Line name is required"}]},{default:n(()=>[t(O,{modelValue:e.formData.equipmentId,"onUpdate:modelValue":a[8]||(a[8]=v=>e.formData.equipmentId=v),placeholder:"Select production line",filterable:!c.lockProductionLine,clearable:!c.lockProductionLine,disabled:c.lockProductionLine,style:{width:"100%"},loading:e.productionLineLoading},{default:n(()=>[(d(!0),V(oe,null,ue(e.productionLines,v=>(d(),G(y,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","filterable","clearable","disabled","loading"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:v=>Number(v)}]},{default:n(()=>[t(g,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[9]||(a[9]=v=>e.formData.sequenceOrder=v),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label-position","model"]),t(_),E("div",Lo,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleExplosionViewUpdate,"image-label":"Upload Exploded View","upload-type":"images","max-images":1})]),t(_),E("div",xo,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"upload-type":"both","max-images":5,"max-files":5})]),E("div",Io,[t(P,{onClick:e.handleCancel},{default:n(()=>a[11]||(a[11]=[U("Cancel")])),_:1,__:[11]}),t(P,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[12]||(a[12]=[U("Confirm")])),_:1,__:[12]},8,["loading"])])])])}const st=ne(bo,[["render",ko],["__scopeId","data-v-944cb60c"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/components/AddEquipment.vue"]]),So={__name:"EditEquipment",props:{equipmentId:{type:[Number,String],required:!0}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o(!1),p=o([]),y=o(!1),O=o([]),m=o([]),_=o([]),P=o([]),v=o([]),R=o([]),K=A,ee=c,M=(w,k,B)=>{k!=null&&k!==""&&(!Number.isInteger(k)||k<0)?B(new Error("Power must be a positive integer")):B()},z=me({name:"",code:"",description:"",serialNumber:"",plc:"",power:null,installationDate:null,parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),$={children:"children",label:"name"},ie=()=>{O.value=[],m.value=[],_.value=[],P.value=[],v.value=[],R.value=[]},se=async w=>{if(!(!u.value||!w))try{if(await ae(),L.value.length===0)return;u.value.setCurrentKey(w);const k=u.value.getNode(w);if(!k)return;let B=k.parent;for(;B&&B.key!==void 0;)B.expanded=!0,B=B.parent;z.selectedLocationId=w,e.value&&(await ae(),e.value.clearValidate("selectedLocationId"))}catch{}},de=w=>{if(!w)return null;try{const k=new Date(w);return isNaN(k.getTime())?null:k.toISOString().split("T")[0]}catch{return null}},re=async()=>{var w;if(K.equipmentId){y.value=!0;try{const B=(await _e(K.equipmentId)).data,Q=B.data||B;return ie(),z.name=Q.name||"",z.code=Q.code||"",z.description=Q.description||"",z.serialNumber=Q.serial_number||"",z.plc=Q.plc||"",z.power=Q.power||null,z.installationDate=de(Q.installation_date),z.parentId=Q.parent_id||Q.parent_equipment_node_id,z.selectedLocationId=Q.location_id,z.sequenceOrder=Q.sequence_order||1,z.imageList=Q.image_list||[],z.filesList=Q.file_list||[],g.value=((w=Q.location)==null?void 0:w.id)||Q.location_id,Q}catch(k){throw W.error("Failed to load equipment details"),k}finally{y.value=!1}}},j=async()=>{var w;r.value=!0,l.value=null;try{const k=await be();let B;return(w=k.data)!=null&&w.data?B=k.data.data:Array.isArray(k.data)?B=k.data:k.data?B=[k.data]:B=[],L.value=B,B}catch(k){throw l.value=k.message||"Failed to load location tree",W.error("Failed to load location tree"),k}finally{r.value=!1}},Z=async w=>{var B;if(!w)return;const k=((B=w.location)==null?void 0:B.id)||w.location_id;k&&(await ae(),u.value&&L.value.length>0&&await se(k))},Y=(w,k)=>{switch(w){case"imageList":O.value=k;break;case"filesList":m.value=k;break;case"removeImage":_.value=k;break;case"removeFile":P.value=k;break}},q=async()=>{var w,k;try{if(O.value.length>0){const B=await ce(O.value);v.value=((w=B.data.uploadedFiles)==null?void 0:w.map(Q=>Q.url))||[]}if(m.value.length>0){const B=await ce(m.value);R.value=((k=B.data.uploadedFiles)==null?void 0:k.map(Q=>Q.url))||[]}}catch{throw new Error("File upload failed")}},T=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{let k=z.imageList||[],B=z.filesList||[];(O.value.length>0||m.value.length>0)&&await q(),k=[...k||[],...v.value||[]],B=[...B||[],...R.value||[]],k=k.filter(pe=>!_.value.includes(pe)),B=B.filter(pe=>!P.value.includes(pe));const Q={name:z.name,code:z.code,description:z.description,serial_number:z.serialNumber,plc:z.plc,power:z.power,installation_date:z.installationDate?`${z.installationDate}T00:00:00Z`:null,parent_id:z.parentId,location_id:z.selectedLocationId,sequence_order:Number(z.sequenceOrder),image_list:k,file_list:B},ge=await ke(K.equipmentId,Q);if(W.success("Equipment updated successfully!"),_.value.length>0||P.value.length>0){const pe=[..._.value,...P.value];Promise.resolve().then(async()=>{try{(await Te({bucketName:"sv-file-bucket",objectUrls:pe})).status===0&&W.success("Old files deleted successfully!")}catch{}})}ie(),ee("close"),ee("success",ge.data)}catch(k){W.error(`Failed to update equipment: ${k.message}`)}finally{C.value=!1}}},S=()=>{ie(),ee("close"),ee("cancel")},h=async()=>{var w,k;if(z.parentId){x.value=!0;try{const Q=((w=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[4]})).data)==null?void 0:w.content)||[];I.value=Q;const ye=(((k=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[5],parent_ids:[z.parentId]})).data)==null?void 0:k.content)||[]).filter(he=>he.id!==parseInt(K.equipmentId)).map(he=>he.sequence_order).filter(he=>he!=null&&!isNaN(he));p.value=ye}catch{W.error("Failed to load production lines")}finally{x.value=!1}}},f=te(()=>{const w=p.value.length+1;return Math.max(w,z.sequenceOrder||1)});H(s,w=>{var k;(k=u.value)==null||k.filter(w)});const F=(w,k)=>w?k.name.toLowerCase().includes(w.toLowerCase()):!0,b=async(w,k)=>{g.value=w.id,z.selectedLocationId=w.id,await ae(),e.value&&e.value.validateField("selectedLocationId")};H(()=>z.parentId,(w,k)=>{w&&w!==k&&h()},{immediate:!1}),H(L,async w=>{w.length>0&&g.value&&(await ae(),await se(g.value))}),H(()=>z.selectedLocationId,async(w,k)=>{w&&w!==k&&(g.value=w,L.value.length>0&&(await ae(),await se(w)))}),le(async()=>{try{ie();const[w]=await Promise.all([re(),j()]);w&&(await Z(w),(w.parent_id||w.parent_equipment_node_id)&&await h())}catch{}}),H(()=>K.equipmentId,(w,k)=>{w&&w!==k&&(ie(),Object.assign(z,{name:"",code:"",description:"",serialNumber:"",plc:"",power:null,installationDate:null,parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),g.value=null,re())},{immediate:!1});const N={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,productionLines:I,productionLineLoading:x,sequenceOrders:p,dataLoading:y,newImages:O,newFiles:m,removedImages:_,removedFiles:P,newImageUrls:v,newFileUrls:R,props:K,emit:ee,validatePowerInteger:M,formData:z,treeProps:$,resetFileState:ie,setCurrentTreeNode:se,formatDateForDisplay:de,fetchEquipmentData:re,fetchLocationTree:j,initializeTreeSelection:Z,handleFileUpdate:Y,uploadFilesToServer:q,handleConfirm:T,handleCancel:S,fetchProductionLines:h,maxSequenceOrder:f,filterNode:F,handleNodeClick:b,ref:o,reactive:me,onMounted:le,watch:H,computed:te,nextTick:ae,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get editEquipmentNode(){return ke},get getEquipmentById(){return _e},get uploadMultipleToMinio(){return ce},get deleteObjectList(){return Te},FileUploadMultiple:Ee};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},To={class:"edit-equipment"},Co={key:0,class:"loading-container"},Eo={key:1,class:"general-information"},Po={class:"tree-container"},No={key:0,class:"tree-loading"},Vo={key:1,class:"tree-error"},Fo={class:"file-upload"},Oo={class:"dialog-footer"};function Ao(A,a,c,e,D,L){const r=i("el-icon"),l=i("el-input"),s=i("el-form-item"),u=i("el-col"),g=i("el-row"),C=i("el-input-number"),I=i("el-date-picker"),x=i("el-alert"),p=i("el-tree"),y=i("el-option"),O=i("el-select"),m=i("el-form"),_=i("el-divider"),P=i("el-button");return d(),V("div",To,[e.dataLoading?(d(),V("div",Co,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[14]||(a[14]=U(" Loading equipment data... "))])):(d(),V("div",Eo,[t(m,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Equipment Name",prop:"name",rules:[{required:!0,message:"Equipment name is required"},{type:"string",message:"Equipment name must be a string"}]},{default:n(()=>[t(l,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=v=>e.formData.name=v)},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Equipment Code",prop:"code",rules:[{required:!0,message:"Equipment code is required"}]},{default:n(()=>[t(l,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=v=>e.formData.code=v)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Model",prop:"serialNumber"},{default:n(()=>[t(l,{modelValue:e.formData.serialNumber,"onUpdate:modelValue":a[2]||(a[2]=v=>e.formData.serialNumber=v),placeholder:"Enter equipment model"},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"PLC",prop:"plc"},{default:n(()=>[t(l,{modelValue:e.formData.plc,"onUpdate:modelValue":a[3]||(a[3]=v=>e.formData.plc=v),placeholder:"Enter PLC information"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Power",prop:"power",rules:[{type:"number",message:"Power must be a number",transform:v=>Number(v)},{validator:e.validatePowerInteger,trigger:"blur"}]},{default:n(()=>[t(C,{modelValue:e.formData.power,"onUpdate:modelValue":a[4]||(a[4]=v=>e.formData.power=v),placeholder:"Enter power specifications",min:0,precision:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Install Date",prop:"installationDate"},{default:n(()=>[t(I,{modelValue:e.formData.installationDate,"onUpdate:modelValue":a[5]||(a[5]=v=>e.formData.installationDate=v),type:"date",placeholder:"Select installation date",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(s,{label:"Description",prop:"description"},{default:n(()=>[t(l,{modelValue:e.formData.description,"onUpdate:modelValue":a[6]||(a[6]=v=>e.formData.description=v),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(s,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",Po,[t(l,{modelValue:e.filterText,"onUpdate:modelValue":a[7]||(a[7]=v=>e.filterText=v),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",No,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[15]||(a[15]=U(" Loading locations... "))])):e.error?(d(),V("div",Vo,[t(x,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(p,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Production Line",prop:"parentId",rules:[{required:!0,message:"Production Line is required"}]},{default:n(()=>[t(O,{modelValue:e.formData.parentId,"onUpdate:modelValue":a[8]||(a[8]=v=>e.formData.parentId=v),placeholder:"Select production line",filterable:"",clearable:"",style:{width:"100%"},loading:e.productionLineLoading},{default:n(()=>[(d(!0),V(oe,null,ue(e.productionLines,v=>(d(),G(y,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:v=>Number(v)}]},{default:n(()=>[t(C,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[9]||(a[9]=v=>e.formData.sequenceOrder=v),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label-position","model"]),t(_),E("div",Fo,[t(e.FileUploadMultiple,{"onUpdate:imageList":a[10]||(a[10]=v=>e.handleFileUpdate("imageList",v)),"onUpdate:filesList":a[11]||(a[11]=v=>e.handleFileUpdate("filesList",v)),"onUpdate:removedExistingImages":a[12]||(a[12]=v=>e.handleFileUpdate("removeImage",v)),"onUpdate:removedExistingFiles":a[13]||(a[13]=v=>e.handleFileUpdate("removeFile",v)),"upload-type":"both","max-images":5,"max-files":5,existingImageList:e.formData.imageList,existingFileList:e.formData.filesList},null,8,["existingImageList","existingFileList"])]),E("div",Oo,[t(P,{onClick:e.handleCancel},{default:n(()=>a[16]||(a[16]=[U("Cancel")])),_:1,__:[16]}),t(P,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[17]||(a[17]=[U("Update")])),_:1,__:[17]},8,["loading"])])]))])}const Uo=ne(So,[["render",Ao],["__scopeId","data-v-cfa257e8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/components/EditEquipment.vue"]]),Ro={__name:"index",props:{node:{type:Object,required:!0},breadcrumb:{type:Array,default:()=>[]}},emits:["refresh-tree","refresh-data","after-delete"],setup(A,{expose:a,emit:c}){const e=A,D=c,L=te(()=>{const M=e.breadcrumb.filter((z,$)=>$>0&&z&&typeof z=="object"&&"id"in z);return M.length>=2?M[M.length-2].id:null}),r=o("details"),l=o(!1),s=o(!1),u=o(!1),g=o(0),C=o(0);console.log(e.node.id),console.log(e.breadcrumb);const I=()=>{l.value=!1},x=()=>{C.value+=1,s.value=!0},p=()=>{s.value=!1},y=()=>{u.value=!0},O=()=>{u.value=!1},m=M=>{M()},_=M=>{I(),D("refresh-tree")},P=M=>{p(),D("refresh-tree"),setTimeout(()=>{v()},100)},v=()=>{g.value+=1,D("refresh-data",e.node.id)},R=M=>{O(),D("refresh-tree"),D("after-delete",{parentId:L.value,deletedId:M})},K=()=>{D("refresh-tree")};a({openDeactivateDialog:y});const ee={props:e,emit:D,parentId:L,activeTab:r,showAddDialog:l,showEditDialog:s,showDeactivateDialog:u,refreshKey:g,editDialogKey:C,closeAddDialog:I,openEditDialog:x,closeEditDialog:p,openDeactivateDialog:y,closeDeactivateDialog:O,handleCloseDialog:m,handleAddSuccess:_,handleEditSuccess:P,refreshViewData:v,handleDeleteSuccess:R,handleRefreshTree:K,ref:o,computed:te,get MoreFilled(){return Re},EquipmentDetailsTab:qn,SubItemsTab:An,WorkOrderTab:zn,TasksTab:Yn,PersonnelTab:eo,DocumentsLoadTab:io,DocumentsViewTab:vo,AddEquipment:st,EditEquipment:Uo,DeactivateNode:Be};return Object.defineProperty(ee,"__isScriptSetup",{enumerable:!1,value:!0}),ee}},Mo={class:"t3-main-container"},jo={class:"t3-main-header"},zo={class:"t3-sub-header"},Go={class:"t3-main-details"};function Bo(A,a,c,e,D,L){const r=i("el-breadcrumb-item"),l=i("el-breadcrumb"),s=i("el-icon"),u=i("el-dropdown-item"),g=i("el-dropdown-menu"),C=i("el-dropdown"),I=i("el-tab-pane"),x=i("el-tabs"),p=i("el-dialog");return d(),V("div",Mo,[E("div",jo,[t(l,{separator:"/"},{default:n(()=>[(d(!0),V(oe,null,ue(c.breadcrumb,(y,O)=>(d(),G(r,{key:O},{default:n(()=>[U(J(y.label),1)]),_:2},1024))),128))]),_:1}),E("div",zo,[E("h1",null,J(c.node.label),1),t(C,{class:"kebab-dropdown"},{dropdown:n(()=>[t(g,null,{default:n(()=>[t(u,{onClick:e.openEditDialog},{default:n(()=>a[4]||(a[4]=[U("Edit Tier 3")])),_:1,__:[4]})]),_:1})]),default:n(()=>[t(s,{class:"kebab-icon"},{default:n(()=>[t(e.MoreFilled)]),_:1})]),_:1})])]),E("div",Go,[(d(),G(x,{modelValue:e.activeTab,"onUpdate:modelValue":a[0]||(a[0]=y=>e.activeTab=y),type:"border-card",key:e.refreshKey},{default:n(()=>[t(I,{label:"Details",name:"details"},{default:n(()=>[(d(),G(e.EquipmentDetailsTab,{equipmentId:e.props.node.id,key:`details-${e.refreshKey}`},null,8,["equipmentId"]))]),_:1}),t(I,{label:"Sub Items",name:"subItems"},{default:n(()=>[(d(),G(e.SubItemsTab,{key:`subitems-${e.refreshKey}`}))]),_:1}),t(I,{label:"Work Orders",name:"workOrders"},{default:n(()=>[(d(),G(e.WorkOrderTab,{key:`workorders-${e.refreshKey}`}))]),_:1}),t(I,{label:"Tasks",name:"tasks"},{default:n(()=>[(d(),G(e.TasksTab,{key:`tasks-${e.refreshKey}`}))]),_:1}),t(I,{label:"Personnel",name:"personnel"},{default:n(()=>[(d(),G(e.PersonnelTab,{key:`personnel-${e.refreshKey}`}))]),_:1}),t(I,{label:"Documents Load",name:"documentsLoad"},{default:n(()=>[(d(),G(e.DocumentsLoadTab,{key:`documentsLoad-${e.refreshKey}`}))]),_:1}),t(I,{label:"Documents View",name:"documentsView"},{default:n(()=>[(d(),G(e.DocumentsViewTab,{key:`documentsView-${e.refreshKey}`}))]),_:1})]),_:1},8,["modelValue"]))]),t(p,{modelValue:e.showAddDialog,"onUpdate:modelValue":a[1]||(a[1]=y=>e.showAddDialog=y),title:"Add New Tier 3",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showAddDialog?(d(),G(e.AddEquipment,{key:0,onClose:e.closeAddDialog,onSuccess:e.handleAddSuccess,parentId:e.parentId},null,8,["parentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),t(p,{modelValue:e.showEditDialog,"onUpdate:modelValue":a[2]||(a[2]=y=>e.showEditDialog=y),title:"Edit Tier 3",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showEditDialog?(d(),G(e.EditEquipment,{key:`edit-${e.props.node.id}-${e.editDialogKey}`,onClose:e.closeEditDialog,onSuccess:e.handleEditSuccess,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),t(p,{modelValue:e.showDeactivateDialog,"onUpdate:modelValue":a[3]||(a[3]=y=>e.showDeactivateDialog=y),title:"Delete Tier 3",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showDeactivateDialog?(d(),G(e.DeactivateNode,{key:0,onClose:e.closeDeactivateDialog,onSuccess:e.handleDeleteSuccess,onRefreshTree:e.handleRefreshTree,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"])])}const Ko=ne(Ro,[["render",Bo],["__scopeId","data-v-c1877247"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/equipment/index.vue"]]),Yo={__name:"Details",props:{equipmentId:{type:Number}},setup(A,{expose:a}){a();const c=A,e=o(null),D=o([]),L=o(!1),r=o(null),l=x=>!x||!Array.isArray(x)?[]:x.map((p,y)=>{const O=p.split("/"),_=(O[O.length-1]||`file_${y+1}`).replace(/\d{17}/,"");return{id:y,name:decodeURIComponent(_),url:p,type:C(_)}}),s=async()=>{var x;if(c.equipmentId)try{L.value=!0,r.value=null;const p=await _e(c.equipmentId);e.value=p.data,e.value.file_list&&Array.isArray(e.value.file_list)&&(e.value.file_list=l(e.value.file_list)),(x=e.value.location)!=null&&x.id&&typeof e.value.location.id!="object"&&e.value.location.status!==0?await u(e.value.location.id):D.value=[]}catch(p){r.value=p.message||"Failed to fetch equipment data"}finally{L.value=!1}},u=async x=>{try{const p=await Se(x);D.value=p.data||[]}catch{D.value=[]}};function g(x){switch(x==null?void 0:x.toLowerCase()){case"image":case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return De;case"video":case"mp4":case"avi":case"mov":case"wmv":case"flv":return xe;case"audio":case"mp3":case"wav":case"flac":case"aac":return Le;case"pdf":case"document":case"doc":case"docx":case"txt":case"rtf":return we;case"download":case"zip":case"rar":case"7z":return qe;default:return we}}function C(x){var P;if(!x)return"document";const p=(P=x.split(".").pop())==null?void 0:P.toLowerCase(),y=["jpg","jpeg","png","gif","bmp","webp","svg"],O=["mp4","avi","mov","wmv","flv","mkv"],m=["mp3","wav","flac","aac","ogg"],_=["zip","rar","7z","tar","gz"];return y.includes(p)?"image":O.includes(p)?"video":m.includes(p)?"audio":_.includes(p)?"download":"document"}le(()=>{s()}),H(()=>c.equipmentId,x=>{x&&s()});const I={props:c,equipmentData:e,locationPath:D,loading:L,error:r,parseFileList:l,fetchEquipmentData:s,fetchLocationPath:u,getFileIcon:g,getFileTypeFromName:C,ref:o,onMounted:le,watch:H,get ArrowRight(){return Ue},get Document(){return we},get Picture(){return De},get VideoCamera(){return xe},get Microphone(){return Le},get Download(){return qe},get getEquipmentById(){return _e},get getLocationPathById(){return Se}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}},Qo={class:"t4-details"},Wo={class:"general-information"},Ho={class:"location"},Zo={class:"image"},Jo={key:0,class:"image-gallery"},Xo={key:1,class:"no-images"},$o={class:"files"},el={class:"file-list"},tl={key:0},al={key:1,class:"no-files"},nl={key:1,class:"loading-state","element-loading-text":"Loading equipment details..."},ol={key:2,class:"error-state"},ll={key:3,class:"no-data"};function il(A,a,c,e,D,L){const r=i("el-descriptions-item"),l=i("el-descriptions"),s=i("el-divider"),u=i("el-breadcrumb-item"),g=i("el-breadcrumb"),C=i("el-image"),I=i("el-text"),x=i("el-link"),p=i("el-alert"),y=i("el-empty"),O=je("loading");return d(),V("div",Qo,[e.equipmentData?(d(),V(oe,{key:0},[E("div",Wo,[t(l,{column:3,direction:"vertical"},{default:n(()=>[t(r,{label:"Name"},{default:n(()=>[U(J(e.equipmentData.name),1)]),_:1}),t(r,{label:"Code"},{default:n(()=>[U(J(e.equipmentData.code),1)]),_:1}),t(r,{label:"Model"},{default:n(()=>[U(J(e.equipmentData.model||e.equipmentData.serial_number||"N/A"),1)]),_:1}),t(r,{label:"Description",class:"highlighted-item"},{default:n(()=>[U(J(e.equipmentData.description||"No description available"),1)]),_:1})]),_:1})]),t(s),E("div",Ho,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Location Path"},{default:n(()=>[t(g,{"separator-icon":e.ArrowRight},{default:n(()=>[(d(!0),V(oe,null,ue(e.locationPath,m=>(d(),G(u,{key:m.id},{default:n(()=>[U(J(m.name),1)]),_:2},1024))),128)),e.locationPath.length===0?(d(),G(u,{key:0},{default:n(()=>a[0]||(a[0]=[U(" No location path available ")])),_:1,__:[0]})):X("v-if",!0)]),_:1},8,["separator-icon"])]),_:1})]),_:1})]),t(s),E("div",Zo,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Images"},{default:n(()=>[e.equipmentData.image_list&&e.equipmentData.image_list.length>0?(d(),V("div",Jo,[(d(!0),V(oe,null,ue(e.equipmentData.image_list,(m,_)=>(d(),G(C,{key:_,src:m,"preview-src-list":e.equipmentData.image_list,fit:"cover",class:"equipment-image"},null,8,["src","preview-src-list"]))),128))])):(d(),V("div",Xo,[t(I,null,{default:n(()=>a[1]||(a[1]=[U("No equipment images available")])),_:1,__:[1]})]))]),_:1})]),_:1})]),t(s),E("div",$o,[t(l,{column:1,direction:"vertical"},{default:n(()=>[t(r,{label:"Files"},{default:n(()=>[E("div",el,[e.equipmentData.file_list&&e.equipmentData.file_list.length>0?(d(),V("div",tl,[(d(!0),V(oe,null,ue(e.equipmentData.file_list,m=>(d(),V("div",{key:m.id||m.name,class:"file-item"},[t(x,{href:m.url,target:"_blank",icon:e.getFileIcon(m.type),class:"file-link"},{default:n(()=>[U(J(m.name),1)]),_:2},1032,["href","icon"])]))),128))])):(d(),V("div",al,[t(I,null,{default:n(()=>a[2]||(a[2]=[U(" No files available ")])),_:1,__:[2]})]))])]),_:1})]),_:1})])],64)):e.loading?ze((d(),V("div",nl,a[3]||(a[3]=[E("div",{style:{height:"200px"}},null,-1)]))),[[O,!0]]):e.error?(d(),V("div",ol,[t(p,{type:"error",title:e.error,"show-icon":""},null,8,["title"])])):(d(),V("div",ll,[t(y,{description:"No equipment data found"})]))])}const rl=ne(Yo,[["render",il],["__scopeId","data-v-5cdecd22"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/Details.vue"]]),sl={__name:"SubItems",props:{imageUrl:{type:String,default:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},imageAlt:{type:String,default:"Equipment image"}},setup(A,{expose:a}){a();const c=A,e=o(null),D=o([{id:1,title:"HYDRAULIC PUMP SEAL KIT",partNumber:"HP001",deviceTag:"HP001",deviceTagPositionCode:"1",deviceQuantity:"1",suggestedServiceDays:"2 Days",estimatedServiceDays:"1 Day",autoTriggerCycle:"No",imageUrl:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},{id:2,title:"ROLLER BEARING 6203-2RS",partNumber:"RB002",deviceTag:"RB002",deviceTagPositionCode:"3",deviceQuantity:"2",suggestedServiceDays:"3 Days",estimatedServiceDays:"2 Days",autoTriggerCycle:"Yes",imageUrl:null},{id:3,title:"DRIVE CHAIN 40SS-316L",partNumber:"DC003",deviceTag:"DC003",deviceTagPositionCode:"2",deviceQuantity:"1",suggestedServiceDays:"5 Days",estimatedServiceDays:"3 Days",autoTriggerCycle:"No",imageUrl:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcjpeg.jpeg"},{id:4,title:"PNEUMATIC CYLINDER SEAL",partNumber:"PC004",deviceTag:"PC004",deviceTagPositionCode:"4",deviceQuantity:"1",suggestedServiceDays:"1 Day",estimatedServiceDays:"1 Day",autoTriggerCycle:"No",imageUrl:null},{id:5,title:"MOTOR COUPLING ASSEMBLY",partNumber:"MC005",deviceTag:"MC005",deviceTagPositionCode:"5",deviceQuantity:"1",suggestedServiceDays:"4 Days",estimatedServiceDays:"3 Days",autoTriggerCycle:"Yes",imageUrl:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},{id:6,title:"CONVEYOR BELT SECTION",partNumber:"CB006",deviceTag:"CB006",deviceTagPositionCode:"6",deviceQuantity:"1",suggestedServiceDays:"7 Days",estimatedServiceDays:"5 Days",autoTriggerCycle:"No",imageUrl:null},{id:7,title:"LIMIT SWITCH ASSEMBLY",partNumber:"LS007",deviceTag:"LS007",deviceTagPositionCode:"7",deviceQuantity:"2",suggestedServiceDays:"2 Days",estimatedServiceDays:"1 Day",autoTriggerCycle:"Yes",imageUrl:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcjpeg.jpeg"},{id:8,title:"PRESSURE RELIEF VALVE",partNumber:"PRV008",deviceTag:"PRV008",deviceTagPositionCode:"8",deviceQuantity:"1",suggestedServiceDays:"3 Days",estimatedServiceDays:"2 Days",autoTriggerCycle:"No",imageUrl:null},{id:9,title:"GEARBOX OIL SEAL",partNumber:"GOS009",deviceTag:"GOS009",deviceTagPositionCode:"9",deviceQuantity:"1",suggestedServiceDays:"6 Days",estimatedServiceDays:"4 Days",autoTriggerCycle:"Yes",imageUrl:"https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg"},{id:10,title:"TEMPERATURE SENSOR PROBE",partNumber:"TSP010",deviceTag:"TSP010",deviceTagPositionCode:"10",deviceQuantity:"1",suggestedServiceDays:"1 Day",estimatedServiceDays:"1 Day",autoTriggerCycle:"No",imageUrl:null}]),L=me({page:1,limit:4});function r(u){e.value=u,console.log("Selected spare part:",e.value)}function l(u){L.page=u,console.log("Spare parts current page changed to:",u)}const s={props:c,selectedData:e,sparePartsData:D,listQuery:L,handleRequestData:r,handleCurrentChange:l,ref:o,reactive:me,MaintenanceCardTable:Ge};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}},dl={class:"sub-items"},cl={class:"image-container"},ul={class:"spare-parts-table"};function ml(A,a,c,e,D,L){const r=i("el-image");return d(),V("div",dl,[E("div",cl,[t(r,{src:e.props.imageUrl,alt:e.props.imageAlt,fit:"contain","preview-src-list":[e.props.imageUrl],class:"equipment-image"},null,8,["src","alt","preview-src-list"])]),E("div",ul,[t(e.MaintenanceCardTable,{items:e.sparePartsData,pageSize:4,module:5,onRequestData:e.handleRequestData,height:"400px",totalItems:e.sparePartsData.length,handleCurrentChange:e.handleCurrentChange,currentPage:e.listQuery.page},null,8,["items","totalItems","currentPage"])])])}const pl=ne(sl,[["render",ml],["__scopeId","data-v-dd5421bc"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/SubItems.vue"]]),fl={__name:"MaintenanceHistory",setup(A,{expose:a}){a();const c=o(""),e=o(1),D=o(15),L=o([{locationCode:"A-101",deviceTag:"CONV-001",sparePart:"Belt Drive Motor",vendorSuggestedDays:90,estimatedServiceDays:85,previousRuntime:"2,340 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-08-15"},{locationCode:"B-205",deviceTag:"PUMP-003",sparePart:"Impeller Assembly",vendorSuggestedDays:120,estimatedServiceDays:110,previousRuntime:"1,890 hrs",maintenanceType:"Predictive",maintenanceDate:"2025-08-22"},{locationCode:"C-150",deviceTag:"FAN-007",sparePart:"Bearing Set",vendorSuggestedDays:180,estimatedServiceDays:175,previousRuntime:"4,200 hrs",maintenanceType:"Corrective",maintenanceDate:"2025-09-05"},{locationCode:"A-102",deviceTag:"VALVE-012",sparePart:"Actuator Seal",vendorSuggestedDays:365,estimatedServiceDays:350,previousRuntime:"8,760 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-09-12"},{locationCode:"D-301",deviceTag:"COMP-005",sparePart:"Cylinder Head",vendorSuggestedDays:730,estimatedServiceDays:700,previousRuntime:"15,600 hrs",maintenanceType:"Overhaul",maintenanceDate:"2025-10-01"},{locationCode:"B-210",deviceTag:"HEAT-009",sparePart:"Heating Element",vendorSuggestedDays:45,estimatedServiceDays:40,previousRuntime:"960 hrs",maintenanceType:"Emergency",maintenanceDate:"2025-07-28"},{locationCode:"E-405",deviceTag:"SENS-014",sparePart:"Temperature Probe",vendorSuggestedDays:60,estimatedServiceDays:55,previousRuntime:"1,320 hrs",maintenanceType:"Predictive",maintenanceDate:"2025-08-10"},{locationCode:"A-103",deviceTag:"GEAR-002",sparePart:"Gear Assembly",vendorSuggestedDays:540,estimatedServiceDays:520,previousRuntime:"12,000 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-11-15"},{locationCode:"F-502",deviceTag:"CTRL-018",sparePart:"Control Board",vendorSuggestedDays:1095,estimatedServiceDays:1e3,previousRuntime:"26,280 hrs",maintenanceType:"Upgrade",maintenanceDate:"2025-12-20"},{locationCode:"C-155",deviceTag:"TANK-006",sparePart:"Pressure Relief Valve",vendorSuggestedDays:365,estimatedServiceDays:360,previousRuntime:"8,400 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-09-18"},{locationCode:"B-220",deviceTag:"FILTER-011",sparePart:"Filter Cartridge",vendorSuggestedDays:30,estimatedServiceDays:28,previousRuntime:"720 hrs",maintenanceType:"Routine",maintenanceDate:"2025-08-02"},{locationCode:"D-320",deviceTag:"MOTOR-015",sparePart:"Rotor Assembly",vendorSuggestedDays:180,estimatedServiceDays:170,previousRuntime:"4,080 hrs",maintenanceType:"Corrective",maintenanceDate:"2025-09-25"},{locationCode:"E-410",deviceTag:"TRANS-008",sparePart:"Transmission Fluid",vendorSuggestedDays:90,estimatedServiceDays:85,previousRuntime:"2,160 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-08-18"},{locationCode:"A-105",deviceTag:"BELT-004",sparePart:"Timing Belt",vendorSuggestedDays:120,estimatedServiceDays:115,previousRuntime:"2,880 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-09-08"},{locationCode:"F-510",deviceTag:"SEAL-016",sparePart:"Rubber Gasket Set",vendorSuggestedDays:240,estimatedServiceDays:230,previousRuntime:"5,520 hrs",maintenanceType:"Predictive",maintenanceDate:"2025-10-12"},{locationCode:"C-160",deviceTag:"WIRE-013",sparePart:"Electrical Harness",vendorSuggestedDays:730,estimatedServiceDays:720,previousRuntime:"17,520 hrs",maintenanceType:"Inspection",maintenanceDate:"2025-11-30"},{locationCode:"B-225",deviceTag:"LUBR-010",sparePart:"Grease Fitting",vendorSuggestedDays:15,estimatedServiceDays:14,previousRuntime:"360 hrs",maintenanceType:"Routine",maintenanceDate:"2025-07-25"},{locationCode:"D-325",deviceTag:"COOL-017",sparePart:"Cooling Fan",vendorSuggestedDays:365,estimatedServiceDays:355,previousRuntime:"8,520 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-09-22"},{locationCode:"E-415",deviceTag:"DISP-019",sparePart:"Display Panel",vendorSuggestedDays:1095,estimatedServiceDays:1080,previousRuntime:"26,040 hrs",maintenanceType:"Upgrade",maintenanceDate:"2025-12-15"},{locationCode:"A-110",deviceTag:"BRAKE-020",sparePart:"Brake Pad Set",vendorSuggestedDays:90,estimatedServiceDays:88,previousRuntime:"2,112 hrs",maintenanceType:"Preventive",maintenanceDate:"2025-08-28"}]),r=te(()=>c.value.trim()?L.value.filter(I=>I.locationCode.toLowerCase().includes(c.value.toLowerCase())||I.deviceTag.toLowerCase().includes(c.value.toLowerCase())||I.sparePart.toLowerCase().includes(c.value.toLowerCase())):L.value),l=te(()=>{const I=(e.value-1)*D.value;return r.value.slice(I,I+D.value)});function s(I){e.value=I}function u(I){return{Preventive:"success",Predictive:"primary",Corrective:"warning",Emergency:"danger",Routine:"info",Overhaul:"warning",Upgrade:"primary",Inspection:"info"}[I]||"info"}function g(I){return new Date(I).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}const C={searchQuery:c,currentPage:e,pageSize:D,tableData:L,filteredData:r,paginatedData:l,handlePageChange:s,getMaintenanceTypeColor:u,formatDate:g,ref:o,computed:te};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},_l={class:"t4-sub-items"},gl={class:"search-bar"},vl={class:"pagination-wrapper"};function bl(A,a,c,e,D,L){const r=i("el-input"),l=i("el-descriptions-item"),s=i("el-descriptions"),u=i("el-table-column"),g=i("el-tag"),C=i("el-table"),I=i("el-pagination");return d(),V(oe,null,[E("div",_l,[t(s,{column:1,direction:"vertical"},{default:n(()=>[t(l,{label:"Maintenance Schedule"},{default:n(()=>[E("div",gl,[t(r,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=x=>e.searchQuery=x),placeholder:"Search by Location Code, Device Tag, or Spare Part...",clearable:"","prefix-icon":"el-icon-search"},null,8,["modelValue"])])]),_:1})]),_:1}),t(C,{data:e.paginatedData,"default-sort":{prop:"maintenanceDate",order:"ascending"},class:"schedule-table"},{default:n(()=>[t(u,{prop:"locationCode",label:"Location Code",sortable:"",width:"120"}),t(u,{prop:"deviceTag",label:"Device Tag",sortable:"",width:"140"}),t(u,{prop:"sparePart",label:"Spare Part",sortable:"",width:"180"}),t(u,{prop:"vendorSuggestedDays",label:"Vendor Suggested Service Days",sortable:"",width:"200"}),t(u,{prop:"estimatedServiceDays",label:"Estimated Service Days",sortable:"",width:"180"}),t(u,{prop:"previousRuntime",label:"Previous Runtime",sortable:"",width:"150"}),t(u,{prop:"maintenanceType",label:"Maintenance Type",sortable:"",width:"140"},{default:n(({row:x})=>[t(g,{type:e.getMaintenanceTypeColor(x.maintenanceType),size:"small"},{default:n(()=>[U(J(x.maintenanceType),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"maintenanceDate",label:"Maintenance Date",sortable:"",width:"150"},{default:n(({row:x})=>[U(J(e.formatDate(x.maintenanceDate)),1)]),_:1})]),_:1},8,["data"])]),E("div",vl,[t(I,{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.filteredData.length,onCurrentChange:e.handlePageChange},null,8,["current-page","page-size","total"])])],64)}const yl=ne(fl,[["render",bl],["__scopeId","data-v-ef434d96"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/MaintenanceHistory.vue"]]),hl={__name:"AddSubEquipment",props:{parentId:{type:[Number,String],default:null}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o([]),p=o([]),y=o([]),O=A,m=c,_=me({name:"",code:"",model:"",description:"",parentId:O.parentId,selectedLocationId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]});H(()=>O.parentId,(q,T)=>{q!==T&&q!==null&&(_.parentId=q,z(),se())},{immediate:!1});const P={children:"children",label:"name"},v=q=>{x.value=q,_.imageList=q},R=q=>{y.value=q,_.explodedViewDrawing=q},K=q=>{p.value=q,_.filesList=q},ee=async()=>{try{let q=[],T=[],S=[];return _.imageList.length>0&&(q=(await ce(_.imageList)).data.uploadedFiles||[],_.imageList=q.map(f=>f.url)),_.explodedViewDrawing.length>0&&(T=(await ce(_.explodedViewDrawing)).data.uploadedFiles||[],_.explodedViewDrawing=T.map(f=>f.url)),_.filesList.length>0&&(S=(await ce(_.filesList)).data.uploadedFiles||[],_.filesList=S.map(f=>f.url)),{uploadedImages:q,uploadedFiles:S}}catch{throw new Error("File upload failed")}},M=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{(_.imageList.length>0||_.filesList.length>0)&&await ee();const T={name:_.name,code:_.code,serial_number:_.model,description:_.description,node_type_id:6,parent_id:_.parentId,location_id:_.selectedLocationId,sequence_order:Number(_.sequenceOrder),image_list:_.imageList,exploded_view_drawing:_.explodedViewDrawing,file_list:_.filesList},S=await Ie(T);W.success("Sub Equipment created successfully!"),$(),m("close"),m("success",S.data)}catch(T){W.error(`Failed to create sub equipment: ${T.message}`)}finally{C.value=!1}}},z=()=>{e.value&&e.value.resetFields(),Object.assign(_,{name:"",code:"",model:"",description:"",parentId:O.parentId,selectedLocationId:null,sequenceOrder:1,imageList:[],explodedViewDrawing:[],filesList:[]}),g.value=null,x.value=[],y.value=[],p.value=[]},$=()=>{z(),se()},ie=()=>{$(),m("close"),m("cancel")},se=async()=>{var q;if(O.parentId)try{const h=(((q=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[6],parent_ids:[O.parentId]})).data)==null?void 0:q.content)||[]).map(w=>w.sequence_order).filter(w=>w!=null&&!isNaN(w));I.value=h;const F=(h.length>0?Math.max(...h):0)+1,b=h.length+1,N=F>b?b:F;_.sequenceOrder=N}catch{W.error("Failed to load sequence orders")}},de=te(()=>{const q=I.value.length+1;return Math.max(q,_.sequenceOrder||1)}),re=async()=>{var q;r.value=!0,l.value=null;try{const T=await be();let S;(q=T.data)!=null&&q.data?S=T.data.data:Array.isArray(T.data)?S=T.data:T.data?S=[T.data]:S=[],L.value=S}catch(T){l.value=T.message||"Failed to load location tree",W.error("Failed to load location tree")}finally{r.value=!1}};H(s,q=>{var T;(T=u.value)==null||T.filter(q)});const j=(q,T)=>q?T.name.toLowerCase().includes(q.toLowerCase()):!0,Z=(q,T)=>{g.value=q.id,_.selectedLocationId=q.id};le(()=>{re(),O.parentId&&se()});const Y={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,sequenceOrders:I,uploadedImages:x,uploadedFiles:p,uploadedExplosionView:y,props:O,emit:m,formData:_,treeProps:P,handleImageListUpdate:v,handleExplosionViewUpdate:R,handleFilesListUpdate:K,uploadFilesToServer:ee,handleConfirm:M,resetFormData:z,resetForm:$,handleCancel:ie,fetchSequenceOrders:se,maxSequenceOrder:de,fetchLocationTree:re,filterNode:j,handleNodeClick:Z,ref:o,reactive:me,onMounted:le,watch:H,computed:te,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get createNewNode(){return Ie},get uploadMultipleToMinio(){return ce},FileUploadMultiple:Ee};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},wl={class:"add-new-t4"},Dl={class:"general-information"},ql={class:"tree-container"},Ll={key:0,class:"tree-loading"},xl={key:1,class:"tree-error"},Il={class:"file-upload"},kl={class:"file-upload"},Sl={class:"dialog-footer"};function Tl(A,a,c,e,D,L){const r=i("el-input"),l=i("el-form-item"),s=i("el-col"),u=i("el-row"),g=i("el-icon"),C=i("el-alert"),I=i("el-tree"),x=i("el-input-number"),p=i("el-form"),y=i("el-divider"),O=i("el-button");return d(),V("div",wl,[E("div",Dl,[t(p,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(u,{gutter:20},{default:n(()=>[t(s,{span:12},{default:n(()=>[t(l,{label:"Sub Equipment Name",prop:"name",rules:[{required:!0,message:"Sub Equipment name is required"},{type:"string",message:"Sub Equipment name must be a string"}]},{default:n(()=>[t(r,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=m=>e.formData.name=m)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{span:12},{default:n(()=>[t(l,{label:"Sub Equipment Code",prop:"code",rules:[{required:!0,message:"Sub Equipment code is required"}]},{default:n(()=>[t(r,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=m=>e.formData.code=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(l,{label:"Model",prop:"model"},{default:n(()=>[t(r,{modelValue:e.formData.model,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.model=m),placeholder:"Enter sub equipment model"},null,8,["modelValue"])]),_:1}),t(l,{label:"Description",prop:"description"},{default:n(()=>[t(r,{modelValue:e.formData.description,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.description=m),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(l,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",ql,[t(r,{modelValue:e.filterText,"onUpdate:modelValue":a[4]||(a[4]=m=>e.filterText=m),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",Ll,[t(g,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[6]||(a[6]=U(" Loading locations... "))])):e.error?(d(),V("div",xl,[t(C,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(I,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),t(l,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:m=>Number(m)}]},{default:n(()=>[t(x,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[5]||(a[5]=m=>e.formData.sequenceOrder=m),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1},8,["label-position","model"]),t(y),E("div",Il,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleExplosionViewUpdate,"image-label":"Upload Exploded View","upload-type":"images","max-images":1})]),t(y),E("div",kl,[t(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"onUpdate:filesList":e.handleFilesListUpdate,"upload-type":"both","max-images":5,"max-files":5})]),E("div",Sl,[t(O,{onClick:e.handleCancel},{default:n(()=>a[7]||(a[7]=[U("Cancel")])),_:1,__:[7]}),t(O,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[8]||(a[8]=[U("Confirm")])),_:1,__:[8]},8,["loading"])])])])}const dt=ne(hl,[["render",Tl],["__scopeId","data-v-62d09fa3"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/components/AddSubEquipment.vue"]]),Cl={__name:"EditSubEquipment",props:{equipmentId:{type:[Number,String],required:!0}},emits:["close","cancel","success"],setup(A,{expose:a,emit:c}){a();const e=o(null),D=o("top"),L=o([]),r=o(!1),l=o(null),s=o(""),u=o(null),g=o(null),C=o(!1),I=o([]),x=o(!1),p=o([]),y=o([]),O=o([]),m=o([]),_=o([]),P=o([]),v=A,R=c,K=me({name:"",code:"",model:"",description:"",parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),ee={children:"children",label:"name"},M=()=>{p.value=[],y.value=[],O.value=[],m.value=[],_.value=[],P.value=[]},z=async f=>{if(!(!u.value||!f))try{if(await ae(),L.value.length===0)return;u.value.setCurrentKey(f);const F=u.value.getNode(f);if(!F)return;let b=F.parent;for(;b&&b.key!==void 0;)b.expanded=!0,b=b.parent;K.selectedLocationId=f,e.value&&(await ae(),e.value.clearValidate("selectedLocationId"))}catch{}},$=async()=>{var f;if(v.equipmentId){x.value=!0;try{const b=(await _e(v.equipmentId)).data,N=b.data||b;return M(),K.name=N.name||"",K.code=N.code||"",K.model=N.model||N.serial_number||"",K.description=N.description||"",K.parentId=N.parent_id||N.parent_equipment_node_id,K.selectedLocationId=N.location_id,K.sequenceOrder=N.sequence_order||1,K.imageList=N.image_list||[],K.filesList=N.file_list||[],g.value=((f=N.location)==null?void 0:f.id)||N.location_id,N}catch(F){throw W.error("Failed to load sub equipment details"),F}finally{x.value=!1}}},ie=async()=>{var f;r.value=!0,l.value=null;try{const F=await be();let b;return(f=F.data)!=null&&f.data?b=F.data.data:Array.isArray(F.data)?b=F.data:F.data?b=[F.data]:b=[],L.value=b,b}catch(F){throw l.value=F.message||"Failed to load location tree",W.error("Failed to load location tree"),F}finally{r.value=!1}},se=async f=>{var b;if(!f)return;const F=((b=f.location)==null?void 0:b.id)||f.location_id;F&&(await ae(),u.value&&L.value.length>0&&await z(F))},de=(f,F)=>{switch(f){case"imageList":p.value=F;break;case"filesList":y.value=F;break;case"removeImage":O.value=F;break;case"removeFile":m.value=F;break}},re=async()=>{var f,F;try{if(p.value.length>0){const b=await ce(p.value);_.value=((f=b.data.uploadedFiles)==null?void 0:f.map(N=>N.url))||[]}if(y.value.length>0){const b=await ce(y.value);P.value=((F=b.data.uploadedFiles)==null?void 0:F.map(N=>N.url))||[]}}catch{throw new Error("File upload failed")}},j=async()=>{if(!(!e.value||!await e.value.validate())){C.value=!0;try{let F=K.imageList||[],b=K.filesList||[];(p.value.length>0||y.value.length>0)&&await re(),F=[...F||[],..._.value||[]],b=[...b||[],...P.value||[]],F=F.filter(k=>!O.value.includes(k)),b=b.filter(k=>!m.value.includes(k));const N={name:K.name,code:K.code,serial_number:K.model,description:K.description,parent_id:K.parentId,location_id:K.selectedLocationId,sequence_order:Number(K.sequenceOrder),image_list:F,file_list:b},w=await ke(v.equipmentId,N);if(W.success("Sub Equipment updated successfully!"),O.value.length>0||m.value.length>0){const k=[...O.value,...m.value];Promise.resolve().then(async()=>{try{(await Te({bucketName:"sv-file-bucket",objectUrls:k})).status===0&&W.success("Old files deleted successfully!")}catch{}})}M(),R("close"),R("success",w.data)}catch(F){W.error(`Failed to update sub equipment: ${F.message}`)}finally{C.value=!1}}},Z=()=>{M(),R("close"),R("cancel")},Y=async()=>{var f;if(K.parentId)try{const w=(((f=(await fe(1,100,"sequenceOrder","ASC",{node_type_ids:[6],parent_ids:[K.parentId]})).data)==null?void 0:f.content)||[]).filter(k=>k.id!==parseInt(v.equipmentId)).map(k=>k.sequence_order).filter(k=>k!=null&&!isNaN(k));I.value=w}catch{W.error("Failed to load sequence orders")}},q=te(()=>{const f=I.value.length+1;return Math.max(f,K.sequenceOrder||1)});H(s,f=>{var F;(F=u.value)==null||F.filter(f)});const T=(f,F)=>f?F.name.toLowerCase().includes(f.toLowerCase()):!0,S=async(f,F)=>{g.value=f.id,K.selectedLocationId=f.id,await ae(),e.value&&e.value.validateField("selectedLocationId")};H(L,async f=>{f.length>0&&g.value&&(await ae(),await z(g.value))}),H(()=>K.selectedLocationId,async(f,F)=>{f&&f!==F&&(g.value=f,L.value.length>0&&(await ae(),await z(f)))}),le(async()=>{try{M();const[f]=await Promise.all([$(),ie()]);f&&(await se(f),(f.parent_id||f.parent_equipment_node_id)&&await Y())}catch{}}),H(()=>v.equipmentId,(f,F)=>{f&&f!==F&&(M(),Object.assign(K,{name:"",code:"",model:"",description:"",parentId:null,selectedLocationId:null,sequenceOrder:1,imageList:[],filesList:[]}),g.value=null,$())},{immediate:!1});const h={formRef:e,labelPosition:D,treeData:L,loading:r,error:l,filterText:s,treeRef:u,selectedNodeId:g,submitLoading:C,sequenceOrders:I,dataLoading:x,newImages:p,newFiles:y,removedImages:O,removedFiles:m,newImageUrls:_,newFileUrls:P,props:v,emit:R,formData:K,treeProps:ee,resetFileState:M,setCurrentTreeNode:z,fetchEquipmentData:$,fetchLocationTree:ie,initializeTreeSelection:se,handleFileUpdate:de,uploadFilesToServer:re,handleConfirm:j,handleCancel:Z,fetchSequenceOrders:Y,maxSequenceOrder:q,filterNode:T,handleNodeClick:S,ref:o,reactive:me,onMounted:le,watch:H,computed:te,nextTick:ae,get Loading(){return Ce},get ElMessage(){return W},get getLocationTree(){return be},get getEquipmentNodes(){return fe},get editEquipmentNode(){return ke},get getEquipmentById(){return _e},get uploadMultipleToMinio(){return ce},get deleteObjectList(){return Te},FileUploadMultiple:Ee};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},El={class:"edit-sub-equipment"},Pl={key:0,class:"loading-container"},Nl={key:1,class:"general-information"},Vl={class:"tree-container"},Fl={key:0,class:"tree-loading"},Ol={key:1,class:"tree-error"},Al={class:"file-upload"},Ul={class:"dialog-footer"};function Rl(A,a,c,e,D,L){const r=i("el-icon"),l=i("el-input"),s=i("el-form-item"),u=i("el-col"),g=i("el-row"),C=i("el-alert"),I=i("el-tree"),x=i("el-input-number"),p=i("el-form"),y=i("el-divider"),O=i("el-button");return d(),V("div",El,[e.dataLoading?(d(),V("div",Pl,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[10]||(a[10]=U(" Loading sub equipment data... "))])):(d(),V("div",Nl,[t(p,{ref:"formRef","label-position":e.labelPosition,"label-width":"auto",model:e.formData},{default:n(()=>[t(g,{gutter:20},{default:n(()=>[t(u,{span:12},{default:n(()=>[t(s,{label:"Sub Equipment Name",prop:"name",rules:[{required:!0,message:"Sub Equipment name is required"},{type:"string",message:"Sub Equipment name must be a string"}]},{default:n(()=>[t(l,{modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=m=>e.formData.name=m)},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:n(()=>[t(s,{label:"Sub Equipment Code",prop:"code",rules:[{required:!0,message:"Sub Equipment code is required"}]},{default:n(()=>[t(l,{modelValue:e.formData.code,"onUpdate:modelValue":a[1]||(a[1]=m=>e.formData.code=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(s,{label:"Model",prop:"model"},{default:n(()=>[t(l,{modelValue:e.formData.model,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.model=m),placeholder:"Enter sub equipment model"},null,8,["modelValue"])]),_:1}),t(s,{label:"Description",prop:"description"},{default:n(()=>[t(l,{modelValue:e.formData.description,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.description=m),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(s,{label:"Location",prop:"selectedLocationId",rules:[{required:!0,message:"Location is required"}]},{default:n(()=>[E("div",Vl,[t(l,{modelValue:e.filterText,"onUpdate:modelValue":a[4]||(a[4]=m=>e.filterText=m),placeholder:"Search locations",style:{width:"100%","margin-bottom":"10px"},clearable:""},null,8,["modelValue"]),e.loading?(d(),V("div",Fl,[t(r,{class:"is-loading"},{default:n(()=>[t(e.Loading)]),_:1}),a[11]||(a[11]=U(" Loading locations... "))])):e.error?(d(),V("div",Ol,[t(C,{title:e.error,type:"error","show-icon":"",closable:!1},null,8,["title"])])):(d(),G(I,{key:2,data:e.treeData,props:e.treeProps,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"current-node-key":e.selectedNodeId,"highlight-current":!0,ref:"treeRef",onNodeClick:e.handleNodeClick,class:"location-tree"},null,8,["data","current-node-key"]))])]),_:1}),t(s,{label:"Sequence Order",prop:"sequenceOrder",rules:[{required:!0,message:"Sequence Order is required"},{type:"number",message:"Sequence Order must be a number",transform:m=>Number(m)}]},{default:n(()=>[t(x,{modelValue:e.formData.sequenceOrder,"onUpdate:modelValue":a[5]||(a[5]=m=>e.formData.sequenceOrder=m),min:1,max:e.maxSequenceOrder,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1},8,["rules"])]),_:1},8,["label-position","model"]),t(y),E("div",Al,[t(e.FileUploadMultiple,{"onUpdate:imageList":a[6]||(a[6]=m=>e.handleFileUpdate("imageList",m)),"onUpdate:filesList":a[7]||(a[7]=m=>e.handleFileUpdate("filesList",m)),"onUpdate:removedExistingImages":a[8]||(a[8]=m=>e.handleFileUpdate("removeImage",m)),"onUpdate:removedExistingFiles":a[9]||(a[9]=m=>e.handleFileUpdate("removeFile",m)),"upload-type":"both","max-images":5,"max-files":5,existingImageList:e.formData.imageList,existingFileList:e.formData.filesList},null,8,["existingImageList","existingFileList"])]),E("div",Ul,[t(O,{onClick:e.handleCancel},{default:n(()=>a[12]||(a[12]=[U("Cancel")])),_:1,__:[12]}),t(O,{type:"primary",onClick:e.handleConfirm,loading:e.submitLoading},{default:n(()=>a[13]||(a[13]=[U("Update")])),_:1,__:[13]},8,["loading"])])]))])}const Ml=ne(Cl,[["render",Rl],["__scopeId","data-v-b91a34b1"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/components/EditSubEquipment.vue"]]),jl={__name:"index",props:{node:{type:Object,required:!0},breadcrumb:{type:Array,default:()=>[]}},emits:["refresh-tree","refresh-data","after-delete"],setup(A,{expose:a,emit:c}){const e=A,D=c,L=te(()=>{const M=e.breadcrumb.filter((z,$)=>$>0&&z&&typeof z=="object"&&"id"in z);return M.length>=2?M[M.length-2].id:null}),r=o("details"),l=o(!1),s=o(!1),u=o(!1),g=o(0),C=o(0),I=()=>{l.value=!1},x=()=>{C.value+=1,s.value=!0},p=()=>{s.value=!1},y=()=>{u.value=!0},O=()=>{u.value=!1},m=M=>{M()},_=M=>{I(),D("refresh-tree")},P=M=>{p(),D("refresh-tree"),setTimeout(()=>{v()},100)},v=()=>{g.value+=1,D("refresh-data",e.node.id)},R=M=>{O(),D("refresh-tree"),D("after-delete",{parentId:L.value,deletedId:e.node.id})},K=()=>{D("refresh-tree")};a({openDeactivateDialog:y});const ee={props:e,emit:D,parentId:L,activeTab:r,showAddDialog:l,showEditDialog:s,showDeactivateDialog:u,refreshKey:g,editDialogKey:C,closeAddDialog:I,openEditDialog:x,closeEditDialog:p,openDeactivateDialog:y,closeDeactivateDialog:O,handleCloseDialog:m,handleAddSuccess:_,handleEditSuccess:P,refreshViewData:v,handleDeleteSuccess:R,handleRefreshTree:K,ref:o,computed:te,get MoreFilled(){return Re},SubEquipmentDetailsTab:rl,SubItemsTab:pl,MaintenanceHistory:yl,AddSubEquipment:dt,EditSubEquipment:Ml,DeactivateNode:Be};return Object.defineProperty(ee,"__isScriptSetup",{enumerable:!1,value:!0}),ee}},zl={class:"t4-main-container"},Gl={class:"t4-main-header"},Bl={class:"t4-sub-header"},Kl={class:"t4-main-details"};function Yl(A,a,c,e,D,L){const r=i("el-breadcrumb-item"),l=i("el-breadcrumb"),s=i("el-icon"),u=i("el-dropdown-item"),g=i("el-dropdown-menu"),C=i("el-dropdown"),I=i("el-tab-pane"),x=i("el-tabs"),p=i("el-dialog");return d(),V("div",zl,[E("div",Gl,[t(l,{separator:"/"},{default:n(()=>[(d(!0),V(oe,null,ue(c.breadcrumb,(y,O)=>(d(),G(r,{key:O},{default:n(()=>[U(J(y.label),1)]),_:2},1024))),128))]),_:1}),E("div",Bl,[E("h1",null,J(c.node.label),1),t(C,{class:"kebab-dropdown"},{dropdown:n(()=>[t(g,null,{default:n(()=>[t(u,{onClick:e.openEditDialog},{default:n(()=>a[4]||(a[4]=[U("Edit Tier 4")])),_:1,__:[4]})]),_:1})]),default:n(()=>[t(s,{class:"kebab-icon"},{default:n(()=>[t(e.MoreFilled)]),_:1})]),_:1})])]),E("div",Kl,[(d(),G(x,{modelValue:e.activeTab,"onUpdate:modelValue":a[0]||(a[0]=y=>e.activeTab=y),type:"border-card",key:e.refreshKey},{default:n(()=>[t(I,{label:"Details",name:"details"},{default:n(()=>[(d(),G(e.SubEquipmentDetailsTab,{equipmentId:e.props.node.id,key:`details-${e.refreshKey}`},null,8,["equipmentId"]))]),_:1}),t(I,{label:"Sub Items",name:"subItems"},{default:n(()=>[(d(),G(e.SubItemsTab,{key:`subitems-${e.refreshKey}`}))]),_:1}),t(I,{label:"Maintenance History",name:"maintenanceHistory"},{default:n(()=>[(d(),G(e.MaintenanceHistory,{key:`maintenance-${e.refreshKey}`}))]),_:1})]),_:1},8,["modelValue"]))]),t(p,{modelValue:e.showAddDialog,"onUpdate:modelValue":a[1]||(a[1]=y=>e.showAddDialog=y),title:"Add New Tier 4",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showAddDialog?(d(),G(e.AddSubEquipment,{key:0,onClose:e.closeAddDialog,onSuccess:e.handleAddSuccess,parentId:e.parentId},null,8,["parentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),t(p,{modelValue:e.showEditDialog,"onUpdate:modelValue":a[2]||(a[2]=y=>e.showEditDialog=y),title:"Edit Tier 4",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showEditDialog?(d(),G(e.EditSubEquipment,{key:`edit-${e.props.node.id}-${e.editDialogKey}`,onClose:e.closeEditDialog,onSuccess:e.handleEditSuccess,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"]),t(p,{modelValue:e.showDeactivateDialog,"onUpdate:modelValue":a[3]||(a[3]=y=>e.showDeactivateDialog=y),title:"Delete Tier 4",width:"600px","before-close":e.handleCloseDialog},{default:n(()=>[e.showDeactivateDialog?(d(),G(e.DeactivateNode,{key:0,onClose:e.closeDeactivateDialog,onSuccess:e.handleDeleteSuccess,onRefreshTree:e.handleRefreshTree,equipmentId:e.props.node.id},null,8,["equipmentId"])):X("v-if",!0)]),_:1},8,["modelValue"])])}const Ql=ne(jl,[["render",Yl],["__scopeId","data-v-cf6d2b19"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/components/subEquipment/index.vue"]]),Wl={__name:"index",setup(A,{expose:a}){a();const c=Ke(),e=o(null),D=o(null),L=o(null),r=o(null),l=o(null),s=o(null),u=o([]),g=te(()=>{var j;return((j=s.value)==null?void 0:j.level)===2}),C=te(()=>{var j;return((j=s.value)==null?void 0:j.level)===3}),I=te(()=>{var j;return((j=s.value)==null?void 0:j.level)===4});function x(j,Z){s.value=j,u.value=Z??[]}async function p({level:j,node:Z,breadcrumb:Y}){var q,T,S,h,f,F,b,N,w,k,B,Q,ge,pe,ve;if(s.value=Z,u.value=Y??[],await ae(),j===2){const ye=(q=Y==null?void 0:Y.at(-2))==null?void 0:q.id,Pe=(((S=(T=e.value)==null?void 0:T.getChildrenOf)==null?void 0:S.call(T,ye))??[]).findIndex(Ne=>Ne.id===Z.id);l.value={type:"t2",parentId:ye,originalIndex:Pe},(f=(h=D.value)==null?void 0:h.openDeactivateDialog)==null||f.call(h)}if(j===3){const ye=(F=Y==null?void 0:Y.at(-2))==null?void 0:F.id,Pe=(((N=(b=e.value)==null?void 0:b.getChildrenOf)==null?void 0:N.call(b,ye))??[]).findIndex(Ne=>Ne.id===Z.id);l.value={type:"t3",parentId:ye,originalIndex:Pe},(k=(w=L.value)==null?void 0:w.openDeactivateDialog)==null||k.call(w)}if(j===4){const ye=(B=Y==null?void 0:Y.at(-2))==null?void 0:B.id,Pe=(((ge=(Q=e.value)==null?void 0:Q.getChildrenOf)==null?void 0:ge.call(Q,ye))??[]).findIndex(Ne=>Ne.id===Z.id);l.value={type:"t4",parentId:ye,originalIndex:Pe},(ve=(pe=r.value)==null?void 0:pe.openDeactivateDialog)==null||ve.call(pe)}}async function y({parentId:j,deletedId:Z}){var S,h,f,F,b,N,w,k;await _(),await ae();const Y=l.value;if(l.value=null,!Y||Y.type!=="t2"||Y.parentId!==j){(h=(S=e.value)==null?void 0:S.focusNode)==null||h.call(S,j);return}const q=((F=(f=e.value)==null?void 0:f.getChildrenOf)==null?void 0:F.call(f,j))??[];if(!q.length){(N=(b=e.value)==null?void 0:b.focusNode)==null||N.call(b,j);return}const T=Math.min(Y.originalIndex,q.length-1);(k=(w=e.value)==null?void 0:w.focusNode)==null||k.call(w,q[T].id)}async function O({parentId:j,deletedId:Z}){var S,h,f,F,b,N,w,k;await _(),await ae();const Y=l.value;if(l.value=null,!Y||Y.type!=="t3"||Y.parentId!==j){(h=(S=e.value)==null?void 0:S.focusNode)==null||h.call(S,j);return}const q=((F=(f=e.value)==null?void 0:f.getChildrenOf)==null?void 0:F.call(f,j))??[];if(!q.length){(N=(b=e.value)==null?void 0:b.focusNode)==null||N.call(b,j);return}const T=Math.min(Y.originalIndex,q.length-1);(k=(w=e.value)==null?void 0:w.focusNode)==null||k.call(w,q[T].id)}async function m({parentId:j,deletedId:Z}){var h,f,F,b,N,w,k,B,Q,ge,pe;await _(),await ae();const Y=l.value;if(l.value=null,!Y||Y.type!=="t4"||Y.parentId!==j){(f=(h=e.value)==null?void 0:h.focusNode)==null||f.call(h,j);return}const q=((b=(F=e.value)==null?void 0:F.getChildrenOf)==null?void 0:b.call(F,j))??[];if(!q.length){(w=(N=e.value)==null?void 0:N.focusNode)==null||w.call(N,j);return}const T=Math.min(Y.originalIndex,q.length-1),S=(k=q[T])==null?void 0:k.id;S?(Q=(B=e.value)==null?void 0:B.focusNode)==null||Q.call(B,S):(pe=(ge=e.value)==null?void 0:ge.focusNode)==null||pe.call(ge,j)}async function _(){var j,Z;await((Z=(j=e.value)==null?void 0:j.refreshTree)==null?void 0:Z.call(j))}const P=o(!1),v=o(!1),R=o(!1),K=o(null),ee=o(null),M=o("");function z(j=[]){return j.find(Z=>(Z==null?void 0:Z.level)===1)||null}function $(j=""){return j.replace(/^T1:\s*/i,"")}function ie({nextLevel:j,parentId:Z,breadcrumb:Y}){K.value=Z;const q=z(Y);ee.value=(q==null?void 0:q.id)??null,M.value=q?$(q.label):"",P.value=j===2,v.value=j===3,R.value=j===4}function se(){P.value=!1,v.value=!1,R.value=!1,_()}const de=async(j,Z=10,Y=300)=>{if(!j||!e.value)return!1;const q=Number(j);let T=0;const S=async()=>{var f,F;return T++,((F=(f=e.value)==null?void 0:f.focusNode)==null?void 0:F.call(f,q))?(console.log(`Successfully selected equipment ${q} on attempt ${T}`),!0):T<Z?(console.log(`Equipment ${q} not found, retrying in ${Y}ms... (attempt ${T}/${Z})`),await new Promise(b=>setTimeout(b,Y)),S()):(console.warn(`Failed to select equipment ${q} after ${Z} attempts`),!1)};return S()};H(()=>c.query.equipmentId,async j=>{j&&e.value&&(await ae(),de(j))}),le(async()=>{const j=c.query.equipmentId;j&&setTimeout(()=>{de(j)},1e3)});const re={route:c,tree:e,t2Ref:D,t3Ref:L,t4Ref:r,pendingDeleteCtx:l,selectedNode:s,breadcrumbPath:u,isTier2:g,isTier3:C,isTier4:I,onNodeClick:x,onRequestDelete:p,onT2AfterDelete:y,onT3AfterDelete:O,onT4AfterDelete:m,handleRefreshTree:_,showAddT2:P,showAddT3:v,showAddT4:R,addParentId:K,prefilledProductionLineId:ee,prefilledProductionLineName:M,getT1FromBreadcrumb:z,cleanLabel:$,onRequestAdd:ie,handleAddSuccess:se,selectEquipmentById:de,ref:o,computed:te,nextTick:ae,watch:H,onMounted:le,get useRoute(){return Ke},EquipmentTree:Lt,EquipmentGroup:rn,Equipment:Ko,SubEquipment:Ql,AddEquipmentGroup:rt,AddEquipment:st,AddSubEquipment:dt};return Object.defineProperty(re,"__isScriptSetup",{enumerable:!1,value:!0}),re}},Hl={class:"maintenance-equipment-container"},Zl={class:"maintenance-equipment-content"},Jl={class:"maintenance-equipment-tree"},Xl={class:"maintenance-equipment-details"},$l={key:3},ei={key:1};function ti(A,a,c,e,D,L){const r=i("el-dialog");return d(),V("div",Hl,[a[6]||(a[6]=E("div",{class:"maintenance-equipment-header"},null,-1)),E("div",Zl,[X(" Left: Tree "),E("div",Jl,[t(e.EquipmentTree,{ref:"tree",onNodeClick:e.onNodeClick,onRequestDelete:e.onRequestDelete,onRequestAdd:e.onRequestAdd},null,512)]),X(" Right: Details pane "),E("div",Xl,[e.selectedNode?(d(),V(oe,{key:0},[X(" Tier 2 "),e.isTier2?(d(),G(e.EquipmentGroup,{key:0,ref:"t2Ref",node:e.selectedNode,breadcrumb:e.breadcrumbPath,onRefreshTree:e.handleRefreshTree,onAfterDelete:e.onT2AfterDelete},null,8,["node","breadcrumb"])):e.isTier3?(d(),V(oe,{key:1},[X(" Tier 3 "),t(e.Equipment,{ref:"t3Ref",node:e.selectedNode,breadcrumb:e.breadcrumbPath,onRefreshTree:e.handleRefreshTree,onAfterDelete:e.onT3AfterDelete},null,8,["node","breadcrumb"])],2112)):e.isTier4?(d(),V(oe,{key:2},[X(" Tier 4 "),t(e.SubEquipment,{ref:"t4Ref",node:e.selectedNode,breadcrumb:e.breadcrumbPath,onRefreshTree:e.handleRefreshTree,onAfterDelete:e.onT4AfterDelete},null,8,["node","breadcrumb"])],2112)):(d(),V("div",$l,"Select a node to see details"))],64)):(d(),V("div",ei,"Select a node to see details"))]),X(" ================= Add Dialogs ================= "),X(" Add Tier 2 "),t(r,{modelValue:e.showAddT2,"onUpdate:modelValue":a[1]||(a[1]=l=>e.showAddT2=l),title:"Add New Tier 2",width:"600px"},{default:n(()=>[e.showAddT2?(d(),G(e.AddEquipmentGroup,{key:0,parentId:e.addParentId,productionLineId:e.prefilledProductionLineId,productionLineName:e.prefilledProductionLineName,lockProductionLine:!0,onClose:a[0]||(a[0]=l=>e.showAddT2=!1),onSuccess:e.handleAddSuccess},null,8,["parentId","productionLineId","productionLineName"])):X("v-if",!0)]),_:1},8,["modelValue"]),X(" Add Tier 3 "),t(r,{modelValue:e.showAddT3,"onUpdate:modelValue":a[3]||(a[3]=l=>e.showAddT3=l),title:"Add New Tier 3",width:"600px"},{default:n(()=>[e.showAddT3?(d(),G(e.AddEquipment,{key:0,parentId:e.addParentId,productionLineId:e.prefilledProductionLineId,productionLineName:e.prefilledProductionLineName,lockProductionLine:!0,onClose:a[2]||(a[2]=l=>e.showAddT3=!1),onSuccess:e.handleAddSuccess},null,8,["parentId","productionLineId","productionLineName"])):X("v-if",!0)]),_:1},8,["modelValue"]),X(" Add Tier 4 "),t(r,{modelValue:e.showAddT4,"onUpdate:modelValue":a[5]||(a[5]=l=>e.showAddT4=l),title:"Add New Tier 4",width:"600px"},{default:n(()=>[e.showAddT4?(d(),G(e.AddSubEquipment,{key:0,parentId:e.addParentId,onClose:a[4]||(a[4]=l=>e.showAddT4=!1),onSuccess:e.handleAddSuccess},null,8,["parentId"])):X("v-if",!0)]),_:1},8,["modelValue"])])])}const Ki=ne(Wl,[["render",ti],["__scopeId","data-v-4f342cb8"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/equipment/index.vue"]]);export{Ki as default};
