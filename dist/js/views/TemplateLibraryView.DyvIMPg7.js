import"../vue/vue.Dfo81L2Q.js";import{a as Ie,u as Ne}from"../vue-router/vue-router.30cuaQZO.js";import{_ as tt,d as Ee,c as ve}from"../../assets/index-CE-d1vf_.js";import{a0 as At,a1 as Lt,n as Bt,E as It,a2 as Nt,P as Et,$ as Mt,B as Ut,M as Ht,am as Ot}from"../@element-plus/@element-plus.BNeHluFm.js";import{a as Me,u as Ue,S as He,A as ge,T as Oe,N as Re,C as We,I as je,e as Qe}from"../ServiceStepPreview/ServiceStepPreview.BMli3z6c.js";import{d as Ge}from"../equipment/equipment.hEuZPeX-.js";import{a as Ke}from"../common/common.CFlva48m.js";import{am as h,c as _,o as u,O as d,a as s,R as p,K as N,L as n,Q as y,G as ne,j as P,S as l,M as Rt,U as Wt,F as $,a8 as ee,E as Ye,d as at,r as g,_ as Ze,w as he,q as Je,Z as Xe,t as Q,Y as $e,P as jt,a6 as Qt}from"../@vue/@vue.CVGyaoMH.js";import{t as et}from"../task-library/task-library.-tD9DWhJ.js";import{E as D,c as ye}from"../element-plus/element-plus.CU5xiOkY.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../vue-i18n/vue-i18n.DjO1PVT4.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../mitt/mitt.DJ65BbbF.js";import"../lodash-es/lodash-es.BLHqGvLj.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";const Gt={__name:"TemplateCard",props:{template:{type:Object,required:!0},isSelected:{type:Boolean,default:!1},isHighlighted:{type:Boolean,default:!1}},emits:["select","edit","duplicate","delete"],setup(G,{expose:a,emit:w}){a();const e=G,O=w,I=P(()=>{var b,T,z;return((b=e.template)==null?void 0:b.total_steps)??((z=(T=e.template)==null?void 0:T.steps)==null?void 0:z.length)??0}),f=P(()=>{var T;const b=(T=e.template)==null?void 0:T.category;return b?typeof b=="object"?b.name:b:""}),R=P(()=>{var T;const b=(T=e.template)==null?void 0:T.applicable_assets;return!b||b.length===0?"":b.length===1?b[0]:`${b.length} assets`}),x={props:e,emit:O,stepsCount:I,categoryLabel:f,assetLabel:R,computed:P};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},Kt={class:"card-content"},Yt={class:"row-1"},Zt=["title"],Jt={class:"steps-count"},Xt={class:"row-2 card-tags"};function $t(G,a,w,e,O,I){const f=h("el-tag");return u(),_("div",{class:ne(["template-card",{selected:w.isSelected,highlighted:w.isHighlighted}]),onClick:a[0]||(a[0]=R=>G.$emit("select",w.template))},[d(" Card Content "),s("div",Kt,[d(" Row 1: Title + Steps "),s("div",Yt,[s("h4",{class:"card-title",title:w.template.name},p(w.template.name),9,Zt),s("div",Jt,p(e.stepsCount)+" steps",1)]),d(" Row 2: Tags (conditional) "),s("div",Xt,[e.categoryLabel?(u(),N(f,{key:0,size:"small",class:"tag-item"},{default:n(()=>[y(p(e.categoryLabel),1)]),_:1})):d("v-if",!0),e.assetLabel?(u(),N(f,{key:1,size:"small",type:"info",class:"tag-item"},{default:n(()=>[y(p(e.assetLabel),1)]),_:1})):d("v-if",!0),w.template.estimated_minutes?(u(),N(f,{key:2,size:"small",type:"warning",class:"tag-item"},{default:n(()=>[y(p(w.template.estimated_minutes)+" min ",1)]),_:1})):d("v-if",!0)])])],2)}const ea=tt(Gt,[["render",$t],["__scopeId","data-v-e8aed90e"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/components/Library/TemplateCard.vue"]]),ta=at({name:"TaskLibrary"}),aa=Object.assign(ta,{setup(G,{expose:a}){a();const w=Ie(),e=Ne(),O=Ee(),I=Me(),{loading:f,templateDetailLoading:R,templates:x,filteredTemplates:b,currentTemplate:T,pagination:z,loadTemplates:k,loadTemplate:K,createTemplate:W,deleteTemplate:te,setFilter:A,clearFilters:j,setPage:Y,setPageSize:ae}=Ue(),E=g(""),M=g(!1),L=g(""),F=g(1),U=g(20),B=g(null),Z=g(null),o=g(!1),q=g(null),H=g(!1),J=g(""),X=g(!1),le=g(!1),re=g([]),be=g([]),Te=g("general"),de=g(""),ce=g([]),se=Ze({}),ue=g(50),oe=g(34),lt=P(()=>{const t=ue.value+oe.value;return`calc(100vh - ${t>0?t:84}px)`}),we=async()=>{var t;try{const i=await Ge(),r=c=>({value:c.id,label:c.name,children:c.children&&c.children.length>0?c.children.map(r):void 0});let m;(t=i.data)!=null&&t.data?m=i.data.data:Array.isArray(i.data)?m=i.data:i.data?m=[i.data]:m=[],be.value=m.map(c=>r(c))}catch(i){console.error("Equipment tree load failed:",i),D.error("Failed to load asset filter data.")}},ke=async()=>{try{const t=await Ke();ce.value=t.data.map(i=>i.name)}catch(t){console.error("Categories load failed:",t),D.error("Failed to load category filter data.")}},st=()=>{A("equipment_node_ids",re.value),F.value=1},ot=P(()=>ce.value.sort()),it=P(()=>Array.isArray(b.value)?b.value:[]),C=P(()=>T.value&&(T.value.template_id===B.value||T.value.id===B.value)?T.value:Array.isArray(x.value)?x.value.find(t=>t.template_id===B.value||t.id===B.value):null),Se=t=>({numeric:"number",boolean:"checkbox",inspection:"inspection",text:"text",file:"attachments",service:"service"})[t]||t||"text",me=P(()=>{const t=C.value;return(Array.isArray(t==null?void 0:t.steps)?t.steps:[]).map((r,m)=>{const c=r.value||{},S=Se(c.type),v={step_id:r.id||r.step_id||`step-${m}`,order:m+1,type:S,label:r.name||r.label||`Step ${m+1}`,description:r.description||"",required:!!r.required,required_image:!!c.require_image,relevant_tools:(r.tools||[]).map(V=>({tool_id:V.id,name:V.name})),config:{}};return S==="number"?v.config={default_value:typeof c.value=="number"?c.value:void 0,limits:et(c.numeric_limit_bounds),required_image:v.required_image}:S==="checkbox"?v.config={default:!!c.value,required_image:v.required_image}:S==="text"?v.config={default_value:c.value??"",required_image:v.required_image}:S==="inspection"?v.config={default:"pass",required_image:v.required_image}:S==="attachments"&&(v.config={upload_style:{list_type:"picture-card"},required_image:v.required_image}),v})}),nt=P(()=>{if(!de.value)return me.value;const t=de.value.toLowerCase();return me.value.filter(i=>i.label.toLowerCase().includes(t))}),rt=t=>({inspection:je,checkbox:We,number:Re,text:Oe,files:ge,attachments:ge,service:He})[t]||"div",dt=(t,i)=>({...t,label:`${i+1}. ${t.label||"Step"}`}),ct=t=>{se[t]=!se[t]},ut=t=>!!se[t],mt=P(()=>{const t=z.value.total||0,i=z.value.page||1,r=z.value.size||20,m=t===0?0:(i-1)*r+1,c=Math.min(i*r,t);return{start:m,end:c,total:t}}),pe=g(null),pt=()=>{},_t=()=>{clearTimeout(pe.value),pe.value=setTimeout(()=>{M.value?A("reference_id",E.value):A("keyword",E.value),F.value=1},500)},ft=()=>{M.value=!M.value,E.value="",M.value?A("keyword",""):A("reference_id","")},vt=()=>{le.value=!le.value,le.value||_e()},gt=()=>{A("category",L.value),F.value=1},_e=()=>{E.value="",M.value=!1,L.value="",re.value=[],j(),F.value=1},ht=t=>{F.value=t,Y(t),k()},yt=t=>{U.value=t,F.value=1,ae(t)},Ce=async t=>{B.value=t.template_id||t.id;try{await K(t.template_id||t.id)}catch(i){console.error("Template details load failed:",i)}},De=(t=C.value)=>{if(t){const i=t.template_id||t.id;if(!i){console.error("Missing template ID:",t),D.error("Unable to edit task - missing template ID");return}const r=ve(),m=`/maintenance-library/designer/${i}`,c=(r.visitedViews||[]).find(S=>S.path===m);if(c){w.push(c.fullPath||c.path);return}w.push({name:"TaskDesignerEdit",params:{id:i}})}else D.error("No template selected for editing")},xe=(t,i)=>{var m;if(!t)throw new Error("Source template is required");const r={name:i||`${t.name} (Copy)`,description:t.description||"",category:((m=t.category)==null?void 0:m.id)||t.category,estimated_minutes:t.time_estimate_sec?Math.round(t.time_estimate_sec/60):t.estimated_minutes||30,applicable_assets:t.equipment_node_id?Array.isArray(t.equipment_node_id)?t.equipment_node_id:[t.equipment_node_id]:[],steps:[]};return t.steps&&Array.isArray(t.steps)&&(r.steps=t.steps.map((c,S)=>{const v=c.value||{},V=qe(v.type);return{step_id:`step-${Date.now()}-${S}`,order:S+1,type:V,label:c.name||`Step ${S+1}`,description:c.description||"",required:!!c.required,required_image:!!v.require_image,relevant_tools:Ve(c.tools||[]),relevant_resources:c.relevant_resources||[],config:Pe(V,v)}})),r},qe=t=>({numeric:"number",boolean:"checkbox",checkbox:"checkbox",text:"text",file:"attachments",inspection:"inspection",service:"service"})[t]||"text",Ve=t=>Array.isArray(t)?t.map(i=>({tool_id:i.id,name:i.name||"Unnamed Tool"})):[],Pe=(t,i)=>{const r={required_image:!!i.require_image};switch(t){case"number":return{...r,kind:"number",unit:i.unit||"",decimal_places:i.decimal_places||0,default_value:typeof i.value=="number"?i.value:0,limits:i.numeric_limit_bounds||null};case"checkbox":return{...r,kind:"checkbox",default:!!i.value};case"text":return{...r,kind:"text",multiline:!0,max_length:1e3,default_value:String(i.value||"")};case"inspection":return{...r,kind:"inspection",choices:["pass","fail"],default:i.value?"pass":"fail",require_comment_on_fail:!1,require_photo_on_fail:!1};case"attachments":return{...r,kind:"attachments",allow_types:["image","pdf"],max_files:5,max_file_size_mb:10};default:return r}},Fe=async(t=C.value)=>{var i,r;if(!t){D.error("No template selected for duplication");return}try{const c=(await ye.prompt("Are you sure you want to duplicate this task template?","Duplicate Task Template",{confirmButtonText:"Duplicate",cancelButtonText:"Cancel",inputPlaceholder:`${t.name} (Copy)`,inputValue:`${t.name} (Copy)`,inputValidator:V=>!V||V.trim().length===0?"Template name is required":V.trim().length>255?"Template name must be 255 characters or less":!0,inputErrorMessage:"Invalid template name"})).value.trim(),S=xe(t,c),v=await W(S);await k(),D.success(`Task "${c}" duplicated successfully`),v&&v.id&&Q(()=>{const V=x.value.find(Be=>Be.template_id===v.id||Be.id===v.id);V&&(C.value=V)})}catch(m){if(m==="cancel")return;console.error("Template duplication failed:",m);const c=((r=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:r.message)||(m==null?void 0:m.message)||"Failed to duplicate task template";D.error(c)}},ze=t=>{q.value=t,J.value="",X.value=!1,o.value=!0},bt=()=>{var t;X.value=J.value===((t=q.value)==null?void 0:t.name)},Tt=()=>{o.value=!1,q.value=null,J.value="",X.value=!1},wt=async()=>{if(!q.value)return;const t=q.value.id||q.value.template_id;if(!t){D.error("Template ID is missing, cannot delete template");return}H.value=!0;try{await te(t),B.value===t&&(B.value=null),o.value=!1,q.value=null,J.value="",X.value=!1}catch{D.error("Failed to delete task")}finally{H.value=!1}},kt=t=>{switch(t){case"edit":De();break;case"duplicate":Fe();break;case"delete":ze(C.value);break}},St=()=>{const i=(ve().visitedViews||[]).find(r=>r.path==="/maintenance-library/designer");if(i){w.push(i.fullPath||i.path);return}w.push({name:"TaskDesigner"})},Ct=async()=>{if(!C.value){D.error("No template selected. Please select a template first.");return}try{I.hasDraft&&await ye.confirm("You have an unfinished work order. Add this task there?","Unfinished Work Order",{confirmButtonText:"Yes",cancelButtonText:"Cancel",type:"warning",customClass:"work-order-confirmation-dialog"})==="cancel"&&I.clearDraft();const t=Qe(C.value);I.appendTask(t),I.setShouldOpenCreatePanel(!0),w.push({path:"/work-order",query:{view:"todo"}}),D.success(`Template "${C.value.name}" added to work order creation`)}catch(t){if(t==="cancel"||t==="close")return;console.error("Failed to create work order from template:",t),D.error("Failed to add template to work order. Please try again.")}},Dt=()=>{Te.value="steps"},xt=t=>t?typeof t=="object"?t.name:t:"Uncategorized",qt=t=>({inspection:"Inspection",checkbox:"Checkbox",number:"Number Input",text:"Text Input",attachments:"File Upload"})[t]||t,Vt=t=>t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Pt=()=>{var t;return(t=C.value)!=null&&t.steps?C.value.steps.filter(i=>i.required).length:0},Ft=()=>{var t;return(t=C.value)!=null&&t.steps?C.value.steps.filter(i=>!i.required).length:0},zt=()=>{var i;if(!((i=C.value)!=null&&i.steps))return{};const t={};return C.value.steps.forEach(r=>{t[r.type]=(t[r.type]||0)+1}),t},ie=()=>{Q(()=>{const t=document.querySelector(".navbar");t&&t.offsetHeight>0&&(ue.value=t.offsetHeight);const i=document.querySelector("#tags-view-container");O.tagsView&&i&&i.offsetHeight>0?oe.value=i.offsetHeight:oe.value=0})},fe=()=>{ie()};he(()=>O.tagsView,()=>{ie()},{immediate:!1}),Je(()=>{ie(),window.addEventListener("resize",fe),k(),we(),ke()});const Ae=async(t,i=!1)=>{try{i&&await k(),await Q(),_e();let r=x.value.find(m=>m.id===t||m.template_id===t);if(r||(await new Promise(m=>setTimeout(m,500)),await k(),r=x.value.find(m=>m.id===t||m.template_id===t)),r){const m=x.value.findIndex(v=>v.id===t||v.template_id===t),c=Math.ceil((m+1)/U.value);c!==F.value&&(F.value=c,Y(c),await k(),await Q()),Z.value=r.template_id||r.id,await Ce(r),D.success(`Task "${r.name}" created successfully`),setTimeout(()=>{Z.value=null},3e3),await Q();const S=document.querySelector(".template-card.highlighted");S&&S.scrollIntoView({behavior:"smooth",block:"center"})}else D.success("Task created successfully")}catch(r){console.error("Template focus failed:",r)}w.replace({query:{...e.query,focusTemplate:void 0,refresh:void 0}})};he(()=>e.query,t=>{if(t.focusTemplate){const i=t.refresh==="true";Ae(t.focusTemplate,i)}},{immediate:!0}),Xe(()=>{window.removeEventListener("resize",fe)});const Le={router:w,route:e,settingsStore:O,workOrderDraftStore:I,loading:f,templateDetailLoading:R,templates:x,filteredTemplates:b,currentTemplate:T,pagination:z,loadTemplates:k,loadTemplate:K,createTemplate:W,deleteTemplate:te,setFilter:A,clearFilters:j,setPage:Y,setPageSize:ae,searchQuery:E,searchByIdMode:M,categoryFilter:L,currentPage:F,pageSize:U,selectedTemplateId:B,highlightedTemplateId:Z,deleteDialogVisible:o,templateToDelete:q,deleteLoading:H,deleteConfirmationText:J,deleteConfirmationValid:X,showFilters:le,assetFilter:re,equipmentTreeData:be,activeTab:Te,stepSearchQuery:de,allCategories:ce,stepToolsVisible:se,navbarHeight:ue,tagsViewHeight:oe,containerHeight:lt,fetchEquipmentTreeData:we,fetchCategories:ke,handleAssetFilter:st,availableCategories:ot,displayedTemplates:it,selectedTemplate:C,mapValueTypeToPreviewType:Se,previewSteps:me,filteredPreviewSteps:nt,getStepComponent:rt,getStepWithNumber:dt,toggleStepTools:ct,getStepToolsVisible:ut,paginationInfo:mt,searchDebounce:pe,handleStepSearch:pt,handleSearch:_t,toggleSearchMode:ft,toggleFilterVisibility:vt,handleCategoryFilter:gt,clearAllFilters:_e,handlePageChange:ht,handlePageSizeChange:yt,handleTemplateSelect:Ce,handleTemplateEdit:De,prepareDuplicateData:xe,mapApiStepTypeToDesigner:qe,transformApiToolsToDesigner:Ve,transformApiStepConfigToDesigner:Pe,handleTemplateDuplicate:Fe,handleTemplateDelete:ze,validateDeleteConfirmation:bt,handleDeleteCancel:Tt,handleDeleteConfirm:wt,handleHeaderAction:kt,createNewTemplate:St,createNewWorkOrder:Ct,navigateToStepsTab:Dt,getCategoryLabel:xt,getStepTypeLabel:qt,formatDate:Vt,getRequiredStepsCount:Pt,getOptionalStepsCount:Ft,getStepTypesBreakdown:zt,calculateDynamicHeights:ie,handleResize:fe,handleTemplateFocus:Ae,__MACROS_defineComponent:at,ref:g,computed:P,onMounted:Je,onBeforeUnmount:Xe,watch:he,nextTick:Q,reactive:Ze,get useRouter(){return Ie},get useRoute(){return Ne},get useSettingsStore(){return Ee},get useTagsViewStore(){return ve},get Filter(){return Ot},get Search(){return Ht},get Plus(){return Ut},get Edit(){return Mt},get Delete(){return Et},get DocumentCopy(){return Nt},get MoreFilled(){return It},get Calendar(){return Bt},get Upload(){return Lt},get Tools(){return At},get ElMessage(){return D},get ElMessageBox(){return ye},get useTaskLibrary(){return Ue},get getEquipmentTree(){return Ge},get getAllCategories(){return Ke},get useWorkOrderDraftStore(){return Me},get buildDisplayTaskFromTemplate(){return Qe},TemplateCard:ea,InspectionStepPreview:je,CheckboxStepPreview:We,NumberStepPreview:Re,TextStepPreview:Oe,AttachmentStepPreview:ge,ServiceStepPreview:He,get transformLimitsFromBackend(){return et}};return Object.defineProperty(Le,"__isScriptSetup",{enumerable:!1,value:!0}),Le}}),la={class:"left-panel"},sa={class:"search-bar"},oa={class:"search-suffix-icons"},ia={class:"filter-controls"},na={class:"filter-controls"},ra={class:"template-list"},da={key:0,class:"loading-container"},ca={key:1,class:"empty-list"},ua={key:2,class:"list-content"},ma={class:"pagination-info"},pa={class:"info-text"},_a={class:"templates-container"},fa={class:"pagination-container"},va={class:"right-panel"},ga={key:0,class:"loading-container"},ha={key:1,class:"no-selection"},ya={class:"no-selection-content"},ba={key:2,class:"template-details"},Ta={class:"fixed-header-section"},wa={class:"details-header"},ka={class:"header-main"},Sa={class:"template-title"},Ca={key:0},Da={class:"header-actions"},xa={class:"template-tabs-header"},qa={class:"scrollable-content"},Va={class:"tab-content-wrapper"},Pa={key:0,class:"tab-pane-content"},Fa={class:"overview-card"},za={class:"card-content"},Aa={class:"info-value warning"},La={key:0,class:"description-card"},Ba={class:"card-content"},Ia={class:"description-text"},Na={class:"stats-card",style:{"margin-bottom":"100px"}},Ea={class:"card-content"},Ma={class:"stat-item"},Ua={class:"stat-number"},Ha={class:"stat-item"},Oa={class:"stat-number"},Ra={class:"stat-item"},Wa={class:"stat-number"},ja={class:"stat-item"},Qa={class:"stat-number"},Ga={key:1,class:"tab-pane-content"},Ka={class:"step-search-bar"},Ya={key:0,class:"procedure-preview"},Za={class:"preview-main viewport-desktop density-comfortable"},Ja={class_:"section-content"},Xa={class:"step-config-preview"},$a={key:0,class:"preview-bottom-section"},el={class:"desktop-upload-button"},tl={key:1,class:"desktop-tools-list"},al={class:"tools-list-content"},ll={class:"tool-name"},sl={key:1,class:"empty-steps"},ol={key:2,class:"tab-pane-content"},il={key:0,class:"steps-preview"},nl={class:"steps-list"},rl={class:"step-number"},dl={class:"step-content"},cl={class:"step-title"},ul={class:"step-type"},ml={key:0,class:"step-description"},pl={class:"step-required"},_l={key:1,class:"empty-steps"},fl={class:"floating-action"},vl={class:"delete-confirmation-content"},gl={class:"name-confirmation-section"},hl={class:"dialog-footer"};function yl(G,a,w,e,O,I){const f=h("el-icon"),R=h("el-tooltip"),x=h("el-input"),b=h("el-tree-select"),T=h("el-option"),z=h("el-select"),k=h("el-button"),K=h("el-skeleton"),W=h("el-empty"),te=h("el-pagination"),A=h("el-tag"),j=h("el-dropdown-item"),Y=h("el-dropdown-menu"),ae=h("el-dropdown"),E=h("el-tab-pane"),M=h("el-tabs"),L=h("el-descriptions-item"),F=h("el-descriptions"),U=h("el-col"),B=h("el-row"),Z=h("el-dialog");return u(),_("div",{class:"template-library-view",style:Ye({height:e.containerHeight})},[d(" Left Panel - Template List "),s("div",la,[d(" Filters Section "),s("div",{class:ne(["filters-section",{"filters-collapsed":!e.showFilters}])},[d(" Search Input "),s("div",sa,[l(x,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=o=>e.searchQuery=o),placeholder:e.searchByIdMode?"Search template ID...":"Search task templates...",onInput:e.handleSearch},{prefix:n(()=>[l(f,null,{default:n(()=>[l(e.Search)]),_:1})]),suffix:n(()=>[s("div",oa,[l(R,{content:e.searchByIdMode?"Search by Name":"Search by ID",placement:"bottom"},{default:n(()=>[l(f,{class:ne(["search-mode-toggle",{"is-active":e.searchByIdMode}]),onClick:$e(e.toggleSearchMode,["stop"])},{default:n(()=>a[11]||(a[11]=[y(" # ")])),_:1,__:[11]},8,["class"])]),_:1},8,["content"]),l(R,{content:"Show/Hide filters",placement:"top"},{default:n(()=>[l(f,{class:ne(["filter-toggle",{"is-active":e.showFilters}]),onClick:$e(e.toggleFilterVisibility,["stop"])},{default:n(()=>[l(e.Filter)]),_:1},8,["class"])]),_:1})])]),_:1},8,["modelValue","placeholder"])]),d(" Filter Controls "),Rt(s("div",ia,[s("div",na,[l(b,{modelValue:e.assetFilter,"onUpdate:modelValue":a[1]||(a[1]=o=>e.assetFilter=o),placeholder:"Asset",data:e.equipmentTreeData,multiple:"",filterable:"","check-strictly":"","node-key":"value",props:{children:"children",label:"label"},size:"small",style:{width:"120px"},class:"asset-tree-select","popper-class":"asset-tree-select-popper",teleported:!1,onChange:e.handleAssetFilter},null,8,["modelValue","data"]),l(z,{modelValue:e.categoryFilter,"onUpdate:modelValue":a[2]||(a[2]=o=>e.categoryFilter=o),placeholder:"Category",clearable:"",size:"small",style:{width:"140px"},onChange:e.handleCategoryFilter},{default:n(()=>[(u(!0),_($,null,ee(e.availableCategories,o=>(u(),N(T,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(k,{size:"small",onClick:e.clearAllFilters},{default:n(()=>a[12]||(a[12]=[y(" Clear Filters ")])),_:1,__:[12]})])],512),[[Wt,e.showFilters]])],2),d(" Template Cards "),s("div",ra,[e.loading?(u(),_("div",da,[l(K,{rows:3,animated:""})])):e.displayedTemplates.length===0?(u(),_("div",ca,[l(W,{description:"No tasks found","image-size":80})])):(u(),_("div",ua,[d(" Pagination Info "),s("div",ma,[s("div",pa," Showing "+p(e.paginationInfo.start)+"-"+p(e.paginationInfo.end)+" of "+p(e.paginationInfo.total)+" tasks ",1),l(z,{modelValue:e.pageSize,"onUpdate:modelValue":a[3]||(a[3]=o=>e.pageSize=o),onChange:e.handlePageSizeChange,size:"small",style:{width:"100px"}},{default:n(()=>[l(T,{label:"10",value:10}),l(T,{label:"20",value:20}),l(T,{label:"50",value:50})]),_:1},8,["modelValue"])]),d(" Template Cards List "),s("div",_a,[(u(!0),_($,null,ee(e.displayedTemplates,o=>(u(),N(e.TemplateCard,{key:o.template_id,template:o,"is-selected":e.selectedTemplateId===o.template_id,"is-highlighted":e.highlightedTemplateId===o.template_id,onSelect:e.handleTemplateSelect,onEdit:e.handleTemplateEdit,onDuplicate:e.handleTemplateDuplicate,onDelete:e.handleTemplateDelete},null,8,["template","is-selected","is-highlighted"]))),128))]),d(" Pagination "),s("div",fa,[l(te,{"current-page":e.currentPage,"onUpdate:currentPage":a[4]||(a[4]=o=>e.currentPage=o),"page-size":e.pageSize,"onUpdate:pageSize":a[5]||(a[5]=o=>e.pageSize=o),total:e.pagination.total||0,"page-sizes":[10,20,50],layout:"total, prev, pager, next, jumper",onCurrentChange:e.handlePageChange,onSizeChange:e.handlePageSizeChange},null,8,["current-page","page-size","total"])])]))])]),d(" Right Panel - Template Details/Actions "),s("div",va,[e.templateDetailLoading?(u(),_("div",ga,[l(K,{rows:5,animated:""})])):e.selectedTemplate?(u(),_("div",ba,[d(" Fixed Header Section "),s("div",Ta,[d(" Template Header "),s("div",wa,[s("div",ka,[s("h2",Sa,[y(p(e.selectedTemplate.name)+" ",1),l(A,{type:"info",class:"template-id-header"},{default:n(()=>[e.selectedTemplate.reference_id?(u(),_("span",Ca," #"+p(e.selectedTemplate.reference_id),1)):d("v-if",!0)]),_:1})])]),s("div",Da,[l(k,{type:"primary",size:"default",onClick:e.createNewTemplate,class:"create-button"},{default:n(()=>[l(f,null,{default:n(()=>[l(e.Plus)]),_:1}),a[16]||(a[16]=y(" Create "))]),_:1,__:[16]}),l(ae,{trigger:"click",onCommand:e.handleHeaderAction},{dropdown:n(()=>[l(Y,null,{default:n(()=>[l(j,{command:"edit"},{default:n(()=>[l(f,null,{default:n(()=>[l(e.Edit)]),_:1}),a[17]||(a[17]=y(" Edit "))]),_:1,__:[17]}),l(j,{command:"duplicate"},{default:n(()=>[l(f,null,{default:n(()=>[l(e.DocumentCopy)]),_:1}),a[18]||(a[18]=y(" Duplicate "))]),_:1,__:[18]}),l(j,{command:"delete",divided:"",class:"delete-dropdown-item"},{default:n(()=>[l(f,null,{default:n(()=>[l(e.Delete)]),_:1}),a[19]||(a[19]=y(" Delete "))]),_:1,__:[19]})]),_:1})]),default:n(()=>[l(k,{type:"text",size:"default",class:"action-button"},{default:n(()=>[l(f,{class:"rotated-icon"},{default:n(()=>[l(e.MoreFilled)]),_:1})]),_:1})]),_:1})])]),d(" Tab Navigation "),s("div",xa,[l(M,{modelValue:e.activeTab,"onUpdate:modelValue":a[6]||(a[6]=o=>e.activeTab=o),class:"details-tabs"},{default:n(()=>[l(E,{label:"General",name:"general"}),l(E,{label:"Steps",name:"steps"})]),_:1},8,["modelValue"])])]),d(" Scrollable Content Area "),s("div",qa,[s("div",Va,[d(" General Tab Content "),e.activeTab==="general"?(u(),_("div",Pa,[d(" Template Overview Card "),s("div",Fa,[s("div",za,[l(F,{column:3,direction:"vertical"},{default:n(()=>[l(L,{label:"Category"},{default:n(()=>[y(p(e.getCategoryLabel(e.selectedTemplate.category)),1)]),_:1}),l(L,{label:"Asset/Equipment"},{default:n(()=>{var o;return[y(p(((o=e.selectedTemplate.equipment_node)==null?void 0:o.name)||"No asset specified"),1)]}),_:1}),l(L,{width:"33%",label:"Estimated Time (minutes)"},{default:n(()=>[s("span",Aa,p(e.selectedTemplate.time_estimate_sec?`${Math.ceil(e.selectedTemplate.time_estimate_sec/60)} minutes`:"Not specified"),1)]),_:1}),l(L,{width:"33%",label:"Total Steps"},{default:n(()=>{var o;return[s("span",{class:"info-value highlight clickable-steps",onClick:e.navigateToStepsTab},p(((o=e.selectedTemplate.steps)==null?void 0:o.length)||0)+" steps",1)]}),_:1}),l(L,{label:"Created On"},{default:n(()=>[y(p(e.formatDate(e.selectedTemplate.created_at)),1)]),_:1}),l(L,{label:"Last Modified"},{default:n(()=>[y(p(e.formatDate(e.selectedTemplate.updated_at)),1)]),_:1})]),_:1})])]),d(" Description Section "),e.selectedTemplate.description?(u(),_("div",La,[a[20]||(a[20]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"Description")],-1)),s("div",Ba,[s("div",Ia,p(e.selectedTemplate.description),1)])])):d("v-if",!0),d(" Quick Stats "),s("div",Na,[a[25]||(a[25]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"Quick Statistics")],-1)),s("div",Ea,[l(B,{gutter:24},{default:n(()=>[l(U,{span:6},{default:n(()=>{var o;return[s("div",Ma,[s("div",Ua,p(((o=e.selectedTemplate.steps)==null?void 0:o.length)||8),1),a[21]||(a[21]=s("div",{class:"stat-label"},"Total Failure",-1))])]}),_:1}),l(U,{span:6},{default:n(()=>[s("div",Ha,[s("div",Oa,p(e.selectedTemplate.estimated_minutes||0),1),a[22]||(a[22]=s("div",{class:"stat-label"},"AVG Minutes",-1))])]),_:1}),l(U,{span:6},{default:n(()=>[s("div",Ra,[s("div",Wa,p(e.getRequiredStepsCount()),1),a[23]||(a[23]=s("div",{class:"stat-label"},"Parts Consumed",-1))])]),_:1}),l(U,{span:6},{default:n(()=>[s("div",ja,[s("div",Qa,p(e.getOptionalStepsCount()),1),a[24]||(a[24]=s("div",{class:"stat-label"},"Work Orders",-1))])]),_:1})]),_:1})])])])):d("v-if",!0),d(" Steps Tab Content "),e.activeTab==="steps"?(u(),_("div",Ga,[d(" Step Search Bar "),s("div",Ka,[l(x,{modelValue:e.stepSearchQuery,"onUpdate:modelValue":a[7]||(a[7]=o=>e.stepSearchQuery=o),placeholder:"Search steps by name...",clearable:"",onInput:e.handleStepSearch},{prefix:n(()=>[l(f,null,{default:n(()=>[l(e.Search)]),_:1})]),_:1},8,["modelValue"])]),d(" Desktop-style Procedure Preview (read-only) "),e.filteredPreviewSteps&&e.filteredPreviewSteps.length>0?(u(),_("div",Ya,[s("div",Za,[s("div",Ja,[(u(!0),_($,null,ee(e.filteredPreviewSteps,(o,q)=>(u(),_("div",{key:o.step_id||q,class:"preview-step-simple"},[s("div",Xa,[(u(),N(jt(e.getStepComponent(o.type)),{step:e.getStepWithNumber(o,q),"preview-mode":!0,interactive:!1},null,8,["step"])),d(" Bottom section for required image OR tools (desktop style) "),o.required_image||o.relevant_tools&&o.relevant_tools.length>0?(u(),_("div",$a,[s("div",el,[o.required_image?(u(),N(k,{key:0,type:"info",size:"small",disabled:""},{default:n(()=>[a[26]||(a[26]=s("span",{class:"required-asterisk"},"*",-1)),l(f,null,{default:n(()=>[l(e.Upload)]),_:1}),a[27]||(a[27]=y(" Upload Image "))]),_:1,__:[26,27]})):d("v-if",!0),d(" Show Tools Button "),o.relevant_tools&&o.relevant_tools.length>0?(u(),N(k,{key:1,disabled:"",size:"small",plain:"",onClick:H=>e.toggleStepTools(o.step_id),class:"tools-toggle-btn",style:Ye(o.required_image?"margin-left: 8px;":"")},{default:n(()=>[l(f,null,{default:n(()=>[l(e.Tools)]),_:1}),y(" "+p(e.getStepToolsVisible(o.step_id)?"Hide Tools":"Show Tools")+" ("+p(o.relevant_tools.length)+") ",1)]),_:2},1032,["onClick","style"])):d("v-if",!0)])])):d("v-if",!0),d(" Tools List (toggleable) "),e.getStepToolsVisible(o.step_id)&&o.relevant_tools&&o.relevant_tools.length>0?(u(),_("div",tl,[a[28]||(a[28]=s("div",{class:"tools-list-header"},[s("h4",null,"Required Tools")],-1)),s("div",al,[(u(!0),_($,null,ee(o.relevant_tools,H=>(u(),_("div",{key:H.tool_id||H.id,class:"tool-item"},[l(f,null,{default:n(()=>[l(e.Tools)]),_:1}),s("span",ll,p(H.name||"Unnamed Tool"),1)]))),128))])])):d("v-if",!0)])]))),128))])])])):(u(),_("div",sl,[l(W,{description:e.stepSearchQuery?"No steps match your search":"No steps defined yet","image-size":60},null,8,["description"])]))])):d("v-if",!0),d(" Statistics Tab Content "),e.activeTab==="statistics"?(u(),_("div",ol,[d(" Template Steps Preview "),e.selectedTemplate.steps&&e.selectedTemplate.steps.length>0?(u(),_("div",il,[s("div",nl,[(u(!0),_($,null,ee(e.selectedTemplate.steps,o=>(u(),_("div",{key:o.step_id,class:"step-preview-item"},[s("div",rl,p(o.order),1),s("div",dl,[s("div",cl,p(o.label),1),s("div",ul,p(e.getStepTypeLabel(o.type)),1),o.description?(u(),_("div",ml,p(o.description),1)):d("v-if",!0)]),s("div",pl,[o.required?(u(),N(A,{key:0,type:"danger",size:"small"},{default:n(()=>[...a[29]||(a[29]=[y("Required")])]),_:1,__:[29]})):d("v-if",!0)])]))),128))])])):(u(),_("div",_l,[l(W,{description:"No steps defined yet","image-size":60})]))])):d("v-if",!0)])]),d(" Floating Action Button "),s("div",fl,[l(k,{type:"primary",class:"fab-button",onClick:e.createNewWorkOrder,size:"large"},{default:n(()=>[l(f,{style:{margin:"0px 8px 2px 0px","font-size":"16px"}},{default:n(()=>[l(e.Calendar)]),_:1}),a[30]||(a[30]=y(" Create Work Order from Template "))]),_:1,__:[30]})])])):(u(),_("div",ha,[s("div",ya,[l(f,{class:"no-selection-icon"},{default:n(()=>[l(e.DocumentCopy)]),_:1}),a[14]||(a[14]=s("h3",null,"Select a Task",-1)),a[15]||(a[15]=s("p",null,"Choose a task from the list to view details and actions",-1)),l(k,{type:"primary",onClick:e.createNewTemplate,style:{"margin-top":"8px"}},{default:n(()=>[l(f,null,{default:n(()=>[l(e.Plus)]),_:1}),a[13]||(a[13]=y(" Create a New Task "))]),_:1,__:[13]})])]))]),d(" Delete Confirmation Dialog "),l(Z,{"model-value":e.deleteDialogVisible,"onUpdate:modelValue":a[10]||(a[10]=o=>e.deleteDialogVisible=o),title:"Delete Task",width:"500px","before-close":e.handleDeleteCancel},{footer:n(()=>[s("span",hl,[l(k,{onClick:e.handleDeleteCancel},{default:n(()=>a[32]||(a[32]=[y("Cancel")])),_:1,__:[32]}),l(k,{type:"danger",onClick:e.handleDeleteConfirm,loading:e.deleteLoading,disabled:!e.deleteConfirmationValid},{default:n(()=>a[33]||(a[33]=[y(" Delete ")])),_:1,__:[33]},8,["loading","disabled"])])]),default:n(()=>{var o;return[s("div",vl,[s("p",null,[s("strong",null,'Are you sure you want to delete "'+p((o=e.templateToDelete)==null?void 0:o.name)+'"?',1)]),a[31]||(a[31]=s("p",{style:{color:"#f56c6c","font-size":"14px",margin:"12px 0"}},"This action cannot be undone.",-1)),s("div",gl,[l(x,{modelValue:e.deleteConfirmationText,"onUpdate:modelValue":a[8]||(a[8]=q=>e.deleteConfirmationText=q),placeholder:"Type the exact task name",onInput:e.validateDeleteConfirmation,onKeyup:a[9]||(a[9]=Qt(q=>e.deleteConfirmationValid?e.handleDeleteConfirm():null,["enter"]))},null,8,["modelValue"])])])]}),_:1},8,["model-value"])],4)}const as=tt(aa,[["render",yl],["__scopeId","data-v-871685cc"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/taskLibrary/views/TemplateLibraryView.vue"]]);export{as as default};
