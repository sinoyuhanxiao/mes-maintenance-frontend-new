import"../vue/vue.Dfo81L2Q.js";import{h as X,_ as P}from"../../assets/index-CE-d1vf_.js";import{g as $,M as ee,V as te}from"../@element-plus/@element-plus.BNeHluFm.js";import{c as le}from"../datetime/datetime.39-ZCqKU.js";import{am as d,c as V,o as _,a as n,S as o,L as a,Q as c,R as k,K as D,O as v,F as T,a8 as L,r,w as C,_ as U,q as O,Z as B}from"../@vue/@vue.CVGyaoMH.js";import{e as E,p as H,k as j,l as G,m as z}from"../equipment/equipment.hEuZPeX-.js";import{u as Q}from"../minio/minio.D0rhAIsD.js";import{F as ae}from"../FileUploadMultiple/FileUploadMultiple.BvxDRcEa.js";import{E as K}from"../element-plus/element-plus.CU5xiOkY.js";import oe from"../components/NewWorkOrder.hUXOuTMg.js";import{C as ne}from"../CardTable/CardTable.Bmr_ZA3b.js";import"../pinia/pinia.CzPcBe5J.js";import"../vue-demi/vue-demi.-dVQ4Px2.js";import"../js-cookie/js-cookie.Cz0CWeBA.js";import"../geotiff/geotiff.Dp1pzeXC.js";import"../vue-router/vue-router.30cuaQZO.js";import"../path-to-regexp/path-to-regexp.i8-bKtXe.js";import"../fuse.js/fuse.js.BiDyM4rQ.js";import"../path-browserify/path-browserify.DkEToxTs.js";import"../screenfull/screenfull.DmVOzVZz.js";import"../vue-i18n/vue-i18n.DjO1PVT4.js";import"../@intlify/@intlify.BhOIvmlS.js";import"../mitt/mitt.DJ65BbbF.js";import"../lodash-es/lodash-es.BLHqGvLj.js";import"../@vueuse/@vueuse.B5lT-MN9.js";import"../axios/axios.Dq7h7Pqt.js";import"../nprogress/nprogress._Z8YfKSV.js";/* empty css                                 */import"../clipboard/clipboard.DAe4Lk7l.js";import"../vue3-lottie/vue3-lottie.DS19j_I8.js";import"../lottie-web/lottie-web.fKmgUVyQ.js";import"../@popperjs/@popperjs.D_chPuIy.js";import"../@ctrl/@ctrl.r5W6hzzQ.js";import"../dayjs/dayjs.C0sY0_St.js";import"../async-validator/async-validator.D3FX-SGt.js";import"../memoize-one/memoize-one.BdPwpGay.js";import"../normalize-wheel-es/normalize-wheel-es.BQoi3Ox2.js";import"../@floating-ui/@floating-ui.85_40PfK.js";import"../useWorkOrder/useWorkOrder.9JcLncGa.js";import"../work-order/work-order.DahU_I_M.js";import"../commonData/commonData.B4nBUyAw.js";import"../common/common.CFlva48m.js";import"../useErrorHandler/useErrorHandler.DVUZjmHi.js";import"../MaintenanceWorkOrderCard/MaintenanceWorkOrderCard.CWj1vAV1.js";const Z=(b=1,t=10,q="createdAt",e="DESC",R={})=>(console.log({page:b,size:t,sortField:q,direction:e,search:R}),X.request({method:"post",url:`/maintenance_request/search?page=${b}&size=${t}&sortField=${q}&direction=${e}`,data:R})),J=b=>(console.log(b),X.request({method:"post",url:"/maintenance_request",data:b})),ie={__name:"ViewRequest",props:{data:Object},emits:["create"],setup(b,{expose:t,emit:q}){t();const e=b,R=q,x=r(e.data);C(()=>e.data,y=>{x.value={...y},console.log(x.value)},{immediate:!0,deep:!0});const p={props:e,emit:R,localData:x,ref:r,watch:C,get convertToLocalTime(){return le},get ArrowRight(){return $}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},re={class:"details-layout"},de={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},se={class:"details-panel"},ue={class:"displays"},me={class:"displays"};function _e(b,t,q,e,R,x){const p=d("el-text"),y=d("el-button"),i=d("el-descriptions-item"),f=d("el-descriptions"),g=d("el-breadcrumb-item"),s=d("el-breadcrumb"),u=d("el-card"),h=d("el-image");return _(),V("div",re,[n("div",null,[n("div",de,[o(p,{size:"large",tag:"b"},{default:a(()=>[c("Request: "+k(e.localData.name),1)]),_:1}),o(y,{onClick:t[0]||(t[0]=()=>e.emit("create",e.localData))},{default:a(()=>t[1]||(t[1]=[c("Create Work Order")])),_:1,__:[1]})]),t[2]||(t[2]=n("hr",null,null,-1))]),n("div",se,[o(f,{column:e.localData.work_order_id?3:2,direction:"vertical"},{default:a(()=>[e.localData.work_order_id?(_(),D(i,{key:0,label:"Work Order ID"},{default:a(()=>[c(k(e.localData.work_order_id),1)]),_:1})):v("v-if",!0),o(i,{label:"Created By"},{default:a(()=>[c(k(e.localData.created_by),1)]),_:1}),o(i,{label:"Created At"},{default:a(()=>[c(k(e.convertToLocalTime(e.localData.created_at)),1)]),_:1}),o(i,{label:"Description"},{default:a(()=>[n("span",null,k(e.localData.description),1)]),_:1})]),_:1},8,["column"]),n("div",ue,[o(u,null,{default:a(()=>[o(p,{tag:"b"},{default:a(()=>t[3]||(t[3]=[c("Related Assets")])),_:1,__:[3]}),t[4]||(t[4]=n("hr",null,null,-1)),o(s,{"separator-icon":e.ArrowRight,style:{"padding-top":"10px"}},{default:a(()=>[(_(!0),V(T,null,L(e.localData.equipment_node_tree,l=>(_(),D(g,{key:l.id,label:l.name},{default:a(()=>[c(k(l.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["separator-icon"])]),_:1,__:[4]})]),n("div",me,[o(u,null,{default:a(()=>[o(p,{tag:"b"},{default:a(()=>t[5]||(t[5]=[c("Related Images")])),_:1,__:[5]}),t[7]||(t[7]=n("hr",null,null,-1)),e.localData.image_list?(_(),D(h,{key:0,src:e.localData.image_list,style:{"border-radius":"100%","max-height":"150px","aspect-ratio":"1/0.75"}},null,8,["src"])):v("v-if",!0),e.localData.image_list?v("v-if",!0):(_(),D(p,{key:1},{default:a(()=>t[6]||(t[6]=[c("No Attached Images")])),_:1,__:[6]}))]),_:1,__:[7]})])])])}const pe=P(ie,[["render",_e],["__scopeId","data-v-84162413"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/request/components/ViewRequest.vue"]]),ce={__name:"NewRequest",emits:["submitRequest"],setup(b,{expose:t,emit:q}){t();const e=r(null),R=r(null),x=q,p=r(null),y=r(null),i=r(null),f=r(null);async function g(){const m=await E(1,100,"name","ASC",{node_type_ids:[H]}),S=await E(1,100,"name","ASC",{parent_ids:[u.value.p_id],node_type_ids:[j]}),A=await E(1,100,"name","ASC",{parent_ids:[u.value.eg_id],node_type_ids:[G]}),Y=await E(1,100,"name","ASC",{parent_ids:[u.value.e_id],node_type_ids:[z]});p.value=m.data.content,y.value=S.data.content,i.value=A.data.content,f.value=Y.data.content}g();const s=r({id:null,name:null,description:null,equipment_node_id:null,image_list:null,work_order_id:null}),u=r({p_id:null,eg_id:null,e_id:null,c_id:null}),h=r([]);C(u,m=>{const S=[m.c_id,m.e_id,m.eg_id,m.p_id].find(A=>A!=null);S!=null&&(s.value.equipment_node_id=S)},{deep:!0}),C(u,m=>{g()},{deep:!0});const l=U({name:[{required:!0,message:"Please input Request Title",trigger:"blur"}],description:[{required:!0,message:"Please fill in Description",trigger:"change"}],equipment_node_id:[{required:!0,message:"Please select Production Line"}],equipment_group_id:[{required:!1}],equipment_id:[{required:!1}],component_id:[{required:!1}]}),N=m=>{K({message:"Request Submitted: "+m,type:"success"})},F=m=>{h.value=m,s.value.image_list=m,console.log(m)},I=async()=>{try{let m=[];return s.value.image_list.length>0&&(m=(await Q(s.value.image_list)).data.uploadedFiles||[],console.log(m),s.value.image_list=m.map(A=>A.url),console.log(s.value)),{uploadedImages:m}}catch{throw new Error("File upload failed")}},w=async()=>{e.value&&(await I(),await e.value.validate((m,S)=>{m&&(console.log("request submitted: ",s.value),x("submitRequest",J(s.value)),N(s.value.name),M())}))},M=()=>{e.value&&e.value.resetFields()},W={formRef:e,ruleFormRef:R,emit:x,productionLines:p,equipmentGroups:y,equipment:i,components:f,getNodeData:g,inputData:s,nodeData:u,uploadedImages:h,rules:l,requestSubmitted:N,handleImageListUpdate:F,uploadFilesToServer:I,submitRequest:w,resetForm:M,ref:r,reactive:U,watch:C,get productionLineTypeId(){return H},get equipmentGroupTypeId(){return j},get equipmentTypeId(){return G},get componentTypeId(){return z},get getEquipmentNodes(){return E},get createRequest(){return J},get ElMessage(){return K},get uploadMultipleToMinio(){return Q},FileUploadMultiple:ae};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}},fe={class:"details-layout"},ge={class:"asset-container"};function ve(b,t,q,e,R,x){const p=d("el-text"),y=d("el-input"),i=d("el-form-item"),f=d("el-option"),g=d("el-select"),s=d("el-form"),u=d("el-button"),h=d("el-card");return _(),V(T,null,[o(h,null,{default:a(()=>[n("div",fe,[n("div",null,[o(p,{tag:"b"},{default:a(()=>t[7]||(t[7]=[c("Details")])),_:1,__:[7]}),t[8]||(t[8]=n("hr",null,null,-1))]),o(s,{ref:"formRef",model:e.inputData,rules:e.rules,"label-width":"120px"},{default:a(()=>[o(i,{label:"Request Title",prop:"name"},{default:a(()=>[o(y,{clearable:"",modelValue:e.inputData.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.inputData.name=l),placeholder:"Please Input Title",style:{width:"98%"}},null,8,["modelValue"])]),_:1}),o(i,{label:"Description",prop:"description"},{default:a(()=>[o(y,{modelValue:e.inputData.description,"onUpdate:modelValue":t[1]||(t[1]=l=>e.inputData.description=l),style:{width:"98%"},rows:3,type:"textarea",placeholder:"Please Describe the Issue"},null,8,["modelValue"])]),_:1}),v(" Asset Selections  "),o(p,{tag:"b"},{default:a(()=>t[9]||(t[9]=[c("Asset")])),_:1,__:[9]}),t[11]||(t[11]=n("hr",null,null,-1)),n("div",ge,[o(i,{label:"Related Assets",prop:"equipment_node_id"},{default:a(()=>[o(g,{modelValue:e.nodeData.p_id,"onUpdate:modelValue":t[2]||(t[2]=l=>e.nodeData.p_id=l),style:{width:"100%"},placeholder:"Production Line (Tier 1)"},{default:a(()=>[(_(!0),V(T,null,L(e.productionLines,l=>(_(),D(f,{key:l.id,label:l.name,value:l.id},{default:a(()=>[c(k(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.nodeData.p_id?(_(),D(i,{key:0,prop:"equipment_group_id"},{default:a(()=>[o(g,{modelValue:e.nodeData.eg_id,"onUpdate:modelValue":t[3]||(t[3]=l=>e.nodeData.eg_id=l),style:{width:"100%"},placeholder:"Equipment Group (Tier 2)"},{default:a(()=>[(_(!0),V(T,null,L(e.equipmentGroups,l=>(_(),D(f,{key:l.id,label:l.name,value:l.id},{default:a(()=>[c(k(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("v-if",!0),e.nodeData.eg_id?(_(),D(i,{key:1,prop:"equipment_id"},{default:a(()=>[o(g,{modelValue:e.nodeData.e_id,"onUpdate:modelValue":t[4]||(t[4]=l=>e.nodeData.e_id=l),style:{width:"100%"},placeholder:"Equipment (Tier 3)"},{default:a(()=>[(_(!0),V(T,null,L(e.equipment,l=>(_(),D(f,{key:l.id,label:l.name,value:l.id},{default:a(()=>[c(k(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("v-if",!0),e.nodeData.e_id?(_(),D(i,{key:2,prop:"component_id"},{default:a(()=>[o(g,{modelValue:e.nodeData.c_id,"onUpdate:modelValue":t[5]||(t[5]=l=>e.nodeData.c_id=l),style:{width:"100%"},placeholder:"Component (Tier 4)"},{default:a(()=>[(_(!0),V(T,null,L(e.components,l=>(_(),D(f,{key:l.id,label:l.name,value:l.id},{default:a(()=>[c(k(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("v-if",!0)]),o(p,{tag:"b"},{default:a(()=>t[10]||(t[10]=[c("Upload Image(s)")])),_:1,__:[10]}),t[12]||(t[12]=n("hr",null,null,-1)),o(e.FileUploadMultiple,{"onUpdate:imageList":e.handleImageListUpdate,"upload-type":"images","max-images":5})]),_:1,__:[11,12]},8,["model","rules"])]),v(" Submit Button  "),n("div",{class:"submit-button",onClick:t[6]||(t[6]=l=>e.submitRequest(e.ruleFormRef))},[o(i,null,{default:a(()=>[o(u,{type:"primary"},{default:a(()=>t[13]||(t[13]=[c("Submit Request")])),_:1,__:[13]})]),_:1})])]),_:1}),v(" <h1>{{ inputData }}</h1> ")],2112)}const be=P(ce,[["render",ve],["__scopeId","data-v-9c27071a"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/request/components/NewRequest.vue"]]),ye={__name:"index",setup(b,{expose:t}){t();const q=r([]),e=r(0),R=r(!1),x=r(!1),p=r("682px"),y=r("744px");function i(){p.value=window.innerWidth<=1600?"465px":"682px",y.value=window.innerWidth<=1600?"521px":"737px"}O(()=>{i(),window.addEventListener("resize",i)}),B(()=>{window.removeEventListener("resize",i)});const f=U({page:1,limit:10}),g=r(null),s=r({}),u=r(null);C(()=>u.value,w=>{s.value={keyword:w}});async function h(){const w=await Z(f.page,f.limit,"createdAt","DESC",s.value);q.value=w.data.content,e.value=w.data.totalElements,g.value=q.value[0]}h(),C(()=>s,w=>{h()},{immediate:!0,deep:!0});function l(w){g.value=w}const N=w=>{f.page=w,h()};async function F(w){w&&(R.value=!1),await h()}const I={items:q,totalItems:e,dialogVisible:R,createWo:x,woHeight:p,maxHeight:y,updateHeight:i,listQuery:f,selectedData:g,search:s,keyword:u,getAllRequestsData:h,handleRequestData:l,handleCurrentChange:N,handleSubmission:F,ref:r,onMounted:O,onBeforeUnmount:B,reactive:U,watch:C,get searchMaintenanceRequests(){return Z},get EditPen(){return te},get Search(){return ee},ViewRequest:pe,NewRequest:be,NewWorkOrder:oe,CardTable:ne};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}},qe={class:"page-layout"},we={class:"header-title"},De={class:"left-header"},Re={class:"outer-dashboard"},he={class:"dashboard-body"},xe={class:"left-container"},ke={class:"left-table"},Ve={class:"right-container"};function Ce(b,t,q,e,R,x){const p=d("el-input"),y=d("Filter"),i=d("el-icon"),f=d("el-button"),g=d("el-dialog"),s=d("el-card");return _(),V("div",qe,[n("div",we,[n("div",De,[o(p,{modelValue:e.keyword,"onUpdate:modelValue":t[0]||(t[0]=u=>e.keyword=u),placeholder:"Search Request",style:{width:"240px"},size:"small","prefix-icon":e.Search,clearable:""},null,8,["modelValue","prefix-icon"]),o(i,{style:{cursor:"pointer"},title:"Filter"},{default:a(()=>[o(y)]),_:1})]),o(f,{class:"filter-item",type:"primary",icon:e.EditPen,onClick:t[1]||(t[1]=u=>e.dialogVisible=!0),"aria-label":b.$t("requests.createRequest")},{default:a(()=>[c(k(b.$t("requests.createRequest")),1)]),_:1},8,["icon","aria-label"])]),n("div",Re,[n("div",he,[o(g,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=u=>e.dialogVisible=u),title:"New Request",width:"800"},{default:a(()=>[o(e.NewRequest,{onSubmitRequest:e.handleSubmission})]),_:1},8,["modelValue"]),n("div",xe,[v(" <el-card> "),v(' <el-text tag="b">Active Requests</el-text> '),n("div",ke,[o(e.CardTable,{onSelection:e.handleRequestData,data:e.items,module:2,maxHeight:e.maxHeight,totalItems:e.totalItems,handleCurrentChange:e.handleCurrentChange,currentPage:e.listQuery.page},null,8,["data","maxHeight","totalItems","currentPage"])]),v(" </el-card> ")]),n("div",Ve,[o(s,{style:{flex:"1"}},{default:a(()=>[e.createWo?v("v-if",!0):(_(),D(e.ViewRequest,{key:0,data:e.selectedData,"onUpdate:data":t[3]||(t[3]=u=>e.selectedData=u),onCreate:t[4]||(t[4]=()=>e.createWo=!0)},null,8,["data"])),v(" Maybe just route to NewWorkOrder  "),e.createWo?(_(),D(e.NewWorkOrder,{key:1,requestData:e.selectedData,height:e.woHeight,onCancel:t[5]||(t[5]=()=>e.createWo=!1)},null,8,["requestData","height"])):v("v-if",!0)]),_:1})])])])])}const yt=P(ye,[["render",Ce],["__scopeId","data-v-33069e14"],["__file","/home/erikyu/dev/mes-maintenance-frontend/src/views/request/index.vue"]]);export{yt as default};
